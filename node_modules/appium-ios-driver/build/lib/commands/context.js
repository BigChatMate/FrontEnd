"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.WEBVIEW_BASE = exports.WEBVIEW_WIN = exports.NATIVE_WIN = exports.helpers = exports.commands = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncbox = require("asyncbox");

var _appiumRemoteDebugger = require("appium-remote-debugger");

var _iosPerformanceLog = _interopRequireDefault(require("../device-log/ios-performance-log"));

var _appiumBaseDriver = require("appium-base-driver");

var _logger = _interopRequireDefault(require("../logger"));

var _appiumSupport = require("appium-support");

const NATIVE_WIN = 'NATIVE_APP';
exports.NATIVE_WIN = NATIVE_WIN;
const WEBVIEW_WIN = 'WEBVIEW';
exports.WEBVIEW_WIN = WEBVIEW_WIN;
const WEBVIEW_BASE = `${WEBVIEW_WIN}_`;
exports.WEBVIEW_BASE = WEBVIEW_BASE;
let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;
commands.getCurrentContext = (0, _asyncToGenerator2.default)(function* () {
  if (this.curContext && this.curContext !== NATIVE_WIN) {
    return `${WEBVIEW_BASE}${this.curContext}`;
  } else {
    return NATIVE_WIN;
  }
});
commands.getContexts = (0, _asyncToGenerator2.default)(function* () {
  _logger.default.debug('Getting list of available contexts');

  let contexts = yield this.getContextsAndViews(false);

  let mapFn = context => context.id.toString();

  if (this.opts.fullContextList) {
    mapFn = context => {
      return {
        id: context.id.toString(),
        title: context.view.title,
        url: context.view.url
      };
    };
  }

  return contexts.map(mapFn);
});

commands.setContext = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (name, callback, skipReadyCheck) {
    function alreadyInContext(desired, current) {
      return desired === current || desired === null && current === NATIVE_WIN || desired === NATIVE_WIN && current === null;
    }

    _logger.default.debug(`Attempting to set context to '${name}'`);

    if (alreadyInContext(name, this.curContext)) {} else if (name === NATIVE_WIN || name === null) {
      this.curContext = null;

      if (this.isRealDevice()) {
        this.remote.disconnect();
      }
    } else {
      if (_lodash.default.isUndefined(this.contexts)) {
        yield this.getContexts();
      }

      let contextId = name.replace(WEBVIEW_BASE, '');

      if (contextId === '') {
        contextId = this.contexts[1];
      }

      if (!_lodash.default.includes(this.contexts, contextId)) {
        throw new _appiumBaseDriver.errors.NoSuchContextError();
      }

      if (this.isRealDevice()) {
        if (this.remote) {
          yield this.remote.disconnect();
        }

        this.curContext = contextId;
        yield this.remote.connect(contextId);
      } else {
        let _$map = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10)),
            _$map2 = (0, _slicedToArray2.default)(_$map, 2),
            appIdKey = _$map2[0],
            pageIdKey = _$map2[1];

        yield this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
        this.curContext = contextId;
      }
    }

    if (this.opts.enablePerformanceLogging && this.remote) {
      _logger.default.debug(`Starting performance log on '${this.curContext}'`);

      this.logs.performance = new _iosPerformanceLog.default(this.remote);
      yield this.logs.performance.startCapture();
    }
  });

  return function (_x, _x2, _x3) {
    return _ref3.apply(this, arguments);
  };
}();

commands.getWindowHandle = (0, _asyncToGenerator2.default)(function* () {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  return this.curContext.toString();
});
commands.getWindowHandles = (0, _asyncToGenerator2.default)(function* () {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  this.windowHandleCache = yield this.listWebFrames(false);

  const idArray = _lodash.default.map(this.windowHandleCache, 'id');

  if (!this.contexts) {
    this.contexts = idArray;
  }

  return _lodash.default.map(idArray, id => id.toString());
});

commands.setWindow = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (name, skipReadyCheck) {
    if (!this.isWebContext()) {
      throw new _appiumBaseDriver.errors.NotImplementedError();
    }

    if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
      throw new _appiumBaseDriver.errors.NoSuchWindowError();
    }

    let pageIdKey = parseInt(name, 10);

    if (!this.isRealDevice()) {
      yield this.remote.selectPage(pageIdKey, skipReadyCheck);
      this.curContext = this.curWindowHandle = name;
    } else {
      if (name === this.curWindowHandle) {
        _logger.default.debug(`Remote debugger is already connected to window '${name}'`);
      } else if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
        throw new _appiumBaseDriver.errors.NoSuchWindowError();
      } else {
        yield this.remote.disconnect();
        this.curContext = this.curWindowHandle = name;
        yield this.remote.connect(name);
      }
    }
  });

  return function (_x4, _x5) {
    return _ref6.apply(this, arguments);
  };
}();

helpers.webContextIndex = function () {
  return this.curContext.replace(WEBVIEW_BASE, '') - 1;
};

extensions.initAutoWebview = (0, _asyncToGenerator2.default)(function* () {
  if (this.opts.autoWebview) {
    _logger.default.debug('Setting auto webview');

    yield this.navToInitialWebview(this);
  }
});

extensions.getContextsAndViews = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (useUrl = true) {
    _logger.default.debug('Retrieving contexts and views');

    let webviews = yield this.listWebFrames(useUrl);
    let ctxs = [{
      id: NATIVE_WIN,
      view: {}
    }];
    this.contexts = [NATIVE_WIN];
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = webviews[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        let view = _step.value;
        ctxs.push({
          id: `${WEBVIEW_BASE}${view.id}`,
          view
        });
        this.contexts.push(view.id.toString());
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    return ctxs;
  });

  return function () {
    return _ref8.apply(this, arguments);
  };
}();

extensions.getNewRemoteDebugger = (0, _asyncToGenerator2.default)(function* () {
  return new _appiumRemoteDebugger.RemoteDebugger({
    bundleId: this.opts.bundleId,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: _appiumSupport.util.hasValue(this.opts.safariGarbageCollect) ? !!this.opts.safariGarbageCollect : true
  });
});

extensions.listWebFrames = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (useUrl = true) {
    var _this = this;

    if (!this.opts.bundleId) {
      _logger.default.errorAndThrow('Cannot enter web frame without a bundle ID');
    }

    useUrl = useUrl && !!this.getCurrentUrl();

    _logger.default.debug(`Selecting by url: ${useUrl} ${useUrl ? `(expected url: '${this.getCurrentUrl()}')` : ''}`);

    let currentUrl = useUrl ? this.getCurrentUrl() : undefined;
    let pageArray;

    if (this.isRealDevice() && this.remote && this.opts.bundleId) {
      pageArray = yield this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
    } else if (this.remote && this.remote.appIdKey) {
      pageArray = yield this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    } else if (this.isRealDevice()) {
      try {
        this.remote = new _appiumRemoteDebugger.WebKitRemoteDebugger({
          port: this.opts.webkitDebugProxyPort,
          webkitResponseTimeout: this.opts.webkitResponseTimeout
        });
        pageArray = yield this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
      } catch (err) {
        if (!_lodash.default.includes(err.message, 'connect ECONNREFUSED')) throw err;

        _logger.default.warn('Attempted to get a list of webview contexts but could not connect to ' + 'ios-webkit-debug-proxy. If you expect to find webviews, please ensure ' + 'that the proxy is running and accessible');

        this.remote = null;
        pageArray = [];
      }
    } else {
      this.remote = yield this.getNewRemoteDebugger();
      let appInfo = yield this.remote.connect();

      if (!appInfo) {
        _logger.default.debug('Unable to connect to the remote debugger.');

        return [];
      }

      pageArray = yield this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
      this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
      this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
        if (!_lodash.default.isEmpty(this.curWebFrames)) {
          _logger.default.debug(`Clearing ${this.curWebFrames.length} frames: ${this.curWebFrames.join(', ')}`);
        }

        this.curWebFrames = [];
      });

      let tryClosingAlert = function () {
        var _ref11 = (0, _asyncToGenerator2.default)(function* () {
          let didDismiss = yield _this.closeAlertBeforeTest();

          if (!didDismiss) {
            throw new Error('Close alert failed. Retry.');
          }
        });

        return function tryClosingAlert() {
          return _ref11.apply(this, arguments);
        };
      }();

      try {
        yield (0, _asyncbox.retryInterval)(3, 4000, tryClosingAlert);
      } catch (err) {
        if (err.message !== 'Close alert failed. Retry.') {
          _logger.default.errorAndThrow(err);
        }
      }
    }

    if (pageArray.length === 0) {
      _logger.default.debug('No web frames found.');
    }

    return pageArray;
  });

  return function () {
    return _ref10.apply(this, arguments);
  };
}();

extensions.onPageChange = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (pageChangeNotification) {
    _logger.default.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);

    if (this.selectingNewPage) {
      _logger.default.debug('We are in the middle of selecting a page, ignoring');

      return;
    }

    if (!this.remote || !this.remote.isConnected()) {
      _logger.default.debug('We have not yet connected, ignoring');

      return;
    }

    const appIdKey = pageChangeNotification.appIdKey,
          pageArray = pageChangeNotification.pageArray;
    let newIds = [];
    let newPages = [];
    let keyId = null;
    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = pageArray[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        const page = _step2.value;
        const id = page.id.toString();
        newIds.push(id);

        if (page.isKey) {
          keyId = id;
        }

        const contextId = `${appIdKey}.${id}`;

        if (!_lodash.default.includes(this.contexts, contextId)) {
          newPages.push(id);
          this.contexts.push(contextId);
        }
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }

    if (!keyId) {
      _logger.default.debug('No key id found. Choosing first id from page array');

      keyId = newIds[0] || null;
    }

    if (!_appiumSupport.util.hasValue(this.curContext)) {
      _logger.default.debug('We do not appear to have window set yet, ignoring');

      return;
    }

    const _this$curContext$spli = this.curContext.split('.'),
          _this$curContext$spli2 = (0, _slicedToArray2.default)(_this$curContext$spli, 2),
          curAppIdKey = _this$curContext$spli2[0],
          curPageIdKey = _this$curContext$spli2[1];

    if (curAppIdKey !== appIdKey) {
      _logger.default.debug('Page change not referring to currently selected app, ignoring.');

      return;
    }

    let newPage = null;

    if (newPages.length) {
      newPage = _lodash.default.last(newPages);

      _logger.default.debug(`We have new pages, selecting page '${newPage}'`);
    } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
      _logger.default.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');

      if (!_appiumSupport.util.hasValue(keyId)) {
        _logger.default.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');

        this.setCurrentUrl(undefined);
        return;
      }

      _logger.default.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);

      this.curContext = `${appIdKey}.${keyId}`;
      newPage = keyId;
    } else {
      _logger.default.debug('Checking if page needs to load');

      const needsPageLoad = (() => {
        const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);

        return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
      })();

      if (needsPageLoad) {
        _logger.default.debug('Page load needed. Loading...');

        yield this.remote.pageLoad();
      }

      _logger.default.debug('New page listing is same as old, doing nothing');
    }

    if (_appiumSupport.util.hasValue(this.curContext)) {
      let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);

      let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);

      if (page && page.url !== this.getCurrentUrl()) {
        _logger.default.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);

        this.setCurrentUrl(page.url);
      }
    }

    if (_appiumSupport.util.hasValue(newPage)) {
      this.selectingNewPage = true;
      yield this.remote.selectPage(appIdKey, parseInt(newPage, 10));
      this.selectingNewPage = false;
      this.curContext = `${appIdKey}.${newPage}`;
    }

    this.windowHandleCache = pageArray;
  });

  return function (_x6) {
    return _ref12.apply(this, arguments);
  };
}();

extensions.getLatestWebviewContextForTitle = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (regExp) {
    let contexts = yield this.getContextsAndViews();
    let matchingCtx;
    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = contexts[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        let ctx = _step3.value;

        if (ctx.view && (ctx.view.title && ctx.view.title.match(regExp) || ctx.view.url && ctx.view.url.match(regExp))) {
          if (ctx.view.url !== 'about:blank') {
            matchingCtx = ctx;
          } else {
            if (parseFloat(this.iosSdkVersion) < 7 || parseFloat(this.iosSdkVersion) >= 9 || this.opts.platformVersion === '7.1' && this.opts.app && this.opts.app.toLowerCase() !== 'safari') {
              matchingCtx = ctx;
            }
          }

          break;
        }
      }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }

    return matchingCtx ? matchingCtx.id : undefined;
  });

  return function (_x7) {
    return _ref13.apply(this, arguments);
  };
}();

extensions.useNewSafari = function () {
  return parseFloat(this.iosSdkVersion) >= 8.1 && parseFloat(this.opts.platformVersion) >= 8.1 && !this.isRealDevice() && this.opts.safari;
};

extensions.navToInitialWebview = (0, _asyncToGenerator2.default)(function* () {
  let timeout = 0;

  if (this.isRealDevice()) {
    timeout = 3000;

    _logger.default.debug(`Waiting for ${timeout} ms before navigating to view.`);
  }

  yield _bluebird.default.delay(timeout);

  if (this.useNewSafari()) {
    yield this.typeAndNavToUrl();
  } else if (parseInt(this.iosSdkVersion, 10) >= 7 && !this.isRealDevice() && this.opts.safari) {
    yield this.navToViewThroughFavorites();
  } else {
    yield this.navToViewWithTitle(/.*/);
  }
});

function openNewPage() {
  return _openNewPage.apply(this, arguments);
}

function _openNewPage() {
  _openNewPage = (0, _asyncToGenerator2.default)(function* () {
    let newPageButton = yield this.findElement('xpath', "//UIAButton[contains(@name,'New page')]");
    yield this.nativeTap(newPageButton.ELEMENT);
  });
  return _openNewPage.apply(this, arguments);
}

extensions.typeAndNavToUrl = (0, _asyncToGenerator2.default)(function* () {
  var _this2 = this;

  let address = this.opts.address ? this.opts.address : '127.0.0.1';
  this.setCurrentUrl(this.caps.safariInitialUrl || `http://${address}:${this.opts.port}/welcome`);
  let tries = 0;
  const MAX_TRIES = 2;

  let navigate = function () {
    var _ref16 = (0, _asyncToGenerator2.default)(function* () {
      let oldImpWait = _this2.implicitWaitMs;
      _this2.implicitWaitMs = 7000;
      let el = yield (0, _asyncbox.retryInterval)(3, 1000, (0, _asyncToGenerator2.default)(function* () {
        return yield _this2.findElement('accessibility id', 'URL');
      }));
      _this2.implicitWaitMs = oldImpWait;

      try {
        yield _this2.nativeTap(el.ELEMENT);
      } catch (err) {
        if (_lodash.default.includes(err.message, 'could not be tapped')) {
          if (tries++ >= MAX_TRIES) throw err;
          yield openNewPage();
          return yield navigate();
        } else {
          throw err;
        }
      }

      try {
        let el = yield _this2.findElement('class name', 'UIATextField');
        yield _this2.setValueImmediate(_this2.getCurrentUrl(), el);
      } catch (err) {
        if (tries++ >= MAX_TRIES) throw err;
        return yield navigate();
      }

      try {
        el = yield _this2.findElement('accessibility id', 'Go');
        yield _this2.nativeTap(el.ELEMENT);
      } catch (err) {
        if (_lodash.default.includes(err.message, 'could not be tapped')) {
          _logger.default.error('Unable to submit URL because \'Go\' button could not be tapped. ' + 'Please make sure your keyboard is toggled on.');
        }

        throw err;
      }

      yield _this2.navToViewWithTitle(undefined, new RegExp(_this2.getCurrentUrl(), 'i'));
      yield _this2.remote.pageUnload();
    });

    return function navigate() {
      return _ref16.apply(this, arguments);
    };
  }();

  yield navigate();
});
extensions.navToViewThroughFavorites = (0, _asyncToGenerator2.default)(function* () {
  _logger.default.debug('We are on iOS7+ simulator: clicking apple button to get into a webview');

  let oldImpWait = this.implicitWaitMs;
  this.implicitWaitMs = 7000;
  let el;

  try {
    el = yield this.findElement('xpath', '//UIAScrollView[1]/UIAButton[1]');
  } catch (err) {
    let msg = 'Could not find button to click to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);

    this.implicitWaitMs = oldImpWait;
    return yield this.navToViewWithTitle(/.*/i);
  }

  this.implicitWaitMs = oldImpWait;

  try {
    yield this.nativeTap(el.ELEMENT);
  } catch (err) {
    let msg = 'Could not click button to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);
  }

  yield this.navToViewWithTitle(/apple/i);
});

extensions.navToViewWithTitle = function () {
  var _ref19 = (0, _asyncToGenerator2.default)(function* (titleRegex, urlRegExp) {
    var _this3 = this;

    _logger.default.debug('Navigating to most recently opened webview');

    let start = Date.now();
    let spinTime = 500;

    let spinHandles = function () {
      var _ref20 = (0, _asyncToGenerator2.default)(function* () {
        let res;

        try {
          res = yield _this3.getLatestWebviewContextForTitle(titleRegex || urlRegExp);
        } catch (err) {
          if (err.message.indexOf('Could not connect to a valid app after') === -1) {
            throw new Error(`Could not navigate to webview! Err: ${err.message}`);
          }

          _logger.default.debug('Could not navigate to webview. Retrying if possible.');
        }

        if (res) {
          let latestWindow = res;

          _logger.default.debug(`Picking webview '${latestWindow}'`);

          yield _this3.setContext(latestWindow);
          yield _this3.remote.cancelPageLoad();
          return;
        }

        if (Date.now() - start >= 90000) {
          throw new Error('Could not navigate to webview; there are none!');
        }

        _logger.default.warn("Could not find any webviews yet, refreshing/retrying");

        if (_this3.isRealDevice() || !_this3.opts.safari) {
          yield _bluebird.default.delay(spinTime);
          return yield spinHandles();
        }

        let element;

        try {
          _logger.default.debug('Finding and tapping reload button');

          element = yield _this3.findUIElementOrElements('accessibility id', 'ReloadButton', '', false);
          yield _this3.nativeTap(element.ELEMENT);
        } catch (err) {
          _logger.default.warn(`Error finding and tapping reload button: ${err.message}`);

          _logger.default.warn('Retrying.');

          yield _bluebird.default.delay(spinTime);
        }

        return yield spinHandles();
      });

      return function spinHandles() {
        return _ref20.apply(this, arguments);
      };
    }();

    yield spinHandles();
  });

  return function (_x8, _x9) {
    return _ref19.apply(this, arguments);
  };
}();

helpers.closeAlertBeforeTest = (0, _asyncToGenerator2.default)(function* () {
  let present = yield this.uiAutoClient.sendCommand('au.alertIsPresent()');

  if (!present) {
    return false;
  }

  _logger.default.debug('Alert present before starting test, let us banish it');

  yield this.uiAutoClient.sendCommand('au.dismissAlert()');

  _logger.default.debug('Alert banished!');

  return true;
});

helpers.stopRemote = function () {
  var _ref22 = (0, _asyncToGenerator2.default)(function* (closeWindowBeforeDisconnecting = false) {
    if (!this.remote) {
      _logger.default.errorAndThrow('Tried to leave a web frame but were not in one');
    }

    if (closeWindowBeforeDisconnecting) {
      yield this.closeWindow();
    }

    yield this.remote.disconnect();
    this.curContext = null;
    this.curWebFrames = [];
    this.curWebCoords = null;
    this.remote = null;
  });

  return function () {
    return _ref22.apply(this, arguments);
  };
}();

helpers.isWebContext = function () {
  return !!this.curContext && this.curContext !== NATIVE_WIN;
};

helpers.setCurrentUrl = function (url) {
  this._currentUrl = url;
};

helpers.getCurrentUrl = function () {
  return this._currentUrl;
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIl0sIm5hbWVzIjpbIk5BVElWRV9XSU4iLCJXRUJWSUVXX1dJTiIsIldFQlZJRVdfQkFTRSIsImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDdXJyZW50Q29udGV4dCIsImN1ckNvbnRleHQiLCJnZXRDb250ZXh0cyIsImxvZ2dlciIsImRlYnVnIiwiY29udGV4dHMiLCJnZXRDb250ZXh0c0FuZFZpZXdzIiwibWFwRm4iLCJjb250ZXh0IiwiaWQiLCJ0b1N0cmluZyIsIm9wdHMiLCJmdWxsQ29udGV4dExpc3QiLCJ0aXRsZSIsInZpZXciLCJ1cmwiLCJtYXAiLCJzZXRDb250ZXh0IiwibmFtZSIsImNhbGxiYWNrIiwic2tpcFJlYWR5Q2hlY2siLCJhbHJlYWR5SW5Db250ZXh0IiwiZGVzaXJlZCIsImN1cnJlbnQiLCJpc1JlYWxEZXZpY2UiLCJyZW1vdGUiLCJkaXNjb25uZWN0IiwiXyIsImlzVW5kZWZpbmVkIiwiY29udGV4dElkIiwicmVwbGFjZSIsImluY2x1ZGVzIiwiZXJyb3JzIiwiTm9TdWNoQ29udGV4dEVycm9yIiwiY29ubmVjdCIsInNwbGl0IiwicGFyc2VJbnQiLCJhcHBJZEtleSIsInBhZ2VJZEtleSIsInNlbGVjdFBhZ2UiLCJlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmciLCJsb2dzIiwicGVyZm9ybWFuY2UiLCJJT1NQZXJmb3JtYW5jZUxvZyIsInN0YXJ0Q2FwdHVyZSIsImdldFdpbmRvd0hhbmRsZSIsImlzV2ViQ29udGV4dCIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJnZXRXaW5kb3dIYW5kbGVzIiwid2luZG93SGFuZGxlQ2FjaGUiLCJsaXN0V2ViRnJhbWVzIiwiaWRBcnJheSIsInNldFdpbmRvdyIsIk5vU3VjaFdpbmRvd0Vycm9yIiwiY3VyV2luZG93SGFuZGxlIiwid2ViQ29udGV4dEluZGV4IiwiaW5pdEF1dG9XZWJ2aWV3IiwiYXV0b1dlYnZpZXciLCJuYXZUb0luaXRpYWxXZWJ2aWV3IiwidXNlVXJsIiwid2Vidmlld3MiLCJjdHhzIiwicHVzaCIsImdldE5ld1JlbW90ZURlYnVnZ2VyIiwiUmVtb3RlRGVidWdnZXIiLCJidW5kbGVJZCIsInVzZU5ld1NhZmFyaSIsInBhZ2VMb2FkTXMiLCJwbGF0Zm9ybVZlcnNpb24iLCJyZW1vdGVEZWJ1Z1Byb3h5IiwiZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUiLCJ1dGlsIiwiaGFzVmFsdWUiLCJzYWZhcmlHYXJiYWdlQ29sbGVjdCIsImVycm9yQW5kVGhyb3ciLCJnZXRDdXJyZW50VXJsIiwiY3VycmVudFVybCIsInVuZGVmaW5lZCIsInBhZ2VBcnJheSIsInBhZ2VBcnJheUZyb21Kc29uIiwiaWdub3JlQWJvdXRCbGFua1VybCIsInNlbGVjdEFwcCIsIndlYnZpZXdDb25uZWN0UmV0cmllcyIsIldlYktpdFJlbW90ZURlYnVnZ2VyIiwicG9ydCIsIndlYmtpdERlYnVnUHJveHlQb3J0Iiwid2Via2l0UmVzcG9uc2VUaW1lb3V0IiwiZXJyIiwibWVzc2FnZSIsIndhcm4iLCJhcHBJbmZvIiwib24iLCJFVkVOVF9QQUdFX0NIQU5HRSIsIm9uUGFnZUNoYW5nZSIsImJpbmQiLCJFVkVOVF9GUkFNRVNfREVUQUNIRUQiLCJpc0VtcHR5IiwiY3VyV2ViRnJhbWVzIiwibGVuZ3RoIiwiam9pbiIsInRyeUNsb3NpbmdBbGVydCIsImRpZERpc21pc3MiLCJjbG9zZUFsZXJ0QmVmb3JlVGVzdCIsIkVycm9yIiwicGFnZUNoYW5nZU5vdGlmaWNhdGlvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZWxlY3RpbmdOZXdQYWdlIiwiaXNDb25uZWN0ZWQiLCJuZXdJZHMiLCJuZXdQYWdlcyIsImtleUlkIiwicGFnZSIsImlzS2V5IiwiY3VyQXBwSWRLZXkiLCJjdXJQYWdlSWRLZXkiLCJuZXdQYWdlIiwibGFzdCIsImVycm9yIiwic2V0Q3VycmVudFVybCIsIm5lZWRzUGFnZUxvYWQiLCJjb250ZXh0QXJyYXkiLCJpc0VxdWFsIiwiZmluZCIsInBhZ2VMb2FkIiwiY3VycmVudFBhZ2VJZCIsInAiLCJnZXRMYXRlc3RXZWJ2aWV3Q29udGV4dEZvclRpdGxlIiwicmVnRXhwIiwibWF0Y2hpbmdDdHgiLCJjdHgiLCJtYXRjaCIsInBhcnNlRmxvYXQiLCJpb3NTZGtWZXJzaW9uIiwiYXBwIiwidG9Mb3dlckNhc2UiLCJzYWZhcmkiLCJ0aW1lb3V0IiwiQiIsImRlbGF5IiwidHlwZUFuZE5hdlRvVXJsIiwibmF2VG9WaWV3VGhyb3VnaEZhdm9yaXRlcyIsIm5hdlRvVmlld1dpdGhUaXRsZSIsIm9wZW5OZXdQYWdlIiwibmV3UGFnZUJ1dHRvbiIsImZpbmRFbGVtZW50IiwibmF0aXZlVGFwIiwiRUxFTUVOVCIsImFkZHJlc3MiLCJjYXBzIiwic2FmYXJpSW5pdGlhbFVybCIsInRyaWVzIiwiTUFYX1RSSUVTIiwibmF2aWdhdGUiLCJvbGRJbXBXYWl0IiwiaW1wbGljaXRXYWl0TXMiLCJlbCIsInNldFZhbHVlSW1tZWRpYXRlIiwiUmVnRXhwIiwicGFnZVVubG9hZCIsIm1zZyIsInRpdGxlUmVnZXgiLCJ1cmxSZWdFeHAiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJzcGluVGltZSIsInNwaW5IYW5kbGVzIiwicmVzIiwiaW5kZXhPZiIsImxhdGVzdFdpbmRvdyIsImNhbmNlbFBhZ2VMb2FkIiwiZWxlbWVudCIsImZpbmRVSUVsZW1lbnRPckVsZW1lbnRzIiwicHJlc2VudCIsInVpQXV0b0NsaWVudCIsInNlbmRDb21tYW5kIiwic3RvcFJlbW90ZSIsImNsb3NlV2luZG93QmVmb3JlRGlzY29ubmVjdGluZyIsImNsb3NlV2luZG93IiwiY3VyV2ViQ29vcmRzIiwiX2N1cnJlbnRVcmwiLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxVQUFVLEdBQUcsWUFBbkI7O0FBQ0EsTUFBTUMsV0FBVyxHQUFHLFNBQXBCOztBQUNB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QSxTQUFPLElBQVA7QUFDRCxDQVZEOztBQVlBTixPQUFPLENBQUNtTCxVQUFSO0FBQUEsK0NBQXFCLFdBQWdCQyw4QkFBOEIsR0FBRyxLQUFqRCxFQUF3RDtBQUMzRSxRQUFJLENBQUMsS0FBS3pKLE1BQVYsRUFBa0I7QUFDaEJ0QixzQkFBT3VFLGFBQVAsQ0FBcUIsZ0RBQXJCO0FBQ0Q7O0FBRUQsUUFBSXdHLDhCQUFKLEVBQW9DO0FBQ2xDLFlBQU0sS0FBS0MsV0FBTCxFQUFOO0FBQ0Q7O0FBQ0QsVUFBTSxLQUFLMUosTUFBTCxDQUFZQyxVQUFaLEVBQU47QUFDQSxTQUFLekIsVUFBTCxHQUFrQixJQUFsQjtBQUNBLFNBQUtnRyxZQUFMLEdBQW9CLEVBQXBCO0FBQ0EsU0FBS21GLFlBQUwsR0FBb0IsSUFBcEI7QUFDQSxTQUFLM0osTUFBTCxHQUFjLElBQWQ7QUFDRCxHQWJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWVBM0IsT0FBTyxDQUFDZ0QsWUFBUixHQUF1QixZQUFZO0FBQ2pDLFNBQU8sQ0FBQyxDQUFDLEtBQUs3QyxVQUFQLElBQXFCLEtBQUtBLFVBQUwsS0FBb0JQLFVBQWhEO0FBQ0QsQ0FGRDs7QUFJQUksT0FBTyxDQUFDeUgsYUFBUixHQUF3QixVQUFVeEcsR0FBVixFQUFlO0FBQ3JDLE9BQUtzSyxXQUFMLEdBQW1CdEssR0FBbkI7QUFDRCxDQUZEOztBQUlBakIsT0FBTyxDQUFDNkUsYUFBUixHQUF3QixZQUFZO0FBQ2xDLFNBQU8sS0FBSzBHLFdBQVo7QUFDRCxDQUZEOztBQUtBQyxNQUFNLENBQUNDLE1BQVAsQ0FBY3hMLFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBSZW1vdGVEZWJ1Z2dlciwgV2ViS2l0UmVtb3RlRGVidWdnZXIgfSBmcm9tICdhcHBpdW0tcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCBJT1NQZXJmb3JtYW5jZUxvZyBmcm9tICcuLi9kZXZpY2UtbG9nL2lvcy1wZXJmb3JtYW5jZS1sb2cnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cblxuY29uc3QgTkFUSVZFX1dJTiA9ICdOQVRJVkVfQVBQJztcbmNvbnN0IFdFQlZJRVdfV0lOID0gJ1dFQlZJRVcnO1xuY29uc3QgV0VCVklFV19CQVNFID0gYCR7V0VCVklFV19XSU59X2A7XG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudENvbnRleHQgPSBhc3luYyBmdW5jdGlvbiAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICBpZiAodGhpcy5jdXJDb250ZXh0ICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gTkFUSVZFX1dJTikge1xuICAgIHJldHVybiBgJHtXRUJWSUVXX0JBU0V9JHt0aGlzLmN1ckNvbnRleHR9YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gTkFUSVZFX1dJTjtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0Q29udGV4dHMgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxvZ2dlci5kZWJ1ZygnR2V0dGluZyBsaXN0IG9mIGF2YWlsYWJsZSBjb250ZXh0cycpO1xuICBsZXQgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoZmFsc2UpO1xuXG4gIGxldCBtYXBGbiA9IChjb250ZXh0KSA9PiBjb250ZXh0LmlkLnRvU3RyaW5nKCk7XG4gIGlmICh0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0KSB7XG4gICAgbWFwRm4gPSAoY29udGV4dCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGNvbnRleHQuaWQudG9TdHJpbmcoKSxcbiAgICAgICAgdGl0bGU6IGNvbnRleHQudmlldy50aXRsZSxcbiAgICAgICAgdXJsOiBjb250ZXh0LnZpZXcudXJsLFxuICAgICAgfTtcbiAgICB9O1xuICB9XG4gIHJldHVybiBjb250ZXh0cy5tYXAobWFwRm4pO1xufTtcblxuY29tbWFuZHMuc2V0Q29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIChuYW1lLCBjYWxsYmFjaywgc2tpcFJlYWR5Q2hlY2spIHtcbiAgZnVuY3Rpb24gYWxyZWFkeUluQ29udGV4dCAoZGVzaXJlZCwgY3VycmVudCkge1xuICAgIHJldHVybiAoZGVzaXJlZCA9PT0gY3VycmVudCB8fFxuICAgICAgICAgICAoZGVzaXJlZCA9PT0gbnVsbCAmJiBjdXJyZW50ID09PSBOQVRJVkVfV0lOKSB8fFxuICAgICAgICAgICAoZGVzaXJlZCA9PT0gTkFUSVZFX1dJTiAmJiBjdXJyZW50ID09PSBudWxsKSk7XG4gIH1cblxuICBsb2dnZXIuZGVidWcoYEF0dGVtcHRpbmcgdG8gc2V0IGNvbnRleHQgdG8gJyR7bmFtZX0nYCk7XG4gIGlmIChhbHJlYWR5SW5Db250ZXh0KG5hbWUsIHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICAvLyBhbHJlYWR5IGluIHRoZSBuYW1lZCBjb250ZXh0LCBubyBuZWVkIHRvIGRvIGFueXRoaW5nXG4gIH0gZWxzZSBpZiAobmFtZSA9PT0gTkFUSVZFX1dJTiB8fCBuYW1lID09PSBudWxsKSB7XG4gICAgLy8gc3dpdGNoaW5nIGludG8gdGhlIG5hdGl2ZSBjb250ZXh0XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gbnVsbDtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgdGhpcy5yZW1vdGUuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBzd2l0Y2hpbmcgaW50byBhIHdlYnZpZXcgY29udGV4dFxuXG4gICAgLy8gaWYgY29udGV4dHMgaGF2ZSBub3QgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCwgZ2V0IHRoZW1cbiAgICBpZiAoXy5pc1VuZGVmaW5lZCh0aGlzLmNvbnRleHRzKSkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDb250ZXh0cygpO1xuICAgIH1cblxuICAgIGxldCBjb250ZXh0SWQgPSBuYW1lLnJlcGxhY2UoV0VCVklFV19CQVNFLCAnJyk7XG4gICAgaWYgKGNvbnRleHRJZCA9PT0gJycpIHtcbiAgICAgIC8vIGFsbG93IHVzZXIgdG8gcGFzcyBpbiBcIldFQlZJRVdcIiB3aXRob3V0IGFuIGluZGV4XG4gICAgICAvLyB0aGUgc2Vjb25kIGNvbnRleHQgd2lsbCBiZSB0aGUgZmlyc3Qgd2VidmlldyBhc1xuICAgICAgLy8gdGhlIGZpcnN0IGlzIGFsd2F5cyBOQVRJVkVfQVBQXG4gICAgICBjb250ZXh0SWQgPSB0aGlzLmNvbnRleHRzWzFdO1xuICAgIH1cbiAgICBpZiAoIV8uaW5jbHVkZXModGhpcy5jb250ZXh0cywgY29udGV4dElkKSkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hDb250ZXh0RXJyb3IoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgaWYgKHRoaXMucmVtb3RlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmRpc2Nvbm5lY3QoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY3VyQ29udGV4dCA9IGNvbnRleHRJZDtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QoY29udGV4dElkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gYGNvbnRleHRJZGAgd2lsbCBiZSBpbiB0aGUgZm9ybSBvZiBgYXBwSWQucGFnZUlkYCBpbiB0aGlzIGNhc2VcbiAgICAgIGxldCBbYXBwSWRLZXksIHBhZ2VJZEtleV0gPSBfLm1hcChjb250ZXh0SWQuc3BsaXQoJy4nKSwgKGlkKSA9PiBwYXJzZUludChpZCwgMTApKTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhZ2VJZEtleSwgc2tpcFJlYWR5Q2hlY2spO1xuICAgICAgdGhpcy5jdXJDb250ZXh0ID0gY29udGV4dElkO1xuICAgIH1cbiAgfVxuXG4gIC8vIGF0dGVtcHQgdG8gc3RhcnQgcGVyZm9ybWFuY2UgbG9nZ2luZywgaWYgcmVxdWVzdGVkXG4gIGlmICh0aGlzLm9wdHMuZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nICYmIHRoaXMucmVtb3RlKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBTdGFydGluZyBwZXJmb3JtYW5jZSBsb2cgb24gJyR7dGhpcy5jdXJDb250ZXh0fSdgKTtcbiAgICB0aGlzLmxvZ3MucGVyZm9ybWFuY2UgPSBuZXcgSU9TUGVyZm9ybWFuY2VMb2codGhpcy5yZW1vdGUpO1xuICAgIGF3YWl0IHRoaXMubG9ncy5wZXJmb3JtYW5jZS5zdGFydENhcHR1cmUoKTtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlID0gYXN5bmMgZnVuY3Rpb24gKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cbiAgcmV0dXJuIHRoaXMuY3VyQ29udGV4dC50b1N0cmluZygpO1xufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlcyA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICB0aGlzLndpbmRvd0hhbmRsZUNhY2hlID0gYXdhaXQgdGhpcy5saXN0V2ViRnJhbWVzKGZhbHNlKTtcbiAgY29uc3QgaWRBcnJheSA9IF8ubWFwKHRoaXMud2luZG93SGFuZGxlQ2FjaGUsICdpZCcpO1xuICAvLyBzaW5jZSB3ZSB1c2UgdGhpcy5jb250ZXh0cyB0byBtYW5hZ2Ugc2VsZWN0aW5nIGRlYnVnZ2VyIHBhZ2VzLCBtYWtlXG4gIC8vIHN1cmUgaXQgZ2V0cyBwb3B1bGF0ZWQgZXZlbiBpZiBzb21lb25lIGRpZCBub3QgdXNlIHRoZVxuICAvLyBnZXRDb250ZXh0cyBtZXRob2RcbiAgaWYgKCF0aGlzLmNvbnRleHRzKSB7XG4gICAgdGhpcy5jb250ZXh0cyA9IGlkQXJyYXk7XG4gIH1cbiAgcmV0dXJuIF8ubWFwKGlkQXJyYXksIChpZCkgPT4gaWQudG9TdHJpbmcoKSk7XG59O1xuXG5jb21tYW5kcy5zZXRXaW5kb3cgPSBhc3luYyBmdW5jdGlvbiAobmFtZSwgc2tpcFJlYWR5Q2hlY2spIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICBpZiAoIV8uaW5jbHVkZXMoXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyksIG5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hXaW5kb3dFcnJvcigpO1xuICB9XG4gIGxldCBwYWdlSWRLZXkgPSBwYXJzZUludChuYW1lLCAxMCk7XG4gIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UocGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayk7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gdGhpcy5jdXJXaW5kb3dIYW5kbGUgPSBuYW1lO1xuICB9IGVsc2Uge1xuICAgIGlmIChuYW1lID09PSB0aGlzLmN1cldpbmRvd0hhbmRsZSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBSZW1vdGUgZGVidWdnZXIgaXMgYWxyZWFkeSBjb25uZWN0ZWQgdG8gd2luZG93ICcke25hbWV9J2ApO1xuICAgIH0gZWxzZSBpZiAoIV8uaW5jbHVkZXMoXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyksIG5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaFdpbmRvd0Vycm9yKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmRpc2Nvbm5lY3QoKTtcbiAgICAgIHRoaXMuY3VyQ29udGV4dCA9IHRoaXMuY3VyV2luZG93SGFuZGxlID0gbmFtZTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QobmFtZSk7XG4gICAgfVxuICB9XG59O1xuXG5oZWxwZXJzLndlYkNvbnRleHRJbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHRoaXMuY3VyQ29udGV4dC5yZXBsYWNlKFdFQlZJRVdfQkFTRSwgJycpIC0gMTtcbn07XG5cbmV4dGVuc2lvbnMuaW5pdEF1dG9XZWJ2aWV3ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBpZiAodGhpcy5vcHRzLmF1dG9XZWJ2aWV3KSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdTZXR0aW5nIGF1dG8gd2VidmlldycpO1xuICAgIGF3YWl0IHRoaXMubmF2VG9Jbml0aWFsV2Vidmlldyh0aGlzKTtcbiAgfVxufTtcblxuZXh0ZW5zaW9ucy5nZXRDb250ZXh0c0FuZFZpZXdzID0gYXN5bmMgZnVuY3Rpb24gKHVzZVVybCA9IHRydWUpIHtcbiAgbG9nZ2VyLmRlYnVnKCdSZXRyaWV2aW5nIGNvbnRleHRzIGFuZCB2aWV3cycpO1xuICBsZXQgd2Vidmlld3MgPSBhd2FpdCB0aGlzLmxpc3RXZWJGcmFtZXModXNlVXJsKTtcblxuICBsZXQgY3R4cyA9IFt7aWQ6IE5BVElWRV9XSU4sIHZpZXc6IHt9fV07XG4gIHRoaXMuY29udGV4dHMgPSBbTkFUSVZFX1dJTl07XG4gIGZvciAobGV0IHZpZXcgb2Ygd2Vidmlld3MpIHtcbiAgICBjdHhzLnB1c2goe2lkOiBgJHtXRUJWSUVXX0JBU0V9JHt2aWV3LmlkfWAsIHZpZXd9KTtcbiAgICB0aGlzLmNvbnRleHRzLnB1c2godmlldy5pZC50b1N0cmluZygpKTtcbiAgfVxuICByZXR1cm4gY3R4cztcbn07XG5cbmV4dGVuc2lvbnMuZ2V0TmV3UmVtb3RlRGVidWdnZXIgPSBhc3luYyBmdW5jdGlvbiAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICByZXR1cm4gbmV3IFJlbW90ZURlYnVnZ2VyKHtcbiAgICBidW5kbGVJZDogdGhpcy5vcHRzLmJ1bmRsZUlkLFxuICAgIHVzZU5ld1NhZmFyaTogdGhpcy51c2VOZXdTYWZhcmkoKSxcbiAgICBwYWdlTG9hZE1zOiB0aGlzLnBhZ2VMb2FkTXMsXG4gICAgcGxhdGZvcm1WZXJzaW9uOiB0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uLFxuICAgIHJlbW90ZURlYnVnUHJveHk6IHRoaXMub3B0cy5yZW1vdGVEZWJ1Z1Byb3h5LFxuICAgIGdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlOiB1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5zYWZhcmlHYXJiYWdlQ29sbGVjdClcbiAgICAgID8gISF0aGlzLm9wdHMuc2FmYXJpR2FyYmFnZUNvbGxlY3RcbiAgICAgIDogdHJ1ZSxcbiAgfSk7XG59O1xuXG5leHRlbnNpb25zLmxpc3RXZWJGcmFtZXMgPSBhc3luYyBmdW5jdGlvbiAodXNlVXJsID0gdHJ1ZSkge1xuICBpZiAoIXRoaXMub3B0cy5idW5kbGVJZCkge1xuICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdDYW5ub3QgZW50ZXIgd2ViIGZyYW1lIHdpdGhvdXQgYSBidW5kbGUgSUQnKTtcbiAgfVxuXG4gIHVzZVVybCA9IHVzZVVybCAmJiAhIXRoaXMuZ2V0Q3VycmVudFVybCgpO1xuICBsb2dnZXIuZGVidWcoYFNlbGVjdGluZyBieSB1cmw6ICR7dXNlVXJsfSAke3VzZVVybCA/IGAoZXhwZWN0ZWQgdXJsOiAnJHt0aGlzLmdldEN1cnJlbnRVcmwoKX0nKWAgOiAnJ31gKTtcblxuICBsZXQgY3VycmVudFVybCA9IHVzZVVybCA/IHRoaXMuZ2V0Q3VycmVudFVybCgpIDogdW5kZWZpbmVkO1xuICBsZXQgcGFnZUFycmF5O1xuICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSAmJiB0aGlzLnJlbW90ZSAmJiB0aGlzLm9wdHMuYnVuZGxlSWQpIHtcbiAgICAvLyByZWFsIGRldmljZSwgYW5kIGFscmVhZHkgY29ubmVjdGVkXG4gICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUucGFnZUFycmF5RnJvbUpzb24odGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICB9IGVsc2UgaWYgKHRoaXMucmVtb3RlICYmIHRoaXMucmVtb3RlLmFwcElkS2V5KSB7XG4gICAgLy8gc2ltdWxhdG9yLCBhbmQgYWxyZWFkeSBjb25uZWN0ZWRcbiAgICBwYWdlQXJyYXkgPSBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RBcHAoY3VycmVudFVybCwgdGhpcy5vcHRzLndlYnZpZXdDb25uZWN0UmV0cmllcywgdGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICB9IGVsc2UgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICAvLyByZWFsIGRldmljZSwgYW5kIG5vdCBjb25uZWN0ZWRcbiAgICB0cnkge1xuICAgICAgdGhpcy5yZW1vdGUgPSBuZXcgV2ViS2l0UmVtb3RlRGVidWdnZXIoe1xuICAgICAgICBwb3J0OiB0aGlzLm9wdHMud2Via2l0RGVidWdQcm94eVBvcnQsXG4gICAgICAgIHdlYmtpdFJlc3BvbnNlVGltZW91dDogdGhpcy5vcHRzLndlYmtpdFJlc3BvbnNlVGltZW91dCxcbiAgICAgIH0pO1xuICAgICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUucGFnZUFycmF5RnJvbUpzb24odGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gaXQgaXMgcmVhc29uYWJsZSB0byBleHBlY3QgdGhhdCB0aGlzIG1pZ2h0IGJlIGNhbGxlZCB3aGVuIHRoZXJlIGlzIG5vXG4gICAgICAvLyB3ZWJraXQgcmVtb3RlIGRlYnVnZ2VyIHRvIGNvbm5lY3QgdG9cbiAgICAgIGlmICghXy5pbmNsdWRlcyhlcnIubWVzc2FnZSwgJ2Nvbm5lY3QgRUNPTk5SRUZVU0VEJykpIHRocm93IGVycjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgICBsb2dnZXIud2FybignQXR0ZW1wdGVkIHRvIGdldCBhIGxpc3Qgb2Ygd2VidmlldyBjb250ZXh0cyBidXQgY291bGQgbm90IGNvbm5lY3QgdG8gJyArXG4gICAgICAgICAgICAgICAgICAnaW9zLXdlYmtpdC1kZWJ1Zy1wcm94eS4gSWYgeW91IGV4cGVjdCB0byBmaW5kIHdlYnZpZXdzLCBwbGVhc2UgZW5zdXJlICcgK1xuICAgICAgICAgICAgICAgICAgJ3RoYXQgdGhlIHByb3h5IGlzIHJ1bm5pbmcgYW5kIGFjY2Vzc2libGUnKTtcbiAgICAgIHRoaXMucmVtb3RlID0gbnVsbDtcbiAgICAgIHBhZ2VBcnJheSA9IFtdO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBzaW11bGF0b3IsIGFuZCBub3QgY29ubmVjdGVkXG4gICAgdGhpcy5yZW1vdGUgPSBhd2FpdCB0aGlzLmdldE5ld1JlbW90ZURlYnVnZ2VyKCk7XG5cbiAgICBsZXQgYXBwSW5mbyA9IGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QoKTtcbiAgICBpZiAoIWFwcEluZm8pIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnVW5hYmxlIHRvIGNvbm5lY3QgdG8gdGhlIHJlbW90ZSBkZWJ1Z2dlci4nKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0QXBwKGN1cnJlbnRVcmwsIHRoaXMub3B0cy53ZWJ2aWV3Q29ubmVjdFJldHJpZXMsIHRoaXMub3B0cy5pZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgICB0aGlzLnJlbW90ZS5vbihSZW1vdGVEZWJ1Z2dlci5FVkVOVF9QQUdFX0NIQU5HRSwgdGhpcy5vblBhZ2VDaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5yZW1vdGUub24oUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVELCAoKSA9PiB7XG4gICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmN1cldlYkZyYW1lcykpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBDbGVhcmluZyAke3RoaXMuY3VyV2ViRnJhbWVzLmxlbmd0aH0gZnJhbWVzOiAke3RoaXMuY3VyV2ViRnJhbWVzLmpvaW4oJywgJyl9YCk7XG4gICAgICB9XG4gICAgICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICAgIH0pO1xuXG4gICAgbGV0IHRyeUNsb3NpbmdBbGVydCA9IGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBkaWREaXNtaXNzID0gYXdhaXQgdGhpcy5jbG9zZUFsZXJ0QmVmb3JlVGVzdCgpO1xuICAgICAgaWYgKCFkaWREaXNtaXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2xvc2UgYWxlcnQgZmFpbGVkLiBSZXRyeS4nKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCByZXRyeUludGVydmFsKDMsIDQwMDAsIHRyeUNsb3NpbmdBbGVydCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAvLyBpZiB0aGUgbG9vcCB0byBjbG9zZSBhbGVydHMgZmFpbGVkIHRvIGRpc21pc3MsIGlnbm9yZSxcbiAgICAgIC8vIG90aGVyd2lzZSBsb2cgYW5kIHRocm93IHRoZSBlcnJvclxuICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAnQ2xvc2UgYWxlcnQgZmFpbGVkLiBSZXRyeS4nKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGVycik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKHBhZ2VBcnJheS5sZW5ndGggPT09IDApIHtcbiAgICAvLyB3ZSBoYXZlIG5vIHdlYiBmcmFtZXMsIGJ1dCBjb250aW51ZSBhbnl3YXlcbiAgICBsb2dnZXIuZGVidWcoJ05vIHdlYiBmcmFtZXMgZm91bmQuJyk7XG4gIH1cbiAgcmV0dXJuIHBhZ2VBcnJheTtcbn07XG5cbmV4dGVuc2lvbnMub25QYWdlQ2hhbmdlID0gYXN5bmMgZnVuY3Rpb24gKHBhZ2VDaGFuZ2VOb3RpZmljYXRpb24pIHtcbiAgbG9nZ2VyLmRlYnVnKGBSZW1vdGUgZGVidWdnZXIgbm90aWZpZWQgdXMgb2YgYSBuZXcgcGFnZSBsaXN0aW5nOiAke0pTT04uc3RyaW5naWZ5KHBhZ2VDaGFuZ2VOb3RpZmljYXRpb24pfWApO1xuICBpZiAodGhpcy5zZWxlY3RpbmdOZXdQYWdlKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdXZSBhcmUgaW4gdGhlIG1pZGRsZSBvZiBzZWxlY3RpbmcgYSBwYWdlLCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoIXRoaXMucmVtb3RlIHx8ICF0aGlzLnJlbW90ZS5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdXZSBoYXZlIG5vdCB5ZXQgY29ubmVjdGVkLCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHthcHBJZEtleSwgcGFnZUFycmF5fSA9IHBhZ2VDaGFuZ2VOb3RpZmljYXRpb247XG5cbiAgbGV0IG5ld0lkcyA9IFtdO1xuICBsZXQgbmV3UGFnZXMgPSBbXTtcbiAgbGV0IGtleUlkID0gbnVsbDtcbiAgZm9yIChjb25zdCBwYWdlIG9mIHBhZ2VBcnJheSkge1xuICAgIGNvbnN0IGlkID0gcGFnZS5pZC50b1N0cmluZygpO1xuICAgIG5ld0lkcy5wdXNoKGlkKTtcbiAgICBpZiAocGFnZS5pc0tleSkge1xuICAgICAga2V5SWQgPSBpZDtcbiAgICB9XG4gICAgY29uc3QgY29udGV4dElkID0gYCR7YXBwSWRLZXl9LiR7aWR9YDtcblxuICAgIC8vIGFkZCBpZiB0aGlzIGlzIGEgbmV3IHBhZ2VcbiAgICBpZiAoIV8uaW5jbHVkZXModGhpcy5jb250ZXh0cywgY29udGV4dElkKSkge1xuICAgICAgbmV3UGFnZXMucHVzaChpZCk7XG4gICAgICB0aGlzLmNvbnRleHRzLnB1c2goY29udGV4dElkKTtcbiAgICB9XG4gIH1cblxuICBpZiAoIWtleUlkKSB7XG4gICAgLy8gaWYgdGhlcmUgaXMgbm8ga2V5IGlkLCBwdWxsIHRoZSBmaXJzdCBpZCBmcm9tIHRoZSBwYWdlIGFycmF5IGFuZCB1c2UgdGhhdFxuICAgIC8vIGFzIGEgc3RhbmQgaW5cbiAgICBsb2dnZXIuZGVidWcoJ05vIGtleSBpZCBmb3VuZC4gQ2hvb3NpbmcgZmlyc3QgaWQgZnJvbSBwYWdlIGFycmF5Jyk7XG4gICAga2V5SWQgPSBuZXdJZHNbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIGlmICghdXRpbC5oYXNWYWx1ZSh0aGlzLmN1ckNvbnRleHQpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdXZSBkbyBub3QgYXBwZWFyIHRvIGhhdmUgd2luZG93IHNldCB5ZXQsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgW2N1ckFwcElkS2V5LCBjdXJQYWdlSWRLZXldID0gdGhpcy5jdXJDb250ZXh0LnNwbGl0KCcuJyk7XG5cbiAgaWYgKGN1ckFwcElkS2V5ICE9PSBhcHBJZEtleSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnUGFnZSBjaGFuZ2Ugbm90IHJlZmVycmluZyB0byBjdXJyZW50bHkgc2VsZWN0ZWQgYXBwLCBpZ25vcmluZy4nKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgbmV3UGFnZSA9IG51bGw7XG4gIGlmIChuZXdQYWdlcy5sZW5ndGgpIHtcbiAgICBuZXdQYWdlID0gXy5sYXN0KG5ld1BhZ2VzKTtcbiAgICBsb2dnZXIuZGVidWcoYFdlIGhhdmUgbmV3IHBhZ2VzLCBzZWxlY3RpbmcgcGFnZSAnJHtuZXdQYWdlfSdgKTtcbiAgfSBlbHNlIGlmICghXy5pbmNsdWRlcyhuZXdJZHMsIGN1clBhZ2VJZEtleSkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ05ldyBwYWdlIGxpc3RpbmcgZnJvbSByZW1vdGUgZGVidWdnZXIgZG9lcyBub3QgY29udGFpbiAnICtcbiAgICAgICAgICAgICAgICAgJ2N1cnJlbnQgd2luZG93OyBhc3N1bWluZyBpdCBpcyBjbG9zZWQnKTtcbiAgICBpZiAoIXV0aWwuaGFzVmFsdWUoa2V5SWQpKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0RvIG5vdCBoYXZlIG91ciBjdXJyZW50IHdpbmRvdyBhbnltb3JlLCBhbmQgdGhlcmUgJyArXG4gICAgICAgICAgICAgICAgICAgJ2FyZSBub3QgYW55IG1vcmUgdG8gbG9hZCEgRG9pbmcgbm90aGluZy4uLicpO1xuICAgICAgdGhpcy5zZXRDdXJyZW50VXJsKHVuZGVmaW5lZCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbG9nZ2VyLmRlYnVnKGBEZWJ1Z2dlciBhbHJlYWR5IHNlbGVjdGVkIHBhZ2UgJyR7a2V5SWR9JywgYCArXG4gICAgICAgICAgICAgICAgIGBjb25maXJtaW5nIHRoYXQgY2hvaWNlLmApO1xuICAgIHRoaXMuY3VyQ29udGV4dCA9IGAke2FwcElkS2V5fS4ke2tleUlkfWA7XG4gICAgbmV3UGFnZSA9IGtleUlkO1xuICB9IGVsc2Uge1xuICAgIC8vIGF0IHRoaXMgcG9pbnQsIHRoZXJlIGFyZSBubyBuZXcgcGFnZXMsIGFuZCB0aGUgY3VycmVudCBwYWdlIHN0aWxsIGV4aXN0c1xuICAgIGxvZ2dlci5kZWJ1ZygnQ2hlY2tpbmcgaWYgcGFnZSBuZWVkcyB0byBsb2FkJyk7XG4gICAgLy8gSWYgYSB3aW5kb3cgbmF2aWdhdGVzIHRvIGFuIGFuY2hvciBpdCBkb2Vzbid0IGFsd2F5cyBmaXJlIGEgcGFnZVxuICAgIC8vIGNhbGxiYWNrIGV2ZW50LiBMZXQncyBjaGVjayBpZiB3ZSB3b3VuZCB1cCBpbiBzdWNoIGEgc2l0dWF0aW9uLlxuICAgIGNvbnN0IG5lZWRzUGFnZUxvYWQgPSAoKCkgPT4ge1xuICAgICAgLy8gbmVlZCB0byBtYXAgdGhlIHBhZ2UgaWRzIHRvIGNvbnRleHQgaWRzXG4gICAgICBjb25zdCBjb250ZXh0QXJyYXkgPSBfLm1hcChwYWdlQXJyYXksIChwYWdlKSA9PiBgJHthcHBJZEtleX0uJHtwYWdlLmlkfWApO1xuICAgICAgLy8gY2hlY2sgaWYgdGhlIGN1cnJlbnQgY29udGV4dCBleGlzdHMgaW4gYm90aCBvdXIgcmVjb3JkZWQgY29udGV4dHMsXG4gICAgICAvLyBhbmQgdGhlIHBhZ2UgYXJyYXlcbiAgICAgIHJldHVybiAhXy5pc0VxdWFsKF8uZmluZCh0aGlzLmNvbnRleHRzLCB0aGlzLmN1ckNvbnRleHQpLCBfLmZpbmQoY29udGV4dEFycmF5LCB0aGlzLmN1ckNvbnRleHQpKTtcbiAgICB9KSgpO1xuXG4gICAgaWYgKG5lZWRzUGFnZUxvYWQpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnUGFnZSBsb2FkIG5lZWRlZC4gTG9hZGluZy4uLicpO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUucGFnZUxvYWQoKTtcbiAgICB9XG5cbiAgICBsb2dnZXIuZGVidWcoJ05ldyBwYWdlIGxpc3RpbmcgaXMgc2FtZSBhcyBvbGQsIGRvaW5nIG5vdGhpbmcnKTtcbiAgfVxuXG4gIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBwYWdlIGxpc3RpbmcgaXNuJ3QgaW5kaWNhdGluZyBhIHJlZGlyZWN0XG4gIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICBsZXQgY3VycmVudFBhZ2VJZCA9IHBhcnNlSW50KF8ubGFzdCh0aGlzLmN1ckNvbnRleHQuc3BsaXQoJy4nKSksIDEwKTtcbiAgICBsZXQgcGFnZSA9IF8uZmluZChwYWdlQXJyYXksIChwKSA9PiBwYXJzZUludChwLmlkLCAxMCkgPT09IGN1cnJlbnRQYWdlSWQpO1xuICAgIGlmIChwYWdlICYmIHBhZ2UudXJsICE9PSB0aGlzLmdldEN1cnJlbnRVcmwoKSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBSZWRpcmVjdGVkIGZyb20gJyR7dGhpcy5nZXRDdXJyZW50VXJsKCl9JyB0byAnJHtwYWdlLnVybH0nYCk7XG4gICAgICB0aGlzLnNldEN1cnJlbnRVcmwocGFnZS51cmwpO1xuICAgIH1cbiAgfVxuXG4gIGlmICh1dGlsLmhhc1ZhbHVlKG5ld1BhZ2UpKSB7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gdHJ1ZTtcbiAgICBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RQYWdlKGFwcElkS2V5LCBwYXJzZUludChuZXdQYWdlLCAxMCkpO1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IGZhbHNlO1xuICAgIHRoaXMuY3VyQ29udGV4dCA9IGAke2FwcElkS2V5fS4ke25ld1BhZ2V9YDtcbiAgfVxuICB0aGlzLndpbmRvd0hhbmRsZUNhY2hlID0gcGFnZUFycmF5O1xufTtcblxuZXh0ZW5zaW9ucy5nZXRMYXRlc3RXZWJ2aWV3Q29udGV4dEZvclRpdGxlID0gYXN5bmMgZnVuY3Rpb24gKHJlZ0V4cCkge1xuICBsZXQgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoKTtcbiAgbGV0IG1hdGNoaW5nQ3R4O1xuICBmb3IgKGxldCBjdHggb2YgY29udGV4dHMpIHtcbiAgICBpZiAoY3R4LnZpZXcgJiYgKChjdHgudmlldy50aXRsZSAmJiBjdHgudmlldy50aXRsZS5tYXRjaChyZWdFeHApKSB8fCAoY3R4LnZpZXcudXJsICYmIGN0eC52aWV3LnVybC5tYXRjaChyZWdFeHApKSkpIHtcbiAgICAgIGlmIChjdHgudmlldy51cmwgIT09ICdhYm91dDpibGFuaycpIHtcbiAgICAgICAgbWF0Y2hpbmdDdHggPSBjdHg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBpbiB0aGUgY2FzZXMgb2YgWGNvZGUgPCA1IChpLmUuLCBpT1MgU0RLIFZlcnNpb24gbGVzcyB0aGFuIDcpXG4gICAgICAgIC8vIGlPUyA3LjEsIGlPUyA5LjAgJiBpT1MgOS4xIGluIGEgd2VidmlldyAobm90IGluIFNhZmFyaSlcbiAgICAgICAgLy8gd2UgY2FuIGhhdmUgdGhlIHVybCBiZSBgYWJvdXQ6YmxhbmtgXG4gICAgICAgIGlmIChwYXJzZUZsb2F0KHRoaXMuaW9zU2RrVmVyc2lvbikgPCA3IHx8IHBhcnNlRmxvYXQodGhpcy5pb3NTZGtWZXJzaW9uKSA+PSA5IHx8XG4gICAgICAgICAgICAodGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbiA9PT0gJzcuMScgJiYgdGhpcy5vcHRzLmFwcCAmJiB0aGlzLm9wdHMuYXBwLnRvTG93ZXJDYXNlKCkgIT09ICdzYWZhcmknKSkge1xuICAgICAgICAgIG1hdGNoaW5nQ3R4ID0gY3R4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1hdGNoaW5nQ3R4ID8gbWF0Y2hpbmdDdHguaWQgOiB1bmRlZmluZWQ7XG59O1xuXG4vLyBSaWdodCBub3cgd2UgZG9uJ3QgbmVjZXNzYXJpbHkgd2FpdCBmb3Igd2Vidmlld1xuLy8gYW5kIGZyYW1lIHRvIGxvYWQsIHdoaWNoIGxlYWRzIHRvIHJhY2UgY29uZGl0aW9ucyBhbmQgZmxha2luZXNzLFxuLy8gbGV0J3Mgc2VlIGlmIHdlIGNhbiB0cmFuc2l0aW9uIHRvIHNvbWV0aGluZyBiZXR0ZXJcbmV4dGVuc2lvbnMudXNlTmV3U2FmYXJpID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gcGFyc2VGbG9hdCh0aGlzLmlvc1Nka1ZlcnNpb24pID49IDguMSAmJlxuICAgICAgICAgcGFyc2VGbG9hdCh0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uKSA+PSA4LjEgJiZcbiAgICAgICAgICF0aGlzLmlzUmVhbERldmljZSgpICYmXG4gICAgICAgICB0aGlzLm9wdHMuc2FmYXJpO1xufTtcblxuZXh0ZW5zaW9ucy5uYXZUb0luaXRpYWxXZWJ2aWV3ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsZXQgdGltZW91dCA9IDA7XG4gIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgdGltZW91dCA9IDMwMDA7XG4gICAgbG9nZ2VyLmRlYnVnKGBXYWl0aW5nIGZvciAke3RpbWVvdXR9IG1zIGJlZm9yZSBuYXZpZ2F0aW5nIHRvIHZpZXcuYCk7XG4gIH1cbiAgYXdhaXQgQi5kZWxheSh0aW1lb3V0KTtcbiAgaWYgKHRoaXMudXNlTmV3U2FmYXJpKCkpIHtcbiAgICBhd2FpdCB0aGlzLnR5cGVBbmROYXZUb1VybCgpO1xuICB9IGVsc2UgaWYgKHBhcnNlSW50KHRoaXMuaW9zU2RrVmVyc2lvbiwgMTApID49IDcgJiYgIXRoaXMuaXNSZWFsRGV2aWNlKCkgJiYgdGhpcy5vcHRzLnNhZmFyaSkge1xuICAgIGF3YWl0IHRoaXMubmF2VG9WaWV3VGhyb3VnaEZhdm9yaXRlcygpO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKC8uKi8pO1xuICB9XG59O1xuXG5hc3luYyBmdW5jdGlvbiBvcGVuTmV3UGFnZSAoKSB7XG4gIGxldCBuZXdQYWdlQnV0dG9uID0gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgneHBhdGgnLCBcIi8vVUlBQnV0dG9uW2NvbnRhaW5zKEBuYW1lLCdOZXcgcGFnZScpXVwiKTtcbiAgYXdhaXQgdGhpcy5uYXRpdmVUYXAobmV3UGFnZUJ1dHRvbi5FTEVNRU5UKTtcbn1cblxuZXh0ZW5zaW9ucy50eXBlQW5kTmF2VG9VcmwgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCBhZGRyZXNzID0gdGhpcy5vcHRzLmFkZHJlc3MgPyB0aGlzLm9wdHMuYWRkcmVzcyA6ICcxMjcuMC4wLjEnO1xuICB0aGlzLnNldEN1cnJlbnRVcmwodGhpcy5jYXBzLnNhZmFyaUluaXRpYWxVcmwgfHwgYGh0dHA6Ly8ke2FkZHJlc3N9OiR7dGhpcy5vcHRzLnBvcnR9L3dlbGNvbWVgKTtcblxuICBsZXQgdHJpZXMgPSAwO1xuICBjb25zdCBNQVhfVFJJRVMgPSAyO1xuICBsZXQgbmF2aWdhdGUgPSBhc3luYyAoKSA9PiB7XG4gICAgbGV0IG9sZEltcFdhaXQgPSB0aGlzLmltcGxpY2l0V2FpdE1zO1xuICAgIHRoaXMuaW1wbGljaXRXYWl0TXMgPSA3MDAwO1xuXG4gICAgLy8gZmluZCB0aGUgdXJsIGJhciwgYW5kIHRhcCBvbiBpdC4gcmV0cnkgdG8gbWFrZSBzdXJlIHdlIGRvbid0IHRyeVxuICAgIC8vIHRvbyBzb29uIHdoaWxlIHRoZSB2aWV3IGlzIHN0aWxsIGxvYWRpbmdcbiAgICBsZXQgZWwgPSBhd2FpdCByZXRyeUludGVydmFsKDMsIDEwMDAsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmZpbmRFbGVtZW50KCdhY2Nlc3NpYmlsaXR5IGlkJywgJ1VSTCcpO1xuICAgIH0pO1xuICAgIHRoaXMuaW1wbGljaXRXYWl0TXMgPSBvbGRJbXBXYWl0O1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMubmF0aXZlVGFwKGVsLkVMRU1FTlQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKF8uaW5jbHVkZXMoZXJyLm1lc3NhZ2UsICdjb3VsZCBub3QgYmUgdGFwcGVkJykpIHtcbiAgICAgICAgaWYgKHRyaWVzKysgPj0gTUFYX1RSSUVTKSB0aHJvdyBlcnI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgICAgICAvLyBnZW5lcmFsbHkgdGhpcyBtZWFucyB0aGF0IFNhZmFyaSBpcyBpbiBwYWdlIHZpZXdpbmcgbW9kZVxuICAgICAgICAvLyBzbyB0cnkgdG8gb3BlbiBhIG5ldyBwYWdlIGFuZCB0aGVuIHJlZG8gdGhlIG5hdmlnYXRpb25cbiAgICAgICAgYXdhaXQgb3Blbk5ld1BhZ2UoKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5hdmlnYXRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZ2V0IHRoZSBsYXN0IGFkZHJlc3MgZWxlbWVudCBhbmQgc2V0IHRoZSB1cmxcbiAgICB0cnkge1xuICAgICAgbGV0IGVsID0gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgnY2xhc3MgbmFtZScsICdVSUFUZXh0RmllbGQnKTtcbiAgICAgIGF3YWl0IHRoaXMuc2V0VmFsdWVJbW1lZGlhdGUodGhpcy5nZXRDdXJyZW50VXJsKCksIGVsKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIHRoaXMgaXMgZmxha2V5IG9uIGNlcnRhaW4gc3lzdGVtcyBzbyB3ZSByZXRyeSB1bnRpbCB3ZSBnZXQgc29tZXRoaW5nXG4gICAgICAvLyBpb3Mgc2ltczogc2FmYXJpIG9wZW5zIGJ1dCB0aGUgdGV4dCBmaWVsZCBjYW4ndCBiZSBmb3VuZFxuICAgICAgaWYgKHRyaWVzKysgPj0gTUFYX1RSSUVTKSB0aHJvdyBlcnI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICAgIHJldHVybiBhd2FpdCBuYXZpZ2F0ZSgpO1xuICAgIH1cblxuICAgIC8vIG1ha2UgaXQgaGFwcGVuXG4gICAgdHJ5IHtcbiAgICAgIGVsID0gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdHbycpO1xuICAgICAgYXdhaXQgdGhpcy5uYXRpdmVUYXAoZWwuRUxFTUVOVCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoXy5pbmNsdWRlcyhlcnIubWVzc2FnZSwgJ2NvdWxkIG5vdCBiZSB0YXBwZWQnKSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ1VuYWJsZSB0byBzdWJtaXQgVVJMIGJlY2F1c2UgXFwnR29cXCcgYnV0dG9uIGNvdWxkIG5vdCBiZSB0YXBwZWQuICcgK1xuICAgICAgICAgICAgICAgICAgICAgJ1BsZWFzZSBtYWtlIHN1cmUgeW91ciBrZXlib2FyZCBpcyB0b2dnbGVkIG9uLicpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1dpdGhUaXRsZSh1bmRlZmluZWQsIG5ldyBSZWdFeHAodGhpcy5nZXRDdXJyZW50VXJsKCksICdpJykpO1xuXG4gICAgLy8gd2FpdCBmb3IgcGFnZSB0byBmaW5pc2ggbG9hZGluZy5cbiAgICBhd2FpdCB0aGlzLnJlbW90ZS5wYWdlVW5sb2FkKCk7XG4gIH07XG4gIGF3YWl0IG5hdmlnYXRlKCk7XG59O1xuXG5leHRlbnNpb25zLm5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxvZ2dlci5kZWJ1ZygnV2UgYXJlIG9uIGlPUzcrIHNpbXVsYXRvcjogY2xpY2tpbmcgYXBwbGUgYnV0dG9uIHRvIGdldCBpbnRvIGEgd2VidmlldycpO1xuICBsZXQgb2xkSW1wV2FpdCA9IHRoaXMuaW1wbGljaXRXYWl0TXM7XG4gIHRoaXMuaW1wbGljaXRXYWl0TXMgPSA3MDAwOyAvLyB3YWl0IDdzIGZvciBhcHBsZSBidXR0b24gdG8gZXhpc3RcblxuICBsZXQgZWw7XG4gIHRyeSB7XG4gICAgZWwgPSBhd2FpdCB0aGlzLmZpbmRFbGVtZW50KCd4cGF0aCcsICcvL1VJQVNjcm9sbFZpZXdbMV0vVUlBQnV0dG9uWzFdJyk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxldCBtc2cgPSAnQ291bGQgbm90IGZpbmQgYnV0dG9uIHRvIGNsaWNrIHRvIGdldCBpbnRvIHdlYnZpZXcuICcgK1xuICAgICAgICAgICAgICAnUHJvY2VlZGluZyBvbiB0aGUgYXNzdW1wdGlvbiB3ZSBoYXZlIGEgd29ya2luZyBvbmUuJztcbiAgICBsb2dnZXIuZXJyb3IobXNnKTtcbiAgICB0aGlzLmltcGxpY2l0V2FpdE1zID0gb2xkSW1wV2FpdDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXZUb1ZpZXdXaXRoVGl0bGUoLy4qL2kpO1xuICB9XG4gIHRoaXMuaW1wbGljaXRXYWl0TXMgPSBvbGRJbXBXYWl0O1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMubmF0aXZlVGFwKGVsLkVMRU1FTlQpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsZXQgbXNnID0gJ0NvdWxkIG5vdCBjbGljayBidXR0b24gdG8gZ2V0IGludG8gd2Vidmlldy4gJyArXG4gICAgICAgICAgICAgICdQcm9jZWVkaW5nIG9uIHRoZSBhc3N1bXB0aW9uIHdlIGhhdmUgYSB3b3JraW5nIG9uZS4nO1xuICAgIGxvZ2dlci5lcnJvcihtc2cpO1xuICB9XG4gIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKC9hcHBsZS9pKTtcbn07XG5cbmV4dGVuc2lvbnMubmF2VG9WaWV3V2l0aFRpdGxlID0gYXN5bmMgZnVuY3Rpb24gKHRpdGxlUmVnZXgsIHVybFJlZ0V4cCkge1xuICBsb2dnZXIuZGVidWcoJ05hdmlnYXRpbmcgdG8gbW9zdCByZWNlbnRseSBvcGVuZWQgd2VidmlldycpO1xuICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICBsZXQgc3BpblRpbWUgPSA1MDA7XG4gIGxldCBzcGluSGFuZGxlcyA9IGFzeW5jICgpID0+IHtcbiAgICBsZXQgcmVzO1xuICAgIHRyeSB7XG4gICAgICByZXMgPSBhd2FpdCB0aGlzLmdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUodGl0bGVSZWdleCB8fCB1cmxSZWdFeHApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyci5tZXNzYWdlLmluZGV4T2YoJ0NvdWxkIG5vdCBjb25uZWN0IHRvIGEgdmFsaWQgYXBwIGFmdGVyJykgPT09IC0xKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXchIEVycjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5kZWJ1ZygnQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXcuIFJldHJ5aW5nIGlmIHBvc3NpYmxlLicpO1xuICAgIH1cbiAgICBpZiAocmVzKSB7XG4gICAgICBsZXQgbGF0ZXN0V2luZG93ID0gcmVzO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBQaWNraW5nIHdlYnZpZXcgJyR7bGF0ZXN0V2luZG93fSdgKTtcbiAgICAgIGF3YWl0IHRoaXMuc2V0Q29udGV4dChsYXRlc3RXaW5kb3cpO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuY2FuY2VsUGFnZUxvYWQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBubyB3ZWJ2aWV3IHdhcyBmb3VuZFxuICAgIGlmICgoRGF0ZS5ub3coKSAtIHN0YXJ0KSA+PSA5MDAwMCkge1xuICAgICAgLy8gdG9vIHNsb3csIGdldCBvdXRcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXc7IHRoZXJlIGFyZSBub25lIScpO1xuICAgIH1cblxuICAgIGxvZ2dlci53YXJuKFwiQ291bGQgbm90IGZpbmQgYW55IHdlYnZpZXdzIHlldCwgcmVmcmVzaGluZy9yZXRyeWluZ1wiKTtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSB8fCAhdGhpcy5vcHRzLnNhZmFyaSkge1xuICAgICAgLy8gb24gYSByZWFsIGRldmljZSwgd2hlbiBub3QgdXNpbmcgU2FmYXJpLCB3ZSBqdXN0IHdhbnQgdG8gdHJ5IGFnYWluXG4gICAgICBhd2FpdCBCLmRlbGF5KHNwaW5UaW1lKTtcbiAgICAgIHJldHVybiBhd2FpdCBzcGluSGFuZGxlcygpO1xuICAgIH1cblxuICAgIC8vIGZpbmQgdGhlIHJlbG9hZCBidXR0b24gYW5kIHRhcCBpdCwgaWYgcG9zc2libGVcbiAgICBsZXQgZWxlbWVudDtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdGaW5kaW5nIGFuZCB0YXBwaW5nIHJlbG9hZCBidXR0b24nKTtcbiAgICAgIGVsZW1lbnQgPSBhd2FpdCB0aGlzLmZpbmRVSUVsZW1lbnRPckVsZW1lbnRzKCdhY2Nlc3NpYmlsaXR5IGlkJywgJ1JlbG9hZEJ1dHRvbicsICcnLCBmYWxzZSk7XG4gICAgICBhd2FpdCB0aGlzLm5hdGl2ZVRhcChlbGVtZW50LkVMRU1FTlQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLndhcm4oYEVycm9yIGZpbmRpbmcgYW5kIHRhcHBpbmcgcmVsb2FkIGJ1dHRvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZ2dlci53YXJuKCdSZXRyeWluZy4nKTtcbiAgICAgIGF3YWl0IEIuZGVsYXkoc3BpblRpbWUpO1xuICAgIH1cblxuICAgIC8vIHRyeSBpdCBhbGwgYWdhaW5cbiAgICByZXR1cm4gYXdhaXQgc3BpbkhhbmRsZXMoKTtcbiAgfTtcbiAgYXdhaXQgc3BpbkhhbmRsZXMoKTtcbn07XG5cbmhlbHBlcnMuY2xvc2VBbGVydEJlZm9yZVRlc3QgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCBwcmVzZW50ID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoJ2F1LmFsZXJ0SXNQcmVzZW50KCknKTtcbiAgaWYgKCFwcmVzZW50KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKCdBbGVydCBwcmVzZW50IGJlZm9yZSBzdGFydGluZyB0ZXN0LCBsZXQgdXMgYmFuaXNoIGl0Jyk7XG4gIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKCdhdS5kaXNtaXNzQWxlcnQoKScpO1xuICBsb2dnZXIuZGVidWcoJ0FsZXJ0IGJhbmlzaGVkIScpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmhlbHBlcnMuc3RvcFJlbW90ZSA9IGFzeW5jIGZ1bmN0aW9uIChjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmcgPSBmYWxzZSkge1xuICBpZiAoIXRoaXMucmVtb3RlKSB7XG4gICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coJ1RyaWVkIHRvIGxlYXZlIGEgd2ViIGZyYW1lIGJ1dCB3ZXJlIG5vdCBpbiBvbmUnKTtcbiAgfVxuXG4gIGlmIChjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmcpIHtcbiAgICBhd2FpdCB0aGlzLmNsb3NlV2luZG93KCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5yZW1vdGUuZGlzY29ubmVjdCgpO1xuICB0aGlzLmN1ckNvbnRleHQgPSBudWxsO1xuICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICB0aGlzLmN1cldlYkNvb3JkcyA9IG51bGw7XG4gIHRoaXMucmVtb3RlID0gbnVsbDtcbn07XG5cbmhlbHBlcnMuaXNXZWJDb250ZXh0ID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gISF0aGlzLmN1ckNvbnRleHQgJiYgdGhpcy5jdXJDb250ZXh0ICE9PSBOQVRJVkVfV0lOO1xufTtcblxuaGVscGVycy5zZXRDdXJyZW50VXJsID0gZnVuY3Rpb24gKHVybCkge1xuICB0aGlzLl9jdXJyZW50VXJsID0gdXJsO1xufTtcblxuaGVscGVycy5nZXRDdXJyZW50VXJsID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gdGhpcy5fY3VycmVudFVybDtcbn07XG5cblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycywgTkFUSVZFX1dJTiwgV0VCVklFV19XSU4sIFdFQlZJRVdfQkFTRSB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2NvbnRleHQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
