"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _helpers = require("../helpers.js");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("../logger.js"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _semver = _interopRequireDefault(require("semver"));

var _os = _interopRequireDefault(require("os"));

let apkUtilsMethods = {};
const ACTIVITIES_TROUBLESHOOTING_LINK = 'https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/android/activity-startup.md';

apkUtilsMethods.isAppInstalled = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (pkg) {
    _logger.default.debug(`Getting install status for ${pkg}`);

    const installedPattern = new RegExp(`^\\s*Package\\s+\\[${_lodash.default.escapeRegExp(pkg)}\\][^:]+:$`, 'm');

    try {
      const stdout = yield this.shell(['dumpsys', 'package', pkg]);
      const isInstalled = installedPattern.test(stdout);

      _logger.default.debug(`'${pkg}' is${!isInstalled ? ' not' : ''} installed`);

      return isInstalled;
    } catch (e) {
      throw new Error(`Error finding if '${pkg}' is installed. Original error: ${e.message}`);
    }
  });

  return function (_x) {
    return _ref.apply(this, arguments);
  };
}();

apkUtilsMethods.startUri = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (uri, pkg) {
    if (!uri || !pkg) {
      throw new Error("URI and package arguments are required");
    }

    const args = ["am", "start", "-W", "-a", "android.intent.action.VIEW", "-d", uri.replace(/&/g, '\\&'), pkg];

    try {
      const res = yield this.shell(args);

      if (res.toLowerCase().includes('unable to resolve intent')) {
        throw new Error(res);
      }
    } catch (e) {
      throw new Error(`Error attempting to start URI. Original error: ${e}`);
    }
  });

  return function (_x2, _x3) {
    return _ref2.apply(this, arguments);
  };
}();

apkUtilsMethods.startApp = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (startAppOptions = {}) {
    if (!startAppOptions.activity || !startAppOptions.pkg) {
      throw new Error("activity and pkg are required to start an application");
    }

    startAppOptions = _lodash.default.clone(startAppOptions);
    startAppOptions.activity = startAppOptions.activity.replace('$', '\\$');

    _lodash.default.defaults(startAppOptions, {
      waitPkg: startAppOptions.pkg,
      waitActivity: false,
      retry: true,
      stopApp: true
    });

    startAppOptions.waitPkg = startAppOptions.waitPkg || startAppOptions.pkg;
    const apiLevel = yield this.getApiLevel();
    const cmd = (0, _helpers.buildStartCmd)(startAppOptions, apiLevel);

    try {
      const shellOpts = {};

      if (_lodash.default.isInteger(startAppOptions.waitDuration) && startAppOptions.waitDuration > 20000) {
        shellOpts.timeout = startAppOptions.waitDuration;
      }

      const stdout = yield this.shell(cmd, shellOpts);

      if (stdout.includes("Error: Activity class") && stdout.includes("does not exist")) {
        if (startAppOptions.retry && !startAppOptions.activity.startsWith(".")) {
          _logger.default.debug(`We tried to start an activity that doesn't exist, ` + `retrying with '.${startAppOptions.activity}' activity name`);

          startAppOptions.activity = `.${startAppOptions.activity}`;
          startAppOptions.retry = false;
          return yield this.startApp(startAppOptions);
        }

        throw new Error(`Activity name '${startAppOptions.activity}' used to start the app doesn't ` + `exist or cannot be launched! Make sure it exists and is a launchable activity`);
      } else if (stdout.includes("java.lang.SecurityException")) {
        throw new Error(`The permission to start '${startAppOptions.activity}' activity has been denied.` + `Make sure the activity/package names are correct.`);
      }

      if (startAppOptions.waitActivity) {
        yield this.waitForActivity(startAppOptions.waitPkg, startAppOptions.waitActivity, startAppOptions.waitDuration);
      }

      return stdout;
    } catch (e) {
      throw new Error(`Cannot start the '${startAppOptions.pkg}' application. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting. ` + `Original error: ${e.message}`);
    }
  });

  return function () {
    return _ref3.apply(this, arguments);
  };
}();

apkUtilsMethods.getFocusedPackageAndActivity = (0, _asyncToGenerator2.default)(function* () {
  _logger.default.debug("Getting focused package and activity");

  const cmd = ['dumpsys', 'window', 'windows'];
  const nullFocusedAppRe = new RegExp(/^\s*mFocusedApp=null/, 'm');
  const focusedAppRe = new RegExp('^\\s*mFocusedApp.+Record\\{.*\\s([^\\s\\/\\}]+)' + '\\/([^\\s\\/\\}\\,]+)\\,?(\\s[^\\s\\/\\}]+)*\\}', 'm');
  const nullCurrentFocusRe = new RegExp(/^\s*mCurrentFocus=null/, 'm');
  const currentFocusAppRe = new RegExp('^\\s*mCurrentFocus.+\\{.+\\s([^\\s\\/]+)\\/([^\\s]+)\\b', 'm');

  try {
    const stdout = yield this.shell(cmd);
    var _arr = [focusedAppRe, currentFocusAppRe];

    for (var _i = 0; _i < _arr.length; _i++) {
      const pattern = _arr[_i];
      const match = pattern.exec(stdout);

      if (match) {
        return {
          appPackage: match[1].trim(),
          appActivity: match[2].trim()
        };
      }
    }

    var _arr2 = [nullFocusedAppRe, nullCurrentFocusRe];

    for (var _i2 = 0; _i2 < _arr2.length; _i2++) {
      const pattern = _arr2[_i2];

      if (pattern.exec(stdout)) {
        return {
          appPackage: null,
          appActivity: null
        };
      }
    }

    throw new Error("Could not parse activity from dumpsys");
  } catch (e) {
    throw new Error(`Could not get focusPackageAndActivity. Original error: ${e.message}`);
  }
});

apkUtilsMethods.waitForActivityOrNot = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (pkg, activity, waitForStop, waitMs = 20000) {
    var _this = this;

    if (!pkg || !activity) {
      throw new Error('Package and activity required.');
    }

    _logger.default.debug(`Waiting up to ${waitMs}ms for activity matching pkg: '${pkg}' and ` + `activity: '${activity}' to${waitForStop ? ' not' : ''} be focused`);

    const splitNames = names => names.split(',').map(name => name.trim());

    const allPackages = splitNames(pkg);
    const allActivities = splitNames(activity);
    let possibleActivityNames = [];
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = allActivities[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        let oneActivity = _step.value;

        if (oneActivity.startsWith('.')) {
          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = allPackages[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              let currentPkg = _step2.value;
              possibleActivityNames.push(`${currentPkg}${oneActivity}`.replace(/\.+/g, '.'));
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
                _iterator2.return();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }
        } else {
          possibleActivityNames.push(oneActivity);
          possibleActivityNames.push(`${pkg}.${oneActivity}`);
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    _logger.default.debug(`Possible activities, to be checked: ${possibleActivityNames.map(name => `'${name}'`).join(', ')}`);

    let possibleActivityPatterns = possibleActivityNames.map(possibleActivityName => new RegExp(`^${possibleActivityName.replace(/\./g, '\\.').replace(/\*/g, '.*?').replace(/\$/g, '\\$')}$`));
    let retries = parseInt(waitMs / 750, 10) || 1;
    retries = isNaN(retries) ? 30 : retries;
    yield (0, _asyncbox.retryInterval)(retries, 750, (0, _asyncToGenerator2.default)(function* () {
      let _ref7 = yield _this.getFocusedPackageAndActivity(),
          appPackage = _ref7.appPackage,
          appActivity = _ref7.appActivity;

      if (appActivity && appPackage) {
        let fullyQualifiedActivity = appActivity.startsWith('.') ? `${appPackage}${appActivity}` : appActivity;

        _logger.default.debug(`Found package: '${appPackage}' and fully qualified activity name : '${fullyQualifiedActivity}'`);

        let foundAct = _lodash.default.includes(allPackages, appPackage) && _lodash.default.findIndex(possibleActivityPatterns, possiblePattern => possiblePattern.test(fullyQualifiedActivity)) !== -1;

        if (!waitForStop && foundAct || waitForStop && !foundAct) {
          return;
        }
      }

      _logger.default.debug('Incorrect package and activity. Retrying.');

      throw new Error(`${possibleActivityNames.map(name => `'${name}'`).join(' or ')} never ${waitForStop ? 'stopped' : 'started'}. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting`);
    }));
  });

  return function (_x4, _x5, _x6) {
    return _ref5.apply(this, arguments);
  };
}();

apkUtilsMethods.waitForActivity = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (pkg, act, waitMs = 20000) {
    yield this.waitForActivityOrNot(pkg, act, false, waitMs);
  });

  return function (_x7, _x8) {
    return _ref8.apply(this, arguments);
  };
}();

apkUtilsMethods.waitForNotActivity = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (pkg, act, waitMs = 20000) {
    yield this.waitForActivityOrNot(pkg, act, true, waitMs);
  });

  return function (_x9, _x10) {
    return _ref9.apply(this, arguments);
  };
}();

const APK_UNINSTALL_TIMEOUT = 20000;

apkUtilsMethods.uninstallApk = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (pkg, options = {}) {
    options = Object.assign({
      timeout: APK_UNINSTALL_TIMEOUT
    }, options);

    _logger.default.debug(`Uninstalling ${pkg}`);

    if (!(yield this.isAppInstalled(pkg))) {
      _logger.default.info(`${pkg} was not uninstalled, because it was not present on the device`);

      return false;
    }

    const cmd = ['uninstall'];

    if (options.keepData) {
      cmd.push('-k');
    }

    cmd.push(pkg);
    let stdout;

    try {
      yield this.forceStop(pkg);
      stdout = (yield this.adbExec(cmd, {
        timeout: options.timeout
      })).trim();
    } catch (e) {
      throw new Error(`Unable to uninstall APK. Original error: ${e.message}`);
    }

    _logger.default.debug(`'adb ${cmd.join(' ')}' command output: ${stdout}`);

    if (stdout.includes("Success")) {
      _logger.default.info(`${pkg} was successfully uninstalled`);

      return true;
    }

    _logger.default.info(`${pkg} was not uninstalled`);

    return false;
  });

  return function (_x11) {
    return _ref10.apply(this, arguments);
  };
}();

apkUtilsMethods.installFromDevicePath = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (apkPathOnDevice, opts = {}) {
    let stdout = yield this.shell(['pm', 'install', '-r', apkPathOnDevice], opts);

    if (stdout.indexOf("Failure") !== -1) {
      throw new Error(`Remote install failed: ${stdout}`);
    }
  });

  return function (_x12) {
    return _ref11.apply(this, arguments);
  };
}();

apkUtilsMethods.install = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (appPath, options = {}) {
    if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
      return yield this.installApks(appPath, options);
    }

    options = Object.assign({
      replace: true,
      timeout: _helpers.APK_INSTALL_TIMEOUT
    }, options);
    const installArgs = (0, _helpers.buildInstallArgs)((yield this.getApiLevel()), options);

    try {
      const output = yield this.adbExec(['install', ...installArgs, appPath], {
        timeout: options.timeout
      });
      const truncatedOutput = !_lodash.default.isString(output) || output.length <= 300 ? output : `${output.substr(0, 150)}...${output.substr(output.length - 150)}`;

      _logger.default.debug(`Install command stdout: ${truncatedOutput}`);

      if (_lodash.default.includes(output, 'INSTALL_FAILED')) {
        throw new Error(output);
      }
    } catch (err) {
      if (!err.message.includes('INSTALL_FAILED_ALREADY_EXISTS')) {
        throw err;
      }

      _logger.default.debug(`Application '${appPath}' already installed. Continuing.`);
    }
  });

  return function (_x13) {
    return _ref12.apply(this, arguments);
  };
}();

apkUtilsMethods.installOrUpgrade = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (appPath, pkg = null, options = {}) {
    if (!_appiumSupport.util.hasValue(options.timeout)) {
      options.timeout = _helpers.APK_INSTALL_TIMEOUT;
    }

    let apkInfo = null;

    if (!pkg) {
      apkInfo = yield this.getApkInfo(appPath);
      pkg = apkInfo.name;
    }

    if (!pkg) {
      _logger.default.warn(`Cannot read the package name of ${appPath}. Assuming correct app version is already installed`);

      return;
    }

    if (!(yield this.isAppInstalled(pkg))) {
      _logger.default.debug(`App '${appPath}' not installed. Installing`);

      yield this.install(appPath, Object.assign({}, options, {
        replace: false
      }));
      return;
    }

    const _ref14 = yield this.getPackageInfo(pkg),
          pkgVersionCode = _ref14.versionCode,
          pkgVersionNameStr = _ref14.versionName;

    const pkgVersionName = _semver.default.valid(_semver.default.coerce(pkgVersionNameStr));

    if (!apkInfo) {
      apkInfo = yield this.getApkInfo(appPath);
    }

    const _apkInfo = apkInfo,
          apkVersionCode = _apkInfo.versionCode,
          apkVersionNameStr = _apkInfo.versionName;

    const apkVersionName = _semver.default.valid(_semver.default.coerce(apkVersionNameStr));

    if (!_lodash.default.isInteger(apkVersionCode) || !_lodash.default.isInteger(pkgVersionCode)) {
      _logger.default.warn(`Cannot read version codes of '${appPath}' and/or '${pkg}'`);

      if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
        _logger.default.warn(`Cannot read version names of '${appPath}' and/or '${pkg}'. Assuming correct app version is already installed`);

        return;
      }
    }

    if (_lodash.default.isInteger(apkVersionCode) && _lodash.default.isInteger(pkgVersionCode)) {
      if (pkgVersionCode > apkVersionCode) {
        _logger.default.debug(`The installed '${pkg}' package does not require upgrade (${pkgVersionCode} > ${apkVersionCode})`);

        return;
      }

      if (pkgVersionCode === apkVersionCode) {
        if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
          _logger.default.debug(`The installed '${pkg}' package does not require upgrade ('${pkgVersionName}' >= '${apkVersionName}')`);

          return;
        }

        if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
          _logger.default.debug(`The installed '${pkg}' package does not require upgrade (${pkgVersionCode} === ${apkVersionCode})`);

          return;
        }
      }
    } else if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
      _logger.default.debug(`The installed '${pkg}' package does not require upgrade ('${pkgVersionName}' >= '${apkVersionName}')`);

      return;
    }

    _logger.default.debug(`The installed '${pkg}' package is older than '${appPath}' ` + `(${pkgVersionCode} < ${apkVersionCode} or '${pkgVersionName}' < '${apkVersionName}')'. ` + `Executing upgrade`);

    try {
      yield this.install(appPath, Object.assign({}, options, {
        replace: true
      }));
    } catch (err) {
      _logger.default.warn(`Cannot upgrade '${pkg}' because of '${err.message}'. Trying full reinstall`);

      if (!(yield this.uninstallApk(pkg))) {
        throw new Error(`'${pkg}' package cannot be uninstalled`);
      }

      yield this.install(appPath, Object.assign({}, options, {
        replace: false
      }));
    }
  });

  return function (_x14) {
    return _ref13.apply(this, arguments);
  };
}();

apkUtilsMethods.extractStringsFromApk = function () {
  var _ref15 = (0, _asyncToGenerator2.default)(function* (appPath, language, out) {
    _logger.default.debug(`Extracting strings from for language: ${language || 'default'}`);

    if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
      appPath = yield this.extractLanguageApk(appPath, language);
    }

    yield this.initAapt();
    let rawAaptOutput;

    try {
      const _ref16 = yield (0, _teen_process.exec)(this.binaries.aapt, ['d', '--values', 'resources', appPath]),
            stdout = _ref16.stdout;

      rawAaptOutput = stdout;
    } catch (e) {
      throw new Error(`Cannot extract resources from '${appPath}'. Original error: ${e.message}`);
    }

    const defaultConfigMarker = '(default)';
    let configMarker = language || defaultConfigMarker;

    if (configMarker.includes('-') && !configMarker.includes('-r')) {
      configMarker = configMarker.replace('-', '-r');
    }

    if (configMarker.toLowerCase().startsWith('en')) {
      const _ref17 = yield (0, _teen_process.exec)(this.binaries.aapt, ['d', 'configurations', appPath]),
            stdout = _ref17.stdout;

      const configs = stdout.split(_os.default.EOL);

      if (!configs.includes(configMarker)) {
        _logger.default.debug(`There is no '${configMarker}' configuration. ` + `Replacing it with '${defaultConfigMarker}'`);

        configMarker = defaultConfigMarker;
      }
    }

    const apkStrings = {};
    let isInConfig = false;
    let currentResourceId = null;
    let isInPluralGroup = false;

    const startsWithAny = (s, arr) => arr.reduce((acc, x) => acc || s.startsWith(x), false);

    const normalizeStringMatch = s => s.replace(/"$/, '').replace(/^"/, '').replace(/\\"/g, '"');

    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = rawAaptOutput.split(_os.default.EOL)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        const line = _step3.value;
        const trimmedLine = line.trim();

        if (_lodash.default.isEmpty(trimmedLine)) {
          continue;
        }

        if (startsWithAny(trimmedLine, ['config', 'type', 'spec', 'Package'])) {
          isInConfig = trimmedLine.startsWith(`config ${configMarker}:`);
          currentResourceId = null;
          isInPluralGroup = false;
          continue;
        }

        if (!isInConfig) {
          continue;
        }

        if (trimmedLine.startsWith('resource')) {
          isInPluralGroup = false;
          currentResourceId = null;

          if (trimmedLine.includes(':string/')) {
            const match = /:string\/(\S+):/.exec(trimmedLine);

            if (match) {
              currentResourceId = match[1];
            }
          } else if (trimmedLine.includes(':plurals/')) {
            const match = /:plurals\/(\S+):/.exec(trimmedLine);

            if (match) {
              currentResourceId = match[1];
              isInPluralGroup = true;
            }
          }

          continue;
        }

        if (currentResourceId && trimmedLine.startsWith('(string')) {
          const match = /"[^"\\]*(?:\\.[^"\\]*)*"/.exec(trimmedLine);

          if (match) {
            apkStrings[currentResourceId] = normalizeStringMatch(match[0]);
          }

          currentResourceId = null;
          continue;
        }

        if (currentResourceId && isInPluralGroup && trimmedLine.includes(': (string')) {
          const match = /"[^"\\]*(?:\\.[^"\\]*)*"/.exec(trimmedLine);

          if (match) {
            apkStrings[currentResourceId] = [...(apkStrings[currentResourceId] || []), normalizeStringMatch(match[0])];
          }

          continue;
        }
      }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }

    if (_lodash.default.isEmpty(apkStrings)) {
      _logger.default.warn(`No strings have been found in '${appPath}' resources ` + `for '${configMarker}' configuration`);
    } else {
      _logger.default.info(`Successfully extracted ${_lodash.default.keys(apkStrings).length} strings from '${appPath}' resources ` + `for '${configMarker}' configuration`);
    }

    const localPath = _path.default.resolve(out, 'strings.json');

    yield (0, _appiumSupport.mkdirp)(out);
    yield _appiumSupport.fs.writeFile(localPath, JSON.stringify(apkStrings, null, 2), 'utf-8');
    return {
      apkStrings,
      localPath
    };
  });

  return function (_x15, _x16, _x17) {
    return _ref15.apply(this, arguments);
  };
}();

apkUtilsMethods.getDeviceLanguage = (0, _asyncToGenerator2.default)(function* () {
  let language;

  if ((yield this.getApiLevel()) < 23) {
    language = yield this.getDeviceSysLanguage();

    if (!language) {
      language = yield this.getDeviceProductLanguage();
    }
  } else {
    language = (yield this.getDeviceLocale()).split("-")[0];
  }

  return language;
});

apkUtilsMethods.setDeviceLanguage = function () {
  var _ref19 = (0, _asyncToGenerator2.default)(function* (language) {
    yield this.setDeviceSysLanguage(language);
  });

  return function (_x18) {
    return _ref19.apply(this, arguments);
  };
}();

apkUtilsMethods.getDeviceCountry = (0, _asyncToGenerator2.default)(function* () {
  let country = yield this.getDeviceSysCountry();

  if (!country) {
    country = yield this.getDeviceProductCountry();
  }

  return country;
});

apkUtilsMethods.setDeviceCountry = function () {
  var _ref21 = (0, _asyncToGenerator2.default)(function* (country) {
    yield this.setDeviceSysCountry(country);
  });

  return function (_x19) {
    return _ref21.apply(this, arguments);
  };
}();

apkUtilsMethods.getDeviceLocale = (0, _asyncToGenerator2.default)(function* () {
  let locale = yield this.getDeviceSysLocale();

  if (!locale) {
    locale = yield this.getDeviceProductLocale();
  }

  return locale;
});

apkUtilsMethods.setDeviceLocale = function () {
  var _ref23 = (0, _asyncToGenerator2.default)(function* (locale) {
    const validateLocale = new RegExp(/[a-zA-Z]+-[a-zA-Z0-9]+/);

    if (!validateLocale.test(locale)) {
      _logger.default.warn(`setDeviceLocale requires the following format: en-US or ja-JP`);

      return;
    }

    let split_locale = locale.split("-");
    yield this.setDeviceLanguageCountry(split_locale[0], split_locale[1]);
  });

  return function (_x20) {
    return _ref23.apply(this, arguments);
  };
}();

apkUtilsMethods.ensureCurrentLocale = function () {
  var _ref24 = (0, _asyncToGenerator2.default)(function* (language, country, script = null) {
    var _this2 = this;

    const hasLanguage = _lodash.default.isString(language);

    const hasCountry = _lodash.default.isString(country);

    if (!hasLanguage && !hasCountry) {
      _logger.default.warn('ensureCurrentLocale requires language or country');

      return false;
    }

    language = (language || '').toLowerCase();
    country = (country || '').toLowerCase();
    const apiLevel = yield this.getApiLevel();
    return yield (0, _asyncbox.retryInterval)(5, 1000, (0, _asyncToGenerator2.default)(function* () {
      try {
        if (apiLevel < 23) {
          let curLanguage, curCountry;

          if (hasLanguage) {
            curLanguage = (yield _this2.getDeviceLanguage()).toLowerCase();

            if (!hasCountry && language === curLanguage) {
              return true;
            }
          }

          if (hasCountry) {
            curCountry = (yield _this2.getDeviceCountry()).toLowerCase();

            if (!hasLanguage && country === curCountry) {
              return true;
            }
          }

          if (language === curLanguage && country === curCountry) {
            return true;
          }
        } else {
          const curLocale = (yield _this2.getDeviceLocale()).toLowerCase();
          const localeCode = script ? `${language}-${script.toLowerCase()}-${country}` : `${language}-${country}`;

          if (localeCode === curLocale) {
            _logger.default.debug(`Requested locale is equal to current locale: '${curLocale}'`);

            return true;
          }
        }

        return false;
      } catch (err) {
        _logger.default.error(`Unable to check device localization: ${err.message}`);

        _logger.default.debug('Restarting ADB and retrying...');

        yield _this2.restartAdb();
        throw err;
      }
    }));
  });

  return function (_x21, _x22) {
    return _ref24.apply(this, arguments);
  };
}();

apkUtilsMethods.setDeviceLanguageCountry = function () {
  var _ref26 = (0, _asyncToGenerator2.default)(function* (language, country, script = null) {
    let hasLanguage = language && _lodash.default.isString(language);

    let hasCountry = country && _lodash.default.isString(country);

    if (!hasLanguage || !hasCountry) {
      _logger.default.warn(`setDeviceLanguageCountry requires language and country at least`);

      _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

      return;
    }

    let apiLevel = yield this.getApiLevel();
    language = (language || '').toLowerCase();
    country = (country || '').toUpperCase();

    if (apiLevel < 23) {
      let curLanguage = (yield this.getDeviceLanguage()).toLowerCase();
      let curCountry = (yield this.getDeviceCountry()).toUpperCase();

      if (language !== curLanguage || country !== curCountry) {
        yield this.setDeviceSysLocaleViaSettingApp(language, country);
      }
    } else {
      let curLocale = yield this.getDeviceLocale();
      const localeCode = script ? `${language}-${script}-${country}` : `${language}-${country}`;

      _logger.default.debug(`Current locale: '${curLocale}'; requested locale: '${localeCode}'`);

      if (localeCode.toLowerCase() !== curLocale.toLowerCase()) {
        yield this.setDeviceSysLocaleViaSettingApp(language, country, script);
      }
    }
  });

  return function (_x23, _x24) {
    return _ref26.apply(this, arguments);
  };
}();

apkUtilsMethods.getApkInfo = function () {
  var _ref27 = (0, _asyncToGenerator2.default)(function* (appPath) {
    if (!(yield _appiumSupport.fs.exists(appPath))) {
      throw new Error(`The file at path ${appPath} does not exist or is not accessible`);
    }

    if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
      appPath = yield this.extractBaseApk(appPath);
    }

    yield this.initAapt();

    try {
      const _ref28 = yield (0, _teen_process.exec)(this.binaries.aapt, ['d', 'badging', appPath]),
            stdout = _ref28.stdout;

      const matches = new RegExp(/package: name='([^']+)' versionCode='(\d+)' versionName='([^']+)'/).exec(stdout);

      if (matches) {
        return {
          name: matches[1],
          versionCode: parseInt(matches[2], 10),
          versionName: matches[3]
        };
      }
    } catch (err) {
      _logger.default.warn(`Error "${err.message}" while getting badging info`);
    }

    return {};
  });

  return function (_x25) {
    return _ref27.apply(this, arguments);
  };
}();

apkUtilsMethods.getPackageInfo = function () {
  var _ref29 = (0, _asyncToGenerator2.default)(function* (pkg) {
    _logger.default.debug(`Getting package info for '${pkg}'`);

    let result = {
      name: pkg
    };

    try {
      const stdout = yield this.shell(['dumpsys', 'package', pkg]);
      const versionNameMatch = new RegExp(/versionName=([\d+.]+)/).exec(stdout);

      if (versionNameMatch) {
        result.versionName = versionNameMatch[1];
      }

      const versionCodeMatch = new RegExp(/versionCode=(\d+)/).exec(stdout);

      if (versionCodeMatch) {
        result.versionCode = parseInt(versionCodeMatch[1], 10);
      }

      return result;
    } catch (err) {
      _logger.default.warn(`Error '${err.message}' while dumping package info`);
    }

    return result;
  });

  return function (_x26) {
    return _ref29.apply(this, arguments);
  };
}();

apkUtilsMethods.pullApk = function () {
  var _pullApk = (0, _asyncToGenerator2.default)(function* (pkg, tmpDir) {
    const pkgPath = (yield this.adbExec(['shell', 'pm', 'path', pkg])).replace('package:', '');

    const tmpApp = _path.default.resolve(tmpDir, `${pkg}.apk`);

    yield this.pull(pkgPath, tmpApp);

    _logger.default.debug(`Pulled app for package '${pkg}' to '${tmpApp}'`);

    return tmpApp;
  });

  return function pullApk(_x27, _x28) {
    return _pullApk.apply(this, arguments);
  };
}();

var _default = apkUtilsMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hcGstdXRpbHMuanMiXSwibmFtZXMiOlsiYXBrVXRpbHNNZXRob2RzIiwiQUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOSyIsImlzQXBwSW5zdGFsbGVkIiwicGtnIiwibG9nIiwiZGVidWciLCJpbnN0YWxsZWRQYXR0ZXJuIiwiUmVnRXhwIiwiXyIsImVzY2FwZVJlZ0V4cCIsInN0ZG91dCIsInNoZWxsIiwiaXNJbnN0YWxsZWQiLCJ0ZXN0IiwiZSIsIkVycm9yIiwibWVzc2FnZSIsInN0YXJ0VXJpIiwidXJpIiwiYXJncyIsInJlcGxhY2UiLCJyZXMiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwic3RhcnRBcHAiLCJzdGFydEFwcE9wdGlvbnMiLCJhY3Rpdml0eSIsImNsb25lIiwiZGVmYXVsdHMiLCJ3YWl0UGtnIiwid2FpdEFjdGl2aXR5IiwicmV0cnkiLCJzdG9wQXBwIiwiYXBpTGV2ZWwiLCJnZXRBcGlMZXZlbCIsImNtZCIsInNoZWxsT3B0cyIsImlzSW50ZWdlciIsIndhaXREdXJhdGlvbiIsInRpbWVvdXQiLCJzdGFydHNXaXRoIiwid2FpdEZvckFjdGl2aXR5IiwiZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSIsIm51bGxGb2N1c2VkQXBwUmUiLCJmb2N1c2VkQXBwUmUiLCJudWxsQ3VycmVudEZvY3VzUmUiLCJjdXJyZW50Rm9jdXNBcHBSZSIsInBhdHRlcm4iLCJtYXRjaCIsImV4ZWMiLCJhcHBQYWNrYWdlIiwidHJpbSIsImFwcEFjdGl2aXR5Iiwid2FpdEZvckFjdGl2aXR5T3JOb3QiLCJ3YWl0Rm9yU3RvcCIsIndhaXRNcyIsInNwbGl0TmFtZXMiLCJuYW1lcyIsInNwbGl0IiwibWFwIiwibmFtZSIsImFsbFBhY2thZ2VzIiwiYWxsQWN0aXZpdGllcyIsInBvc3NpYmxlQWN0aXZpdHlOYW1lcyIsIm9uZUFjdGl2aXR5IiwiY3VycmVudFBrZyIsInB1c2giLCJqb2luIiwicG9zc2libGVBY3Rpdml0eVBhdHRlcm5zIiwicG9zc2libGVBY3Rpdml0eU5hbWUiLCJyZXRyaWVzIiwicGFyc2VJbnQiLCJpc05hTiIsImZ1bGx5UXVhbGlmaWVkQWN0aXZpdHkiLCJmb3VuZEFjdCIsImZpbmRJbmRleCIsInBvc3NpYmxlUGF0dGVybiIsImFjdCIsIndhaXRGb3JOb3RBY3Rpdml0eSIsIkFQS19VTklOU1RBTExfVElNRU9VVCIsInVuaW5zdGFsbEFwayIsIm9wdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJpbmZvIiwia2VlcERhdGEiLCJmb3JjZVN0b3AiLCJhZGJFeGVjIiwiaW5zdGFsbEZyb21EZXZpY2VQYXRoIiwiYXBrUGF0aE9uRGV2aWNlIiwib3B0cyIsImluZGV4T2YiLCJpbnN0YWxsIiwiYXBwUGF0aCIsImVuZHNXaXRoIiwiQVBLU19FWFRFTlNJT04iLCJpbnN0YWxsQXBrcyIsIkFQS19JTlNUQUxMX1RJTUVPVVQiLCJpbnN0YWxsQXJncyIsIm91dHB1dCIsInRydW5jYXRlZE91dHB1dCIsImlzU3RyaW5nIiwibGVuZ3RoIiwic3Vic3RyIiwiZXJyIiwiaW5zdGFsbE9yVXBncmFkZSIsInV0aWwiLCJoYXNWYWx1ZSIsImFwa0luZm8iLCJnZXRBcGtJbmZvIiwid2FybiIsImdldFBhY2thZ2VJbmZvIiwicGtnVmVyc2lvbkNvZGUiLCJ2ZXJzaW9uQ29kZSIsInBrZ1ZlcnNpb25OYW1lU3RyIiwidmVyc2lvbk5hbWUiLCJwa2dWZXJzaW9uTmFtZSIsInNlbXZlciIsInZhbGlkIiwiY29lcmNlIiwiYXBrVmVyc2lvbkNvZGUiLCJhcGtWZXJzaW9uTmFtZVN0ciIsImFwa1ZlcnNpb25OYW1lIiwic2F0aXNmaWVzIiwiZXh0cmFjdFN0cmluZ3NGcm9tQXBrIiwibGFuZ3VhZ2UiLCJvdXQiLCJleHRyYWN0TGFuZ3VhZ2VBcGsiLCJpbml0QWFwdCIsInJhd0FhcHRPdXRwdXQiLCJiaW5hcmllcyIsImFhcHQiLCJkZWZhdWx0Q29uZmlnTWFya2VyIiwiY29uZmlnTWFya2VyIiwiY29uZmlncyIsIm9zIiwiRU9MIiwiYXBrU3RyaW5ncyIsImlzSW5Db25maWciLCJjdXJyZW50UmVzb3VyY2VJZCIsImlzSW5QbHVyYWxHcm91cCIsInN0YXJ0c1dpdGhBbnkiLCJzIiwiYXJyIiwicmVkdWNlIiwiYWNjIiwieCIsIm5vcm1hbGl6ZVN0cmluZ01hdGNoIiwibGluZSIsInRyaW1tZWRMaW5lIiwiaXNFbXB0eSIsImtleXMiLCJsb2NhbFBhdGgiLCJwYXRoIiwicmVzb2x2ZSIsImZzIiwid3JpdGVGaWxlIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldERldmljZUxhbmd1YWdlIiwiZ2V0RGV2aWNlU3lzTGFuZ3VhZ2UiLCJnZXREZXZpY2VQcm9kdWN0TGFuZ3VhZ2UiLCJnZXREZXZpY2VMb2NhbGUiLCJzZXREZXZpY2VMYW5ndWFnZSIsInNldERldmljZVN5c0xhbmd1YWdlIiwiZ2V0RGV2aWNlQ291bnRyeSIsImNvdW50cnkiLCJnZXREZXZpY2VTeXNDb3VudHJ5IiwiZ2V0RGV2aWNlUHJvZHVjdENvdW50cnkiLCJzZXREZXZpY2VDb3VudHJ5Iiwic2V0RGV2aWNlU3lzQ291bnRyeSIsImxvY2FsZSIsImdldERldmljZVN5c0xvY2FsZSIsImdldERldmljZVByb2R1Y3RMb2NhbGUiLCJzZXREZXZpY2VMb2NhbGUiLCJ2YWxpZGF0ZUxvY2FsZSIsInNwbGl0X2xvY2FsZSIsInNldERldmljZUxhbmd1YWdlQ291bnRyeSIsImVuc3VyZUN1cnJlbnRMb2NhbGUiLCJzY3JpcHQiLCJoYXNMYW5ndWFnZSIsImhhc0NvdW50cnkiLCJjdXJMYW5ndWFnZSIsImN1ckNvdW50cnkiLCJjdXJMb2NhbGUiLCJsb2NhbGVDb2RlIiwiZXJyb3IiLCJyZXN0YXJ0QWRiIiwidG9VcHBlckNhc2UiLCJzZXREZXZpY2VTeXNMb2NhbGVWaWFTZXR0aW5nQXBwIiwiZXhpc3RzIiwiZXh0cmFjdEJhc2VBcGsiLCJtYXRjaGVzIiwicmVzdWx0IiwidmVyc2lvbk5hbWVNYXRjaCIsInZlcnNpb25Db2RlTWF0Y2giLCJwdWxsQXBrIiwidG1wRGlyIiwicGtnUGF0aCIsInRtcEFwcCIsInB1bGwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsSUFBSUEsZUFBZSxHQUFHLEVBQXRCO0FBRUEsTUFBTUMsK0JBQStCLEdBQ25DLHlHQURGOztBQVVBRCxlQUFlLENBQUNFLGNBQWhCO0FBQUEsNkNBQWlDLFdBQWdCQyxHQUFoQixFQUFxQjtBQUNwREMsb0JBQUlDLEtBQUosQ0FBVyw4QkFBNkJGLEdBQUksRUFBNUM7O0FBQ0EsVUFBTUcsZ0JBQWdCLEdBQUcsSUFBSUMsTUFBSixDQUFZLHNCQUFxQkMsZ0JBQUVDLFlBQUYsQ0FBZU4sR0FBZixDQUFvQixZQUFyRCxFQUFrRSxHQUFsRSxDQUF6Qjs7QUFDQSxRQUFJO0FBQ0YsWUFBTU8sTUFBTSxTQUFTLEtBQUtDLEtBQUwsQ0FBVyxDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCUixHQUF2QixDQUFYLENBQXJCO0FBQ0EsWUFBTVMsV0FBVyxHQUFHTixnQkFBZ0IsQ0FBQ08sSUFBakIsQ0FBc0JILE1BQXRCLENBQXBCOztBQUNBTixzQkFBSUMsS0FBSixDQUFXLElBQUdGLEdBQUksT0FBTSxDQUFDUyxXQUFELEdBQWUsTUFBZixHQUF3QixFQUFHLFlBQW5EOztBQUNBLGFBQU9BLFdBQVA7QUFDRCxLQUxELENBS0UsT0FBT0UsQ0FBUCxFQUFVO0FBQ1YsWUFBTSxJQUFJQyxLQUFKLENBQVcscUJBQW9CWixHQUFJLG1DQUFrQ1csQ0FBQyxDQUFDRSxPQUFRLEVBQS9FLENBQU47QUFDRDtBQUNGLEdBWEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBbUJBaEIsZUFBZSxDQUFDaUIsUUFBaEI7QUFBQSw4Q0FBMkIsV0FBZ0JDLEdBQWhCLEVBQXFCZixHQUFyQixFQUEwQjtBQUNuRCxRQUFJLENBQUNlLEdBQUQsSUFBUSxDQUFDZixHQUFiLEVBQWtCO0FBQ2hCLFlBQU0sSUFBSVksS0FBSixDQUFVLHdDQUFWLENBQU47QUFDRDs7QUFFRCxVQUFNSSxJQUFJLEdBQUcsQ0FDWCxJQURXLEVBQ0wsT0FESyxFQUVYLElBRlcsRUFHWCxJQUhXLEVBR0wsNEJBSEssRUFJWCxJQUpXLEVBSUxELEdBQUcsQ0FBQ0UsT0FBSixDQUFZLElBQVosRUFBa0IsS0FBbEIsQ0FKSyxFQUtYakIsR0FMVyxDQUFiOztBQU9BLFFBQUk7QUFDRixZQUFNa0IsR0FBRyxTQUFTLEtBQUtWLEtBQUwsQ0FBV1EsSUFBWCxDQUFsQjs7QUFDQSxVQUFJRSxHQUFHLENBQUNDLFdBQUosR0FBa0JDLFFBQWxCLENBQTJCLDBCQUEzQixDQUFKLEVBQTREO0FBQzFELGNBQU0sSUFBSVIsS0FBSixDQUFVTSxHQUFWLENBQU47QUFDRDtBQUNGLEtBTEQsQ0FLRSxPQUFPUCxDQUFQLEVBQVU7QUFDVixZQUFNLElBQUlDLEtBQUosQ0FBVyxrREFBaURELENBQUUsRUFBOUQsQ0FBTjtBQUNEO0FBQ0YsR0FwQkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBa0RBZCxlQUFlLENBQUN3QixRQUFoQjtBQUFBLDhDQUEyQixXQUFnQkMsZUFBZSxHQUFHLEVBQWxDLEVBQXNDO0FBQy9ELFFBQUksQ0FBQ0EsZUFBZSxDQUFDQyxRQUFqQixJQUE2QixDQUFDRCxlQUFlLENBQUN0QixHQUFsRCxFQUF1RDtBQUNyRCxZQUFNLElBQUlZLEtBQUosQ0FBVSx1REFBVixDQUFOO0FBQ0Q7O0FBRURVLElBQUFBLGVBQWUsR0FBR2pCLGdCQUFFbUIsS0FBRixDQUFRRixlQUFSLENBQWxCO0FBQ0FBLElBQUFBLGVBQWUsQ0FBQ0MsUUFBaEIsR0FBMkJELGVBQWUsQ0FBQ0MsUUFBaEIsQ0FBeUJOLE9BQXpCLENBQWlDLEdBQWpDLEVBQXNDLEtBQXRDLENBQTNCOztBQUVBWixvQkFBRW9CLFFBQUYsQ0FBV0gsZUFBWCxFQUE0QjtBQUMxQkksTUFBQUEsT0FBTyxFQUFFSixlQUFlLENBQUN0QixHQURDO0FBRTFCMkIsTUFBQUEsWUFBWSxFQUFFLEtBRlk7QUFHMUJDLE1BQUFBLEtBQUssRUFBRSxJQUhtQjtBQUkxQkMsTUFBQUEsT0FBTyxFQUFFO0FBSmlCLEtBQTVCOztBQU9BUCxJQUFBQSxlQUFlLENBQUNJLE9BQWhCLEdBQTBCSixlQUFlLENBQUNJLE9BQWhCLElBQTJCSixlQUFlLENBQUN0QixHQUFyRTtBQUVBLFVBQU04QixRQUFRLFNBQVMsS0FBS0MsV0FBTCxFQUF2QjtBQUNBLFVBQU1DLEdBQUcsR0FBRyw0QkFBY1YsZUFBZCxFQUErQlEsUUFBL0IsQ0FBWjs7QUFDQSxRQUFJO0FBQ0YsWUFBTUcsU0FBUyxHQUFHLEVBQWxCOztBQUNBLFVBQUk1QixnQkFBRTZCLFNBQUYsQ0FBWVosZUFBZSxDQUFDYSxZQUE1QixLQUE2Q2IsZUFBZSxDQUFDYSxZQUFoQixHQUErQixLQUFoRixFQUF1RjtBQUNyRkYsUUFBQUEsU0FBUyxDQUFDRyxPQUFWLEdBQW9CZCxlQUFlLENBQUNhLFlBQXBDO0FBQ0Q7O0FBQ0QsWUFBTTVCLE1BQU0sU0FBUyxLQUFLQyxLQUFMLENBQVd3QixHQUFYLEVBQWdCQyxTQUFoQixDQUFyQjs7QUFDQSxVQUFJMUIsTUFBTSxDQUFDYSxRQUFQLENBQWdCLHVCQUFoQixLQUE0Q2IsTUFBTSxDQUFDYSxRQUFQLENBQWdCLGdCQUFoQixDQUFoRCxFQUFtRjtBQUNqRixZQUFJRSxlQUFlLENBQUNNLEtBQWhCLElBQXlCLENBQUNOLGVBQWUsQ0FBQ0MsUUFBaEIsQ0FBeUJjLFVBQXpCLENBQW9DLEdBQXBDLENBQTlCLEVBQXdFO0FBQ3RFcEMsMEJBQUlDLEtBQUosQ0FBVyxvREFBRCxHQUNDLG1CQUFrQm9CLGVBQWUsQ0FBQ0MsUUFBUyxpQkFEdEQ7O0FBRUFELFVBQUFBLGVBQWUsQ0FBQ0MsUUFBaEIsR0FBNEIsSUFBR0QsZUFBZSxDQUFDQyxRQUFTLEVBQXhEO0FBQ0FELFVBQUFBLGVBQWUsQ0FBQ00sS0FBaEIsR0FBd0IsS0FBeEI7QUFDQSx1QkFBYSxLQUFLUCxRQUFMLENBQWNDLGVBQWQsQ0FBYjtBQUNEOztBQUNELGNBQU0sSUFBSVYsS0FBSixDQUFXLGtCQUFpQlUsZUFBZSxDQUFDQyxRQUFTLGtDQUEzQyxHQUNDLCtFQURYLENBQU47QUFFRCxPQVZELE1BVU8sSUFBSWhCLE1BQU0sQ0FBQ2EsUUFBUCxDQUFnQiw2QkFBaEIsQ0FBSixFQUFvRDtBQUV6RCxjQUFNLElBQUlSLEtBQUosQ0FBVyw0QkFBMkJVLGVBQWUsQ0FBQ0MsUUFBUyw2QkFBckQsR0FDQyxtREFEWCxDQUFOO0FBRUQ7O0FBQ0QsVUFBSUQsZUFBZSxDQUFDSyxZQUFwQixFQUFrQztBQUNoQyxjQUFNLEtBQUtXLGVBQUwsQ0FBcUJoQixlQUFlLENBQUNJLE9BQXJDLEVBQThDSixlQUFlLENBQUNLLFlBQTlELEVBQTRFTCxlQUFlLENBQUNhLFlBQTVGLENBQU47QUFDRDs7QUFDRCxhQUFPNUIsTUFBUDtBQUNELEtBekJELENBeUJFLE9BQU9JLENBQVAsRUFBVTtBQUNWLFlBQU0sSUFBSUMsS0FBSixDQUFXLHFCQUFvQlUsZUFBZSxDQUFDdEIsR0FBSSxpQkFBekMsR0FDYixTQUFRRiwrQkFBZ0Msd0JBRDNCLEdBRWIsbUJBQWtCYSxDQUFDLENBQUNFLE9BQVEsRUFGekIsQ0FBTjtBQUdEO0FBQ0YsR0FqREQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBZ0VBaEIsZUFBZSxDQUFDMEMsNEJBQWhCLG1DQUErQyxhQUFrQjtBQUMvRHRDLGtCQUFJQyxLQUFKLENBQVUsc0NBQVY7O0FBQ0EsUUFBTThCLEdBQUcsR0FBRyxDQUFDLFNBQUQsRUFBWSxRQUFaLEVBQXNCLFNBQXRCLENBQVo7QUFDQSxRQUFNUSxnQkFBZ0IsR0FBRyxJQUFJcEMsTUFBSixDQUFXLHNCQUFYLEVBQW1DLEdBQW5DLENBQXpCO0FBRUEsUUFBTXFDLFlBQVksR0FBRyxJQUFJckMsTUFBSixDQUFXLG9EQUNBLGlEQURYLEVBQzhELEdBRDlELENBQXJCO0FBRUEsUUFBTXNDLGtCQUFrQixHQUFHLElBQUl0QyxNQUFKLENBQVcsd0JBQVgsRUFBcUMsR0FBckMsQ0FBM0I7QUFDQSxRQUFNdUMsaUJBQWlCLEdBQUcsSUFBSXZDLE1BQUosQ0FBVyx5REFBWCxFQUFzRSxHQUF0RSxDQUExQjs7QUFFQSxNQUFJO0FBQ0YsVUFBTUcsTUFBTSxTQUFTLEtBQUtDLEtBQUwsQ0FBV3dCLEdBQVgsQ0FBckI7QUFERSxlQUdvQixDQUFDUyxZQUFELEVBQWVFLGlCQUFmLENBSHBCOztBQUdGLDZDQUF5RDtBQUFwRCxZQUFNQyxPQUFPLFdBQWI7QUFDSCxZQUFNQyxLQUFLLEdBQUdELE9BQU8sQ0FBQ0UsSUFBUixDQUFhdkMsTUFBYixDQUFkOztBQUNBLFVBQUlzQyxLQUFKLEVBQVc7QUFDVCxlQUFPO0FBQ0xFLFVBQUFBLFVBQVUsRUFBRUYsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTRyxJQUFULEVBRFA7QUFFTEMsVUFBQUEsV0FBVyxFQUFFSixLQUFLLENBQUMsQ0FBRCxDQUFMLENBQVNHLElBQVQ7QUFGUixTQUFQO0FBSUQ7QUFDRjs7QUFYQyxnQkFhb0IsQ0FBQ1IsZ0JBQUQsRUFBbUJFLGtCQUFuQixDQWJwQjs7QUFhRixpREFBOEQ7QUFBekQsWUFBTUUsT0FBTyxhQUFiOztBQUNILFVBQUlBLE9BQU8sQ0FBQ0UsSUFBUixDQUFhdkMsTUFBYixDQUFKLEVBQTBCO0FBQ3hCLGVBQU87QUFDTHdDLFVBQUFBLFVBQVUsRUFBRSxJQURQO0FBRUxFLFVBQUFBLFdBQVcsRUFBRTtBQUZSLFNBQVA7QUFJRDtBQUNGOztBQUVELFVBQU0sSUFBSXJDLEtBQUosQ0FBVSx1Q0FBVixDQUFOO0FBQ0QsR0F2QkQsQ0F1QkUsT0FBT0QsQ0FBUCxFQUFVO0FBQ1YsVUFBTSxJQUFJQyxLQUFKLENBQVcsMERBQXlERCxDQUFDLENBQUNFLE9BQVEsRUFBOUUsQ0FBTjtBQUNEO0FBQ0YsQ0FwQ0Q7O0FBaURBaEIsZUFBZSxDQUFDcUQsb0JBQWhCO0FBQUEsOENBQXVDLFdBQWdCbEQsR0FBaEIsRUFBcUJ1QixRQUFyQixFQUErQjRCLFdBQS9CLEVBQTRDQyxNQUFNLEdBQUcsS0FBckQsRUFBNEQ7QUFBQTs7QUFDakcsUUFBSSxDQUFDcEQsR0FBRCxJQUFRLENBQUN1QixRQUFiLEVBQXVCO0FBQ3JCLFlBQU0sSUFBSVgsS0FBSixDQUFVLGdDQUFWLENBQU47QUFDRDs7QUFDRFgsb0JBQUlDLEtBQUosQ0FBVyxpQkFBZ0JrRCxNQUFPLGtDQUFpQ3BELEdBQUksUUFBN0QsR0FDQyxjQUFhdUIsUUFBUyxPQUFNNEIsV0FBVyxHQUFHLE1BQUgsR0FBWSxFQUFHLGFBRGpFOztBQUdBLFVBQU1FLFVBQVUsR0FBSUMsS0FBRCxJQUFXQSxLQUFLLENBQUNDLEtBQU4sQ0FBWSxHQUFaLEVBQWlCQyxHQUFqQixDQUFzQkMsSUFBRCxJQUFVQSxJQUFJLENBQUNULElBQUwsRUFBL0IsQ0FBOUI7O0FBRUEsVUFBTVUsV0FBVyxHQUFHTCxVQUFVLENBQUNyRCxHQUFELENBQTlCO0FBQ0EsVUFBTTJELGFBQWEsR0FBR04sVUFBVSxDQUFDOUIsUUFBRCxDQUFoQztBQUVBLFFBQUlxQyxxQkFBcUIsR0FBRyxFQUE1QjtBQVppRztBQUFBO0FBQUE7O0FBQUE7QUFhakcsMkJBQXdCRCxhQUF4Qiw4SEFBdUM7QUFBQSxZQUE5QkUsV0FBOEI7O0FBQ3JDLFlBQUlBLFdBQVcsQ0FBQ3hCLFVBQVosQ0FBdUIsR0FBdkIsQ0FBSixFQUFpQztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUUvQixrQ0FBdUJxQixXQUF2QixtSUFBb0M7QUFBQSxrQkFBM0JJLFVBQTJCO0FBQ2xDRixjQUFBQSxxQkFBcUIsQ0FBQ0csSUFBdEIsQ0FBNEIsR0FBRUQsVUFBVyxHQUFFRCxXQUFZLEVBQTVCLENBQThCNUMsT0FBOUIsQ0FBc0MsTUFBdEMsRUFBOEMsR0FBOUMsQ0FBM0I7QUFDRDtBQUo4QjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS2hDLFNBTEQsTUFLTztBQUVMMkMsVUFBQUEscUJBQXFCLENBQUNHLElBQXRCLENBQTJCRixXQUEzQjtBQUNBRCxVQUFBQSxxQkFBcUIsQ0FBQ0csSUFBdEIsQ0FBNEIsR0FBRS9ELEdBQUksSUFBRzZELFdBQVksRUFBakQ7QUFDRDtBQUNGO0FBeEJnRztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQXlCakc1RCxvQkFBSUMsS0FBSixDQUFXLHVDQUFzQzBELHFCQUFxQixDQUFDSixHQUF0QixDQUEyQkMsSUFBRCxJQUFXLElBQUdBLElBQUssR0FBN0MsRUFBaURPLElBQWpELENBQXNELElBQXRELENBQTRELEVBQTdHOztBQUVBLFFBQUlDLHdCQUF3QixHQUFHTCxxQkFBcUIsQ0FBQ0osR0FBdEIsQ0FBMkJVLG9CQUFELElBQ3ZELElBQUk5RCxNQUFKLENBQVksSUFBRzhELG9CQUFvQixDQUFDakQsT0FBckIsQ0FBNkIsS0FBN0IsRUFBb0MsS0FBcEMsRUFBMkNBLE9BQTNDLENBQW1ELEtBQW5ELEVBQTBELEtBQTFELEVBQWlFQSxPQUFqRSxDQUF5RSxLQUF6RSxFQUFnRixLQUFoRixDQUF1RixHQUF0RyxDQUQ2QixDQUEvQjtBQU1BLFFBQUlrRCxPQUFPLEdBQUdDLFFBQVEsQ0FBQ2hCLE1BQU0sR0FBRyxHQUFWLEVBQWUsRUFBZixDQUFSLElBQThCLENBQTVDO0FBQ0FlLElBQUFBLE9BQU8sR0FBR0UsS0FBSyxDQUFDRixPQUFELENBQUwsR0FBaUIsRUFBakIsR0FBc0JBLE9BQWhDO0FBQ0EsVUFBTSw2QkFBY0EsT0FBZCxFQUF1QixHQUF2QixrQ0FBNEIsYUFBWTtBQUFBLHdCQUNOLEtBQUksQ0FBQzVCLDRCQUFMLEVBRE07QUFBQSxVQUN2Q1EsVUFEdUMsU0FDdkNBLFVBRHVDO0FBQUEsVUFDM0JFLFdBRDJCLFNBQzNCQSxXQUQyQjs7QUFFNUMsVUFBSUEsV0FBVyxJQUFJRixVQUFuQixFQUErQjtBQUM3QixZQUFJdUIsc0JBQXNCLEdBQUdyQixXQUFXLENBQUNaLFVBQVosQ0FBdUIsR0FBdkIsSUFBK0IsR0FBRVUsVUFBVyxHQUFFRSxXQUFZLEVBQTFELEdBQThEQSxXQUEzRjs7QUFDQWhELHdCQUFJQyxLQUFKLENBQVcsbUJBQWtCNkMsVUFBVywwQ0FBeUN1QixzQkFBdUIsR0FBeEc7O0FBQ0EsWUFBSUMsUUFBUSxHQUFJbEUsZ0JBQUVlLFFBQUYsQ0FBV3NDLFdBQVgsRUFBd0JYLFVBQXhCLEtBQ0ExQyxnQkFBRW1FLFNBQUYsQ0FBWVAsd0JBQVosRUFBdUNRLGVBQUQsSUFBcUJBLGVBQWUsQ0FBQy9ELElBQWhCLENBQXFCNEQsc0JBQXJCLENBQTNELE1BQTZHLENBQUMsQ0FEOUg7O0FBRUEsWUFBSyxDQUFDbkIsV0FBRCxJQUFnQm9CLFFBQWpCLElBQStCcEIsV0FBVyxJQUFJLENBQUNvQixRQUFuRCxFQUE4RDtBQUM1RDtBQUNEO0FBQ0Y7O0FBQ0R0RSxzQkFBSUMsS0FBSixDQUFVLDJDQUFWOztBQUNBLFlBQU0sSUFBSVUsS0FBSixDQUFXLEdBQUVnRCxxQkFBcUIsQ0FBQ0osR0FBdEIsQ0FBMkJDLElBQUQsSUFBVyxJQUFHQSxJQUFLLEdBQTdDLEVBQWlETyxJQUFqRCxDQUFzRCxNQUF0RCxDQUE4RCxVQUFTYixXQUFXLEdBQUcsU0FBSCxHQUFlLFNBQVUsSUFBOUcsR0FDYixTQUFRckQsK0JBQWdDLHNCQURyQyxDQUFOO0FBRUQsS0FkSyxFQUFOO0FBZUQsR0FsREQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBNkRBRCxlQUFlLENBQUN5QyxlQUFoQjtBQUFBLDhDQUFrQyxXQUFnQnRDLEdBQWhCLEVBQXFCMEUsR0FBckIsRUFBMEJ0QixNQUFNLEdBQUcsS0FBbkMsRUFBMEM7QUFDMUUsVUFBTSxLQUFLRixvQkFBTCxDQUEwQmxELEdBQTFCLEVBQStCMEUsR0FBL0IsRUFBb0MsS0FBcEMsRUFBMkN0QixNQUEzQyxDQUFOO0FBQ0QsR0FGRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFhQXZELGVBQWUsQ0FBQzhFLGtCQUFoQjtBQUFBLDhDQUFxQyxXQUFnQjNFLEdBQWhCLEVBQXFCMEUsR0FBckIsRUFBMEJ0QixNQUFNLEdBQUcsS0FBbkMsRUFBMEM7QUFDN0UsVUFBTSxLQUFLRixvQkFBTCxDQUEwQmxELEdBQTFCLEVBQStCMEUsR0FBL0IsRUFBb0MsSUFBcEMsRUFBMEN0QixNQUExQyxDQUFOO0FBQ0QsR0FGRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFZQSxNQUFNd0IscUJBQXFCLEdBQUcsS0FBOUI7O0FBVUEvRSxlQUFlLENBQUNnRixZQUFoQjtBQUFBLCtDQUErQixXQUFnQjdFLEdBQWhCLEVBQXFCOEUsT0FBTyxHQUFHLEVBQS9CLEVBQW1DO0FBQ2hFQSxJQUFBQSxPQUFPLEdBQUdDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjO0FBQ3RCNUMsTUFBQUEsT0FBTyxFQUFFd0M7QUFEYSxLQUFkLEVBRVBFLE9BRk8sQ0FBVjs7QUFHQTdFLG9CQUFJQyxLQUFKLENBQVcsZ0JBQWVGLEdBQUksRUFBOUI7O0FBQ0EsUUFBSSxRQUFPLEtBQUtELGNBQUwsQ0FBb0JDLEdBQXBCLENBQVAsQ0FBSixFQUFxQztBQUNuQ0Msc0JBQUlnRixJQUFKLENBQVUsR0FBRWpGLEdBQUksZ0VBQWhCOztBQUNBLGFBQU8sS0FBUDtBQUNEOztBQUVELFVBQU1nQyxHQUFHLEdBQUcsQ0FBQyxXQUFELENBQVo7O0FBQ0EsUUFBSThDLE9BQU8sQ0FBQ0ksUUFBWixFQUFzQjtBQUNwQmxELE1BQUFBLEdBQUcsQ0FBQytCLElBQUosQ0FBUyxJQUFUO0FBQ0Q7O0FBQ0QvQixJQUFBQSxHQUFHLENBQUMrQixJQUFKLENBQVMvRCxHQUFUO0FBRUEsUUFBSU8sTUFBSjs7QUFDQSxRQUFJO0FBQ0YsWUFBTSxLQUFLNEUsU0FBTCxDQUFlbkYsR0FBZixDQUFOO0FBQ0FPLE1BQUFBLE1BQU0sR0FBRyxPQUFPLEtBQUs2RSxPQUFMLENBQWFwRCxHQUFiLEVBQWtCO0FBQUNJLFFBQUFBLE9BQU8sRUFBRTBDLE9BQU8sQ0FBQzFDO0FBQWxCLE9BQWxCLENBQVAsRUFBc0RZLElBQXRELEVBQVQ7QUFDRCxLQUhELENBR0UsT0FBT3JDLENBQVAsRUFBVTtBQUNWLFlBQU0sSUFBSUMsS0FBSixDQUFXLDRDQUEyQ0QsQ0FBQyxDQUFDRSxPQUFRLEVBQWhFLENBQU47QUFDRDs7QUFDRFosb0JBQUlDLEtBQUosQ0FBVyxRQUFPOEIsR0FBRyxDQUFDZ0MsSUFBSixDQUFTLEdBQVQsQ0FBYyxxQkFBb0J6RCxNQUFPLEVBQTNEOztBQUNBLFFBQUlBLE1BQU0sQ0FBQ2EsUUFBUCxDQUFnQixTQUFoQixDQUFKLEVBQWdDO0FBQzlCbkIsc0JBQUlnRixJQUFKLENBQVUsR0FBRWpGLEdBQUksK0JBQWhCOztBQUNBLGFBQU8sSUFBUDtBQUNEOztBQUNEQyxvQkFBSWdGLElBQUosQ0FBVSxHQUFFakYsR0FBSSxzQkFBaEI7O0FBQ0EsV0FBTyxLQUFQO0FBQ0QsR0E5QkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBd0NBSCxlQUFlLENBQUN3RixxQkFBaEI7QUFBQSwrQ0FBd0MsV0FBZ0JDLGVBQWhCLEVBQWlDQyxJQUFJLEdBQUcsRUFBeEMsRUFBNEM7QUFDbEYsUUFBSWhGLE1BQU0sU0FBUyxLQUFLQyxLQUFMLENBQVcsQ0FBQyxJQUFELEVBQU8sU0FBUCxFQUFrQixJQUFsQixFQUF3QjhFLGVBQXhCLENBQVgsRUFBcURDLElBQXJELENBQW5COztBQUNBLFFBQUloRixNQUFNLENBQUNpRixPQUFQLENBQWUsU0FBZixNQUE4QixDQUFDLENBQW5DLEVBQXNDO0FBQ3BDLFlBQU0sSUFBSTVFLEtBQUosQ0FBVywwQkFBeUJMLE1BQU8sRUFBM0MsQ0FBTjtBQUNEO0FBQ0YsR0FMRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUErQkFWLGVBQWUsQ0FBQzRGLE9BQWhCO0FBQUEsK0NBQTBCLFdBQWdCQyxPQUFoQixFQUF5QlosT0FBTyxHQUFHLEVBQW5DLEVBQXVDO0FBQy9ELFFBQUlZLE9BQU8sQ0FBQ0MsUUFBUixDQUFpQkMsdUJBQWpCLENBQUosRUFBc0M7QUFDcEMsbUJBQWEsS0FBS0MsV0FBTCxDQUFpQkgsT0FBakIsRUFBMEJaLE9BQTFCLENBQWI7QUFDRDs7QUFFREEsSUFBQUEsT0FBTyxHQUFHQyxNQUFNLENBQUNDLE1BQVAsQ0FBYztBQUN0Qi9ELE1BQUFBLE9BQU8sRUFBRSxJQURhO0FBRXRCbUIsTUFBQUEsT0FBTyxFQUFFMEQ7QUFGYSxLQUFkLEVBR1BoQixPQUhPLENBQVY7QUFLQSxVQUFNaUIsV0FBVyxHQUFHLHNDQUF1QixLQUFLaEUsV0FBTCxFQUF2QixHQUEyQytDLE9BQTNDLENBQXBCOztBQUNBLFFBQUk7QUFDRixZQUFNa0IsTUFBTSxTQUFTLEtBQUtaLE9BQUwsQ0FBYSxDQUFDLFNBQUQsRUFBWSxHQUFHVyxXQUFmLEVBQTRCTCxPQUE1QixDQUFiLEVBQW1EO0FBQ3RFdEQsUUFBQUEsT0FBTyxFQUFFMEMsT0FBTyxDQUFDMUM7QUFEcUQsT0FBbkQsQ0FBckI7QUFHQSxZQUFNNkQsZUFBZSxHQUFJLENBQUM1RixnQkFBRTZGLFFBQUYsQ0FBV0YsTUFBWCxDQUFELElBQXVCQSxNQUFNLENBQUNHLE1BQVAsSUFBaUIsR0FBekMsR0FDdEJILE1BRHNCLEdBQ1osR0FBRUEsTUFBTSxDQUFDSSxNQUFQLENBQWMsQ0FBZCxFQUFpQixHQUFqQixDQUFzQixNQUFLSixNQUFNLENBQUNJLE1BQVAsQ0FBY0osTUFBTSxDQUFDRyxNQUFQLEdBQWdCLEdBQTlCLENBQW1DLEVBRDVFOztBQUVBbEcsc0JBQUlDLEtBQUosQ0FBVywyQkFBMEIrRixlQUFnQixFQUFyRDs7QUFDQSxVQUFJNUYsZ0JBQUVlLFFBQUYsQ0FBVzRFLE1BQVgsRUFBbUIsZ0JBQW5CLENBQUosRUFBMEM7QUFDeEMsY0FBTSxJQUFJcEYsS0FBSixDQUFVb0YsTUFBVixDQUFOO0FBQ0Q7QUFDRixLQVZELENBVUUsT0FBT0ssR0FBUCxFQUFZO0FBR1osVUFBSSxDQUFDQSxHQUFHLENBQUN4RixPQUFKLENBQVlPLFFBQVosQ0FBcUIsK0JBQXJCLENBQUwsRUFBNEQ7QUFDMUQsY0FBTWlGLEdBQU47QUFDRDs7QUFDRHBHLHNCQUFJQyxLQUFKLENBQVcsZ0JBQWV3RixPQUFRLGtDQUFsQztBQUNEO0FBQ0YsR0E3QkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBdURBN0YsZUFBZSxDQUFDeUcsZ0JBQWhCO0FBQUEsK0NBQW1DLFdBQWdCWixPQUFoQixFQUF5QjFGLEdBQUcsR0FBRyxJQUEvQixFQUFxQzhFLE9BQU8sR0FBRyxFQUEvQyxFQUFtRDtBQUNwRixRQUFJLENBQUN5QixvQkFBS0MsUUFBTCxDQUFjMUIsT0FBTyxDQUFDMUMsT0FBdEIsQ0FBTCxFQUFxQztBQUNuQzBDLE1BQUFBLE9BQU8sQ0FBQzFDLE9BQVIsR0FBa0IwRCw0QkFBbEI7QUFDRDs7QUFFRCxRQUFJVyxPQUFPLEdBQUcsSUFBZDs7QUFDQSxRQUFJLENBQUN6RyxHQUFMLEVBQVU7QUFDUnlHLE1BQUFBLE9BQU8sU0FBUyxLQUFLQyxVQUFMLENBQWdCaEIsT0FBaEIsQ0FBaEI7QUFDQTFGLE1BQUFBLEdBQUcsR0FBR3lHLE9BQU8sQ0FBQ2hELElBQWQ7QUFDRDs7QUFDRCxRQUFJLENBQUN6RCxHQUFMLEVBQVU7QUFDUkMsc0JBQUkwRyxJQUFKLENBQVUsbUNBQWtDakIsT0FBUSxxREFBcEQ7O0FBQ0E7QUFDRDs7QUFFRCxRQUFJLFFBQU8sS0FBSzNGLGNBQUwsQ0FBb0JDLEdBQXBCLENBQVAsQ0FBSixFQUFxQztBQUNuQ0Msc0JBQUlDLEtBQUosQ0FBVyxRQUFPd0YsT0FBUSw2QkFBMUI7O0FBQ0EsWUFBTSxLQUFLRCxPQUFMLENBQWFDLE9BQWIsRUFBc0JYLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLEVBQWQsRUFBa0JGLE9BQWxCLEVBQTJCO0FBQUM3RCxRQUFBQSxPQUFPLEVBQUU7QUFBVixPQUEzQixDQUF0QixDQUFOO0FBQ0E7QUFDRDs7QUFuQm1GLHlCQXFCUixLQUFLMkYsY0FBTCxDQUFvQjVHLEdBQXBCLENBckJRO0FBQUEsVUFxQmhFNkcsY0FyQmdFLFVBcUI3RUMsV0FyQjZFO0FBQUEsVUFxQm5DQyxpQkFyQm1DLFVBcUJoREMsV0FyQmdEOztBQXNCcEYsVUFBTUMsY0FBYyxHQUFHQyxnQkFBT0MsS0FBUCxDQUFhRCxnQkFBT0UsTUFBUCxDQUFjTCxpQkFBZCxDQUFiLENBQXZCOztBQUNBLFFBQUksQ0FBQ04sT0FBTCxFQUFjO0FBQ1pBLE1BQUFBLE9BQU8sU0FBUyxLQUFLQyxVQUFMLENBQWdCaEIsT0FBaEIsQ0FBaEI7QUFDRDs7QUF6Qm1GLHFCQTBCZGUsT0ExQmM7QUFBQSxVQTBCaEVZLGNBMUJnRSxZQTBCN0VQLFdBMUI2RTtBQUFBLFVBMEJuQ1EsaUJBMUJtQyxZQTBCaEROLFdBMUJnRDs7QUEyQnBGLFVBQU1PLGNBQWMsR0FBR0wsZ0JBQU9DLEtBQVAsQ0FBYUQsZ0JBQU9FLE1BQVAsQ0FBY0UsaUJBQWQsQ0FBYixDQUF2Qjs7QUFFQSxRQUFJLENBQUNqSCxnQkFBRTZCLFNBQUYsQ0FBWW1GLGNBQVosQ0FBRCxJQUFnQyxDQUFDaEgsZ0JBQUU2QixTQUFGLENBQVkyRSxjQUFaLENBQXJDLEVBQWtFO0FBQ2hFNUcsc0JBQUkwRyxJQUFKLENBQVUsaUNBQWdDakIsT0FBUSxhQUFZMUYsR0FBSSxHQUFsRTs7QUFDQSxVQUFJLENBQUNLLGdCQUFFNkYsUUFBRixDQUFXcUIsY0FBWCxDQUFELElBQStCLENBQUNsSCxnQkFBRTZGLFFBQUYsQ0FBV2UsY0FBWCxDQUFwQyxFQUFnRTtBQUM5RGhILHdCQUFJMEcsSUFBSixDQUFVLGlDQUFnQ2pCLE9BQVEsYUFBWTFGLEdBQUksc0RBQWxFOztBQUNBO0FBQ0Q7QUFDRjs7QUFDRCxRQUFJSyxnQkFBRTZCLFNBQUYsQ0FBWW1GLGNBQVosS0FBK0JoSCxnQkFBRTZCLFNBQUYsQ0FBWTJFLGNBQVosQ0FBbkMsRUFBZ0U7QUFDOUQsVUFBSUEsY0FBYyxHQUFHUSxjQUFyQixFQUFxQztBQUNuQ3BILHdCQUFJQyxLQUFKLENBQVcsa0JBQWlCRixHQUFJLHVDQUFzQzZHLGNBQWUsTUFBS1EsY0FBZSxHQUF6Rzs7QUFDQTtBQUNEOztBQUVELFVBQUlSLGNBQWMsS0FBS1EsY0FBdkIsRUFBdUM7QUFDckMsWUFBSWhILGdCQUFFNkYsUUFBRixDQUFXcUIsY0FBWCxLQUE4QmxILGdCQUFFNkYsUUFBRixDQUFXZSxjQUFYLENBQTlCLElBQTREQyxnQkFBT00sU0FBUCxDQUFpQlAsY0FBakIsRUFBa0MsS0FBSU0sY0FBZSxFQUFyRCxDQUFoRSxFQUF5SDtBQUN2SHRILDBCQUFJQyxLQUFKLENBQVcsa0JBQWlCRixHQUFJLHdDQUF1Q2lILGNBQWUsU0FBUU0sY0FBZSxJQUE3Rzs7QUFDQTtBQUNEOztBQUNELFlBQUksQ0FBQ2xILGdCQUFFNkYsUUFBRixDQUFXcUIsY0FBWCxDQUFELElBQStCLENBQUNsSCxnQkFBRTZGLFFBQUYsQ0FBV2UsY0FBWCxDQUFwQyxFQUFnRTtBQUM5RGhILDBCQUFJQyxLQUFKLENBQVcsa0JBQWlCRixHQUFJLHVDQUFzQzZHLGNBQWUsUUFBT1EsY0FBZSxHQUEzRzs7QUFDQTtBQUNEO0FBQ0Y7QUFDRixLQWhCRCxNQWdCTyxJQUFJaEgsZ0JBQUU2RixRQUFGLENBQVdxQixjQUFYLEtBQThCbEgsZ0JBQUU2RixRQUFGLENBQVdlLGNBQVgsQ0FBOUIsSUFBNERDLGdCQUFPTSxTQUFQLENBQWlCUCxjQUFqQixFQUFrQyxLQUFJTSxjQUFlLEVBQXJELENBQWhFLEVBQXlIO0FBQzlIdEgsc0JBQUlDLEtBQUosQ0FBVyxrQkFBaUJGLEdBQUksd0NBQXVDaUgsY0FBZSxTQUFRTSxjQUFlLElBQTdHOztBQUNBO0FBQ0Q7O0FBRUR0SCxvQkFBSUMsS0FBSixDQUFXLGtCQUFpQkYsR0FBSSw0QkFBMkIwRixPQUFRLElBQXpELEdBQ0MsSUFBR21CLGNBQWUsTUFBS1EsY0FBZSxRQUFPSixjQUFlLFFBQU9NLGNBQWUsT0FEbkYsR0FFQyxtQkFGWDs7QUFHQSxRQUFJO0FBQ0YsWUFBTSxLQUFLOUIsT0FBTCxDQUFhQyxPQUFiLEVBQXNCWCxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCRixPQUFsQixFQUEyQjtBQUFDN0QsUUFBQUEsT0FBTyxFQUFFO0FBQVYsT0FBM0IsQ0FBdEIsQ0FBTjtBQUNELEtBRkQsQ0FFRSxPQUFPb0YsR0FBUCxFQUFZO0FBQ1pwRyxzQkFBSTBHLElBQUosQ0FBVSxtQkFBa0IzRyxHQUFJLGlCQUFnQnFHLEdBQUcsQ0FBQ3hGLE9BQVEsMEJBQTVEOztBQUNBLFVBQUksUUFBTyxLQUFLZ0UsWUFBTCxDQUFrQjdFLEdBQWxCLENBQVAsQ0FBSixFQUFtQztBQUNqQyxjQUFNLElBQUlZLEtBQUosQ0FBVyxJQUFHWixHQUFJLGlDQUFsQixDQUFOO0FBQ0Q7O0FBQ0QsWUFBTSxLQUFLeUYsT0FBTCxDQUFhQyxPQUFiLEVBQXNCWCxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCRixPQUFsQixFQUEyQjtBQUFDN0QsUUFBQUEsT0FBTyxFQUFFO0FBQVYsT0FBM0IsQ0FBdEIsQ0FBTjtBQUNEO0FBQ0YsR0FyRUQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBbUZBcEIsZUFBZSxDQUFDNEgscUJBQWhCO0FBQUEsK0NBQXdDLFdBQWdCL0IsT0FBaEIsRUFBeUJnQyxRQUF6QixFQUFtQ0MsR0FBbkMsRUFBd0M7QUFDOUUxSCxvQkFBSUMsS0FBSixDQUFXLHlDQUF3Q3dILFFBQVEsSUFBSSxTQUFVLEVBQXpFOztBQUNBLFFBQUloQyxPQUFPLENBQUNDLFFBQVIsQ0FBaUJDLHVCQUFqQixDQUFKLEVBQXNDO0FBQ3BDRixNQUFBQSxPQUFPLFNBQVMsS0FBS2tDLGtCQUFMLENBQXdCbEMsT0FBeEIsRUFBaUNnQyxRQUFqQyxDQUFoQjtBQUNEOztBQUNELFVBQU0sS0FBS0csUUFBTCxFQUFOO0FBQ0EsUUFBSUMsYUFBSjs7QUFDQSxRQUFJO0FBQUEsMkJBQ3FCLHdCQUFLLEtBQUtDLFFBQUwsQ0FBY0MsSUFBbkIsRUFBeUIsQ0FDOUMsR0FEOEMsRUFFOUMsVUFGOEMsRUFHOUMsV0FIOEMsRUFJOUN0QyxPQUo4QyxDQUF6QixDQURyQjtBQUFBLFlBQ0tuRixNQURMLFVBQ0tBLE1BREw7O0FBT0Z1SCxNQUFBQSxhQUFhLEdBQUd2SCxNQUFoQjtBQUNELEtBUkQsQ0FRRSxPQUFPSSxDQUFQLEVBQVU7QUFDVixZQUFNLElBQUlDLEtBQUosQ0FBVyxrQ0FBaUM4RSxPQUFRLHNCQUFxQi9FLENBQUMsQ0FBQ0UsT0FBUSxFQUFuRixDQUFOO0FBQ0Q7O0FBRUQsVUFBTW9ILG1CQUFtQixHQUFHLFdBQTVCO0FBQ0EsUUFBSUMsWUFBWSxHQUFHUixRQUFRLElBQUlPLG1CQUEvQjs7QUFDQSxRQUFJQyxZQUFZLENBQUM5RyxRQUFiLENBQXNCLEdBQXRCLEtBQThCLENBQUM4RyxZQUFZLENBQUM5RyxRQUFiLENBQXNCLElBQXRCLENBQW5DLEVBQWdFO0FBQzlEOEcsTUFBQUEsWUFBWSxHQUFHQSxZQUFZLENBQUNqSCxPQUFiLENBQXFCLEdBQXJCLEVBQTBCLElBQTFCLENBQWY7QUFDRDs7QUFDRCxRQUFJaUgsWUFBWSxDQUFDL0csV0FBYixHQUEyQmtCLFVBQTNCLENBQXNDLElBQXRDLENBQUosRUFBaUQ7QUFBQSwyQkFFeEIsd0JBQUssS0FBSzBGLFFBQUwsQ0FBY0MsSUFBbkIsRUFBeUIsQ0FDOUMsR0FEOEMsRUFFOUMsZ0JBRjhDLEVBRzlDdEMsT0FIOEMsQ0FBekIsQ0FGd0I7QUFBQSxZQUV4Q25GLE1BRndDLFVBRXhDQSxNQUZ3Qzs7QUFPL0MsWUFBTTRILE9BQU8sR0FBRzVILE1BQU0sQ0FBQ2dELEtBQVAsQ0FBYTZFLFlBQUdDLEdBQWhCLENBQWhCOztBQUNBLFVBQUksQ0FBQ0YsT0FBTyxDQUFDL0csUUFBUixDQUFpQjhHLFlBQWpCLENBQUwsRUFBcUM7QUFDbkNqSSx3QkFBSUMsS0FBSixDQUFXLGdCQUFlZ0ksWUFBYSxtQkFBN0IsR0FDQyxzQkFBcUJELG1CQUFvQixHQURwRDs7QUFFQUMsUUFBQUEsWUFBWSxHQUFHRCxtQkFBZjtBQUNEO0FBQ0Y7O0FBRUQsVUFBTUssVUFBVSxHQUFHLEVBQW5CO0FBQ0EsUUFBSUMsVUFBVSxHQUFHLEtBQWpCO0FBQ0EsUUFBSUMsaUJBQWlCLEdBQUcsSUFBeEI7QUFDQSxRQUFJQyxlQUFlLEdBQUcsS0FBdEI7O0FBQ0EsVUFBTUMsYUFBYSxHQUFHLENBQUNDLENBQUQsRUFBSUMsR0FBSixLQUFZQSxHQUFHLENBQUNDLE1BQUosQ0FBVyxDQUFDQyxHQUFELEVBQU1DLENBQU4sS0FBWUQsR0FBRyxJQUFJSCxDQUFDLENBQUN0RyxVQUFGLENBQWEwRyxDQUFiLENBQTlCLEVBQStDLEtBQS9DLENBQWxDOztBQUNBLFVBQU1DLG9CQUFvQixHQUFJTCxDQUFELElBQU9BLENBQUMsQ0FBQzFILE9BQUYsQ0FBVSxJQUFWLEVBQWdCLEVBQWhCLEVBQW9CQSxPQUFwQixDQUE0QixJQUE1QixFQUFrQyxFQUFsQyxFQUFzQ0EsT0FBdEMsQ0FBOEMsTUFBOUMsRUFBc0QsR0FBdEQsQ0FBcEM7O0FBNUM4RTtBQUFBO0FBQUE7O0FBQUE7QUE2QzlFLDRCQUFtQjZHLGFBQWEsQ0FBQ3ZFLEtBQWQsQ0FBb0I2RSxZQUFHQyxHQUF2QixDQUFuQixtSUFBZ0Q7QUFBQSxjQUFyQ1ksSUFBcUM7QUFDOUMsY0FBTUMsV0FBVyxHQUFHRCxJQUFJLENBQUNqRyxJQUFMLEVBQXBCOztBQUNBLFlBQUkzQyxnQkFBRThJLE9BQUYsQ0FBVUQsV0FBVixDQUFKLEVBQTRCO0FBQzFCO0FBQ0Q7O0FBRUQsWUFBSVIsYUFBYSxDQUFDUSxXQUFELEVBQWMsQ0FBQyxRQUFELEVBQVcsTUFBWCxFQUFtQixNQUFuQixFQUEyQixTQUEzQixDQUFkLENBQWpCLEVBQXVFO0FBQ3JFWCxVQUFBQSxVQUFVLEdBQUdXLFdBQVcsQ0FBQzdHLFVBQVosQ0FBd0IsVUFBUzZGLFlBQWEsR0FBOUMsQ0FBYjtBQUNBTSxVQUFBQSxpQkFBaUIsR0FBRyxJQUFwQjtBQUNBQyxVQUFBQSxlQUFlLEdBQUcsS0FBbEI7QUFDQTtBQUNEOztBQUVELFlBQUksQ0FBQ0YsVUFBTCxFQUFpQjtBQUNmO0FBQ0Q7O0FBRUQsWUFBSVcsV0FBVyxDQUFDN0csVUFBWixDQUF1QixVQUF2QixDQUFKLEVBQXdDO0FBQ3RDb0csVUFBQUEsZUFBZSxHQUFHLEtBQWxCO0FBQ0FELFVBQUFBLGlCQUFpQixHQUFHLElBQXBCOztBQUVBLGNBQUlVLFdBQVcsQ0FBQzlILFFBQVosQ0FBcUIsVUFBckIsQ0FBSixFQUFzQztBQUNwQyxrQkFBTXlCLEtBQUssR0FBRyxrQkFBa0JDLElBQWxCLENBQXVCb0csV0FBdkIsQ0FBZDs7QUFDQSxnQkFBSXJHLEtBQUosRUFBVztBQUNUMkYsY0FBQUEsaUJBQWlCLEdBQUczRixLQUFLLENBQUMsQ0FBRCxDQUF6QjtBQUNEO0FBQ0YsV0FMRCxNQUtPLElBQUlxRyxXQUFXLENBQUM5SCxRQUFaLENBQXFCLFdBQXJCLENBQUosRUFBdUM7QUFDNUMsa0JBQU15QixLQUFLLEdBQUcsbUJBQW1CQyxJQUFuQixDQUF3Qm9HLFdBQXhCLENBQWQ7O0FBQ0EsZ0JBQUlyRyxLQUFKLEVBQVc7QUFDVDJGLGNBQUFBLGlCQUFpQixHQUFHM0YsS0FBSyxDQUFDLENBQUQsQ0FBekI7QUFDQTRGLGNBQUFBLGVBQWUsR0FBRyxJQUFsQjtBQUNEO0FBQ0Y7O0FBQ0Q7QUFDRDs7QUFFRCxZQUFJRCxpQkFBaUIsSUFBSVUsV0FBVyxDQUFDN0csVUFBWixDQUF1QixTQUF2QixDQUF6QixFQUE0RDtBQUMxRCxnQkFBTVEsS0FBSyxHQUFHLDJCQUEyQkMsSUFBM0IsQ0FBZ0NvRyxXQUFoQyxDQUFkOztBQUNBLGNBQUlyRyxLQUFKLEVBQVc7QUFDVHlGLFlBQUFBLFVBQVUsQ0FBQ0UsaUJBQUQsQ0FBVixHQUFnQ1Esb0JBQW9CLENBQUNuRyxLQUFLLENBQUMsQ0FBRCxDQUFOLENBQXBEO0FBQ0Q7O0FBQ0QyRixVQUFBQSxpQkFBaUIsR0FBRyxJQUFwQjtBQUNBO0FBQ0Q7O0FBRUQsWUFBSUEsaUJBQWlCLElBQUlDLGVBQXJCLElBQXdDUyxXQUFXLENBQUM5SCxRQUFaLENBQXFCLFdBQXJCLENBQTVDLEVBQStFO0FBQzdFLGdCQUFNeUIsS0FBSyxHQUFHLDJCQUEyQkMsSUFBM0IsQ0FBZ0NvRyxXQUFoQyxDQUFkOztBQUNBLGNBQUlyRyxLQUFKLEVBQVc7QUFDVHlGLFlBQUFBLFVBQVUsQ0FBQ0UsaUJBQUQsQ0FBVixHQUFnQyxDQUM5QixJQUFJRixVQUFVLENBQUNFLGlCQUFELENBQVYsSUFBaUMsRUFBckMsQ0FEOEIsRUFFOUJRLG9CQUFvQixDQUFDbkcsS0FBSyxDQUFDLENBQUQsQ0FBTixDQUZVLENBQWhDO0FBSUQ7O0FBQ0Q7QUFDRDtBQUNGO0FBcEc2RTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQXNHOUUsUUFBSXhDLGdCQUFFOEksT0FBRixDQUFVYixVQUFWLENBQUosRUFBMkI7QUFDekJySSxzQkFBSTBHLElBQUosQ0FBVSxrQ0FBaUNqQixPQUFRLGNBQTFDLEdBQ0MsUUFBT3dDLFlBQWEsaUJBRDlCO0FBRUQsS0FIRCxNQUdPO0FBQ0xqSSxzQkFBSWdGLElBQUosQ0FBVSwwQkFBeUI1RSxnQkFBRStJLElBQUYsQ0FBT2QsVUFBUCxFQUFtQm5DLE1BQU8sa0JBQWlCVCxPQUFRLGNBQTdFLEdBQ0MsUUFBT3dDLFlBQWEsaUJBRDlCO0FBRUQ7O0FBRUQsVUFBTW1CLFNBQVMsR0FBR0MsY0FBS0MsT0FBTCxDQUFhNUIsR0FBYixFQUFrQixjQUFsQixDQUFsQjs7QUFDQSxVQUFNLDJCQUFPQSxHQUFQLENBQU47QUFDQSxVQUFNNkIsa0JBQUdDLFNBQUgsQ0FBYUosU0FBYixFQUF3QkssSUFBSSxDQUFDQyxTQUFMLENBQWVyQixVQUFmLEVBQTJCLElBQTNCLEVBQWlDLENBQWpDLENBQXhCLEVBQTZELE9BQTdELENBQU47QUFDQSxXQUFPO0FBQUNBLE1BQUFBLFVBQUQ7QUFBYWUsTUFBQUE7QUFBYixLQUFQO0FBQ0QsR0FsSEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBeUhBeEosZUFBZSxDQUFDK0osaUJBQWhCLG1DQUFvQyxhQUFrQjtBQUNwRCxNQUFJbEMsUUFBSjs7QUFDQSxNQUFJLE9BQU0sS0FBSzNGLFdBQUwsRUFBTixJQUEyQixFQUEvQixFQUFtQztBQUNqQzJGLElBQUFBLFFBQVEsU0FBUyxLQUFLbUMsb0JBQUwsRUFBakI7O0FBQ0EsUUFBSSxDQUFDbkMsUUFBTCxFQUFlO0FBQ2JBLE1BQUFBLFFBQVEsU0FBUyxLQUFLb0Msd0JBQUwsRUFBakI7QUFDRDtBQUNGLEdBTEQsTUFLTztBQUNMcEMsSUFBQUEsUUFBUSxHQUFHLE9BQU8sS0FBS3FDLGVBQUwsRUFBUCxFQUErQnhHLEtBQS9CLENBQXFDLEdBQXJDLEVBQTBDLENBQTFDLENBQVg7QUFDRDs7QUFDRCxTQUFPbUUsUUFBUDtBQUNELENBWEQ7O0FBa0JBN0gsZUFBZSxDQUFDbUssaUJBQWhCO0FBQUEsK0NBQW9DLFdBQWdCdEMsUUFBaEIsRUFBMEI7QUFFNUQsVUFBTSxLQUFLdUMsb0JBQUwsQ0FBMEJ2QyxRQUExQixDQUFOO0FBQ0QsR0FIRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFVQTdILGVBQWUsQ0FBQ3FLLGdCQUFoQixtQ0FBbUMsYUFBa0I7QUFFbkQsTUFBSUMsT0FBTyxTQUFTLEtBQUtDLG1CQUFMLEVBQXBCOztBQUNBLE1BQUksQ0FBQ0QsT0FBTCxFQUFjO0FBQ1pBLElBQUFBLE9BQU8sU0FBUyxLQUFLRSx1QkFBTCxFQUFoQjtBQUNEOztBQUNELFNBQU9GLE9BQVA7QUFDRCxDQVBEOztBQWNBdEssZUFBZSxDQUFDeUssZ0JBQWhCO0FBQUEsK0NBQW1DLFdBQWdCSCxPQUFoQixFQUF5QjtBQUUxRCxVQUFNLEtBQUtJLG1CQUFMLENBQXlCSixPQUF6QixDQUFOO0FBQ0QsR0FIRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFVQXRLLGVBQWUsQ0FBQ2tLLGVBQWhCLG1DQUFrQyxhQUFrQjtBQUVsRCxNQUFJUyxNQUFNLFNBQVMsS0FBS0Msa0JBQUwsRUFBbkI7O0FBQ0EsTUFBSSxDQUFDRCxNQUFMLEVBQWE7QUFDWEEsSUFBQUEsTUFBTSxTQUFTLEtBQUtFLHNCQUFMLEVBQWY7QUFDRDs7QUFDRCxTQUFPRixNQUFQO0FBQ0QsQ0FQRDs7QUFlQTNLLGVBQWUsQ0FBQzhLLGVBQWhCO0FBQUEsK0NBQWtDLFdBQWdCSCxNQUFoQixFQUF3QjtBQUN4RCxVQUFNSSxjQUFjLEdBQUcsSUFBSXhLLE1BQUosQ0FBVyx3QkFBWCxDQUF2Qjs7QUFDQSxRQUFJLENBQUN3SyxjQUFjLENBQUNsSyxJQUFmLENBQW9COEosTUFBcEIsQ0FBTCxFQUFrQztBQUNoQ3ZLLHNCQUFJMEcsSUFBSixDQUFVLCtEQUFWOztBQUNBO0FBQ0Q7O0FBRUQsUUFBSWtFLFlBQVksR0FBR0wsTUFBTSxDQUFDakgsS0FBUCxDQUFhLEdBQWIsQ0FBbkI7QUFDQSxVQUFNLEtBQUt1SCx3QkFBTCxDQUE4QkQsWUFBWSxDQUFDLENBQUQsQ0FBMUMsRUFBK0NBLFlBQVksQ0FBQyxDQUFELENBQTNELENBQU47QUFDRCxHQVREOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQW9CQWhMLGVBQWUsQ0FBQ2tMLG1CQUFoQjtBQUFBLCtDQUFzQyxXQUFnQnJELFFBQWhCLEVBQTBCeUMsT0FBMUIsRUFBbUNhLE1BQU0sR0FBRyxJQUE1QyxFQUFrRDtBQUFBOztBQUN0RixVQUFNQyxXQUFXLEdBQUc1SyxnQkFBRTZGLFFBQUYsQ0FBV3dCLFFBQVgsQ0FBcEI7O0FBQ0EsVUFBTXdELFVBQVUsR0FBRzdLLGdCQUFFNkYsUUFBRixDQUFXaUUsT0FBWCxDQUFuQjs7QUFFQSxRQUFJLENBQUNjLFdBQUQsSUFBZ0IsQ0FBQ0MsVUFBckIsRUFBaUM7QUFDL0JqTCxzQkFBSTBHLElBQUosQ0FBUyxrREFBVDs7QUFDQSxhQUFPLEtBQVA7QUFDRDs7QUFHRGUsSUFBQUEsUUFBUSxHQUFHLENBQUNBLFFBQVEsSUFBSSxFQUFiLEVBQWlCdkcsV0FBakIsRUFBWDtBQUNBZ0osSUFBQUEsT0FBTyxHQUFHLENBQUNBLE9BQU8sSUFBSSxFQUFaLEVBQWdCaEosV0FBaEIsRUFBVjtBQUVBLFVBQU1XLFFBQVEsU0FBUyxLQUFLQyxXQUFMLEVBQXZCO0FBRUEsaUJBQWEsNkJBQWMsQ0FBZCxFQUFpQixJQUFqQixrQ0FBdUIsYUFBWTtBQUM5QyxVQUFJO0FBQ0YsWUFBSUQsUUFBUSxHQUFHLEVBQWYsRUFBbUI7QUFDakIsY0FBSXFKLFdBQUosRUFBaUJDLFVBQWpCOztBQUNBLGNBQUlILFdBQUosRUFBaUI7QUFDZkUsWUFBQUEsV0FBVyxHQUFHLE9BQU8sTUFBSSxDQUFDdkIsaUJBQUwsRUFBUCxFQUFpQ3pJLFdBQWpDLEVBQWQ7O0FBQ0EsZ0JBQUksQ0FBQytKLFVBQUQsSUFBZXhELFFBQVEsS0FBS3lELFdBQWhDLEVBQTZDO0FBQzNDLHFCQUFPLElBQVA7QUFDRDtBQUNGOztBQUNELGNBQUlELFVBQUosRUFBZ0I7QUFDZEUsWUFBQUEsVUFBVSxHQUFHLE9BQU8sTUFBSSxDQUFDbEIsZ0JBQUwsRUFBUCxFQUFnQy9JLFdBQWhDLEVBQWI7O0FBQ0EsZ0JBQUksQ0FBQzhKLFdBQUQsSUFBZ0JkLE9BQU8sS0FBS2lCLFVBQWhDLEVBQTRDO0FBQzFDLHFCQUFPLElBQVA7QUFDRDtBQUNGOztBQUNELGNBQUkxRCxRQUFRLEtBQUt5RCxXQUFiLElBQTRCaEIsT0FBTyxLQUFLaUIsVUFBNUMsRUFBd0Q7QUFDdEQsbUJBQU8sSUFBUDtBQUNEO0FBQ0YsU0FqQkQsTUFpQk87QUFDTCxnQkFBTUMsU0FBUyxHQUFHLE9BQU8sTUFBSSxDQUFDdEIsZUFBTCxFQUFQLEVBQStCNUksV0FBL0IsRUFBbEI7QUFFQSxnQkFBTW1LLFVBQVUsR0FBR04sTUFBTSxHQUFJLEdBQUV0RCxRQUFTLElBQUdzRCxNQUFNLENBQUM3SixXQUFQLEVBQXFCLElBQUdnSixPQUFRLEVBQWxELEdBQXVELEdBQUV6QyxRQUFTLElBQUd5QyxPQUFRLEVBQXRHOztBQUVBLGNBQUltQixVQUFVLEtBQUtELFNBQW5CLEVBQThCO0FBQzVCcEwsNEJBQUlDLEtBQUosQ0FBVyxpREFBZ0RtTCxTQUFVLEdBQXJFOztBQUNBLG1CQUFPLElBQVA7QUFDRDtBQUNGOztBQUNELGVBQU8sS0FBUDtBQUNELE9BN0JELENBNkJFLE9BQU9oRixHQUFQLEVBQVk7QUFFWnBHLHdCQUFJc0wsS0FBSixDQUFXLHdDQUF1Q2xGLEdBQUcsQ0FBQ3hGLE9BQVEsRUFBOUQ7O0FBQ0FaLHdCQUFJQyxLQUFKLENBQVUsZ0NBQVY7O0FBQ0EsY0FBTSxNQUFJLENBQUNzTCxVQUFMLEVBQU47QUFDQSxjQUFNbkYsR0FBTjtBQUNEO0FBQ0YsS0FyQ1ksRUFBYjtBQXNDRCxHQXJERDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFpRUF4RyxlQUFlLENBQUNpTCx3QkFBaEI7QUFBQSwrQ0FBMkMsV0FBZ0JwRCxRQUFoQixFQUEwQnlDLE9BQTFCLEVBQW1DYSxNQUFNLEdBQUcsSUFBNUMsRUFBa0Q7QUFDM0YsUUFBSUMsV0FBVyxHQUFHdkQsUUFBUSxJQUFJckgsZ0JBQUU2RixRQUFGLENBQVd3QixRQUFYLENBQTlCOztBQUNBLFFBQUl3RCxVQUFVLEdBQUdmLE9BQU8sSUFBSTlKLGdCQUFFNkYsUUFBRixDQUFXaUUsT0FBWCxDQUE1Qjs7QUFDQSxRQUFJLENBQUNjLFdBQUQsSUFBZ0IsQ0FBQ0MsVUFBckIsRUFBaUM7QUFDL0JqTCxzQkFBSTBHLElBQUosQ0FBVSxpRUFBVjs7QUFDQTFHLHNCQUFJMEcsSUFBSixDQUFVLGtCQUFpQmUsUUFBUyxtQkFBa0J5QyxPQUFRLEdBQTlEOztBQUNBO0FBQ0Q7O0FBQ0QsUUFBSXJJLFFBQVEsU0FBUyxLQUFLQyxXQUFMLEVBQXJCO0FBRUEyRixJQUFBQSxRQUFRLEdBQUcsQ0FBQ0EsUUFBUSxJQUFJLEVBQWIsRUFBaUJ2RyxXQUFqQixFQUFYO0FBQ0FnSixJQUFBQSxPQUFPLEdBQUcsQ0FBQ0EsT0FBTyxJQUFJLEVBQVosRUFBZ0JzQixXQUFoQixFQUFWOztBQUVBLFFBQUkzSixRQUFRLEdBQUcsRUFBZixFQUFtQjtBQUNqQixVQUFJcUosV0FBVyxHQUFHLE9BQU8sS0FBS3ZCLGlCQUFMLEVBQVAsRUFBaUN6SSxXQUFqQyxFQUFsQjtBQUNBLFVBQUlpSyxVQUFVLEdBQUcsT0FBTyxLQUFLbEIsZ0JBQUwsRUFBUCxFQUFnQ3VCLFdBQWhDLEVBQWpCOztBQUVBLFVBQUkvRCxRQUFRLEtBQUt5RCxXQUFiLElBQTRCaEIsT0FBTyxLQUFLaUIsVUFBNUMsRUFBd0Q7QUFDdEQsY0FBTSxLQUFLTSwrQkFBTCxDQUFxQ2hFLFFBQXJDLEVBQStDeUMsT0FBL0MsQ0FBTjtBQUNEO0FBQ0YsS0FQRCxNQU9PO0FBQ0wsVUFBSWtCLFNBQVMsU0FBUyxLQUFLdEIsZUFBTCxFQUF0QjtBQUdBLFlBQU11QixVQUFVLEdBQUdOLE1BQU0sR0FBSSxHQUFFdEQsUUFBUyxJQUFHc0QsTUFBTyxJQUFHYixPQUFRLEVBQXBDLEdBQXlDLEdBQUV6QyxRQUFTLElBQUd5QyxPQUFRLEVBQXhGOztBQUNBbEssc0JBQUlDLEtBQUosQ0FBVyxvQkFBbUJtTCxTQUFVLHlCQUF3QkMsVUFBVyxHQUEzRTs7QUFDQSxVQUFJQSxVQUFVLENBQUNuSyxXQUFYLE9BQTZCa0ssU0FBUyxDQUFDbEssV0FBVixFQUFqQyxFQUEwRDtBQUN4RCxjQUFNLEtBQUt1SywrQkFBTCxDQUFxQ2hFLFFBQXJDLEVBQStDeUMsT0FBL0MsRUFBd0RhLE1BQXhELENBQU47QUFDRDtBQUNGO0FBQ0YsR0E5QkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBOENBbkwsZUFBZSxDQUFDNkcsVUFBaEI7QUFBQSwrQ0FBNkIsV0FBZ0JoQixPQUFoQixFQUF5QjtBQUNwRCxRQUFJLFFBQU84RCxrQkFBR21DLE1BQUgsQ0FBVWpHLE9BQVYsQ0FBUCxDQUFKLEVBQStCO0FBQzdCLFlBQU0sSUFBSTlFLEtBQUosQ0FBVyxvQkFBbUI4RSxPQUFRLHNDQUF0QyxDQUFOO0FBQ0Q7O0FBRUQsUUFBSUEsT0FBTyxDQUFDQyxRQUFSLENBQWlCQyx1QkFBakIsQ0FBSixFQUFzQztBQUNwQ0YsTUFBQUEsT0FBTyxTQUFTLEtBQUtrRyxjQUFMLENBQW9CbEcsT0FBcEIsQ0FBaEI7QUFDRDs7QUFFRCxVQUFNLEtBQUttQyxRQUFMLEVBQU47O0FBQ0EsUUFBSTtBQUFBLDJCQUNxQix3QkFBSyxLQUFLRSxRQUFMLENBQWNDLElBQW5CLEVBQXlCLENBQUMsR0FBRCxFQUFNLFNBQU4sRUFBaUJ0QyxPQUFqQixDQUF6QixDQURyQjtBQUFBLFlBQ0tuRixNQURMLFVBQ0tBLE1BREw7O0FBRUYsWUFBTXNMLE9BQU8sR0FBRyxJQUFJekwsTUFBSixDQUFXLG1FQUFYLEVBQWdGMEMsSUFBaEYsQ0FBcUZ2QyxNQUFyRixDQUFoQjs7QUFDQSxVQUFJc0wsT0FBSixFQUFhO0FBQ1gsZUFBTztBQUNMcEksVUFBQUEsSUFBSSxFQUFFb0ksT0FBTyxDQUFDLENBQUQsQ0FEUjtBQUVML0UsVUFBQUEsV0FBVyxFQUFFMUMsUUFBUSxDQUFDeUgsT0FBTyxDQUFDLENBQUQsQ0FBUixFQUFhLEVBQWIsQ0FGaEI7QUFHTDdFLFVBQUFBLFdBQVcsRUFBRTZFLE9BQU8sQ0FBQyxDQUFEO0FBSGYsU0FBUDtBQUtEO0FBQ0YsS0FWRCxDQVVFLE9BQU94RixHQUFQLEVBQVk7QUFDWnBHLHNCQUFJMEcsSUFBSixDQUFVLFVBQVNOLEdBQUcsQ0FBQ3hGLE9BQVEsOEJBQS9CO0FBQ0Q7O0FBQ0QsV0FBTyxFQUFQO0FBQ0QsR0F4QkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBZ0NBaEIsZUFBZSxDQUFDK0csY0FBaEI7QUFBQSwrQ0FBaUMsV0FBZ0I1RyxHQUFoQixFQUFxQjtBQUNwREMsb0JBQUlDLEtBQUosQ0FBVyw2QkFBNEJGLEdBQUksR0FBM0M7O0FBQ0EsUUFBSThMLE1BQU0sR0FBRztBQUFDckksTUFBQUEsSUFBSSxFQUFFekQ7QUFBUCxLQUFiOztBQUNBLFFBQUk7QUFDRixZQUFNTyxNQUFNLFNBQVMsS0FBS0MsS0FBTCxDQUFXLENBQUMsU0FBRCxFQUFZLFNBQVosRUFBdUJSLEdBQXZCLENBQVgsQ0FBckI7QUFDQSxZQUFNK0wsZ0JBQWdCLEdBQUcsSUFBSTNMLE1BQUosQ0FBVyx1QkFBWCxFQUFvQzBDLElBQXBDLENBQXlDdkMsTUFBekMsQ0FBekI7O0FBQ0EsVUFBSXdMLGdCQUFKLEVBQXNCO0FBQ3BCRCxRQUFBQSxNQUFNLENBQUM5RSxXQUFQLEdBQXFCK0UsZ0JBQWdCLENBQUMsQ0FBRCxDQUFyQztBQUNEOztBQUNELFlBQU1DLGdCQUFnQixHQUFHLElBQUk1TCxNQUFKLENBQVcsbUJBQVgsRUFBZ0MwQyxJQUFoQyxDQUFxQ3ZDLE1BQXJDLENBQXpCOztBQUNBLFVBQUl5TCxnQkFBSixFQUFzQjtBQUNwQkYsUUFBQUEsTUFBTSxDQUFDaEYsV0FBUCxHQUFxQjFDLFFBQVEsQ0FBQzRILGdCQUFnQixDQUFDLENBQUQsQ0FBakIsRUFBc0IsRUFBdEIsQ0FBN0I7QUFDRDs7QUFDRCxhQUFPRixNQUFQO0FBQ0QsS0FYRCxDQVdFLE9BQU96RixHQUFQLEVBQVk7QUFDWnBHLHNCQUFJMEcsSUFBSixDQUFVLFVBQVNOLEdBQUcsQ0FBQ3hGLE9BQVEsOEJBQS9CO0FBQ0Q7O0FBQ0QsV0FBT2lMLE1BQVA7QUFDRCxHQWxCRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFvQkFqTSxlQUFlLENBQUNvTSxPQUFoQjtBQUFBLGlEQUEwQixXQUF3QmpNLEdBQXhCLEVBQTZCa00sTUFBN0IsRUFBcUM7QUFDN0QsVUFBTUMsT0FBTyxHQUFHLE9BQU8sS0FBSy9HLE9BQUwsQ0FBYSxDQUFDLE9BQUQsRUFBVSxJQUFWLEVBQWdCLE1BQWhCLEVBQXdCcEYsR0FBeEIsQ0FBYixDQUFQLEVBQW1EaUIsT0FBbkQsQ0FBMkQsVUFBM0QsRUFBdUUsRUFBdkUsQ0FBaEI7O0FBQ0EsVUFBTW1MLE1BQU0sR0FBRzlDLGNBQUtDLE9BQUwsQ0FBYTJDLE1BQWIsRUFBc0IsR0FBRWxNLEdBQUksTUFBNUIsQ0FBZjs7QUFDQSxVQUFNLEtBQUtxTSxJQUFMLENBQVVGLE9BQVYsRUFBbUJDLE1BQW5CLENBQU47O0FBQ0FuTSxvQkFBSUMsS0FBSixDQUFXLDJCQUEwQkYsR0FBSSxTQUFRb00sTUFBTyxHQUF4RDs7QUFDQSxXQUFPQSxNQUFQO0FBQ0QsR0FORDs7QUFBQSxrQkFBeUNILE9BQXpDO0FBQUE7QUFBQTtBQUFBOztlQVFlcE0sZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGJ1aWxkU3RhcnRDbWQsIEFQS1NfRVhURU5TSU9OLCBidWlsZEluc3RhbGxBcmdzLCBBUEtfSU5TVEFMTF9USU1FT1VUIH0gZnJvbSAnLi4vaGVscGVycy5qcyc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBmcywgdXRpbCwgbWtkaXJwIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcblxubGV0IGFwa1V0aWxzTWV0aG9kcyA9IHt9O1xuXG5jb25zdCBBQ1RJVklUSUVTX1RST1VCTEVTSE9PVElOR19MSU5LID1cbiAgJ2h0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2Jsb2IvbWFzdGVyL2RvY3MvZW4vd3JpdGluZy1ydW5uaW5nLWFwcGl1bS9hbmRyb2lkL2FjdGl2aXR5LXN0YXJ0dXAubWQnO1xuXG4vKipcbiAqIENoZWNrIHdoZXRoZXIgdGhlIHBhcnRpY3VsYXIgcGFja2FnZSBpcyBwcmVzZW50IG9uIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBwYWNrYWdlIGlzIGluc3RhbGxlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZGV0ZWN0aW5nIGFwcGxpY2F0aW9uIHN0YXRlXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5pc0FwcEluc3RhbGxlZCA9IGFzeW5jIGZ1bmN0aW9uIChwa2cpIHtcbiAgbG9nLmRlYnVnKGBHZXR0aW5nIGluc3RhbGwgc3RhdHVzIGZvciAke3BrZ31gKTtcbiAgY29uc3QgaW5zdGFsbGVkUGF0dGVybiA9IG5ldyBSZWdFeHAoYF5cXFxccypQYWNrYWdlXFxcXHMrXFxcXFske18uZXNjYXBlUmVnRXhwKHBrZyl9XFxcXF1bXjpdKzokYCwgJ20nKTtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICdwYWNrYWdlJywgcGtnXSk7XG4gICAgY29uc3QgaXNJbnN0YWxsZWQgPSBpbnN0YWxsZWRQYXR0ZXJuLnRlc3Qoc3Rkb3V0KTtcbiAgICBsb2cuZGVidWcoYCcke3BrZ30nIGlzJHshaXNJbnN0YWxsZWQgPyAnIG5vdCcgOiAnJ30gaW5zdGFsbGVkYCk7XG4gICAgcmV0dXJuIGlzSW5zdGFsbGVkO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBmaW5kaW5nIGlmICcke3BrZ30nIGlzIGluc3RhbGxlZC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIFN0YXJ0IHRoZSBwYXJ0aWN1bGFyIFVSSSBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSAtIFRoZSBuYW1lIG9mIFVSSSB0byBzdGFydC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byBzdGFydCB0aGUgVVJJIHdpdGguXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5zdGFydFVyaSA9IGFzeW5jIGZ1bmN0aW9uICh1cmksIHBrZykge1xuICBpZiAoIXVyaSB8fCAhcGtnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVVJJIGFuZCBwYWNrYWdlIGFyZ3VtZW50cyBhcmUgcmVxdWlyZWRcIik7XG4gIH1cblxuICBjb25zdCBhcmdzID0gW1xuICAgIFwiYW1cIiwgXCJzdGFydFwiLFxuICAgIFwiLVdcIixcbiAgICBcIi1hXCIsIFwiYW5kcm9pZC5pbnRlbnQuYWN0aW9uLlZJRVdcIixcbiAgICBcIi1kXCIsIHVyaS5yZXBsYWNlKC8mL2csICdcXFxcJicpLFxuICAgIHBrZyxcbiAgXTtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnNoZWxsKGFyZ3MpO1xuICAgIGlmIChyZXMudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygndW5hYmxlIHRvIHJlc29sdmUgaW50ZW50JykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgYXR0ZW1wdGluZyB0byBzdGFydCBVUkkuIE9yaWdpbmFsIGVycm9yOiAke2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gU3RhcnRBcHBPcHRpb25zXG4gKiBAcHJvcGVydHkgeyFzdHJpbmd9IGFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIG1haW4gYXBwbGljYXRpb24gYWN0aXZpdHlcbiAqIEBwcm9wZXJ0eSB7IXN0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIGFwcGxpY2F0aW9uIHBhY2thZ2VcbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHJldHJ5IFt0cnVlXSAtIElmIHRoaXMgcHJvcGVydHkgaXMgc2V0IHRvIGB0cnVlYFxuICogYW5kIHRoZSBhY3Rpdml0eSBuYW1lIGRvZXMgbm90IHN0YXJ0IHdpdGggJy4nIHRoZW4gdGhlIG1ldGhvZFxuICogd2lsbCB0cnkgdG8gYWRkIHRoZSBtaXNzaW5nIGRvdCBhbmQgc3RhcnQgdGhlIGFjdGl2aXR5IG9uY2UgbW9yZVxuICogaWYgdGhlIGZpcnN0IHN0YXJ0dXAgdHJ5IGZhaWxzLlxuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gc3RvcEFwcCBbdHJ1ZV0gLSBTZXQgaXQgdG8gYHRydWVgIGluIG9yZGVyIHRvIGZvcmNlZnVsbHlcbiAqIHN0b3AgdGhlIGFjdGl2aXR5IGlmIGl0IGlzIGFscmVhZHkgcnVubmluZy5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gd2FpdFBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIHdhaXQgdG8gb25cbiAqIHN0YXJ0dXAgKHRoaXMgb25seSBtYWtlcyBzZW5zZSBpZiB0aGlzIG5hbWUgaXMgZGlmZmVyZW50IGZyb20gdGhlIG9uZSwgd2hpY2ggaXMgc2V0IGFzIGBwa2dgKVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSB3YWl0QWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHkgdG8gd2FpdCB0byBvblxuICogc3RhcnR1cCAodGhpcyBvbmx5IG1ha2VzIHNlbnNlIGlmIHRoaXMgbmFtZSBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgb25lLCB3aGljaCBpcyBzZXQgYXMgYGFjdGl2aXR5YClcbiAqIEBwcm9wZXJ0eSB7P251bWJlcn0gd2FpdER1cmF0aW9uIC0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqIGB3YWl0QWN0aXZpdHlgIGlzIGZvY3VzZWRcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ3xudW1iZXJ9IHVzZXIgLSBUaGUgbnVtYmVyIG9mIHRoZSB1c2VyIHByb2ZpbGUgdG8gc3RhcnRcbiAqIHRoZSBnaXZlbiBhY3Rpdml0eSB3aXRoLiBUaGUgZGVmYXVsdCBPUyB1c2VyIHByb2ZpbGUgKHVzdWFsbHkgemVybykgaXMgdXNlZFxuICogd2hlbiB0aGlzIHByb3BlcnR5IGlzIHVuc2V0XG4gKi9cblxuLyoqXG4gKiBTdGFydCB0aGUgcGFydGljdWxhciBwYWNrYWdlL2FjdGl2aXR5IG9uIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge1N0YXJ0QXBwT3B0aW9uc30gc3RhcnRBcHBPcHRpb25zIFt7fV0gLSBTdGFydHVwIG9wdGlvbnMgbWFwcGluZy5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG91dHB1dCBvZiB0aGUgY29ycmVzcG9uZGluZyBhZGIgY29tbWFuZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSBpcyBhbiBlcnJvciB3aGlsZSBleGVjdXRpbmcgdGhlIGFjdGl2aXR5XG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5zdGFydEFwcCA9IGFzeW5jIGZ1bmN0aW9uIChzdGFydEFwcE9wdGlvbnMgPSB7fSkge1xuICBpZiAoIXN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eSB8fCAhc3RhcnRBcHBPcHRpb25zLnBrZykge1xuICAgIHRocm93IG5ldyBFcnJvcihcImFjdGl2aXR5IGFuZCBwa2cgYXJlIHJlcXVpcmVkIHRvIHN0YXJ0IGFuIGFwcGxpY2F0aW9uXCIpO1xuICB9XG5cbiAgc3RhcnRBcHBPcHRpb25zID0gXy5jbG9uZShzdGFydEFwcE9wdGlvbnMpO1xuICBzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHkgPSBzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHkucmVwbGFjZSgnJCcsICdcXFxcJCcpO1xuICAvLyBpbml0aWFsaXppbmcgZGVmYXVsdHNcbiAgXy5kZWZhdWx0cyhzdGFydEFwcE9wdGlvbnMsIHtcbiAgICB3YWl0UGtnOiBzdGFydEFwcE9wdGlvbnMucGtnLFxuICAgIHdhaXRBY3Rpdml0eTogZmFsc2UsXG4gICAgcmV0cnk6IHRydWUsXG4gICAgc3RvcEFwcDogdHJ1ZVxuICB9KTtcbiAgLy8gcHJldmVudGluZyBudWxsIHdhaXRwa2dcbiAgc3RhcnRBcHBPcHRpb25zLndhaXRQa2cgPSBzdGFydEFwcE9wdGlvbnMud2FpdFBrZyB8fCBzdGFydEFwcE9wdGlvbnMucGtnO1xuXG4gIGNvbnN0IGFwaUxldmVsID0gYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpO1xuICBjb25zdCBjbWQgPSBidWlsZFN0YXJ0Q21kKHN0YXJ0QXBwT3B0aW9ucywgYXBpTGV2ZWwpO1xuICB0cnkge1xuICAgIGNvbnN0IHNoZWxsT3B0cyA9IHt9O1xuICAgIGlmIChfLmlzSW50ZWdlcihzdGFydEFwcE9wdGlvbnMud2FpdER1cmF0aW9uKSAmJiBzdGFydEFwcE9wdGlvbnMud2FpdER1cmF0aW9uID4gMjAwMDApIHtcbiAgICAgIHNoZWxsT3B0cy50aW1lb3V0ID0gc3RhcnRBcHBPcHRpb25zLndhaXREdXJhdGlvbjtcbiAgICB9XG4gICAgY29uc3Qgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbChjbWQsIHNoZWxsT3B0cyk7XG4gICAgaWYgKHN0ZG91dC5pbmNsdWRlcyhcIkVycm9yOiBBY3Rpdml0eSBjbGFzc1wiKSAmJiBzdGRvdXQuaW5jbHVkZXMoXCJkb2VzIG5vdCBleGlzdFwiKSkge1xuICAgICAgaWYgKHN0YXJ0QXBwT3B0aW9ucy5yZXRyeSAmJiAhc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5LnN0YXJ0c1dpdGgoXCIuXCIpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgV2UgdHJpZWQgdG8gc3RhcnQgYW4gYWN0aXZpdHkgdGhhdCBkb2Vzbid0IGV4aXN0LCBgICtcbiAgICAgICAgICAgICAgICAgIGByZXRyeWluZyB3aXRoICcuJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9JyBhY3Rpdml0eSBuYW1lYCk7XG4gICAgICAgIHN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eSA9IGAuJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9YDtcbiAgICAgICAgc3RhcnRBcHBPcHRpb25zLnJldHJ5ID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnN0YXJ0QXBwKHN0YXJ0QXBwT3B0aW9ucyk7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFjdGl2aXR5IG5hbWUgJyR7c3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5fScgdXNlZCB0byBzdGFydCB0aGUgYXBwIGRvZXNuJ3QgYCArXG4gICAgICAgICAgICAgICAgICAgICAgYGV4aXN0IG9yIGNhbm5vdCBiZSBsYXVuY2hlZCEgTWFrZSBzdXJlIGl0IGV4aXN0cyBhbmQgaXMgYSBsYXVuY2hhYmxlIGFjdGl2aXR5YCk7XG4gICAgfSBlbHNlIGlmIChzdGRvdXQuaW5jbHVkZXMoXCJqYXZhLmxhbmcuU2VjdXJpdHlFeGNlcHRpb25cIikpIHtcbiAgICAgIC8vIGlmIHRoZSBhcHAgaXMgZGlzYWJsZWQgb24gYSByZWFsIGRldmljZSBpdCB3aWxsIHRocm93IGEgc2VjdXJpdHkgZXhjZXB0aW9uXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBwZXJtaXNzaW9uIHRvIHN0YXJ0ICcke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX0nIGFjdGl2aXR5IGhhcyBiZWVuIGRlbmllZC5gICtcbiAgICAgICAgICAgICAgICAgICAgICBgTWFrZSBzdXJlIHRoZSBhY3Rpdml0eS9wYWNrYWdlIG5hbWVzIGFyZSBjb3JyZWN0LmApO1xuICAgIH1cbiAgICBpZiAoc3RhcnRBcHBPcHRpb25zLndhaXRBY3Rpdml0eSkge1xuICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHkoc3RhcnRBcHBPcHRpb25zLndhaXRQa2csIHN0YXJ0QXBwT3B0aW9ucy53YWl0QWN0aXZpdHksIHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24pO1xuICAgIH1cbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3Qgc3RhcnQgdGhlICcke3N0YXJ0QXBwT3B0aW9ucy5wa2d9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICBgVmlzaXQgJHtBQ1RJVklUSUVTX1RST1VCTEVTSE9PVElOR19MSU5LfSBmb3IgdHJvdWJsZXNob290aW5nLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUGFja2FnZUFjdGl2aXR5SW5mb1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSBhcHBQYWNrYWdlIC0gVGhlIG5hbWUgb2YgYXBwbGljYXRpb24gcGFja2FnZSxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBleGFtcGxlICdjb20uYWNtZS5hcHAnLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBhcHBBY3Rpdml0eSAtIFRoZSBuYW1lIG9mIG1haW4gYXBwbGljYXRpb24gYWN0aXZpdHkuXG4gKi9cblxuLyoqXG4gKiBHZXQgdGhlIG5hbWUgb2YgY3VycmVudGx5IGZvY3VzZWQgcGFja2FnZSBhbmQgYWN0aXZpdHkuXG4gKlxuICogQHJldHVybiB7UGFja2FnZUFjdGl2aXR5SW5mb30gVGhlIG1hcHBpbmcsIHdoZXJlIHByb3BlcnR5IG5hbWVzIGFyZSAnYXBwUGFja2FnZScgYW5kICdhcHBBY3Rpdml0eScuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgaXMgYW4gZXJyb3Igd2hpbGUgcGFyc2luZyB0aGUgZGF0YS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxvZy5kZWJ1ZyhcIkdldHRpbmcgZm9jdXNlZCBwYWNrYWdlIGFuZCBhY3Rpdml0eVwiKTtcbiAgY29uc3QgY21kID0gWydkdW1wc3lzJywgJ3dpbmRvdycsICd3aW5kb3dzJ107XG4gIGNvbnN0IG51bGxGb2N1c2VkQXBwUmUgPSBuZXcgUmVnRXhwKC9eXFxzKm1Gb2N1c2VkQXBwPW51bGwvLCAnbScpO1xuICAvLyBodHRwczovL3JlZ2V4MTAxLmNvbS9yL3haOHZGNy8xXG4gIGNvbnN0IGZvY3VzZWRBcHBSZSA9IG5ldyBSZWdFeHAoJ15cXFxccyptRm9jdXNlZEFwcC4rUmVjb3JkXFxcXHsuKlxcXFxzKFteXFxcXHNcXFxcL1xcXFx9XSspJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1xcXFwvKFteXFxcXHNcXFxcL1xcXFx9XFxcXCxdKylcXFxcLD8oXFxcXHNbXlxcXFxzXFxcXC9cXFxcfV0rKSpcXFxcfScsICdtJyk7XG4gIGNvbnN0IG51bGxDdXJyZW50Rm9jdXNSZSA9IG5ldyBSZWdFeHAoL15cXHMqbUN1cnJlbnRGb2N1cz1udWxsLywgJ20nKTtcbiAgY29uc3QgY3VycmVudEZvY3VzQXBwUmUgPSBuZXcgUmVnRXhwKCdeXFxcXHMqbUN1cnJlbnRGb2N1cy4rXFxcXHsuK1xcXFxzKFteXFxcXHNcXFxcL10rKVxcXFwvKFteXFxcXHNdKylcXFxcYicsICdtJyk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKGNtZCk7XG4gICAgLy8gVGhlIG9yZGVyIG1hdHRlcnMgaGVyZVxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBbZm9jdXNlZEFwcFJlLCBjdXJyZW50Rm9jdXNBcHBSZV0pIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gcGF0dGVybi5leGVjKHN0ZG91dCk7XG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhcHBQYWNrYWdlOiBtYXRjaFsxXS50cmltKCksXG4gICAgICAgICAgYXBwQWN0aXZpdHk6IG1hdGNoWzJdLnRyaW0oKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBbbnVsbEZvY3VzZWRBcHBSZSwgbnVsbEN1cnJlbnRGb2N1c1JlXSkge1xuICAgICAgaWYgKHBhdHRlcm4uZXhlYyhzdGRvdXQpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYXBwUGFja2FnZTogbnVsbCxcbiAgICAgICAgICBhcHBBY3Rpdml0eTogbnVsbFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBwYXJzZSBhY3Rpdml0eSBmcm9tIGR1bXBzeXNcIik7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBnZXQgZm9jdXNQYWNrYWdlQW5kQWN0aXZpdHkuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBXYWl0IGZvciB0aGUgZ2l2ZW4gYWN0aXZpdHkgdG8gYmUgZm9jdXNlZC9ub24tZm9jdXNlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHksIGJlbG9uZ2luZyB0byB0aGF0IHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gd2FpdEZvclN0b3AgLSBXaGV0aGVyIHRvIHdhaXQgdW50aWwgdGhlIGFjdGl2aXR5IGlzIGZvY3VzZWQgKHRydWUpXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgaXMgbm90IGZvY3VzZWQgKGZhbHNlKS5cbiAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0TXMgWzIwMDAwXSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgdGltZW91dCBvY2N1cnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGltZW91dCBoYXBwZW5zLlxuICovXG5hcGtVdGlsc01ldGhvZHMud2FpdEZvckFjdGl2aXR5T3JOb3QgPSBhc3luYyBmdW5jdGlvbiAocGtnLCBhY3Rpdml0eSwgd2FpdEZvclN0b3AsIHdhaXRNcyA9IDIwMDAwKSB7XG4gIGlmICghcGtnIHx8ICFhY3Rpdml0eSkge1xuICAgIHRocm93IG5ldyBFcnJvcignUGFja2FnZSBhbmQgYWN0aXZpdHkgcmVxdWlyZWQuJyk7XG4gIH1cbiAgbG9nLmRlYnVnKGBXYWl0aW5nIHVwIHRvICR7d2FpdE1zfW1zIGZvciBhY3Rpdml0eSBtYXRjaGluZyBwa2c6ICcke3BrZ30nIGFuZCBgICtcbiAgICAgICAgICAgIGBhY3Rpdml0eTogJyR7YWN0aXZpdHl9JyB0byR7d2FpdEZvclN0b3AgPyAnIG5vdCcgOiAnJ30gYmUgZm9jdXNlZGApO1xuXG4gIGNvbnN0IHNwbGl0TmFtZXMgPSAobmFtZXMpID0+IG5hbWVzLnNwbGl0KCcsJykubWFwKChuYW1lKSA9PiBuYW1lLnRyaW0oKSk7XG5cbiAgY29uc3QgYWxsUGFja2FnZXMgPSBzcGxpdE5hbWVzKHBrZyk7XG4gIGNvbnN0IGFsbEFjdGl2aXRpZXMgPSBzcGxpdE5hbWVzKGFjdGl2aXR5KTtcblxuICBsZXQgcG9zc2libGVBY3Rpdml0eU5hbWVzID0gW107XG4gIGZvciAobGV0IG9uZUFjdGl2aXR5IG9mIGFsbEFjdGl2aXRpZXMpIHtcbiAgICBpZiAob25lQWN0aXZpdHkuc3RhcnRzV2l0aCgnLicpKSB7XG4gICAgICAvLyBhZGQgdGhlIHBhY2thZ2UgbmFtZSBpZiBhY3Rpdml0eSBpcyBub3QgZnVsbCBxdWFsaWZpZWRcbiAgICAgIGZvciAobGV0IGN1cnJlbnRQa2cgb2YgYWxsUGFja2FnZXMpIHtcbiAgICAgICAgcG9zc2libGVBY3Rpdml0eU5hbWVzLnB1c2goYCR7Y3VycmVudFBrZ30ke29uZUFjdGl2aXR5fWAucmVwbGFjZSgvXFwuKy9nLCAnLicpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gYWNjZXB0IGZ1bGx5IHF1YWxpZmllZCBhY3Rpdml0eSBuYW1lLlxuICAgICAgcG9zc2libGVBY3Rpdml0eU5hbWVzLnB1c2gob25lQWN0aXZpdHkpO1xuICAgICAgcG9zc2libGVBY3Rpdml0eU5hbWVzLnB1c2goYCR7cGtnfS4ke29uZUFjdGl2aXR5fWApO1xuICAgIH1cbiAgfVxuICBsb2cuZGVidWcoYFBvc3NpYmxlIGFjdGl2aXRpZXMsIHRvIGJlIGNoZWNrZWQ6ICR7cG9zc2libGVBY3Rpdml0eU5hbWVzLm1hcCgobmFtZSkgPT4gYCcke25hbWV9J2ApLmpvaW4oJywgJyl9YCk7XG5cbiAgbGV0IHBvc3NpYmxlQWN0aXZpdHlQYXR0ZXJucyA9IHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5tYXAoKHBvc3NpYmxlQWN0aXZpdHlOYW1lKSA9PlxuICAgIG5ldyBSZWdFeHAoYF4ke3Bvc3NpYmxlQWN0aXZpdHlOYW1lLnJlcGxhY2UoL1xcLi9nLCAnXFxcXC4nKS5yZXBsYWNlKC9cXCovZywgJy4qPycpLnJlcGxhY2UoL1xcJC9nLCAnXFxcXCQnKX0kYClcbiAgKTtcblxuICAvLyBmaWd1cmUgb3V0IHRoZSBudW1iZXIgb2YgcmV0cmllcy4gVHJ5IG9uY2UgaWYgd2FpdE1zIGlzIGxlc3MgdGhhdCA3NTBcbiAgLy8gMzAgdGltZXMgaWYgcGFyc2luZyBpcyBub3QgcG9zc2libGVcbiAgbGV0IHJldHJpZXMgPSBwYXJzZUludCh3YWl0TXMgLyA3NTAsIDEwKSB8fCAxO1xuICByZXRyaWVzID0gaXNOYU4ocmV0cmllcykgPyAzMCA6IHJldHJpZXM7XG4gIGF3YWl0IHJldHJ5SW50ZXJ2YWwocmV0cmllcywgNzUwLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IHthcHBQYWNrYWdlLCBhcHBBY3Rpdml0eX0gPSBhd2FpdCB0aGlzLmdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkoKTtcbiAgICBpZiAoYXBwQWN0aXZpdHkgJiYgYXBwUGFja2FnZSkge1xuICAgICAgbGV0IGZ1bGx5UXVhbGlmaWVkQWN0aXZpdHkgPSBhcHBBY3Rpdml0eS5zdGFydHNXaXRoKCcuJykgPyBgJHthcHBQYWNrYWdlfSR7YXBwQWN0aXZpdHl9YCA6IGFwcEFjdGl2aXR5O1xuICAgICAgbG9nLmRlYnVnKGBGb3VuZCBwYWNrYWdlOiAnJHthcHBQYWNrYWdlfScgYW5kIGZ1bGx5IHF1YWxpZmllZCBhY3Rpdml0eSBuYW1lIDogJyR7ZnVsbHlRdWFsaWZpZWRBY3Rpdml0eX0nYCk7XG4gICAgICBsZXQgZm91bmRBY3QgPSAoXy5pbmNsdWRlcyhhbGxQYWNrYWdlcywgYXBwUGFja2FnZSkgJiZcbiAgICAgICAgICAgICAgICAgICAgICBfLmZpbmRJbmRleChwb3NzaWJsZUFjdGl2aXR5UGF0dGVybnMsIChwb3NzaWJsZVBhdHRlcm4pID0+IHBvc3NpYmxlUGF0dGVybi50ZXN0KGZ1bGx5UXVhbGlmaWVkQWN0aXZpdHkpKSAhPT0gLTEpO1xuICAgICAgaWYgKCghd2FpdEZvclN0b3AgJiYgZm91bmRBY3QpIHx8ICh3YWl0Rm9yU3RvcCAmJiAhZm91bmRBY3QpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nLmRlYnVnKCdJbmNvcnJlY3QgcGFja2FnZSBhbmQgYWN0aXZpdHkuIFJldHJ5aW5nLicpO1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtwb3NzaWJsZUFjdGl2aXR5TmFtZXMubWFwKChuYW1lKSA9PiBgJyR7bmFtZX0nYCkuam9pbignIG9yICcpfSBuZXZlciAke3dhaXRGb3JTdG9wID8gJ3N0b3BwZWQnIDogJ3N0YXJ0ZWQnfS4gYCArXG4gICAgICBgVmlzaXQgJHtBQ1RJVklUSUVTX1RST1VCTEVTSE9PVElOR19MSU5LfSBmb3IgdHJvdWJsZXNob290aW5nYCk7XG4gIH0pO1xufTtcblxuLyoqXG4gKiBXYWl0IGZvciB0aGUgZ2l2ZW4gYWN0aXZpdHkgdG8gYmUgZm9jdXNlZFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpdml0eSAtIFRoZSBuYW1lIG9mIHRoZSBhY3Rpdml0eSwgYmVsb25naW5nIHRvIHRoYXQgcGFja2FnZSxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtudW1iZXJ9IHdhaXRNcyBbMjAwMDBdIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSB0aW1lb3V0IG9jY3Vycy5cbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiB0aW1lb3V0IGhhcHBlbnMuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy53YWl0Rm9yQWN0aXZpdHkgPSBhc3luYyBmdW5jdGlvbiAocGtnLCBhY3QsIHdhaXRNcyA9IDIwMDAwKSB7XG4gIGF3YWl0IHRoaXMud2FpdEZvckFjdGl2aXR5T3JOb3QocGtnLCBhY3QsIGZhbHNlLCB3YWl0TXMpO1xufTtcblxuLyoqXG4gKiBXYWl0IGZvciB0aGUgZ2l2ZW4gYWN0aXZpdHkgdG8gYmUgbm9uLWZvY3VzZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5LCBiZWxvbmdpbmcgdG8gdGhhdCBwYWNrYWdlLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge251bWJlcn0gd2FpdE1zIFsyMDAwMF0gLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHRpbWVvdXQgb2NjdXJzLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRpbWVvdXQgaGFwcGVucy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLndhaXRGb3JOb3RBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uIChwa2csIGFjdCwgd2FpdE1zID0gMjAwMDApIHtcbiAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHlPck5vdChwa2csIGFjdCwgdHJ1ZSwgd2FpdE1zKTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gVW5pbnN0YWxsT3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgWzIwMDAwXSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgdW5pbnN0YWxsZWQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGtlZXBEYXRhIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBrZWVwIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwbGljYXRpb24gZGF0YSBhbmQgY2FjaGUgZm9sZGVycyBhZnRlciB1bmluc3RhbGwuXG4gKi9cblxuY29uc3QgQVBLX1VOSU5TVEFMTF9USU1FT1VUID0gMjAwMDA7XG5cbi8qKlxuICogVW5pbnN0YWxsIHRoZSBnaXZlbiBwYWNrYWdlIGZyb20gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byBiZSB1bmluc3RhbGxlZC5cbiAqIEBwYXJhbSB7P1VuaW5zdGFsbE9wdGlvbnN9IG9wdGlvbnMgLSBUaGUgc2V0IG9mIHVuaW5zdGFsbGF0aW9uIG9wdGlvbnMuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBwYWNrYWdlIHdhcyBmb3VuZCBvbiB0aGUgZGV2aWNlIGFuZFxuICogICAgICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bGx5IHVuaW5zdGFsbGVkLlxuICovXG5hcGtVdGlsc01ldGhvZHMudW5pbnN0YWxsQXBrID0gYXN5bmMgZnVuY3Rpb24gKHBrZywgb3B0aW9ucyA9IHt9KSB7XG4gIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICB0aW1lb3V0OiBBUEtfVU5JTlNUQUxMX1RJTUVPVVRcbiAgfSwgb3B0aW9ucyk7XG4gIGxvZy5kZWJ1ZyhgVW5pbnN0YWxsaW5nICR7cGtnfWApO1xuICBpZiAoIWF3YWl0IHRoaXMuaXNBcHBJbnN0YWxsZWQocGtnKSkge1xuICAgIGxvZy5pbmZvKGAke3BrZ30gd2FzIG5vdCB1bmluc3RhbGxlZCwgYmVjYXVzZSBpdCB3YXMgbm90IHByZXNlbnQgb24gdGhlIGRldmljZWApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNvbnN0IGNtZCA9IFsndW5pbnN0YWxsJ107XG4gIGlmIChvcHRpb25zLmtlZXBEYXRhKSB7XG4gICAgY21kLnB1c2goJy1rJyk7XG4gIH1cbiAgY21kLnB1c2gocGtnKTtcblxuICBsZXQgc3Rkb3V0O1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuZm9yY2VTdG9wKHBrZyk7XG4gICAgc3Rkb3V0ID0gKGF3YWl0IHRoaXMuYWRiRXhlYyhjbWQsIHt0aW1lb3V0OiBvcHRpb25zLnRpbWVvdXR9KSkudHJpbSgpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbmFibGUgdG8gdW5pbnN0YWxsIEFQSy4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG4gIGxvZy5kZWJ1ZyhgJ2FkYiAke2NtZC5qb2luKCcgJyl9JyBjb21tYW5kIG91dHB1dDogJHtzdGRvdXR9YCk7XG4gIGlmIChzdGRvdXQuaW5jbHVkZXMoXCJTdWNjZXNzXCIpKSB7XG4gICAgbG9nLmluZm8oYCR7cGtnfSB3YXMgc3VjY2Vzc2Z1bGx5IHVuaW5zdGFsbGVkYCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgbG9nLmluZm8oYCR7cGtnfSB3YXMgbm90IHVuaW5zdGFsbGVkYCk7XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qKlxuICogSW5zdGFsbCB0aGUgcGFja2FnZSBhZnRlciBpdCB3YXMgcHVzaGVkIHRvIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrUGF0aE9uRGV2aWNlIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgcGFja2FnZSBvbiB0aGUgZGV2aWNlIGZpbGUgc3lzdGVtLlxuICogQHBhcmFtIHtvYmplY3R9IG9wdHMgW3t9XSAtIEFkZGl0aW9uYWwgZXhlYyBvcHRpb25zLiBTZWUge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vbm9kZS10ZWVuX3Byb2Nlc3N9XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG1vcmUgZGV0YWlscyBvbiB0aGlzIHBhcmFtZXRlci5cbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiB0aGVyZSB3YXMgYSBmYWlsdXJlIGR1cmluZyBhcHBsaWNhdGlvbiBpbnN0YWxsLlxuICovXG5hcGtVdGlsc01ldGhvZHMuaW5zdGFsbEZyb21EZXZpY2VQYXRoID0gYXN5bmMgZnVuY3Rpb24gKGFwa1BhdGhPbkRldmljZSwgb3B0cyA9IHt9KSB7XG4gIGxldCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsncG0nLCAnaW5zdGFsbCcsICctcicsIGFwa1BhdGhPbkRldmljZV0sIG9wdHMpO1xuICBpZiAoc3Rkb3V0LmluZGV4T2YoXCJGYWlsdXJlXCIpICE9PSAtMSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgUmVtb3RlIGluc3RhbGwgZmFpbGVkOiAke3N0ZG91dH1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBJbnN0YWxsT3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgWzYwMDAwXSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgaW5zdGFsbGVkLlxuICogQHByb3BlcnR5IHtib29sZWFufSBhbGxvd1Rlc3RQYWNrYWdlcyBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8gYWxsb3cgdGVzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZXMgaW5zdGFsbGF0aW9uLlxuICogQHByb3BlcnR5IHtib29sZWFufSB1c2VTZGNhcmQgW2ZhbHNlXSAtIFNldCB0byB0cnVlIHRvIGluc3RhbGwgdGhlIGFwcCBvbiBzZGNhcmRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0ZWFkIG9mIHRoZSBkZXZpY2UgbWVtb3J5LlxuICogQHByb3BlcnR5IHtib29sZWFufSBncmFudFBlcm1pc3Npb25zIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBncmFudCBhbGwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zIHJlcXVlc3RlZCBpbiB0aGUgYXBwbGljYXRpb24ncyBtYW5pZmVzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5IGFmdGVyIHRoZSBpbnN0YWxsYXRpb24gaXMgY29tcGxldGVkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuZGVyIEFuZHJvaWQgNisuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHJlcGxhY2UgW3RydWVdIC0gU2V0IGl0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIHVwZ3JhZGVkL3JlaW5zdGFsbGVkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXQgaXMgYWxyZWFkeSBwcmVzZW50IG9uIHRoZSBkZXZpY2UuXG4gKi9cblxuLyoqXG4gKiBJbnN0YWxsIHRoZSBwYWNrYWdlIGZyb20gdGhlIGxvY2FsIGZpbGUgc3lzdGVtLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgcGFja2FnZS5cbiAqIEBwYXJhbSB7P0luc3RhbGxPcHRpb25zfSBvcHRpb25zIC0gVGhlIHNldCBvZiBpbnN0YWxsYXRpb24gb3B0aW9ucy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBhbiB1bmV4cGVjdGVkIGVycm9yIGhhcHBlbnMgZHVyaW5nIGluc3RhbGwuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5pbnN0YWxsID0gYXN5bmMgZnVuY3Rpb24gKGFwcFBhdGgsIG9wdGlvbnMgPSB7fSkge1xuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5pbnN0YWxsQXBrcyhhcHBQYXRoLCBvcHRpb25zKTtcbiAgfVxuXG4gIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICByZXBsYWNlOiB0cnVlLFxuICAgIHRpbWVvdXQ6IEFQS19JTlNUQUxMX1RJTUVPVVQsXG4gIH0sIG9wdGlvbnMpO1xuXG4gIGNvbnN0IGluc3RhbGxBcmdzID0gYnVpbGRJbnN0YWxsQXJncyhhd2FpdCB0aGlzLmdldEFwaUxldmVsKCksIG9wdGlvbnMpO1xuICB0cnkge1xuICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IHRoaXMuYWRiRXhlYyhbJ2luc3RhbGwnLCAuLi5pbnN0YWxsQXJncywgYXBwUGF0aF0sIHtcbiAgICAgIHRpbWVvdXQ6IG9wdGlvbnMudGltZW91dCxcbiAgICB9KTtcbiAgICBjb25zdCB0cnVuY2F0ZWRPdXRwdXQgPSAoIV8uaXNTdHJpbmcob3V0cHV0KSB8fCBvdXRwdXQubGVuZ3RoIDw9IDMwMCkgP1xuICAgICAgb3V0cHV0IDogYCR7b3V0cHV0LnN1YnN0cigwLCAxNTApfS4uLiR7b3V0cHV0LnN1YnN0cihvdXRwdXQubGVuZ3RoIC0gMTUwKX1gO1xuICAgIGxvZy5kZWJ1ZyhgSW5zdGFsbCBjb21tYW5kIHN0ZG91dDogJHt0cnVuY2F0ZWRPdXRwdXR9YCk7XG4gICAgaWYgKF8uaW5jbHVkZXMob3V0cHV0LCAnSU5TVEFMTF9GQUlMRUQnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKG91dHB1dCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICAvLyBvbiBzb21lIHN5c3RlbXMgdGhpcyB3aWxsIHRocm93IGFuIGVycm9yIGlmIHRoZSBhcHAgYWxyZWFkeVxuICAgIC8vIGV4aXN0c1xuICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoJ0lOU1RBTExfRkFJTEVEX0FMUkVBRFlfRVhJU1RTJykpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBBcHBsaWNhdGlvbiAnJHthcHBQYXRofScgYWxyZWFkeSBpbnN0YWxsZWQuIENvbnRpbnVpbmcuYCk7XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbE9yVXBncmFkZU9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lb3V0IFs2MDAwMF0gLSBUaGUgY291bnQgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwIGlzIGluc3RhbGxlZC5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gYWxsb3dUZXN0UGFja2FnZXMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGFsbG93IHRlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VzIGluc3RhbGxhdGlvbi5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gdXNlU2RjYXJkIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSB0byBpbnN0YWxsIHRoZSBhcHAgb24gc2RjYXJkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGVhZCBvZiB0aGUgZGV2aWNlIG1lbW9yeS5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZ3JhbnRQZXJtaXNzaW9ucyBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8gZ3JhbnQgYWxsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQgaW4gdGhlIGFwcGxpY2F0aW9uJ3MgbWFuaWZlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b21hdGljYWxseSBhZnRlciB0aGUgaW5zdGFsbGF0aW9uIGlzIGNvbXBsZXRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmRlciBBbmRyb2lkIDYrLlxuICovXG5cbi8qKlxuICogSW5zdGFsbCB0aGUgcGFja2FnZSBmcm9tIHRoZSBsb2NhbCBmaWxlIHN5c3RlbSBvZiB1cGdyYWRlIGl0IGlmIGFuIG9sZGVyXG4gKiB2ZXJzaW9uIG9mIHRoZSBzYW1lIHBhY2thZ2UgaXMgYWxyZWFkeSBpbnN0YWxsZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCBwYWNrYWdlLlxuICogQHBhcmFtIHs/c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgaW5zdGFsbGVkIHBhY2thZ2UuIFRoZSBtZXRob2Qgd2lsbFxuICogICAgICAgICAgICAgICAgICAgICAgICBwZXJmb3JtIGZhc3RlciBpZiBpdCBpcyBzZXQuXG4gKiBAcGFyYW0gez9JbnN0YWxsT3JVcGdyYWRlT3B0aW9uc30gb3B0aW9ucyAtIFNldCBvZiBpbnN0YWxsIG9wdGlvbnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgYW4gdW5leHBlY3RlZCBlcnJvciBoYXBwZW5zIGR1cmluZyBpbnN0YWxsLlxuICovXG5hcGtVdGlsc01ldGhvZHMuaW5zdGFsbE9yVXBncmFkZSA9IGFzeW5jIGZ1bmN0aW9uIChhcHBQYXRoLCBwa2cgPSBudWxsLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKG9wdGlvbnMudGltZW91dCkpIHtcbiAgICBvcHRpb25zLnRpbWVvdXQgPSBBUEtfSU5TVEFMTF9USU1FT1VUO1xuICB9XG5cbiAgbGV0IGFwa0luZm8gPSBudWxsO1xuICBpZiAoIXBrZykge1xuICAgIGFwa0luZm8gPSBhd2FpdCB0aGlzLmdldEFwa0luZm8oYXBwUGF0aCk7XG4gICAgcGtnID0gYXBrSW5mby5uYW1lO1xuICB9XG4gIGlmICghcGtnKSB7XG4gICAgbG9nLndhcm4oYENhbm5vdCByZWFkIHRoZSBwYWNrYWdlIG5hbWUgb2YgJHthcHBQYXRofS4gQXNzdW1pbmcgY29ycmVjdCBhcHAgdmVyc2lvbiBpcyBhbHJlYWR5IGluc3RhbGxlZGApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICghYXdhaXQgdGhpcy5pc0FwcEluc3RhbGxlZChwa2cpKSB7XG4gICAgbG9nLmRlYnVnKGBBcHAgJyR7YXBwUGF0aH0nIG5vdCBpbnN0YWxsZWQuIEluc3RhbGxpbmdgKTtcbiAgICBhd2FpdCB0aGlzLmluc3RhbGwoYXBwUGF0aCwgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge3JlcGxhY2U6IGZhbHNlfSkpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHt2ZXJzaW9uQ29kZTogcGtnVmVyc2lvbkNvZGUsIHZlcnNpb25OYW1lOiBwa2dWZXJzaW9uTmFtZVN0cn0gPSBhd2FpdCB0aGlzLmdldFBhY2thZ2VJbmZvKHBrZyk7XG4gIGNvbnN0IHBrZ1ZlcnNpb25OYW1lID0gc2VtdmVyLnZhbGlkKHNlbXZlci5jb2VyY2UocGtnVmVyc2lvbk5hbWVTdHIpKTtcbiAgaWYgKCFhcGtJbmZvKSB7XG4gICAgYXBrSW5mbyA9IGF3YWl0IHRoaXMuZ2V0QXBrSW5mbyhhcHBQYXRoKTtcbiAgfVxuICBjb25zdCB7dmVyc2lvbkNvZGU6IGFwa1ZlcnNpb25Db2RlLCB2ZXJzaW9uTmFtZTogYXBrVmVyc2lvbk5hbWVTdHJ9ID0gYXBrSW5mbztcbiAgY29uc3QgYXBrVmVyc2lvbk5hbWUgPSBzZW12ZXIudmFsaWQoc2VtdmVyLmNvZXJjZShhcGtWZXJzaW9uTmFtZVN0cikpO1xuXG4gIGlmICghXy5pc0ludGVnZXIoYXBrVmVyc2lvbkNvZGUpIHx8ICFfLmlzSW50ZWdlcihwa2dWZXJzaW9uQ29kZSkpIHtcbiAgICBsb2cud2FybihgQ2Fubm90IHJlYWQgdmVyc2lvbiBjb2RlcyBvZiAnJHthcHBQYXRofScgYW5kL29yICcke3BrZ30nYCk7XG4gICAgaWYgKCFfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSB8fCAhXy5pc1N0cmluZyhwa2dWZXJzaW9uTmFtZSkpIHtcbiAgICAgIGxvZy53YXJuKGBDYW5ub3QgcmVhZCB2ZXJzaW9uIG5hbWVzIG9mICcke2FwcFBhdGh9JyBhbmQvb3IgJyR7cGtnfScuIEFzc3VtaW5nIGNvcnJlY3QgYXBwIHZlcnNpb24gaXMgYWxyZWFkeSBpbnN0YWxsZWRgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgaWYgKF8uaXNJbnRlZ2VyKGFwa1ZlcnNpb25Db2RlKSAmJiBfLmlzSW50ZWdlcihwa2dWZXJzaW9uQ29kZSkpIHtcbiAgICBpZiAocGtnVmVyc2lvbkNvZGUgPiBhcGtWZXJzaW9uQ29kZSkge1xuICAgICAgbG9nLmRlYnVnKGBUaGUgaW5zdGFsbGVkICcke3BrZ30nIHBhY2thZ2UgZG9lcyBub3QgcmVxdWlyZSB1cGdyYWRlICgke3BrZ1ZlcnNpb25Db2RlfSA+ICR7YXBrVmVyc2lvbkNvZGV9KWApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBWZXJzaW9uIGNvZGVzIG1pZ2h0IG5vdCBiZSBtYWludGFpbmVkLiBDaGVjayB2ZXJzaW9uIG5hbWVzLlxuICAgIGlmIChwa2dWZXJzaW9uQ29kZSA9PT0gYXBrVmVyc2lvbkNvZGUpIHtcbiAgICAgIGlmIChfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSAmJiBfLmlzU3RyaW5nKHBrZ1ZlcnNpb25OYW1lKSAmJiBzZW12ZXIuc2F0aXNmaWVzKHBrZ1ZlcnNpb25OYW1lLCBgPj0ke2Fwa1ZlcnNpb25OYW1lfWApKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVGhlIGluc3RhbGxlZCAnJHtwa2d9JyBwYWNrYWdlIGRvZXMgbm90IHJlcXVpcmUgdXBncmFkZSAoJyR7cGtnVmVyc2lvbk5hbWV9JyA+PSAnJHthcGtWZXJzaW9uTmFtZX0nKWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNTdHJpbmcoYXBrVmVyc2lvbk5hbWUpIHx8ICFfLmlzU3RyaW5nKHBrZ1ZlcnNpb25OYW1lKSkge1xuICAgICAgICBsb2cuZGVidWcoYFRoZSBpbnN0YWxsZWQgJyR7cGtnfScgcGFja2FnZSBkb2VzIG5vdCByZXF1aXJlIHVwZ3JhZGUgKCR7cGtnVmVyc2lvbkNvZGV9ID09PSAke2Fwa1ZlcnNpb25Db2RlfSlgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmIChfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSAmJiBfLmlzU3RyaW5nKHBrZ1ZlcnNpb25OYW1lKSAmJiBzZW12ZXIuc2F0aXNmaWVzKHBrZ1ZlcnNpb25OYW1lLCBgPj0ke2Fwa1ZlcnNpb25OYW1lfWApKSB7XG4gICAgbG9nLmRlYnVnKGBUaGUgaW5zdGFsbGVkICcke3BrZ30nIHBhY2thZ2UgZG9lcyBub3QgcmVxdWlyZSB1cGdyYWRlICgnJHtwa2dWZXJzaW9uTmFtZX0nID49ICcke2Fwa1ZlcnNpb25OYW1lfScpYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nLmRlYnVnKGBUaGUgaW5zdGFsbGVkICcke3BrZ30nIHBhY2thZ2UgaXMgb2xkZXIgdGhhbiAnJHthcHBQYXRofScgYCArXG4gICAgICAgICAgICBgKCR7cGtnVmVyc2lvbkNvZGV9IDwgJHthcGtWZXJzaW9uQ29kZX0gb3IgJyR7cGtnVmVyc2lvbk5hbWV9JyA8ICcke2Fwa1ZlcnNpb25OYW1lfScpJy4gYCArXG4gICAgICAgICAgICBgRXhlY3V0aW5nIHVwZ3JhZGVgKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmluc3RhbGwoYXBwUGF0aCwgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge3JlcGxhY2U6IHRydWV9KSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgdXBncmFkZSAnJHtwa2d9JyBiZWNhdXNlIG9mICcke2Vyci5tZXNzYWdlfScuIFRyeWluZyBmdWxsIHJlaW5zdGFsbGApO1xuICAgIGlmICghYXdhaXQgdGhpcy51bmluc3RhbGxBcGsocGtnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAnJHtwa2d9JyBwYWNrYWdlIGNhbm5vdCBiZSB1bmluc3RhbGxlZGApO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLmluc3RhbGwoYXBwUGF0aCwgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge3JlcGxhY2U6IGZhbHNlfSkpO1xuICB9XG59O1xuXG4vKipcbiAqIEV4dHJhY3Qgc3RyaW5nIHJlc291cmNlcyBmcm9tIHRoZSBnaXZlbiBwYWNrYWdlIG9uIGxvY2FsIGZpbGUgc3lzdGVtLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgLmFwayhzKSBwYWNrYWdlLlxuICogQHBhcmFtIHs/c3RyaW5nfSBsYW5ndWFnZSAtIFRoZSBuYW1lIG9mIHRoZSBsYW5ndWFnZSB0byBleHRyYWN0IHRoZSByZXNvdXJjZXMgZm9yLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBkZWZhdWx0IGxhbmd1YWdlIGlzIHVzZWQgaWYgdGhpcyBlcXVhbHMgdG8gYG51bGxgL2B1bmRlZmluZWRgXG4gKiBAcGFyYW0ge3N0cmluZ30gb3V0IC0gVGhlIG5hbWUgb2YgdGhlIGRlc3RpbmF0aW9uIGZvbGRlciBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0gdG9cbiAqICAgICAgICAgICAgICAgICAgICAgICBzdG9yZSB0aGUgZXh0cmFjdGVkIGZpbGUgdG8uXG4gKiBAcmV0dXJuIHtPYmplY3R9IEEgbWFwcGluZyBvYmplY3QsIHdoZXJlIHByb3BlcnRpZXMgYXJlOiAnYXBrU3RyaW5ncycsIGNvbnRhaW5pbmdcbiAqICAgICAgICAgICAgICAgICAgcGFyc2VkIHJlc291cmNlIGZpbGUgcmVwcmVzZW50ZWQgYXMgSlNPTiBvYmplY3QsIGFuZCAnbG9jYWxQYXRoJyxcbiAqICAgICAgICAgICAgICAgICAgY29udGFpbmluZyB0aGUgcGF0aCB0byB0aGUgZXh0cmFjdGVkIGZpbGUgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZXh0cmFjdFN0cmluZ3NGcm9tQXBrID0gYXN5bmMgZnVuY3Rpb24gKGFwcFBhdGgsIGxhbmd1YWdlLCBvdXQpIHtcbiAgbG9nLmRlYnVnKGBFeHRyYWN0aW5nIHN0cmluZ3MgZnJvbSBmb3IgbGFuZ3VhZ2U6ICR7bGFuZ3VhZ2UgfHwgJ2RlZmF1bHQnfWApO1xuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0TGFuZ3VhZ2VBcGsoYXBwUGF0aCwgbGFuZ3VhZ2UpO1xuICB9XG4gIGF3YWl0IHRoaXMuaW5pdEFhcHQoKTtcbiAgbGV0IHJhd0FhcHRPdXRwdXQ7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgW1xuICAgICAgJ2QnLFxuICAgICAgJy0tdmFsdWVzJyxcbiAgICAgICdyZXNvdXJjZXMnLFxuICAgICAgYXBwUGF0aCxcbiAgICBdKTtcbiAgICByYXdBYXB0T3V0cHV0ID0gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZXh0cmFjdCByZXNvdXJjZXMgZnJvbSAnJHthcHBQYXRofScuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxuXG4gIGNvbnN0IGRlZmF1bHRDb25maWdNYXJrZXIgPSAnKGRlZmF1bHQpJztcbiAgbGV0IGNvbmZpZ01hcmtlciA9IGxhbmd1YWdlIHx8IGRlZmF1bHRDb25maWdNYXJrZXI7XG4gIGlmIChjb25maWdNYXJrZXIuaW5jbHVkZXMoJy0nKSAmJiAhY29uZmlnTWFya2VyLmluY2x1ZGVzKCctcicpKSB7XG4gICAgY29uZmlnTWFya2VyID0gY29uZmlnTWFya2VyLnJlcGxhY2UoJy0nLCAnLXInKTtcbiAgfVxuICBpZiAoY29uZmlnTWFya2VyLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCgnZW4nKSkge1xuICAgIC8vIEFzc3VtZSB0aGUgJ2VuJyBjb25maWd1cmF0aW9uIGlzIHRoZSBkZWZhdWx0IG9uZVxuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIFtcbiAgICAgICdkJyxcbiAgICAgICdjb25maWd1cmF0aW9ucycsXG4gICAgICBhcHBQYXRoLFxuICAgIF0pO1xuICAgIGNvbnN0IGNvbmZpZ3MgPSBzdGRvdXQuc3BsaXQob3MuRU9MKTtcbiAgICBpZiAoIWNvbmZpZ3MuaW5jbHVkZXMoY29uZmlnTWFya2VyKSkge1xuICAgICAgbG9nLmRlYnVnKGBUaGVyZSBpcyBubyAnJHtjb25maWdNYXJrZXJ9JyBjb25maWd1cmF0aW9uLiBgICtcbiAgICAgICAgICAgICAgICBgUmVwbGFjaW5nIGl0IHdpdGggJyR7ZGVmYXVsdENvbmZpZ01hcmtlcn0nYCk7XG4gICAgICBjb25maWdNYXJrZXIgPSBkZWZhdWx0Q29uZmlnTWFya2VyO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGFwa1N0cmluZ3MgPSB7fTtcbiAgbGV0IGlzSW5Db25maWcgPSBmYWxzZTtcbiAgbGV0IGN1cnJlbnRSZXNvdXJjZUlkID0gbnVsbDtcbiAgbGV0IGlzSW5QbHVyYWxHcm91cCA9IGZhbHNlO1xuICBjb25zdCBzdGFydHNXaXRoQW55ID0gKHMsIGFycikgPT4gYXJyLnJlZHVjZSgoYWNjLCB4KSA9PiBhY2MgfHwgcy5zdGFydHNXaXRoKHgpLCBmYWxzZSk7XG4gIGNvbnN0IG5vcm1hbGl6ZVN0cmluZ01hdGNoID0gKHMpID0+IHMucmVwbGFjZSgvXCIkLywgJycpLnJlcGxhY2UoL15cIi8sICcnKS5yZXBsYWNlKC9cXFxcXCIvZywgJ1wiJyk7XG4gIGZvciAoY29uc3QgbGluZSBvZiByYXdBYXB0T3V0cHV0LnNwbGl0KG9zLkVPTCkpIHtcbiAgICBjb25zdCB0cmltbWVkTGluZSA9IGxpbmUudHJpbSgpO1xuICAgIGlmIChfLmlzRW1wdHkodHJpbW1lZExpbmUpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoc3RhcnRzV2l0aEFueSh0cmltbWVkTGluZSwgWydjb25maWcnLCAndHlwZScsICdzcGVjJywgJ1BhY2thZ2UnXSkpIHtcbiAgICAgIGlzSW5Db25maWcgPSB0cmltbWVkTGluZS5zdGFydHNXaXRoKGBjb25maWcgJHtjb25maWdNYXJrZXJ9OmApO1xuICAgICAgY3VycmVudFJlc291cmNlSWQgPSBudWxsO1xuICAgICAgaXNJblBsdXJhbEdyb3VwID0gZmFsc2U7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoIWlzSW5Db25maWcpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmICh0cmltbWVkTGluZS5zdGFydHNXaXRoKCdyZXNvdXJjZScpKSB7XG4gICAgICBpc0luUGx1cmFsR3JvdXAgPSBmYWxzZTtcbiAgICAgIGN1cnJlbnRSZXNvdXJjZUlkID0gbnVsbDtcblxuICAgICAgaWYgKHRyaW1tZWRMaW5lLmluY2x1ZGVzKCc6c3RyaW5nLycpKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gLzpzdHJpbmdcXC8oXFxTKyk6Ly5leGVjKHRyaW1tZWRMaW5lKTtcbiAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgY3VycmVudFJlc291cmNlSWQgPSBtYXRjaFsxXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0cmltbWVkTGluZS5pbmNsdWRlcygnOnBsdXJhbHMvJykpIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSAvOnBsdXJhbHNcXC8oXFxTKyk6Ly5leGVjKHRyaW1tZWRMaW5lKTtcbiAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgY3VycmVudFJlc291cmNlSWQgPSBtYXRjaFsxXTtcbiAgICAgICAgICBpc0luUGx1cmFsR3JvdXAgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoY3VycmVudFJlc291cmNlSWQgJiYgdHJpbW1lZExpbmUuc3RhcnRzV2l0aCgnKHN0cmluZycpKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IC9cIlteXCJcXFxcXSooPzpcXFxcLlteXCJcXFxcXSopKlwiLy5leGVjKHRyaW1tZWRMaW5lKTtcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBhcGtTdHJpbmdzW2N1cnJlbnRSZXNvdXJjZUlkXSA9IG5vcm1hbGl6ZVN0cmluZ01hdGNoKG1hdGNoWzBdKTtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnRSZXNvdXJjZUlkID0gbnVsbDtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChjdXJyZW50UmVzb3VyY2VJZCAmJiBpc0luUGx1cmFsR3JvdXAgJiYgdHJpbW1lZExpbmUuaW5jbHVkZXMoJzogKHN0cmluZycpKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IC9cIlteXCJcXFxcXSooPzpcXFxcLlteXCJcXFxcXSopKlwiLy5leGVjKHRyaW1tZWRMaW5lKTtcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBhcGtTdHJpbmdzW2N1cnJlbnRSZXNvdXJjZUlkXSA9IFtcbiAgICAgICAgICAuLi4oYXBrU3RyaW5nc1tjdXJyZW50UmVzb3VyY2VJZF0gfHwgW10pLFxuICAgICAgICAgIG5vcm1hbGl6ZVN0cmluZ01hdGNoKG1hdGNoWzBdKSxcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChfLmlzRW1wdHkoYXBrU3RyaW5ncykpIHtcbiAgICBsb2cud2FybihgTm8gc3RyaW5ncyBoYXZlIGJlZW4gZm91bmQgaW4gJyR7YXBwUGF0aH0nIHJlc291cmNlcyBgICtcbiAgICAgICAgICAgICBgZm9yICcke2NvbmZpZ01hcmtlcn0nIGNvbmZpZ3VyYXRpb25gKTtcbiAgfSBlbHNlIHtcbiAgICBsb2cuaW5mbyhgU3VjY2Vzc2Z1bGx5IGV4dHJhY3RlZCAke18ua2V5cyhhcGtTdHJpbmdzKS5sZW5ndGh9IHN0cmluZ3MgZnJvbSAnJHthcHBQYXRofScgcmVzb3VyY2VzIGAgK1xuICAgICAgICAgICAgIGBmb3IgJyR7Y29uZmlnTWFya2VyfScgY29uZmlndXJhdGlvbmApO1xuICB9XG5cbiAgY29uc3QgbG9jYWxQYXRoID0gcGF0aC5yZXNvbHZlKG91dCwgJ3N0cmluZ3MuanNvbicpO1xuICBhd2FpdCBta2RpcnAob3V0KTtcbiAgYXdhaXQgZnMud3JpdGVGaWxlKGxvY2FsUGF0aCwgSlNPTi5zdHJpbmdpZnkoYXBrU3RyaW5ncywgbnVsbCwgMiksICd1dGYtOCcpO1xuICByZXR1cm4ge2Fwa1N0cmluZ3MsIGxvY2FsUGF0aH07XG59O1xuXG4vKipcbiAqIEdldCB0aGUgbGFuZ3VhZ2UgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgbmFtZSBvZiBkZXZpY2UgbGFuZ3VhZ2UuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXREZXZpY2VMYW5ndWFnZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgbGV0IGxhbmd1YWdlO1xuICBpZiAoYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpIDwgMjMpIHtcbiAgICBsYW5ndWFnZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlU3lzTGFuZ3VhZ2UoKTtcbiAgICBpZiAoIWxhbmd1YWdlKSB7XG4gICAgICBsYW5ndWFnZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlUHJvZHVjdExhbmd1YWdlKCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxhbmd1YWdlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTG9jYWxlKCkpLnNwbGl0KFwiLVwiKVswXTtcbiAgfVxuICByZXR1cm4gbGFuZ3VhZ2U7XG59O1xuXG4vKipcbiAqIFNldCB0aGUgbGFuZ3VhZ2UgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gVGhlIG5hbWUgb2YgdGhlIG5ldyBkZXZpY2UgbGFuZ3VhZ2UuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5zZXREZXZpY2VMYW5ndWFnZSA9IGFzeW5jIGZ1bmN0aW9uIChsYW5ndWFnZSkge1xuICAvLyB0aGlzIG1ldGhvZCBpcyBvbmx5IHVzZWQgaW4gQVBJIDwgMjNcbiAgYXdhaXQgdGhpcy5zZXREZXZpY2VTeXNMYW5ndWFnZShsYW5ndWFnZSk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgY291bnRyeSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBuYW1lIG9mIGRldmljZSBjb3VudHJ5LlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0RGV2aWNlQ291bnRyeSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgLy8gdGhpcyBtZXRob2QgaXMgb25seSB1c2VkIGluIEFQSSA8IDIzXG4gIGxldCBjb3VudHJ5ID0gYXdhaXQgdGhpcy5nZXREZXZpY2VTeXNDb3VudHJ5KCk7XG4gIGlmICghY291bnRyeSkge1xuICAgIGNvdW50cnkgPSBhd2FpdCB0aGlzLmdldERldmljZVByb2R1Y3RDb3VudHJ5KCk7XG4gIH1cbiAgcmV0dXJuIGNvdW50cnk7XG59O1xuXG4vKipcbiAqIFNldCB0aGUgY291bnRyeSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY291bnRyeSAtIFRoZSBuYW1lIG9mIHRoZSBuZXcgZGV2aWNlIGNvdW50cnkuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5zZXREZXZpY2VDb3VudHJ5ID0gYXN5bmMgZnVuY3Rpb24gKGNvdW50cnkpIHtcbiAgLy8gdGhpcyBtZXRob2QgaXMgb25seSB1c2VkIGluIEFQSSA8IDIzXG4gIGF3YWl0IHRoaXMuc2V0RGV2aWNlU3lzQ291bnRyeShjb3VudHJ5KTtcbn07XG5cbi8qKlxuICogR2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgbmFtZSBvZiBkZXZpY2UgbG9jYWxlLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0RGV2aWNlTG9jYWxlID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICAvLyB0aGlzIG1ldGhvZCBpcyBvbmx5IHVzZWQgaW4gQVBJID49IDIzXG4gIGxldCBsb2NhbGUgPSBhd2FpdCB0aGlzLmdldERldmljZVN5c0xvY2FsZSgpO1xuICBpZiAoIWxvY2FsZSkge1xuICAgIGxvY2FsZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlUHJvZHVjdExvY2FsZSgpO1xuICB9XG4gIHJldHVybiBsb2NhbGU7XG59O1xuXG4vKipcbiAqIFNldCB0aGUgbG9jYWxlIG5hbWUgb2YgdGhlIGRldmljZSB1bmRlciB0ZXN0IGFuZCB0aGUgZm9ybWF0IG9mIHRoZSBsb2NhbGUgaXMgZW4tVVMsIGZvciBleGFtcGxlLlxuICogVGhpcyBtZXRob2QgY2FsbCBzZXREZXZpY2VMYW5ndWFnZUNvdW50cnksIHNvLCBwbGVhc2UgdXNlIHNldERldmljZUxhbmd1YWdlQ291bnRyeSBhcyBwb3NzaWJsZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbG9jYWxlIC0gTmFtZXMgb2YgdGhlIGRldmljZSBsYW5ndWFnZSBhbmQgdGhlIGNvdW50cnkgY29ubmVjdGVkIHdpdGggYC1gLiBlLmcuIGVuLVVTLlxuICovXG5hcGtVdGlsc01ldGhvZHMuc2V0RGV2aWNlTG9jYWxlID0gYXN5bmMgZnVuY3Rpb24gKGxvY2FsZSkge1xuICBjb25zdCB2YWxpZGF0ZUxvY2FsZSA9IG5ldyBSZWdFeHAoL1thLXpBLVpdKy1bYS16QS1aMC05XSsvKTtcbiAgaWYgKCF2YWxpZGF0ZUxvY2FsZS50ZXN0KGxvY2FsZSkpIHtcbiAgICBsb2cud2Fybihgc2V0RGV2aWNlTG9jYWxlIHJlcXVpcmVzIHRoZSBmb2xsb3dpbmcgZm9ybWF0OiBlbi1VUyBvciBqYS1KUGApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBzcGxpdF9sb2NhbGUgPSBsb2NhbGUuc3BsaXQoXCItXCIpO1xuICBhd2FpdCB0aGlzLnNldERldmljZUxhbmd1YWdlQ291bnRyeShzcGxpdF9sb2NhbGVbMF0sIHNwbGl0X2xvY2FsZVsxXSk7XG59O1xuXG4vKipcbiAqIE1ha2Ugc3VyZSBjdXJyZW50IGRldmljZSBsb2NhbGUgaXMgZXhwZWN0ZWQgb3Igbm90LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsYW5ndWFnZSAtIExhbmd1YWdlLiBUaGUgbGFuZ3VhZ2UgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSwgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byBsb3dlciBjYXNlLlxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgbGFuZ3VhZ2UgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSwgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byBsb3dlciBjYXNlLlxuICogQHBhcmFtIHs/c3RyaW5nfSBzY3JpcHQgLSBTY3JpcHQuIFRoZSBzY3JpcHQgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHRpdGxlIGNhc2UuXG4gKlxuICogQHJldHVybiB7Ym9vbGVhbn0gSWYgY3VycmVudCBsb2NhbGUgaXMgbGFuZ3VhZ2UgYW5kIGNvdW50cnkgYXMgYXJndW1lbnRzLCByZXR1cm4gdHJ1ZS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmVuc3VyZUN1cnJlbnRMb2NhbGUgPSBhc3luYyBmdW5jdGlvbiAobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCA9IG51bGwpIHtcbiAgY29uc3QgaGFzTGFuZ3VhZ2UgPSBfLmlzU3RyaW5nKGxhbmd1YWdlKTtcbiAgY29uc3QgaGFzQ291bnRyeSA9IF8uaXNTdHJpbmcoY291bnRyeSk7XG5cbiAgaWYgKCFoYXNMYW5ndWFnZSAmJiAhaGFzQ291bnRyeSkge1xuICAgIGxvZy53YXJuKCdlbnN1cmVDdXJyZW50TG9jYWxlIHJlcXVpcmVzIGxhbmd1YWdlIG9yIGNvdW50cnknKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBnZXQgbG93ZXIgY2FzZSB2ZXJzaW9ucyBvZiB0aGUgc3RyaW5nc1xuICBsYW5ndWFnZSA9IChsYW5ndWFnZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgY291bnRyeSA9IChjb3VudHJ5IHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuXG4gIGNvbnN0IGFwaUxldmVsID0gYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpO1xuXG4gIHJldHVybiBhd2FpdCByZXRyeUludGVydmFsKDUsIDEwMDAsIGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGFwaUxldmVsIDwgMjMpIHtcbiAgICAgICAgbGV0IGN1ckxhbmd1YWdlLCBjdXJDb3VudHJ5O1xuICAgICAgICBpZiAoaGFzTGFuZ3VhZ2UpIHtcbiAgICAgICAgICBjdXJMYW5ndWFnZSA9IChhd2FpdCB0aGlzLmdldERldmljZUxhbmd1YWdlKCkpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgaWYgKCFoYXNDb3VudHJ5ICYmIGxhbmd1YWdlID09PSBjdXJMYW5ndWFnZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNDb3VudHJ5KSB7XG4gICAgICAgICAgY3VyQ291bnRyeSA9IChhd2FpdCB0aGlzLmdldERldmljZUNvdW50cnkoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoIWhhc0xhbmd1YWdlICYmIGNvdW50cnkgPT09IGN1ckNvdW50cnkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IGN1ckxhbmd1YWdlICYmIGNvdW50cnkgPT09IGN1ckNvdW50cnkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgY3VyTG9jYWxlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTG9jYWxlKCkpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIC8vIHpoLWhhbnMtY24gOiB6aC1jblxuICAgICAgICBjb25zdCBsb2NhbGVDb2RlID0gc2NyaXB0ID8gYCR7bGFuZ3VhZ2V9LSR7c2NyaXB0LnRvTG93ZXJDYXNlKCl9LSR7Y291bnRyeX1gIDogYCR7bGFuZ3VhZ2V9LSR7Y291bnRyeX1gO1xuXG4gICAgICAgIGlmIChsb2NhbGVDb2RlID09PSBjdXJMb2NhbGUpIHtcbiAgICAgICAgICBsb2cuZGVidWcoYFJlcXVlc3RlZCBsb2NhbGUgaXMgZXF1YWwgdG8gY3VycmVudCBsb2NhbGU6ICcke2N1ckxvY2FsZX0nYCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGlmIHRoZXJlIGhhcyBiZWVuIGFuIGVycm9yLCByZXN0YXJ0IGFkYiBhbmQgcmV0cnlcbiAgICAgIGxvZy5lcnJvcihgVW5hYmxlIHRvIGNoZWNrIGRldmljZSBsb2NhbGl6YXRpb246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuZGVidWcoJ1Jlc3RhcnRpbmcgQURCIGFuZCByZXRyeWluZy4uLicpO1xuICAgICAgYXdhaXQgdGhpcy5yZXN0YXJ0QWRiKCk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gTGFuZ3VhZ2UuIFRoZSBsYW5ndWFnZSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIGxvd2VyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezIsOH0uIGUuZy4gZW4sIGphIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgY291bnRyeSAocmVnaW9uKSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHVwcGVyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezJ9IHwgWzAtOV17M30uIGUuZy4gVVMsIEpQIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHs/c3RyaW5nfSBzY3JpcHQgLSBTY3JpcHQuIFRoZSBzY3JpcHQgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHRpdGxlIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezR9LiBlLmcuIEhhbnMgaW4gemgtSGFucy1DTiA6IGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3JlZmVyZW5jZS9qYXZhL3V0aWwvTG9jYWxlLmh0bWxcbiAqL1xuYXBrVXRpbHNNZXRob2RzLnNldERldmljZUxhbmd1YWdlQ291bnRyeSA9IGFzeW5jIGZ1bmN0aW9uIChsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0ID0gbnVsbCkge1xuICBsZXQgaGFzTGFuZ3VhZ2UgPSBsYW5ndWFnZSAmJiBfLmlzU3RyaW5nKGxhbmd1YWdlKTtcbiAgbGV0IGhhc0NvdW50cnkgPSBjb3VudHJ5ICYmIF8uaXNTdHJpbmcoY291bnRyeSk7XG4gIGlmICghaGFzTGFuZ3VhZ2UgfHwgIWhhc0NvdW50cnkpIHtcbiAgICBsb2cud2Fybihgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IHJlcXVpcmVzIGxhbmd1YWdlIGFuZCBjb3VudHJ5IGF0IGxlYXN0YCk7XG4gICAgbG9nLndhcm4oYEdvdCBsYW5ndWFnZTogJyR7bGFuZ3VhZ2V9JyBhbmQgY291bnRyeTogJyR7Y291bnRyeX0nYCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGxldCBhcGlMZXZlbCA9IGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKTtcblxuICBsYW5ndWFnZSA9IChsYW5ndWFnZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgY291bnRyeSA9IChjb3VudHJ5IHx8ICcnKS50b1VwcGVyQ2FzZSgpO1xuXG4gIGlmIChhcGlMZXZlbCA8IDIzKSB7XG4gICAgbGV0IGN1ckxhbmd1YWdlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTGFuZ3VhZ2UoKSkudG9Mb3dlckNhc2UoKTtcbiAgICBsZXQgY3VyQ291bnRyeSA9IChhd2FpdCB0aGlzLmdldERldmljZUNvdW50cnkoKSkudG9VcHBlckNhc2UoKTtcblxuICAgIGlmIChsYW5ndWFnZSAhPT0gY3VyTGFuZ3VhZ2UgfHwgY291bnRyeSAhPT0gY3VyQ291bnRyeSkge1xuICAgICAgYXdhaXQgdGhpcy5zZXREZXZpY2VTeXNMb2NhbGVWaWFTZXR0aW5nQXBwKGxhbmd1YWdlLCBjb3VudHJ5KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IGN1ckxvY2FsZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlTG9jYWxlKCk7XG5cbiAgICAvLyB6aC1IYW5zLUNOIDogemgtQ05cbiAgICBjb25zdCBsb2NhbGVDb2RlID0gc2NyaXB0ID8gYCR7bGFuZ3VhZ2V9LSR7c2NyaXB0fS0ke2NvdW50cnl9YCA6IGAke2xhbmd1YWdlfS0ke2NvdW50cnl9YDtcbiAgICBsb2cuZGVidWcoYEN1cnJlbnQgbG9jYWxlOiAnJHtjdXJMb2NhbGV9JzsgcmVxdWVzdGVkIGxvY2FsZTogJyR7bG9jYWxlQ29kZX0nYCk7XG4gICAgaWYgKGxvY2FsZUNvZGUudG9Mb3dlckNhc2UoKSAhPT0gY3VyTG9jYWxlLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0RGV2aWNlU3lzTG9jYWxlVmlhU2V0dGluZ0FwcChsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0KTtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQXBwSW5mb1xuICogQHByb3BlcnR5IHtzdHJpbmd9IG5hbWUgLSBQYWNrYWdlIG5hbWUsIGZvciBleGFtcGxlICdjb20uYWNtZS5hcHAnLlxuICogQHByb3BlcnR5IHtudW1iZXJ9IHZlcnNpb25Db2RlIC0gVmVyc2lvbiBjb2RlLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHZlcnNpb25OYW1lIC0gVmVyc2lvbiBuYW1lLCBmb3IgZXhhbXBsZSAnMS4wJy5cbiAqL1xuXG4vKipcbiAqIEdldCB0aGUgcGFja2FnZSBpbmZvIGZyb20gbG9jYWwgYXBrIGZpbGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIGV4aXN0aW5nIC5hcGsocykgcGFja2FnZSBvbiB0aGUgbG9jYWxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSBzeXN0ZW0uXG4gKiBAcmV0dXJuIHs/QXBwSW5mb30gVGhlIHBhcnNlZCBhcHBsaWNhdGlvbiBpbmZvcm1hdGlvbi5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldEFwa0luZm8gPSBhc3luYyBmdW5jdGlvbiAoYXBwUGF0aCkge1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhhcHBQYXRoKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGZpbGUgYXQgcGF0aCAke2FwcFBhdGh9IGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlYCk7XG4gIH1cblxuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0QmFzZUFwayhhcHBQYXRoKTtcbiAgfVxuXG4gIGF3YWl0IHRoaXMuaW5pdEFhcHQoKTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbJ2QnLCAnYmFkZ2luZycsIGFwcFBhdGhdKTtcbiAgICBjb25zdCBtYXRjaGVzID0gbmV3IFJlZ0V4cCgvcGFja2FnZTogbmFtZT0nKFteJ10rKScgdmVyc2lvbkNvZGU9JyhcXGQrKScgdmVyc2lvbk5hbWU9JyhbXiddKyknLykuZXhlYyhzdGRvdXQpO1xuICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBtYXRjaGVzWzFdLFxuICAgICAgICB2ZXJzaW9uQ29kZTogcGFyc2VJbnQobWF0Y2hlc1syXSwgMTApLFxuICAgICAgICB2ZXJzaW9uTmFtZTogbWF0Y2hlc1szXVxuICAgICAgfTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBFcnJvciBcIiR7ZXJyLm1lc3NhZ2V9XCIgd2hpbGUgZ2V0dGluZyBiYWRnaW5nIGluZm9gKTtcbiAgfVxuICByZXR1cm4ge307XG59O1xuXG4vKipcbiAqIEdldCB0aGUgcGFja2FnZSBpbmZvIGZyb20gdGhlIGluc3RhbGxlZCBhcHBsaWNhdGlvbi5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIGluc3RhbGxlZCBwYWNrYWdlLlxuICogQHJldHVybiB7P0FwcEluZm99IFRoZSBwYXJzZWQgYXBwbGljYXRpb24gaW5mb3JtYXRpb24uXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRQYWNrYWdlSW5mbyA9IGFzeW5jIGZ1bmN0aW9uIChwa2cpIHtcbiAgbG9nLmRlYnVnKGBHZXR0aW5nIHBhY2thZ2UgaW5mbyBmb3IgJyR7cGtnfSdgKTtcbiAgbGV0IHJlc3VsdCA9IHtuYW1lOiBwa2d9O1xuICB0cnkge1xuICAgIGNvbnN0IHN0ZG91dCA9IGF3YWl0IHRoaXMuc2hlbGwoWydkdW1wc3lzJywgJ3BhY2thZ2UnLCBwa2ddKTtcbiAgICBjb25zdCB2ZXJzaW9uTmFtZU1hdGNoID0gbmV3IFJlZ0V4cCgvdmVyc2lvbk5hbWU9KFtcXGQrLl0rKS8pLmV4ZWMoc3Rkb3V0KTtcbiAgICBpZiAodmVyc2lvbk5hbWVNYXRjaCkge1xuICAgICAgcmVzdWx0LnZlcnNpb25OYW1lID0gdmVyc2lvbk5hbWVNYXRjaFsxXTtcbiAgICB9XG4gICAgY29uc3QgdmVyc2lvbkNvZGVNYXRjaCA9IG5ldyBSZWdFeHAoL3ZlcnNpb25Db2RlPShcXGQrKS8pLmV4ZWMoc3Rkb3V0KTtcbiAgICBpZiAodmVyc2lvbkNvZGVNYXRjaCkge1xuICAgICAgcmVzdWx0LnZlcnNpb25Db2RlID0gcGFyc2VJbnQodmVyc2lvbkNvZGVNYXRjaFsxXSwgMTApO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgRXJyb3IgJyR7ZXJyLm1lc3NhZ2V9JyB3aGlsZSBkdW1waW5nIHBhY2thZ2UgaW5mb2ApO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG5hcGtVdGlsc01ldGhvZHMucHVsbEFwayA9IGFzeW5jIGZ1bmN0aW9uIHB1bGxBcGsgKHBrZywgdG1wRGlyKSB7XG4gIGNvbnN0IHBrZ1BhdGggPSAoYXdhaXQgdGhpcy5hZGJFeGVjKFsnc2hlbGwnLCAncG0nLCAncGF0aCcsIHBrZ10pKS5yZXBsYWNlKCdwYWNrYWdlOicsICcnKTtcbiAgY29uc3QgdG1wQXBwID0gcGF0aC5yZXNvbHZlKHRtcERpciwgYCR7cGtnfS5hcGtgKTtcbiAgYXdhaXQgdGhpcy5wdWxsKHBrZ1BhdGgsIHRtcEFwcCk7XG4gIGxvZy5kZWJ1ZyhgUHVsbGVkIGFwcCBmb3IgcGFja2FnZSAnJHtwa2d9JyB0byAnJHt0bXBBcHB9J2ApO1xuICByZXR1cm4gdG1wQXBwO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgYXBrVXRpbHNNZXRob2RzO1xuIl0sImZpbGUiOiJsaWIvdG9vbHMvYXBrLXV0aWxzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
