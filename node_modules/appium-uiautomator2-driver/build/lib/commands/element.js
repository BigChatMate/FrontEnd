"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumBaseDriver = require("appium-base-driver");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

function toBool(s) {
  return _lodash.default.isString(s) ? s.toLowerCase() === 'true' : !!s;
}

commands.getAttribute = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (attribute, elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/attribute/${attribute}`, 'GET', {});
  });

  return function (_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

commands.elementDisplayed = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return toBool((yield this.getAttribute("displayed", elementId)));
  });

  return function (_x3) {
    return _ref2.apply(this, arguments);
  };
}();

commands.elementEnabled = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return toBool((yield this.getAttribute("enabled", elementId)));
  });

  return function (_x4) {
    return _ref3.apply(this, arguments);
  };
}();

commands.elementSelected = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return toBool((yield this.getAttribute("selected", elementId)));
  });

  return function (_x5) {
    return _ref4.apply(this, arguments);
  };
}();

commands.getName = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/name`, 'GET', {});
  });

  return function (_x6) {
    return _ref5.apply(this, arguments);
  };
}();

commands.getLocation = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (elementId) {
    _logger.default.info(`calling get location: ${elementId}`);

    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/location`, 'GET', {});
  });

  return function (_x7) {
    return _ref6.apply(this, arguments);
  };
}();

commands.getSize = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/size`, 'GET', {});
  });

  return function (_x8) {
    return _ref7.apply(this, arguments);
  };
}();

commands.touchLongClick = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (element, x, y, duration) {
    let params = {
      element,
      x,
      y,
      duration
    };
    return yield this.uiautomator2.jwproxy.command(`/touch/longclick`, 'POST', {
      params
    });
  });

  return function (_x9, _x10, _x11, _x12) {
    return _ref8.apply(this, arguments);
  };
}();

commands.touchDown = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (element, x, y) {
    let params = {
      element,
      x,
      y
    };
    return yield this.uiautomator2.jwproxy.command(`/touch/down`, 'POST', {
      params
    });
  });

  return function (_x13, _x14, _x15) {
    return _ref9.apply(this, arguments);
  };
}();

commands.touchUp = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (element, x, y) {
    let params = {
      element,
      x,
      y
    };
    return yield this.uiautomator2.jwproxy.command(`/touch/up`, 'POST', {
      params
    });
  });

  return function (_x16, _x17, _x18) {
    return _ref10.apply(this, arguments);
  };
}();

commands.touchMove = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (element, x, y) {
    let params = {
      element,
      x,
      y
    };
    return yield this.uiautomator2.jwproxy.command(`/touch/move`, 'POST', {
      params
    });
  });

  return function (_x19, _x20, _x21) {
    return _ref11.apply(this, arguments);
  };
}();

helpers.doSetElementValue = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (params) {
    return yield this.uiautomator2.jwproxy.command(`/element/${params.elementId}/value`, 'POST', params);
  });

  return function (_x22) {
    return _ref12.apply(this, arguments);
  };
}();

commands.setValueImmediate = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (keys, elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/value`, 'POST', {
      elementId,
      text: _lodash.default.isArray(keys) ? keys.join('') : keys,
      replace: false,
      unicodeKeyboard: this.opts.unicodeKeyboard
    });
  });

  return function (_x23, _x24) {
    return _ref13.apply(this, arguments);
  };
}();

commands.getText = function () {
  var _ref14 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/text`, 'GET', {});
  });

  return function (_x25) {
    return _ref14.apply(this, arguments);
  };
}();

commands.click = function () {
  var _ref15 = (0, _asyncToGenerator2.default)(function* (element) {
    return yield this.uiautomator2.jwproxy.command(`/element/${element}/click`, 'POST', {
      element
    });
  });

  return function (_x26) {
    return _ref15.apply(this, arguments);
  };
}();

commands.getElementScreenshot = function () {
  var _ref16 = (0, _asyncToGenerator2.default)(function* (element) {
    return yield this.uiautomator2.jwproxy.command(`/element/${element}/screenshot`, 'GET', {});
  });

  return function (_x27) {
    return _ref16.apply(this, arguments);
  };
}();

commands.tap = function () {
  var _ref17 = (0, _asyncToGenerator2.default)(function* (element, x = 0, y = 0, count = 1) {
    for (let i = 0; i < count; i++) {
      if (element) {
        let params = {
          element
        };

        if (x !== 0 || y !== 0) {
          params.x = x;
          params.y = y;
        }

        yield this.uiautomator2.jwproxy.command(`/element/${element}/click`, 'POST', params);
      } else {
        yield this.uiautomator2.jwproxy.command(`/appium/tap`, 'POST', {
          x,
          y
        });
      }
    }
  });

  return function (_x28) {
    return _ref17.apply(this, arguments);
  };
}();

commands.clear = function () {
  var _ref18 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/clear`, 'POST', {
      elementId
    });
  });

  return function (_x29) {
    return _ref18.apply(this, arguments);
  };
}();

commands.getElementRect = function () {
  var _ref19 = (0, _asyncToGenerator2.default)(function* (elementId) {
    if (this.isWebContext()) {
      _logger.default.debug(`Detected downstream chromedriver protocol: ${this.chromedriver.jwproxy.downstreamProtocol}`);

      if (this.chromedriver.jwproxy.downstreamProtocol === _appiumBaseDriver.BaseDriver.DRIVER_PROTOCOL.MJSONWP) {
        const _ref20 = yield this.chromedriver.jwproxy.command(`/element/${elementId}/location`, 'GET'),
              x = _ref20.x,
              y = _ref20.y;

        const _ref21 = yield this.chromedriver.jwproxy.command(`/element/${elementId}/size`, 'GET'),
              width = _ref21.width,
              height = _ref21.height;

        return {
          x,
          y,
          width,
          height
        };
      }

      return yield this.chromedriver.jwproxy.command(`/element/${elementId}/rect`, 'GET');
    }

    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/rect`, 'GET');
  });

  return function (_x30) {
    return _ref19.apply(this, arguments);
  };
}();

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJ0b0Jvb2wiLCJzIiwiXyIsImlzU3RyaW5nIiwidG9Mb3dlckNhc2UiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJlbGVtZW50SWQiLCJ1aWF1dG9tYXRvcjIiLCJqd3Byb3h5IiwiY29tbWFuZCIsImVsZW1lbnREaXNwbGF5ZWQiLCJlbGVtZW50RW5hYmxlZCIsImVsZW1lbnRTZWxlY3RlZCIsImdldE5hbWUiLCJnZXRMb2NhdGlvbiIsImxvZyIsImluZm8iLCJnZXRTaXplIiwidG91Y2hMb25nQ2xpY2siLCJlbGVtZW50IiwieCIsInkiLCJkdXJhdGlvbiIsInBhcmFtcyIsInRvdWNoRG93biIsInRvdWNoVXAiLCJ0b3VjaE1vdmUiLCJkb1NldEVsZW1lbnRWYWx1ZSIsInNldFZhbHVlSW1tZWRpYXRlIiwia2V5cyIsInRleHQiLCJpc0FycmF5Iiwiam9pbiIsInJlcGxhY2UiLCJ1bmljb2RlS2V5Ym9hcmQiLCJvcHRzIiwiZ2V0VGV4dCIsImNsaWNrIiwiZ2V0RWxlbWVudFNjcmVlbnNob3QiLCJ0YXAiLCJjb3VudCIsImkiLCJjbGVhciIsImdldEVsZW1lbnRSZWN0IiwiaXNXZWJDb250ZXh0IiwiZGVidWciLCJjaHJvbWVkcml2ZXIiLCJkb3duc3RyZWFtUHJvdG9jb2wiLCJCYXNlRHJpdmVyIiwiRFJJVkVSX1BST1RPQ09MIiwiTUpTT05XUCIsIndpZHRoIiwiaGVpZ2h0IiwiT2JqZWN0IiwiYXNzaWduIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLFFBQVEsR0FBRyxFQUFmO0FBQUEsSUFBbUJDLE9BQU8sR0FBRyxFQUE3QjtBQUFBLElBQWlDQyxVQUFVLEdBQUcsRUFBOUM7Ozs7QUFFQSxTQUFTQyxNQUFULENBQWlCQyxDQUFqQixFQUFvQjtBQUNsQixTQUFPQyxn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Z0UsS0FBaEUsQ0FBYjtBQUNEOztBQUNELGlCQUFhLEtBQUtDLFlBQUwsQ0FBa0JDLE9BQWxCLENBQTBCQyxPQUExQixDQUFtQyxZQUFXSCxTQUFVLE9BQXhELEVBQWdFLEtBQWhFLENBQWI7QUFDRCxHQVhEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWFBK0MsTUFBTSxDQUFDQyxNQUFQLENBQWN4RCxVQUFkLEVBQTBCRixRQUExQixFQUFvQ0MsT0FBcEM7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBCYXNlRHJpdmVyIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5mdW5jdGlvbiB0b0Jvb2wgKHMpIHtcbiAgcmV0dXJuIF8uaXNTdHJpbmcocykgPyAocy50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZScpIDogISFzO1xufVxuXG5jb21tYW5kcy5nZXRBdHRyaWJ1dGUgPSBhc3luYyBmdW5jdGlvbiAoYXR0cmlidXRlLCBlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L2F0dHJpYnV0ZS8ke2F0dHJpYnV0ZX1gLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMuZWxlbWVudERpc3BsYXllZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIHRvQm9vbChhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZShcImRpc3BsYXllZFwiLCBlbGVtZW50SWQpKTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRFbmFibGVkID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gdG9Cb29sKGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKFwiZW5hYmxlZFwiLCBlbGVtZW50SWQpKTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRTZWxlY3RlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIHRvQm9vbChhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZShcInNlbGVjdGVkXCIsIGVsZW1lbnRJZCkpO1xufTtcblxuY29tbWFuZHMuZ2V0TmFtZSA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L25hbWVgLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb24gPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIGxvZy5pbmZvKGBjYWxsaW5nIGdldCBsb2NhdGlvbjogJHtlbGVtZW50SWR9YCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9sb2NhdGlvbmAsICdHRVQnLCB7fSk7XG59O1xuXG5jb21tYW5kcy5nZXRTaXplID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vc2l6ZWAsICdHRVQnLCB7fSk7XG59O1xuXG5jb21tYW5kcy50b3VjaExvbmdDbGljayA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50LCB4LCB5LCBkdXJhdGlvbikge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnQsIHgsIHksIGR1cmF0aW9ufTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL3RvdWNoL2xvbmdjbGlja2AsICdQT1NUJywge3BhcmFtc30pO1xufTtcblxuY29tbWFuZHMudG91Y2hEb3duID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQsIHgsIHkpIHtcbiAgbGV0IHBhcmFtcyA9IHtlbGVtZW50LCB4LCB5fTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL3RvdWNoL2Rvd25gLCAnUE9TVCcsIHtwYXJhbXN9KTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoVXAgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCwgeCwgeSkge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnQsIHgsIHl9O1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvdG91Y2gvdXBgLCAnUE9TVCcsIHtwYXJhbXN9KTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoTW92ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50LCB4LCB5KSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudCwgeCwgeX07XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC90b3VjaC9tb3ZlYCwgJ1BPU1QnLCB7cGFyYW1zfSk7XG59O1xuXG5oZWxwZXJzLmRvU2V0RWxlbWVudFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKHBhcmFtcykge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke3BhcmFtcy5lbGVtZW50SWR9L3ZhbHVlYCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWVJbW1lZGlhdGUgPSBhc3luYyBmdW5jdGlvbiAoa2V5cywgZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS92YWx1ZWAsICdQT1NUJywge1xuICAgIGVsZW1lbnRJZCxcbiAgICB0ZXh0OiBfLmlzQXJyYXkoa2V5cykgPyBrZXlzLmpvaW4oJycpIDoga2V5cyxcbiAgICByZXBsYWNlOiBmYWxzZSxcbiAgICB1bmljb2RlS2V5Ym9hcmQ6IHRoaXMub3B0cy51bmljb2RlS2V5Ym9hcmQsXG4gIH0pO1xufTtcblxuY29tbWFuZHMuZ2V0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L3RleHRgLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMuY2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnR9L2NsaWNrYCwgJ1BPU1QnLCB7ZWxlbWVudH0pO1xufTtcblxuY29tbWFuZHMuZ2V0RWxlbWVudFNjcmVlbnNob3QgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnR9L3NjcmVlbnNob3RgLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMudGFwID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQsIHggPSAwLCB5ID0gMCwgY291bnQgPSAxKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAvLyB3ZSBhcmUgZWl0aGVyIHRhcHBpbmcgb24gdGhlIGRlZmF1bHQgbG9jYXRpb24gb2YgdGhlIGVsZW1lbnRcbiAgICAgIC8vIG9yIGFuIG9mZnNldCBmcm9tIHRoZSB0b3AgbGVmdCBjb3JuZXJcbiAgICAgIGxldCBwYXJhbXMgPSB7ZWxlbWVudH07XG4gICAgICBpZiAoeCAhPT0gMCB8fCB5ICE9PSAwKSB7XG4gICAgICAgIHBhcmFtcy54ID0geDtcbiAgICAgICAgcGFyYW1zLnkgPSB5O1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnR9L2NsaWNrYCwgJ1BPU1QnLCBwYXJhbXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9hcHBpdW0vdGFwYCwgJ1BPU1QnLCB7eCwgeX0pO1xuICAgIH1cbiAgfVxufTtcblxuY29tbWFuZHMuY2xlYXIgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9jbGVhcmAsICdQT1NUJywge2VsZW1lbnRJZH0pO1xufTtcblxuY29tbWFuZHMuZ2V0RWxlbWVudFJlY3QgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbG9nLmRlYnVnKGBEZXRlY3RlZCBkb3duc3RyZWFtIGNocm9tZWRyaXZlciBwcm90b2NvbDogJHt0aGlzLmNocm9tZWRyaXZlci5qd3Byb3h5LmRvd25zdHJlYW1Qcm90b2NvbH1gKTtcbiAgICBpZiAodGhpcy5jaHJvbWVkcml2ZXIuandwcm94eS5kb3duc3RyZWFtUHJvdG9jb2wgPT09IEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLk1KU09OV1ApIHtcbiAgICAgIGNvbnN0IHt4LCB5fSA9IGF3YWl0IHRoaXMuY2hyb21lZHJpdmVyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L2xvY2F0aW9uYCwgJ0dFVCcpO1xuICAgICAgY29uc3Qge3dpZHRoLCBoZWlnaHR9ID0gYXdhaXQgdGhpcy5jaHJvbWVkcml2ZXIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vc2l6ZWAsICdHRVQnKTtcbiAgICAgIHJldHVybiB7eCwgeSwgd2lkdGgsIGhlaWdodH07XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNocm9tZWRyaXZlci5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9yZWN0YCwgJ0dFVCcpO1xuICB9XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9yZWN0YCwgJ0dFVCcpO1xufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2VsZW1lbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
