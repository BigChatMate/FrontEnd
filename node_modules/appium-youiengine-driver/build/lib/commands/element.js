"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _appiumBaseDriver = require("appium-base-driver");

var _utils = require("../utils");

var _appiumSupport = require("appium-support");

let commands = {};

commands.getAttribute = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (attribute, el) {
    el = (0, _utils.unwrapEl)(el);
    let commandObject = {
      name: 'getAttribute',
      args: [`${el}`, `${attribute}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from getAttribute");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
      throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_INVALID_SELECTOR) {
      throw new _appiumBaseDriver.errors.InvalidSelectorError(result.value);
    }

    return result.value;
  });

  return function (_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

commands.setValue = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (value, el) {
    el = (0, _utils.unwrapEl)(el);

    if (value instanceof Array) {
      value = value.join("");
    }

    if (typeof value !== 'string') {
      value = `${value}`;
    }

    value = _appiumSupport.util.escapeSpecialChars(value, "'");
    value = value.replace(/\\\\n/g, "\\n");
    let commandObject = {
      name: 'sendkeys',
      args: [`${el}`, `${value}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from setValue");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
      throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
    }

    return result.value;
  });

  return function (_x3, _x4) {
    return _ref2.apply(this, arguments);
  };
}();

commands.getText = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);
    let commandObject = {
      name: 'getText',
      args: [`${el}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from getText");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
      throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
    }

    return result.value;
  });

  return function (_x5) {
    return _ref3.apply(this, arguments);
  };
}();

commands.elementEnabled = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);
    let commandObject = {
      name: 'elementEnabled',
      args: [`${el}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from elementEnabled");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
      throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
    } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
      throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
    }

    return result.value;
  });

  return function (_x6) {
    return _ref4.apply(this, arguments);
  };
}();

commands.elementSelected = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);
    let commandObject = {
      name: 'elementSelected',
      args: [`${el}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from elementSelected");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_ELEMENT_IS_NOT_SELECTABLE) {
      throw new _appiumBaseDriver.errors.ElementIsNotSelectableError(result.value);
    } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
      throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
    }

    return result.value;
  });

  return function (_x7) {
    return _ref5.apply(this, arguments);
  };
}();

commands.elementDisplayed = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);
    let commandObject = {
      name: 'elementDisplayed',
      args: [`${el}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from elementDisplayed");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
      throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
    } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
      throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
    }

    return result.value;
  });

  return function (_x8) {
    return _ref6.apply(this, arguments);
  };
}();

commands.clear = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);
    let commandObject = {
      name: 'clear',
      args: [`${el}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from clear");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
      throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
    } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
      throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
    }

    return result.value;
  });

  return function (_x9) {
    return _ref7.apply(this, arguments);
  };
}();

commands.getLocation = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);
    let commandObject = {
      name: 'elementLocation',
      args: [`${el}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from elementLocation");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
      throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
    } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
      throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
    }

    return result.value;
  });

  return function (_x10) {
    return _ref8.apply(this, arguments);
  };
}();

commands.getLocationInView = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.getLocation(elementId);
  });

  return function (_x11) {
    return _ref9.apply(this, arguments);
  };
}();

commands.getSize = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);
    let commandObject = {
      name: 'elementSize',
      args: [`${el}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from getSize");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
      throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
    } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
      throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
    }

    return result.value;
  });

  return function (_x12) {
    return _ref10.apply(this, arguments);
  };
}();

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiZ2V0QXR0cmlidXRlIiwiYXR0cmlidXRlIiwiZWwiLCJjb21tYW5kT2JqZWN0IiwibmFtZSIsImFyZ3MiLCJjb21tYW5kSlNPTiIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhIiwiZXhlY3V0ZVNvY2tldENvbW1hbmQiLCJyZXN1bHQiLCJwYXJzZSIsImUiLCJFcnJvciIsInN0YXR1cyIsInlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMiLCJXRUJEUklWRVJfU1RBTEVfRUxFTUVOVCIsImVycm9ycyIsIlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yIiwidmFsdWUiLCJXRUJEUklWRVJfSU5WQUxJRF9TRUxFQ1RPUiIsIkludmFsaWRTZWxlY3RvckVycm9yIiwic2V0VmFsdWUiLCJBcnJheSIsImpvaW4iLCJ1dGlsIiwiZXNjYXBlU3BlY2lhbENoYXJzIiwicmVwbGFjZSIsImdldFRleHQiLCJlbGVtZW50RW5hYmxlZCIsIldFQkRSSVZFUl9VTktOT1dOX0NPTU1BTkQiLCJVbmtub3duQ29tbWFuZEVycm9yIiwiV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCIsIk5vU3VjaEVsZW1lbnRFcnJvciIsImVsZW1lbnRTZWxlY3RlZCIsIldFQkRSSVZFUl9FTEVNRU5UX0lTX05PVF9TRUxFQ1RBQkxFIiwiRWxlbWVudElzTm90U2VsZWN0YWJsZUVycm9yIiwiZWxlbWVudERpc3BsYXllZCIsImNsZWFyIiwiZ2V0TG9jYXRpb24iLCJnZXRMb2NhdGlvbkluVmlldyIsImVsZW1lbnRJZCIsImdldFNpemUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBRUEsSUFBSUEsUUFBUSxHQUFHLEVBQWY7O0FBRUFBLFFBQVEsQ0FBQ0MsWUFBVDtBQUFBLDZDQUF3QixXQUFnQkMsU0FBaEIsRUFBMkJDLEVBQTNCLEVBQStCO0FBQ3JEQSxJQUFBQSxFQUFF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cnQgeyB1bndyYXBFbCwgeW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcyB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cbmxldCBjb21tYW5kcyA9IHt9O1xuXG5jb21tYW5kcy5nZXRBdHRyaWJ1dGUgPSBhc3luYyBmdW5jdGlvbiAoYXR0cmlidXRlLCBlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZ2V0QXR0cmlidXRlJyxcbiAgICBhcmdzOiBbYCR7ZWx9YCwgYCR7YXR0cmlidXRlfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gZ2V0QXR0cmlidXRlXCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZFxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9JTlZBTElEX1NFTEVDVE9SKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkU2VsZWN0b3JFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLnNldFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKHZhbHVlLCBlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgIHZhbHVlID0gdmFsdWUuam9pbihcIlwiKTtcbiAgfVxuICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuICAgIHZhbHVlID0gYCR7dmFsdWV9YDtcbiAgfVxuICB2YWx1ZSA9IHV0aWwuZXNjYXBlU3BlY2lhbENoYXJzKHZhbHVlLCBcIidcIik7XG4gIC8vIGRlLWVzY2FwZSBcXG4gc28gaXQgY2FuIGJlIHVzZWQgc3BlY2lhbGx5XG4gIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxcXFxcXFxuL2csIFwiXFxcXG5cIik7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ3NlbmRrZXlzJyxcbiAgICBhcmdzOiBbYCR7ZWx9YCwgYCR7dmFsdWV9YF1cbiAgfTtcbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBzZXRWYWx1ZVwiKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWRcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1NUQUxFX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xuXG59O1xuXG5jb21tYW5kcy5nZXRUZXh0ID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGxldCBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdnZXRUZXh0JyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBnZXRUZXh0XCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZFxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG5cbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRFbmFibGVkID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGxldCBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdlbGVtZW50RW5hYmxlZCcsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gZWxlbWVudEVuYWJsZWRcIik7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkIGFuZCBoYW5kbGUgZXJyb3JzIHJldHVybmVkIGZyb20gc2VydmVyXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9VTktOT1dOX0NPTU1BTkQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25Db21tYW5kRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRTZWxlY3RlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZWxlbWVudFNlbGVjdGVkJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBlbGVtZW50U2VsZWN0ZWRcIik7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkIGFuZCBoYW5kbGUgZXJyb3JzIHJldHVybmVkIGZyb20gc2VydmVyXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9FTEVNRU5UX0lTX05PVF9TRUxFQ1RBQkxFKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5FbGVtZW50SXNOb3RTZWxlY3RhYmxlRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnREaXNwbGF5ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcblxuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZWxlbWVudERpc3BsYXllZCcsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gZWxlbWVudERpc3BsYXllZFwiKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWQgYW5kIGhhbmRsZSBlcnJvcnMgcmV0dXJuZWQgZnJvbSBzZXJ2ZXJcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1VOS05PV05fQ09NTUFORCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkNvbW1hbmRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuY2xlYXIgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2NsZWFyJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcblxuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkJhZCByZXNwb25zZSBmcm9tIGNsZWFyXCIpO1xuICB9XG5cbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb24gPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2VsZW1lbnRMb2NhdGlvbicsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gZWxlbWVudExvY2F0aW9uXCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZCBhbmQgaGFuZGxlIGVycm9ycyByZXR1cm5lZCBmcm9tIHNlcnZlclxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfTk9fU1VDSF9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hFbGVtZW50RXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy5nZXRMb2NhdGlvbkluVmlldyA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0TG9jYXRpb24oZWxlbWVudElkKTtcbn07XG5cbmNvbW1hbmRzLmdldFNpemUgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2VsZW1lbnRTaXplJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBnZXRTaXplXCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZCBhbmQgaGFuZGxlIGVycm9ycyByZXR1cm5lZCBmcm9tIHNlcnZlclxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfTk9fU1VDSF9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hFbGVtZW50RXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2VsZW1lbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
