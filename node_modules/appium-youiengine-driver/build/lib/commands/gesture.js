"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _appiumBaseDriver = require("appium-base-driver");

var _utils = require("../utils");

let commands = {};

commands.click = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (el) {
    let retVal = yield this.tapEl(el);
    return retVal;
  });

  return function (_x) {
    return _ref.apply(this, arguments);
  };
}();

commands.tapEl = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (el, longPress) {
    el = (0, _utils.unwrapEl)(el);
    let commandName = 'tap';

    if (longPress) {
      commandName = 'longpress';
    }

    let commandObject = {
      name: commandName,
      args: [`${el}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from click");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
      throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
    }

    return result.value;
  });

  return function (_x2, _x3) {
    return _ref2.apply(this, arguments);
  };
}();

commands.tapElXY = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (el, x, y, longPress) {
    el = (0, _utils.unwrapEl)(el);
    let commandName = 'tap';

    if (longPress) {
      commandName = 'longpress';
    }

    let commandObject = {
      name: commandName,
      args: [`${el}`, `${x}`, `${y}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from tapElXY");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
      throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
    } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
      throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
    } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
      throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
    }

    return result.value;
  });

  return function (_x4, _x5, _x6, _x7) {
    return _ref3.apply(this, arguments);
  };
}();

commands.tapXY = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (x, y, longPress) {
    let commandName = 'tap';

    if (longPress === true) {
      commandName = 'longpress';
    }

    let commandObject = {
      name: commandName,
      args: [`${x}`, `${y}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from tapXY");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
      throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
    }

    return result.value;
  });

  return function (_x8, _x9, _x10) {
    return _ref4.apply(this, arguments);
  };
}();

commands.tap = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (gestures, longPress) {
    let elementId = gestures[0].options.element;
    let x = gestures[0].options.x;
    let y = gestures[0].options.y;

    if (elementId) {
      if (x && y) {
        yield this.tapElXY(elementId, x, y, longPress);
      } else {
        yield this.tapEl(elementId, longPress);
      }
    } else {
      yield this.tapXY(x, y, longPress);
    }
  });

  return function (_x11, _x12) {
    return _ref5.apply(this, arguments);
  };
}();

commands.doSwipe = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (gestures, longPress) {
    let press = gestures[0];
    let moveTo = gestures[1];
    let startX = press.options.x || 0,
        startY = press.options.y || 0,
        deltaX = moveTo.options.x || 0,
        deltaY = moveTo.options.y || 0;

    if (press.options.element) {
      let _ref7 = yield this.getLocation(press.options.element),
          x = _ref7.x,
          y = _ref7.y;

      let _ref8 = yield this.getSize(press.options.element),
          width = _ref8.width,
          height = _ref8.height;

      if (!press.options.x && !press.options.y && width && height) {
        startX += width / 2;
        startY += height / 2;
      }

      startX += x || 0;
      startY += y || 0;
    }

    if (moveTo.options.element) {
      let _ref9 = yield this.getLocation(moveTo.options.element),
          x = _ref9.x,
          y = _ref9.y;

      let _ref10 = yield this.getSize(moveTo.options.element),
          width = _ref10.width,
          height = _ref10.height;

      deltaX += x || 0;
      deltaY += y || 0;

      if (!moveTo.options.x && !moveTo.options.y && width && height) {
        deltaX += width / 2;
        deltaY += height / 2;
      }
    }

    let commandName = 'swipe';

    if (longPress === true) {
      commandName = 'longpressswipe';
    }

    let commandObject = {
      name: commandName,
      args: [`${startX}`, `${startY}`, `${deltaX}`, `${deltaY}`]
    };
    let commandJSON = JSON.stringify(commandObject);
    let data = yield this.executeSocketCommand(commandJSON);
    let result;

    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error("Bad response from doSwipe");
    }

    if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
      throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
    }

    return result.value;
  });

  return function (_x13, _x14) {
    return _ref6.apply(this, arguments);
  };
}();

commands.performTouch = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (gestures) {
    if (gestures.length === 3) {
      if (gestures[0].action === 'press' && gestures[1].action === 'moveTo' && gestures[2].action === 'release') {
        return yield this.doSwipe(gestures, false);
      } else if (gestures[0].action === 'longPress' && gestures[1].action === 'moveTo' && gestures[2].action === 'release') {
        return yield this.doSwipe(gestures, true);
      }
    } else if (gestures.length === 2) {
      if (gestures[0].action === 'press' && gestures[1].action === 'release') {
        return yield this.tap(gestures, false);
      } else if (gestures[0].action === 'longPress' && gestures[1].action === 'release') {
        return yield this.tap(gestures, true);
      }
    } else if (gestures.length === 1) {
      if (gestures[0].action === 'tap') {
        return yield this.tap(gestures, false);
      }
    }
  });

  return function (_x15) {
    return _ref11.apply(this, arguments);
  };
}();

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiY2xpY2siLCJlbCIsInJldFZhbCIsInRhcEVsIiwibG9uZ1ByZXNzIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kT2JqZWN0IiwibmFtZSIsImFyZ3MiLCJjb21tYW5kSlNPTiIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhIiwiZXhlY3V0ZVNvY2tldENvbW1hbmQiLCJyZXN1bHQiLCJwYXJzZSIsImUiLCJFcnJvciIsInN0YXR1cyIsInlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMiLCJXRUJEUklWRVJfU1RBTEVfRUxFTUVOVCIsImVycm9ycyIsIlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yIiwidmFsdWUiLCJ0YXBFbFhZIiwieCIsInkiLCJXRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EIiwiVW5rbm93bkNvbW1hbmRFcnJvciIsIldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQiLCJOb1N1Y2hFbGVtZW50RXJyb3IiLCJ0YXBYWSIsInRhcCIsImdlc3R1cmVzIiwiZWxlbWVudElkIiwib3B0aW9ucyIsImVsZW1lbnQiLCJkb1N3aXBlIiwicHJlc3MiLCJtb3ZlVG8iLCJzdGFydFgiLCJzdGFydFkiLCJkZWx0YVgiLCJkZWx0YVkiLCJnZXRMb2NhdGlvbiIsImdldFNpemUiLCJ3aWR0aCIsImhlaWdodCIsInBlcmZvcm1Ub3VjaCIsImxlbmd0aCIsImFjdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjs7QUFFQUEsUUFBUSxDQUFDQyxLQUFUO0FBQUEsNkNBQWlCLFdBQWdCQyxFQUFoQixFQUFvQjtBQUNuQyxRQUFJQyxNQUFNLFNBQVMsS0FBS0MsS0FBTCxDQUFXRixFQUFYLENBQW5CO0FBQ0EsV0FBT0MsTUFBUDtBQUNELEdBSEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBS0FILFFBQVEsQ0FB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RixxQkFBYSxLQUFLbEIsR0FBTCxDQUFTQyxRQUFULEVBQW1CLElBQW5CLENBQWI7QUFFRDtBQUNGLEtBWE0sTUFXQSxJQUFJQSxRQUFRLENBQUNnQixNQUFULEtBQW9CLENBQXhCLEVBQTJCO0FBQ2hDLFVBQUloQixRQUFRLENBQUMsQ0FBRCxDQUFSLENBQVlpQixNQUFaLEtBQXVCLEtBQTNCLEVBQWtDO0FBQ2hDLHFCQUFhLEtBQUtsQixHQUFMLENBQVNDLFFBQVQsRUFBbUIsS0FBbkIsQ0FBYjtBQUNEO0FBQ0Y7QUFDRixHQTdCRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7ZUErQmVsQyxRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHVud3JhcEVsLCB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzIH0gZnJvbSAnLi4vdXRpbHMnO1xuXG5sZXQgY29tbWFuZHMgPSB7fTtcblxuY29tbWFuZHMuY2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgbGV0IHJldFZhbCA9IGF3YWl0IHRoaXMudGFwRWwoZWwpO1xuICByZXR1cm4gcmV0VmFsO1xufTtcblxuY29tbWFuZHMudGFwRWwgPSBhc3luYyBmdW5jdGlvbiAoZWwsIGxvbmdQcmVzcykge1xuXG4gIC8vIHBlcmZvcm0gYSB0YXAgb24gdGhlIGdpdmVuIGVsZW1lbnRcbiAgLy8gaWYgbG9uZ1ByZXNzIGlzIHRydWUsIHRoZSB0YXAgYmVjb21lcyBhIGxvbmdQcmVzcyBhY3Rpb25cblxuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE5hbWUgPSAndGFwJztcbiAgaWYgKGxvbmdQcmVzcykge1xuICAgIGNvbW1hbmROYW1lID0gJ2xvbmdwcmVzcyc7XG4gIH1cblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiBjb21tYW5kTmFtZSxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBjbGlja1wiKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWRcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1NUQUxFX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMudGFwRWxYWSA9IGFzeW5jIGZ1bmN0aW9uIChlbCwgeCwgeSwgbG9uZ1ByZXNzKSB7XG5cbiAgLy8gcGVyZm9ybSBhIHRhcCBvbiB0aGUgZ2l2ZW4gZWxlbWVudCBhdCB0aGUgZ2l2ZW4geCx5IG9mZnNldFxuICAvLyBpZiBsb25nUHJlc3MgaXMgdHJ1ZSwgdGhlIHRhcCBiZWNvbWVzIGEgbG9uZ1ByZXNzIGFjdGlvblxuXG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGxldCBjb21tYW5kTmFtZSA9ICd0YXAnO1xuICBpZiAobG9uZ1ByZXNzKSB7XG4gICAgY29tbWFuZE5hbWUgPSAnbG9uZ3ByZXNzJztcbiAgfVxuXG4gIGxldCBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6IGNvbW1hbmROYW1lLFxuICAgIGFyZ3M6IFtgJHtlbH1gLCBgJHt4fWAsIGAke3l9YF1cbiAgfTtcblxuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSB0YXBFbFhZXCIpO1xuICB9XG5cbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1VOS05PV05fQ09NTUFORCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkNvbW1hbmRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy50YXBYWSA9IGFzeW5jIGZ1bmN0aW9uICh4LCB5LCBsb25nUHJlc3MpIHtcblxuICAvLyBwZXJmb3JtIGEgdGFwIGF0IHRoZSBnaXZlbiB4LHkgc2NyZWVuIGNvb3JkaW5hdGVcbiAgLy8gaWYgbG9uZ1ByZXNzIGlzIHRydWUsIHRoZSB0YXAgYmVjb21lcyBhIGxvbmdQcmVzcyBhY3Rpb25cblxuICBsZXQgY29tbWFuZE5hbWUgPSAndGFwJztcbiAgaWYgKGxvbmdQcmVzcyA9PT0gdHJ1ZSkge1xuICAgIGNvbW1hbmROYW1lID0gJ2xvbmdwcmVzcyc7XG4gIH1cblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiBjb21tYW5kTmFtZSxcbiAgICBhcmdzOiBbYCR7eH1gLCBgJHt5fWBdXG4gIH07XG5cbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gdGFwWFlcIik7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9TVEFMRV9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5TdGFsZUVsZW1lbnRSZWZlcmVuY2VFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLnRhcCA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlcywgbG9uZ1ByZXNzKSB7XG5cbiAgLy8gcGFyc2UgdGhlIGdpdmVuIGdlc3R1cmVzIGFycmF5IHRvIGNhbGwgdGhlIGFwcHJvcHJpYXRlIHRhcCBtZXRob2RcbiAgLy8gaWYgbG9uZ1ByZXNzIGlzIHRydWUsIHRoZSB0YXAgaXMgYSBsb25nIHByZXNzIGFjdGlvblxuXG4gIGxldCBlbGVtZW50SWQgPSBnZXN0dXJlc1swXS5vcHRpb25zLmVsZW1lbnQ7XG4gIGxldCB4ID0gZ2VzdHVyZXNbMF0ub3B0aW9ucy54O1xuICBsZXQgeSA9IGdlc3R1cmVzWzBdLm9wdGlvbnMueTtcblxuICBpZiAoZWxlbWVudElkKSB7XG5cbiAgICAvLyB3ZSBhcmUgZWl0aGVyIHRhcHBpbmcgb24gdGhlIGRlZmF1bHQgbG9jYXRpb24gb2YgdGhlIGVsZW1lbnRcbiAgICAvLyB0b3AgbGVmdCBoYXMgYmVlbiBzcGVjaWZpZWQgb2YgdGhlIGVsZW1lbnQgaGFzIGJlZW4gc3BlY2lmaWVkXG5cbiAgICBpZiAoeCAmJiB5KSB7XG4gICAgICBhd2FpdCB0aGlzLnRhcEVsWFkoZWxlbWVudElkLCB4LCB5LCBsb25nUHJlc3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyB0YXBwaW5nIHdpdGggYW4gZWxlbWVudCBwYXJhbWV0ZXIgaXMgdGhlIHNhbWUgYXMgY2xpY2sgb24gYSBXZWJFbGVtZW50XG4gICAgICBhd2FpdCB0aGlzLnRhcEVsKGVsZW1lbnRJZCwgbG9uZ1ByZXNzKTtcbiAgICB9XG4gIH0gZWxzZSB7XG5cbiAgICAvLyB3ZSBhcmUgdGFwcGluZyBhdCBhbiBhYnNvbHV0ZSB4LHkgY29vcmRpbmF0ZSBvbiB0aGUgc2NyZWVuXG4gICAgYXdhaXQgdGhpcy50YXBYWSh4LCB5LCBsb25nUHJlc3MpO1xuICB9XG59O1xuXG5jb21tYW5kcy5kb1N3aXBlID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzLCBsb25nUHJlc3MpIHtcblxuICAvLyBwYXJzZSBpbnB1dCB2YWx1ZXNcbiAgbGV0IHByZXNzID0gZ2VzdHVyZXNbMF07XG4gIGxldCBtb3ZlVG8gPSBnZXN0dXJlc1sxXTtcbiAgbGV0IHN0YXJ0WCA9IHByZXNzLm9wdGlvbnMueCB8fCAwLFxuICAgICAgc3RhcnRZID0gcHJlc3Mub3B0aW9ucy55IHx8IDAsXG4gICAgICBkZWx0YVggPSBtb3ZlVG8ub3B0aW9ucy54IHx8IDAsXG4gICAgICBkZWx0YVkgPSBtb3ZlVG8ub3B0aW9ucy55IHx8IDA7XG5cbiAgaWYgKHByZXNzLm9wdGlvbnMuZWxlbWVudCkge1xuICAgIGxldCB7eCwgeX0gPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uKHByZXNzLm9wdGlvbnMuZWxlbWVudCk7XG4gICAgbGV0IHt3aWR0aCwgaGVpZ2h0fSA9IGF3YWl0IHRoaXMuZ2V0U2l6ZShwcmVzcy5vcHRpb25zLmVsZW1lbnQpO1xuXG4gICAgLy8gVXNlIHRoZSBtaWRkbGUgb2YgdGhlIGVsZW1lbnQgdG8gcHJlc3Mgb24sIHVubGVzcyBhbiBvZmZzZXQgZnJvbVxuICAgIC8vIHRvcCBsZWZ0IG9mIHRoZSBlbGVtZW50IGhhcyBiZWVuIHNwZWNpZmllZFxuICAgIGlmICghcHJlc3Mub3B0aW9ucy54ICYmICFwcmVzcy5vcHRpb25zLnkgJiYgd2lkdGggJiYgaGVpZ2h0KSB7XG4gICAgICBzdGFydFggKz0gd2lkdGggLyAyO1xuICAgICAgc3RhcnRZICs9IGhlaWdodCAvIDI7XG4gICAgfVxuXG4gICAgc3RhcnRYICs9IHggfHwgMDtcbiAgICBzdGFydFkgKz0geSB8fCAwO1xuXG4gIH1cblxuICBpZiAobW92ZVRvLm9wdGlvbnMuZWxlbWVudCkge1xuICAgIGxldCB7eCwgeX0gPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uKG1vdmVUby5vcHRpb25zLmVsZW1lbnQpO1xuICAgIGxldCB7d2lkdGgsIGhlaWdodH0gPSBhd2FpdCB0aGlzLmdldFNpemUobW92ZVRvLm9wdGlvbnMuZWxlbWVudCk7XG4gICAgZGVsdGFYICs9IHggfHwgMDtcbiAgICBkZWx0YVkgKz0geSB8fCAwO1xuXG4gICAgLy8gVXNlIHRoZSBtaWRkbGUgb2YgdGhlIGVsZW1lbnQgdG8gbW92ZSB0bywgdW5sZXNzIGFuIG9mZnNldCBmcm9tXG4gICAgLy8gdG9wIGxlZnQgb2YgdGhlIGVsZW1lbnQgaGFzIGJlZW4gc3BlY2lmaWVkXG4gICAgaWYgKCFtb3ZlVG8ub3B0aW9ucy54ICYmICFtb3ZlVG8ub3B0aW9ucy55ICYmIHdpZHRoICYmIGhlaWdodCkge1xuICAgICAgZGVsdGFYICs9IHdpZHRoIC8gMjtcbiAgICAgIGRlbHRhWSArPSBoZWlnaHQgLyAyO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNvbnN0cnVjdCB0aGUgY29tbWFuZCBvYmplY3RcbiAgbGV0IGNvbW1hbmROYW1lID0gJ3N3aXBlJztcbiAgaWYgKGxvbmdQcmVzcyA9PT0gdHJ1ZSkge1xuICAgIGNvbW1hbmROYW1lID0gJ2xvbmdwcmVzc3N3aXBlJztcbiAgfVxuXG4gIGxldCBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6IGNvbW1hbmROYW1lLFxuICAgIGFyZ3M6IFtgJHtzdGFydFh9YCwgYCR7c3RhcnRZfWAsIGAke2RlbHRhWH1gLCBgJHtkZWx0YVl9YF1cbiAgfTtcblxuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBkb1N3aXBlXCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZFxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG5cbn07XG5cbmNvbW1hbmRzLnBlcmZvcm1Ub3VjaCA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlcykge1xuXG4gIGlmIChnZXN0dXJlcy5sZW5ndGggPT09IDMpIHtcblxuICAgIGlmIChnZXN0dXJlc1swXS5hY3Rpb24gPT09ICdwcmVzcycgJiYgZ2VzdHVyZXNbMV0uYWN0aW9uID09PSAnbW92ZVRvJyAmJiBnZXN0dXJlc1syXS5hY3Rpb24gPT09ICdyZWxlYXNlJykge1xuXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5kb1N3aXBlKGdlc3R1cmVzLCBmYWxzZSk7XG5cbiAgICB9IGVsc2UgaWYgKGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ2xvbmdQcmVzcycgJiYgZ2VzdHVyZXNbMV0uYWN0aW9uID09PSAnbW92ZVRvJyAmJiBnZXN0dXJlc1syXS5hY3Rpb24gPT09ICdyZWxlYXNlJykge1xuXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5kb1N3aXBlKGdlc3R1cmVzLCB0cnVlKTtcbiAgICB9XG5cbiAgfSBlbHNlIGlmIChnZXN0dXJlcy5sZW5ndGggPT09IDIpIHtcblxuICAgIGlmIChnZXN0dXJlc1swXS5hY3Rpb24gPT09ICdwcmVzcycgJiYgZ2VzdHVyZXNbMV0uYWN0aW9uID09PSAncmVsZWFzZScpIHtcblxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMudGFwKGdlc3R1cmVzLCBmYWxzZSk7XG5cbiAgICB9IGVsc2UgaWYgKGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ2xvbmdQcmVzcycgJiYgZ2VzdHVyZXNbMV0uYWN0aW9uID09PSAncmVsZWFzZScpIHtcblxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMudGFwKGdlc3R1cmVzLCB0cnVlKTtcblxuICAgIH1cbiAgfSBlbHNlIGlmIChnZXN0dXJlcy5sZW5ndGggPT09IDEpIHtcbiAgICBpZiAoZ2VzdHVyZXNbMF0uYWN0aW9uID09PSAndGFwJykge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMudGFwKGdlc3R1cmVzLCBmYWxzZSk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2dlc3R1cmUuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
