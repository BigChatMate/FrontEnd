"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.gesturesChainToString = gesturesChainToString;
exports.default = exports.commands = exports.helpers = exports.extensions = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _appiumIosDriver = require("appium-ios-driver");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("../logger"));

let helpers = {},
    extensions = {},
    commands = {};
exports.commands = commands;
exports.extensions = extensions;
exports.helpers = helpers;
commands.moveTo = _appiumIosDriver.iosCommands.gesture.moveTo;
commands.mobileShake = (0, _asyncToGenerator2.default)(function* () {
  if (!this.isSimulator()) {
    throw new _appiumBaseDriver.errors.UnknownError('Shake is not supported on real devices');
  }

  yield this.opts.device.shake();
});

commands.click = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (el) {
    if (!this.isWebContext()) {
      return yield this.nativeClick(el);
    }

    el = _appiumSupport.util.unwrapElement(el);

    if ((yield this.settings.getSettings()).nativeWebTap) {
      _logger.default.debug('Using native web tap');

      yield this.nativeWebTap(el);
    } else {
      let atomsElement = this.useAtomsElement(el);
      return yield this.executeAtom('click', [atomsElement]);
    }
  });

  return function (_x) {
    return _ref2.apply(this, arguments);
  };
}();

function gesturesChainToString(gestures, keysToInclude = ['options']) {
  return gestures.map(item => {
    let otherKeys = _lodash.default.difference(_lodash.default.keys(item), ['action']);

    otherKeys = _lodash.default.isArray(keysToInclude) ? _lodash.default.intersection(otherKeys, keysToInclude) : otherKeys;

    if (otherKeys.length) {
      return `${item.action}` + `(${_lodash.default.map(otherKeys, x => x + '=' + (_lodash.default.isPlainObject(item[x]) ? JSON.stringify(item[x]) : item[x])).join(', ')})`;
    }

    return item.action;
  }).join('-');
}

commands.performActions = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (actions) {
    _logger.default.debug(`Received the following W3C actions: ${JSON.stringify(actions, null, '  ')}`);

    const preprocessedActions = actions.map(action => Object.assign({}, action, action.type === 'pointer' ? {
      parameters: {
        pointerType: 'touch'
      }
    } : {})).map(action => {
      const modifiedAction = _lodash.default.clone(action) || {};
      modifiedAction.actions = (action.actions || []).filter(innerAction => !(innerAction.type === 'pause' && innerAction.duration === 0));
      return modifiedAction;
    });

    _logger.default.debug(`Preprocessed actions: ${JSON.stringify(preprocessedActions, null, '  ')}`);

    return yield this.proxyCommand('/actions', 'POST', {
      actions: preprocessedActions
    });
  });

  return function (_x2) {
    return _ref3.apply(this, arguments);
  };
}();

commands.performTouch = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (gestures) {
    _logger.default.debug(`Received the following touch action: ${gesturesChainToString(gestures)}`);

    try {
      return yield this.proxyCommand('/wda/touch/perform', 'POST', {
        actions: gestures
      });
    } catch (e) {
      if (!this.isWebContext()) {
        throw e;
      }

      _logger.default.errorAndThrow('The Touch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate touch events being in WEBVIEW context. Original error: ${e.message}`);
    }
  });

  return function (_x3) {
    return _ref4.apply(this, arguments);
  };
}();

commands.performMultiAction = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (actions) {
    _logger.default.debug(`Received the following multi touch action:`);

    for (let i in actions) {
      _logger.default.debug(`    ${parseInt(i, 10) + 1}: ${_lodash.default.map(actions[i], 'action').join('-')}`);
    }

    try {
      return yield this.proxyCommand('/wda/touch/multi/perform', 'POST', {
        actions
      });
    } catch (e) {
      if (!this.isWebContext()) {
        throw e;
      }

      _logger.default.errorAndThrow('The MultiTouch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate multitouch events being in WEBVIEW context. Original error: ${e.message}`);
    }
  });

  return function (_x4) {
    return _ref5.apply(this, arguments);
  };
}();

commands.nativeClick = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (el) {
    el = _appiumSupport.util.unwrapElement(el);
    let endpoint = `/element/${el}/click`;
    return yield this.proxyCommand(endpoint, 'POST', {});
  });

  return function (_x5) {
    return _ref6.apply(this, arguments);
  };
}();

helpers.mobileScroll = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (opts = {}, swipe = false) {
    if (!opts.element) {
      opts.element = yield this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
    }

    let params = {};

    if (opts.name && !swipe) {
      params.name = opts.name;
    } else if (opts.direction) {
      if (['up', 'down', 'left', 'right'].indexOf(opts.direction.toLowerCase()) < 0) {
        let msg = 'Direction must be up, down, left or right';

        _logger.default.errorAndThrow(msg);
      }

      params.direction = opts.direction;
    } else if (opts.predicateString && !swipe) {
      params.predicateString = opts.predicateString;
    } else if (opts.toVisible && !swipe) {
      params.toVisible = opts.toVisible;
    } else {
      let msg = swipe ? 'Mobile swipe requires direction' : 'Mobile scroll supports the following strategies: name, direction, predicateString, and toVisible. Specify one of these';

      _logger.default.errorAndThrow(msg);
    }

    if (!swipe && opts.distance) {
      params.distance = opts.distance;
    }

    let element = opts.element.ELEMENT || opts.element;
    let endpoint = `/wda/element/${element}/${swipe ? 'swipe' : 'scroll'}`;
    return yield this.proxyCommand(endpoint, 'POST', params);
  });

  return function () {
    return _ref7.apply(this, arguments);
  };
}();

helpers.mobileSwipe = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    return yield this.mobileScroll(opts, true);
  });

  return function () {
    return _ref8.apply(this, arguments);
  };
}();

function parseFloatParameter(paramName, paramValue, methodName) {
  if (_lodash.default.isUndefined(paramValue)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter is mandatory for "${methodName}" call`);
  }

  const result = parseFloat(paramValue);

  if (isNaN(result)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter should be a valid number. "${paramValue}" is given instead`);
  }

  return result;
}

helpers.mobilePinch = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    if (!opts.element) {
      opts.element = yield this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
    }

    const params = {
      scale: parseFloatParameter('scale', opts.scale, 'pinch'),
      velocity: parseFloatParameter('velocity', opts.velocity, 'pinch')
    };
    const el = opts.element.ELEMENT || opts.element;
    return yield this.proxyCommand(`/wda/element/${el}/pinch`, 'POST', params);
  });

  return function () {
    return _ref9.apply(this, arguments);
  };
}();

helpers.mobileDoubleTap = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    if (opts.element) {
      const el = opts.element.ELEMENT || opts.element;
      return yield this.proxyCommand(`/wda/element/${el}/doubleTap`, 'POST');
    }

    const params = {
      x: parseFloatParameter('x', opts.x, 'doubleTap'),
      y: parseFloatParameter('y', opts.y, 'doubleTap')
    };
    return yield this.proxyCommand('/wda/doubleTap', 'POST', params);
  });

  return function () {
    return _ref10.apply(this, arguments);
  };
}();

helpers.mobileTwoFingerTap = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    if (!opts.element) {
      opts.element = yield this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
    }

    const el = opts.element.ELEMENT || opts.element;
    return yield this.proxyCommand(`/wda/element/${el}/twoFingerTap`, 'POST');
  });

  return function () {
    return _ref11.apply(this, arguments);
  };
}();

helpers.mobileTouchAndHold = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    let params = {
      duration: parseFloatParameter('duration', opts.duration, 'touchAndHold')
    };

    if (opts.element) {
      const el = opts.element.ELEMENT || opts.element;
      return yield this.proxyCommand(`/wda/element/${el}/touchAndHold`, 'POST', params);
    }

    params.x = parseFloatParameter('x', opts.x, 'touchAndHold');
    params.y = parseFloatParameter('y', opts.y, 'touchAndHold');
    return yield this.proxyCommand('/wda/touchAndHold', 'POST', params);
  });

  return function () {
    return _ref12.apply(this, arguments);
  };
}();

helpers.mobileTap = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    const params = {
      x: parseFloatParameter('x', opts.x, 'tap'),
      y: parseFloatParameter('y', opts.y, 'tap')
    };
    const el = opts.element ? opts.element.ELEMENT || opts.element : '0';
    return yield this.proxyCommand(`/wda/tap/${el}`, 'POST', params);
  });

  return function () {
    return _ref13.apply(this, arguments);
  };
}();

helpers.mobileDragFromToForDuration = function () {
  var _ref14 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    const params = {
      duration: parseFloatParameter('duration', opts.duration, 'dragFromToForDuration'),
      fromX: parseFloatParameter('fromX', opts.fromX, 'dragFromToForDuration'),
      fromY: parseFloatParameter('fromY', opts.fromY, 'dragFromToForDuration'),
      toX: parseFloatParameter('toX', opts.toX, 'dragFromToForDuration'),
      toY: parseFloatParameter('toY', opts.toY, 'dragFromToForDuration')
    };

    if (opts.element) {
      const el = opts.element.ELEMENT || opts.element;
      return yield this.proxyCommand(`/wda/element/${el}/dragfromtoforduration`, 'POST', params);
    }

    return yield this.proxyCommand('/wda/dragfromtoforduration', 'POST', params);
  });

  return function () {
    return _ref14.apply(this, arguments);
  };
}();

helpers.mobileSelectPickerWheelValue = function () {
  var _ref15 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    if (!opts.element) {
      _logger.default.errorAndThrow('Element id is expected to be set for selectPickerWheelValue method');
    }

    if (!_lodash.default.isString(opts.order) || ['next', 'previous'].indexOf(opts.order.toLowerCase()) === -1) {
      _logger.default.errorAndThrow(`The mandatory "order" parameter is expected to be equal either to 'next' or 'previous'. ` + `'${opts.order}' is given instead`);
    }

    const el = opts.element.ELEMENT || opts.element;
    const params = {
      order: opts.order
    };

    if (opts.offset) {
      params.offset = parseFloatParameter('offset', opts.offset, 'selectPickerWheelValue');
    }

    return yield this.proxyCommand(`/wda/pickerwheel/${el}/select`, 'POST', params);
  });

  return function () {
    return _ref15.apply(this, arguments);
  };
}();

helpers.getCoordinates = function () {
  var _ref16 = (0, _asyncToGenerator2.default)(function* (gesture) {
    let el = gesture.options.element;
    let coordinates = {
      x: 0,
      y: 0,
      areOffsets: false
    };
    let optionX = null;

    if (gesture.options.x) {
      optionX = parseFloatParameter('x', gesture.options.x, 'getCoordinates');
    }

    let optionY = null;

    if (gesture.options.y) {
      optionY = parseFloatParameter('y', gesture.options.y, 'getCoordinates');
    }

    if (el) {
      let rect = yield this.getElementRect(el);
      let pos = {
        x: rect.x,
        y: rect.y
      };
      let size = {
        w: rect.width,
        h: rect.height
      };
      let offsetX = 0;
      let offsetY = 0;

      if (optionX || optionY) {
        offsetX = optionX || 0;
        offsetY = optionY || 0;
      } else {
        offsetX = size.w / 2;
        offsetY = size.h / 2;
      }

      coordinates.x = pos.x + offsetX;
      coordinates.y = pos.y + offsetY;
    } else {
      coordinates.areOffsets = gesture.action === 'moveTo';
      coordinates.x = optionX || 0;
      coordinates.y = optionY || 0;
    }

    return coordinates;
  });

  return function (_x6) {
    return _ref16.apply(this, arguments);
  };
}();

helpers.applyMoveToOffset = function (firstCoordinates, secondCoordinates) {
  if (secondCoordinates.areOffsets) {
    return {
      x: firstCoordinates.x + secondCoordinates.x,
      y: firstCoordinates.y + secondCoordinates.y
    };
  } else {
    return secondCoordinates;
  }
};

Object.assign(extensions, helpers, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbImhlbHBlcnMiLCJleHRlbnNpb25zIiwiY29tbWFuZHMiLCJtb3ZlVG8iLCJpb3NDb21tYW5kcyIsImdlc3R1cmUiLCJtb2JpbGVTaGFrZSIsImlzU2ltdWxhdG9yIiwiZXJyb3JzIiwiVW5rbm93bkVycm9yIiwib3B0cyIsImRldmljZSIsInNoYWtlIiwiY2xpY2siLCJlbCIsImlzV2ViQ29udGV4dCIsIm5hdGl2ZUNsaWNrIiwidXRpbCIsInVud3JhcEVsZW1lbnQiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwibmF0aXZlV2ViVGFwIiwibG9nIiwiZGVidWciLCJhdG9tc0VsZW1lbnQiLCJ1c2VBdG9tc0VsZW1lbnQiLCJleGVjdXRlQXRvbSIsImdlc3R1cmVzQ2hhaW5Ub1N0cmluZyIsImdlc3R1cmVzIiwia2V5c1RvSW5jbHVkZSIsIm1hcCIsIml0ZW0iLCJvdGhlcktleXMiLCJfIiwiZGlmZmVyZW5jZSIsImtleXMiLCJpc0FycmF5IiwiaW50ZXJzZWN0aW9uIiwibGVuZ3RoIiwiYWN0aW9uIiwieCIsImlzUGxhaW5PYmplY3QiLCJKU09OIiwic3RyaW5naWZ5Iiwiam9pbiIsInBlcmZvcm1BY3Rpb25zIiwiYWN0aW9ucyIsInByZXByb2Nlc3NlZEFjdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJ0eXBlIiwicGFyYW1ldGVycyIsInBvaW50ZXJUeXBlIiwibW9kaWZpZWRBY3Rpb24iLCJjbG9uZSIsImZpbHRlciIsImlubmVyQWN0aW9uIiwiZHVyYXRpb24iLCJwcm94eUNvbW1hbmQiLCJwZXJmb3JtVG91Y2giLCJlIiwiZXJyb3JBbmRUaHJvdyIsIm1lc3NhZ2UiLCJwZXJmb3JtTXVsdGlBY3Rpb24iLCJpIiwicGFyc2VJbnQiLCJlbmRwb2ludCIsIm1vYmlsZVNjcm9sbCIsInN3aXBlIiwiZWxlbWVudCIsImZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyIsInBhcmFtcyIsIm5hbWUiLCJkaXJlY3Rpb24iLCJpbmRleE9mIiwidG9Mb3dlckNhc2UiLCJtc2ciLCJwcmVkaWNhdGVTdHJpbmciLCJ0b1Zpc2libGUiLCJkaXN0YW5jZSIsIkVMRU1FTlQiLCJtb2JpbGVTd2lwZSIsInBhcnNlRmxvYXRQYXJhbWV0ZXIiLCJwYXJhbU5hbWUiLCJwYXJhbVZhbHVlIiwibWV0aG9kTmFtZSIsImlzVW5kZWZpbmVkIiwicmVzdWx0IiwicGFyc2VGbG9hdCIsImlzTmFOIiwibW9iaWxlUGluY2giLCJzY2FsZSIsInZlbG9jaXR5IiwibW9iaWxlRG91YmxlVGFwIiwieSIsIm1vYmlsZVR3b0ZpbmdlclRhcCIsIm1vYmlsZVRvdWNoQW5kSG9sZCIsIm1vYmlsZVRhcCIsIm1vYmlsZURyYWdGcm9tVG9Gb3JEdXJhdGlvbiIsImZyb21YIiwiZnJvbVkiLCJ0b1giLCJ0b1kiLCJtb2JpbGVTZWxlY3RQaWNrZXJXaGVlbFZhbHVlIiwiaXNTdHJpbmciLCJvcmRlciIsIm9mZnNldCIsImdldENvb3JkaW5hdGVzIiwib3B0aW9ucyIsImNvb3JkaW5hdGVzIiwiYXJlT2Zmc2V0cyIsIm9wdGlvblgiLCJvcHRpb25ZIiwicmVjdCIsImdldEVsZW1lbnRSZWN0IiwicG9zIiwic2l6ZSIsInciLCJ3aWR0aCIsImgiLCJoZWlnaHQiLCJvZmZzZXRYIiwib2Zmc2V0WSIsImFwcGx5TW92ZVRvT2Zmc2V0IiwiZmlyc3RDb29yZGluYXRlcyIsInNlY29uZENvb3JkaW5hdGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxJQUFJQSxPQUFPLEdBQUcsRUFBZDtBQUFBLElBQWtCQyxVQUFVLEdBQUcsRUFBL0I7QUFBQSxJQUFtQ0MsUUFBUSxHQUFHLEVBQTlDOzs7O0FBRUFBLFFBQVEsQ0FBQ0MsTUFBVCxHQUFrQkMsNkJBQVlDLE9BQVosQ0FBb0JGLE1BQXRDO0FBRUFELFFBQVEsQ0FBQ0ksV0FBVCxtQ0FBdUIsYUFBa0I7QUFDdkMsTUFBSSxDQUFD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QUFDM0UsQ0FBSixHQUFRaUYsT0FBeEI7QUFDQVosTUFBQUEsV0FBVyxDQUFDZixDQUFaLEdBQWdCcUIsR0FBRyxDQUFDckIsQ0FBSixHQUFRNEIsT0FBeEI7QUFDRCxLQXJCRCxNQXFCTztBQUVMYixNQUFBQSxXQUFXLENBQUNDLFVBQVosR0FBMEJ6RyxPQUFPLENBQUNrQyxNQUFSLEtBQW1CLFFBQTdDO0FBQ0FzRSxNQUFBQSxXQUFXLENBQUNyRSxDQUFaLEdBQWlCdUUsT0FBTyxJQUFJLENBQTVCO0FBQ0FGLE1BQUFBLFdBQVcsQ0FBQ2YsQ0FBWixHQUFpQmtCLE9BQU8sSUFBSSxDQUE1QjtBQUNEOztBQUNELFdBQU9ILFdBQVA7QUFDRCxHQTVDRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUE4Q0E3RyxPQUFPLENBQUMySCxpQkFBUixHQUE0QixVQUFVQyxnQkFBVixFQUE0QkMsaUJBQTVCLEVBQStDO0FBQ3pFLE1BQUlBLGlCQUFpQixDQUFDZixVQUF0QixFQUFrQztBQUNoQyxXQUFPO0FBQ0x0RSxNQUFBQSxDQUFDLEVBQUVvRixnQkFBZ0IsQ0FBQ3BGLENBQWpCLEdBQXFCcUYsaUJBQWlCLENBQUNyRixDQURyQztBQUVMc0QsTUFBQUEsQ0FBQyxFQUFFOEIsZ0JBQWdCLENBQUM5QixDQUFqQixHQUFxQitCLGlCQUFpQixDQUFDL0I7QUFGckMsS0FBUDtBQUlELEdBTEQsTUFLTztBQUNMLFdBQU8rQixpQkFBUDtBQUNEO0FBQ0YsQ0FURDs7QUFXQTdFLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjaEQsVUFBZCxFQUEwQkQsT0FBMUIsRUFBbUNFLFFBQW5DO2VBRWVELFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IGlvc0NvbW1hbmRzIH0gZnJvbSAnYXBwaXVtLWlvcy1kcml2ZXInO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcblxuXG5sZXQgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge30sIGNvbW1hbmRzID0ge307XG5cbmNvbW1hbmRzLm1vdmVUbyA9IGlvc0NvbW1hbmRzLmdlc3R1cmUubW92ZVRvO1xuXG5jb21tYW5kcy5tb2JpbGVTaGFrZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgaWYgKCF0aGlzLmlzU2ltdWxhdG9yKCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcignU2hha2UgaXMgbm90IHN1cHBvcnRlZCBvbiByZWFsIGRldmljZXMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLm9wdHMuZGV2aWNlLnNoYWtlKCk7XG59O1xuXG5jb21tYW5kcy5jbGljayA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAvLyB0aGVyZSBhcmUgbXVsdGlwbGUgY29tbWFuZHMgdGhhdCBtYXAgaGVyZSwgc28gbWFudWFsbHkgcHJveHlcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRpdmVDbGljayhlbCk7XG4gIH1cbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBpZiAoKGF3YWl0IHRoaXMuc2V0dGluZ3MuZ2V0U2V0dGluZ3MoKSkubmF0aXZlV2ViVGFwKSB7XG4gICAgLy8gYXRvbXMtYmFzZWQgY2xpY2tzIGRvbid0IGFsd2F5cyB3b3JrIGluIHNhZmFyaSA3XG4gICAgbG9nLmRlYnVnKCdVc2luZyBuYXRpdmUgd2ViIHRhcCcpO1xuICAgIGF3YWl0IHRoaXMubmF0aXZlV2ViVGFwKGVsKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdjbGljaycsIFthdG9tc0VsZW1lbnRdKTtcbiAgfVxufTtcblxuZnVuY3Rpb24gZ2VzdHVyZXNDaGFpblRvU3RyaW5nIChnZXN0dXJlcywga2V5c1RvSW5jbHVkZSA9IFsnb3B0aW9ucyddKSB7XG4gIHJldHVybiBnZXN0dXJlcy5tYXAoKGl0ZW0pID0+IHtcbiAgICBsZXQgb3RoZXJLZXlzID0gXy5kaWZmZXJlbmNlKF8ua2V5cyhpdGVtKSwgWydhY3Rpb24nXSk7XG4gICAgb3RoZXJLZXlzID0gXy5pc0FycmF5KGtleXNUb0luY2x1ZGUpID8gXy5pbnRlcnNlY3Rpb24ob3RoZXJLZXlzLCBrZXlzVG9JbmNsdWRlKSA6IG90aGVyS2V5cztcbiAgICBpZiAob3RoZXJLZXlzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIGAke2l0ZW0uYWN0aW9ufWAgK1xuICAgICAgICBgKCR7Xy5tYXAob3RoZXJLZXlzLCAoeCkgPT4geCArICc9JyArIChfLmlzUGxhaW5PYmplY3QoaXRlbVt4XSkgPyBKU09OLnN0cmluZ2lmeShpdGVtW3hdKSA6IGl0ZW1beF0pKS5qb2luKCcsICcpfSlgO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbS5hY3Rpb247XG4gIH0pLmpvaW4oJy0nKTtcbn1cblxuY29tbWFuZHMucGVyZm9ybUFjdGlvbnMgPSBhc3luYyBmdW5jdGlvbiAoYWN0aW9ucykge1xuICBsb2cuZGVidWcoYFJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgVzNDIGFjdGlvbnM6ICR7SlNPTi5zdHJpbmdpZnkoYWN0aW9ucywgbnVsbCwgJyAgJyl9YCk7XG4gIC8vIFRoaXMgaXMgbWFuZGF0b3J5LCBzaW5jZSBXREEgb25seSBzdXBwb3J0cyBUT1VDSCBwb2ludGVyIHR5cGVcbiAgLy8gYW5kIFNlbGVuaXVtIEFQSSB1c2VzIE1PVVNFIGFzIHRoZSBkZWZhdWx0IG9uZVxuICBjb25zdCBwcmVwcm9jZXNzZWRBY3Rpb25zID0gYWN0aW9uc1xuICAgIC5tYXAoKGFjdGlvbikgPT4gT2JqZWN0LmFzc2lnbih7fSwgYWN0aW9uLCBhY3Rpb24udHlwZSA9PT0gJ3BvaW50ZXInID8ge1xuICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICBwb2ludGVyVHlwZTogJ3RvdWNoJ1xuICAgICAgfVxuICAgIH0gOiB7fSkpXG4gICAgLm1hcCgoYWN0aW9uKSA9PiB7XG4gICAgICBjb25zdCBtb2RpZmllZEFjdGlvbiA9IF8uY2xvbmUoYWN0aW9uKSB8fCB7fTtcbiAgICAgIC8vIFNlbGVuaXVtIEFQSSB1bmV4cGVjdGVkbHkgaW5zZXJ0cyB6ZXJvIHBhdXNlcywgd2hpY2ggYXJlIG5vdCBzdXBwb3J0ZWQgYnkgV0RBXG4gICAgICBtb2RpZmllZEFjdGlvbi5hY3Rpb25zID0gKGFjdGlvbi5hY3Rpb25zIHx8IFtdKVxuICAgICAgICAuZmlsdGVyKChpbm5lckFjdGlvbikgPT4gIShpbm5lckFjdGlvbi50eXBlID09PSAncGF1c2UnICYmIGlubmVyQWN0aW9uLmR1cmF0aW9uID09PSAwKSk7XG4gICAgICByZXR1cm4gbW9kaWZpZWRBY3Rpb247XG4gICAgfSk7XG4gIGxvZy5kZWJ1ZyhgUHJlcHJvY2Vzc2VkIGFjdGlvbnM6ICR7SlNPTi5zdHJpbmdpZnkocHJlcHJvY2Vzc2VkQWN0aW9ucywgbnVsbCwgJyAgJyl9YCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL2FjdGlvbnMnLCAnUE9TVCcsIHthY3Rpb25zOiBwcmVwcm9jZXNzZWRBY3Rpb25zfSk7XG59O1xuXG5jb21tYW5kcy5wZXJmb3JtVG91Y2ggPSBhc3luYyBmdW5jdGlvbiAoZ2VzdHVyZXMpIHtcbiAgbG9nLmRlYnVnKGBSZWNlaXZlZCB0aGUgZm9sbG93aW5nIHRvdWNoIGFjdGlvbjogJHtnZXN0dXJlc0NoYWluVG9TdHJpbmcoZ2VzdHVyZXMpfWApO1xuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS90b3VjaC9wZXJmb3JtJywgJ1BPU1QnLCB7YWN0aW9uczogZ2VzdHVyZXN9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ1RoZSBUb3VjaCBBUEkgaXMgYWltZWQgZm9yIHVzYWdlIGluIE5BVElWRSBjb250ZXh0LiAnICtcbiAgICAgICdDb25zaWRlciB1c2luZyBcImV4ZWN1dGVcIiBBUEkgd2l0aCBjdXN0b20gZXZlbnRzIHRyaWdnZXIgc2NyaXB0ICcgK1xuICAgICAgYHRvIGVtdWxhdGUgdG91Y2ggZXZlbnRzIGJlaW5nIGluIFdFQlZJRVcgY29udGV4dC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG5jb21tYW5kcy5wZXJmb3JtTXVsdGlBY3Rpb24gPSBhc3luYyBmdW5jdGlvbiAoYWN0aW9ucykge1xuICBsb2cuZGVidWcoYFJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgbXVsdGkgdG91Y2ggYWN0aW9uOmApO1xuICBmb3IgKGxldCBpIGluIGFjdGlvbnMpIHtcbiAgICBsb2cuZGVidWcoYCAgICAke3BhcnNlSW50KGksIDEwKSArIDF9OiAke18ubWFwKGFjdGlvbnNbaV0sICdhY3Rpb24nKS5qb2luKCctJyl9YCk7XG4gIH1cbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvdG91Y2gvbXVsdGkvcGVyZm9ybScsICdQT1NUJywge2FjdGlvbnN9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ1RoZSBNdWx0aVRvdWNoIEFQSSBpcyBhaW1lZCBmb3IgdXNhZ2UgaW4gTkFUSVZFIGNvbnRleHQuICcgK1xuICAgICAgJ0NvbnNpZGVyIHVzaW5nIFwiZXhlY3V0ZVwiIEFQSSB3aXRoIGN1c3RvbSBldmVudHMgdHJpZ2dlciBzY3JpcHQgJyArXG4gICAgICBgdG8gZW11bGF0ZSBtdWx0aXRvdWNoIGV2ZW50cyBiZWluZyBpbiBXRUJWSUVXIGNvbnRleHQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuY29tbWFuZHMubmF0aXZlQ2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBsZXQgZW5kcG9pbnQgPSBgL2VsZW1lbnQvJHtlbH0vY2xpY2tgO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsICdQT1NUJywge30pO1xufTtcblxuLypcbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svV2ViRHJpdmVyQWdlbnQvYmxvYi9tYXN0ZXIvV2ViRHJpdmVyQWdlbnRMaWIvQ29tbWFuZHMvRkJFbGVtZW50Q29tbWFuZHMubVxuICogdG8gZ2V0IHRoZSBpbmZvIGFib3V0IGF2YWlsYWJsZSBXREEgZ2VzdHVyZXMgQVBJXG4gKlxuICogU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9yZWZlcmVuY2UveGN0ZXN0L3hjdWllbGVtZW50IGFuZFxuICogaHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL3JlZmVyZW5jZS94Y3Rlc3QveGN1aWNvb3JkaW5hdGUgdG8gZ2V0IHRoZSBkZXRhaWxlZCBkZXNjcmlwdGlvbiBvZlxuICogYWxsIFhDVGVzdCBnZXN0dXJlc1xuKi9cblxuaGVscGVycy5tb2JpbGVTY3JvbGwgPSBhc3luYyBmdW5jdGlvbiAob3B0cyA9IHt9LCBzd2lwZSA9IGZhbHNlKSB7XG4gIGlmICghb3B0cy5lbGVtZW50KSB7XG4gICAgb3B0cy5lbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoYGNsYXNzIG5hbWVgLCBgWENVSUVsZW1lbnRUeXBlQXBwbGljYXRpb25gLCBmYWxzZSk7XG4gIH1cbiAgLy8gV0RBIHN1cHBvcnRzIGZvdXIgc2Nyb2xsaW5nIHN0cmF0ZWdpZXM6IHByZWRpY2F0aW9uIGJhc2VkIG9uIG5hbWUsIGRpcmVjdGlvbixcbiAgLy8gcHJlZGljYXRlU3RyaW5nLCBhbmQgdG9WaXNpYmxlLCBpbiB0aGF0IG9yZGVyLiBTd2lwaW5nIHJlcXVpcmVzIGRpcmVjdGlvbi5cbiAgbGV0IHBhcmFtcyA9IHt9O1xuICBpZiAob3B0cy5uYW1lICYmICFzd2lwZSkge1xuICAgIHBhcmFtcy5uYW1lID0gb3B0cy5uYW1lO1xuICB9IGVsc2UgaWYgKG9wdHMuZGlyZWN0aW9uKSB7XG4gICAgaWYgKFsndXAnLCAnZG93bicsICdsZWZ0JywgJ3JpZ2h0J10uaW5kZXhPZihvcHRzLmRpcmVjdGlvbi50b0xvd2VyQ2FzZSgpKSA8IDApIHtcbiAgICAgIGxldCBtc2cgPSAnRGlyZWN0aW9uIG11c3QgYmUgdXAsIGRvd24sIGxlZnQgb3IgcmlnaHQnO1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgICB9XG4gICAgcGFyYW1zLmRpcmVjdGlvbiA9IG9wdHMuZGlyZWN0aW9uO1xuICB9IGVsc2UgaWYgKG9wdHMucHJlZGljYXRlU3RyaW5nICYmICFzd2lwZSkge1xuICAgIHBhcmFtcy5wcmVkaWNhdGVTdHJpbmcgPSBvcHRzLnByZWRpY2F0ZVN0cmluZztcbiAgfSBlbHNlIGlmIChvcHRzLnRvVmlzaWJsZSAmJiAhc3dpcGUpIHtcbiAgICBwYXJhbXMudG9WaXNpYmxlID0gb3B0cy50b1Zpc2libGU7XG4gIH0gZWxzZSB7XG4gICAgbGV0IG1zZyA9IHN3aXBlXG4gICAgICA/ICdNb2JpbGUgc3dpcGUgcmVxdWlyZXMgZGlyZWN0aW9uJ1xuICAgICAgOiAnTW9iaWxlIHNjcm9sbCBzdXBwb3J0cyB0aGUgZm9sbG93aW5nIHN0cmF0ZWdpZXM6IG5hbWUsIGRpcmVjdGlvbiwgcHJlZGljYXRlU3RyaW5nLCBhbmQgdG9WaXNpYmxlLiBTcGVjaWZ5IG9uZSBvZiB0aGVzZSc7XG4gICAgbG9nLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgfVxuXG4gIC8vIHdlIGNhbiBhbHNvIG9wdGlvbmFsbHkgcGFzcyBhIGRpc3RhbmNlIHdoaWNoIGFwcGVhcnMgdG8gYmUgYSByYXRpbyBvZlxuICAvLyBzY3JlZW4gaGVpZ2h0LCBzbyAxLjAgbWVhbnMgYSBmdWxsIHNjcmVlbidzIHdvcnRoIG9mIHNjcm9sbGluZ1xuICBpZiAoIXN3aXBlICYmIG9wdHMuZGlzdGFuY2UpIHtcbiAgICBwYXJhbXMuZGlzdGFuY2UgPSBvcHRzLmRpc3RhbmNlO1xuICB9XG5cbiAgbGV0IGVsZW1lbnQgPSBvcHRzLmVsZW1lbnQuRUxFTUVOVCB8fCBvcHRzLmVsZW1lbnQ7XG4gIGxldCBlbmRwb2ludCA9IGAvd2RhL2VsZW1lbnQvJHtlbGVtZW50fS8ke3N3aXBlID8gJ3N3aXBlJyA6ICdzY3JvbGwnfWA7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChlbmRwb2ludCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVTd2lwZSA9IGFzeW5jIGZ1bmN0aW9uIChvcHRzID0ge30pIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMubW9iaWxlU2Nyb2xsKG9wdHMsIHRydWUpO1xufTtcblxuZnVuY3Rpb24gcGFyc2VGbG9hdFBhcmFtZXRlciAocGFyYW1OYW1lLCBwYXJhbVZhbHVlLCBtZXRob2ROYW1lKSB7XG4gIGlmIChfLmlzVW5kZWZpbmVkKHBhcmFtVmFsdWUpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFwiJHtwYXJhbU5hbWV9XCIgcGFyYW1ldGVyIGlzIG1hbmRhdG9yeSBmb3IgXCIke21ldGhvZE5hbWV9XCIgY2FsbGApO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IHBhcnNlRmxvYXQocGFyYW1WYWx1ZSk7XG4gIGlmIChpc05hTihyZXN1bHQpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFwiJHtwYXJhbU5hbWV9XCIgcGFyYW1ldGVyIHNob3VsZCBiZSBhIHZhbGlkIG51bWJlci4gXCIke3BhcmFtVmFsdWV9XCIgaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmhlbHBlcnMubW9iaWxlUGluY2ggPSBhc3luYyBmdW5jdGlvbiAob3B0cyA9IHt9KSB7XG4gIGlmICghb3B0cy5lbGVtZW50KSB7XG4gICAgb3B0cy5lbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoYGNsYXNzIG5hbWVgLCBgWENVSUVsZW1lbnRUeXBlQXBwbGljYXRpb25gLCBmYWxzZSk7XG4gIH1cbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHNjYWxlOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdzY2FsZScsIG9wdHMuc2NhbGUsICdwaW5jaCcpLFxuICAgIHZlbG9jaXR5OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd2ZWxvY2l0eScsIG9wdHMudmVsb2NpdHksICdwaW5jaCcpXG4gIH07XG4gIGNvbnN0IGVsID0gb3B0cy5lbGVtZW50LkVMRU1FTlQgfHwgb3B0cy5lbGVtZW50O1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS9waW5jaGAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlRG91YmxlVGFwID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBpZiAob3B0cy5lbGVtZW50KSB7XG4gICAgLy8gRG91YmxlIHRhcCBlbGVtZW50XG4gICAgY29uc3QgZWwgPSBvcHRzLmVsZW1lbnQuRUxFTUVOVCB8fCBvcHRzLmVsZW1lbnQ7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vZG91YmxlVGFwYCwgJ1BPU1QnKTtcbiAgfVxuICAvLyBEb3VibGUgdGFwIGNvb3JkaW5hdGVzXG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICB4OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd4Jywgb3B0cy54LCAnZG91YmxlVGFwJyksXG4gICAgeTogcGFyc2VGbG9hdFBhcmFtZXRlcigneScsIG9wdHMueSwgJ2RvdWJsZVRhcCcpXG4gIH07XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS9kb3VibGVUYXAnLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVR3b0ZpbmdlclRhcCA9IGFzeW5jIGZ1bmN0aW9uIChvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzLmVsZW1lbnQpIHtcbiAgICBvcHRzLmVsZW1lbnQgPSBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyhgY2xhc3MgbmFtZWAsIGBYQ1VJRWxlbWVudFR5cGVBcHBsaWNhdGlvbmAsIGZhbHNlKTtcbiAgfVxuICBjb25zdCBlbCA9IG9wdHMuZWxlbWVudC5FTEVNRU5UIHx8IG9wdHMuZWxlbWVudDtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vdHdvRmluZ2VyVGFwYCwgJ1BPU1QnKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlVG91Y2hBbmRIb2xkID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBsZXQgcGFyYW1zID0ge1xuICAgIGR1cmF0aW9uOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdkdXJhdGlvbicsIG9wdHMuZHVyYXRpb24sICd0b3VjaEFuZEhvbGQnKVxuICB9O1xuICBpZiAob3B0cy5lbGVtZW50KSB7XG4gICAgLy8gTG9uZyB0YXAgZWxlbWVudFxuICAgIGNvbnN0IGVsID0gb3B0cy5lbGVtZW50LkVMRU1FTlQgfHwgb3B0cy5lbGVtZW50O1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L3RvdWNoQW5kSG9sZGAsICdQT1NUJywgcGFyYW1zKTtcbiAgfVxuICAvLyBMb25nIHRhcCBjb29yZGluYXRlc1xuICBwYXJhbXMueCA9IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBvcHRzLngsICd0b3VjaEFuZEhvbGQnKTtcbiAgcGFyYW1zLnkgPSBwYXJzZUZsb2F0UGFyYW1ldGVyKCd5Jywgb3B0cy55LCAndG91Y2hBbmRIb2xkJyk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS90b3VjaEFuZEhvbGQnLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVRhcCA9IGFzeW5jIGZ1bmN0aW9uIChvcHRzID0ge30pIHtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHg6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBvcHRzLngsICd0YXAnKSxcbiAgICB5OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd5Jywgb3B0cy55LCAndGFwJylcbiAgfTtcbiAgY29uc3QgZWwgPSBvcHRzLmVsZW1lbnQgPyAob3B0cy5lbGVtZW50LkVMRU1FTlQgfHwgb3B0cy5lbGVtZW50KSA6ICcwJztcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL3RhcC8ke2VsfWAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlRHJhZ0Zyb21Ub0ZvckR1cmF0aW9uID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgZHVyYXRpb246IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ2R1cmF0aW9uJywgb3B0cy5kdXJhdGlvbiwgJ2RyYWdGcm9tVG9Gb3JEdXJhdGlvbicpLFxuICAgIGZyb21YOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdmcm9tWCcsIG9wdHMuZnJvbVgsICdkcmFnRnJvbVRvRm9yRHVyYXRpb24nKSxcbiAgICBmcm9tWTogcGFyc2VGbG9hdFBhcmFtZXRlcignZnJvbVknLCBvcHRzLmZyb21ZLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgdG9YOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd0b1gnLCBvcHRzLnRvWCwgJ2RyYWdGcm9tVG9Gb3JEdXJhdGlvbicpLFxuICAgIHRvWTogcGFyc2VGbG9hdFBhcmFtZXRlcigndG9ZJywgb3B0cy50b1ksICdkcmFnRnJvbVRvRm9yRHVyYXRpb24nKVxuICB9O1xuICBpZiAob3B0cy5lbGVtZW50KSB7XG4gICAgLy8gRHJhZyBlbGVtZW50XG4gICAgY29uc3QgZWwgPSBvcHRzLmVsZW1lbnQuRUxFTUVOVCB8fCBvcHRzLmVsZW1lbnQ7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vZHJhZ2Zyb210b2ZvcmR1cmF0aW9uYCwgJ1BPU1QnLCBwYXJhbXMpO1xuICB9XG4gIC8vIERyYWcgY29vcmRpbmF0ZXNcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL2RyYWdmcm9tdG9mb3JkdXJhdGlvbicsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlU2VsZWN0UGlja2VyV2hlZWxWYWx1ZSA9IGFzeW5jIGZ1bmN0aW9uIChvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzLmVsZW1lbnQpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRWxlbWVudCBpZCBpcyBleHBlY3RlZCB0byBiZSBzZXQgZm9yIHNlbGVjdFBpY2tlcldoZWVsVmFsdWUgbWV0aG9kJyk7XG4gIH1cbiAgaWYgKCFfLmlzU3RyaW5nKG9wdHMub3JkZXIpIHx8IFsnbmV4dCcsICdwcmV2aW91cyddLmluZGV4T2Yob3B0cy5vcmRlci50b0xvd2VyQ2FzZSgpKSA9PT0gLTEpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIG1hbmRhdG9yeSBcIm9yZGVyXCIgcGFyYW1ldGVyIGlzIGV4cGVjdGVkIHRvIGJlIGVxdWFsIGVpdGhlciB0byAnbmV4dCcgb3IgJ3ByZXZpb3VzJy4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYCcke29wdHMub3JkZXJ9JyBpcyBnaXZlbiBpbnN0ZWFkYCk7XG4gIH1cbiAgY29uc3QgZWwgPSBvcHRzLmVsZW1lbnQuRUxFTUVOVCB8fCBvcHRzLmVsZW1lbnQ7XG4gIGNvbnN0IHBhcmFtcyA9IHtvcmRlcjogb3B0cy5vcmRlcn07XG4gIGlmIChvcHRzLm9mZnNldCkge1xuICAgIHBhcmFtcy5vZmZzZXQgPSBwYXJzZUZsb2F0UGFyYW1ldGVyKCdvZmZzZXQnLCBvcHRzLm9mZnNldCwgJ3NlbGVjdFBpY2tlcldoZWVsVmFsdWUnKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvcGlja2Vyd2hlZWwvJHtlbH0vc2VsZWN0YCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5nZXRDb29yZGluYXRlcyA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlKSB7XG4gIGxldCBlbCA9IGdlc3R1cmUub3B0aW9ucy5lbGVtZW50O1xuXG4gIC8vIGRlZmF1bHRzXG4gIGxldCBjb29yZGluYXRlcyA9IHt4OiAwLCB5OiAwLCBhcmVPZmZzZXRzOiBmYWxzZX07XG5cbiAgbGV0IG9wdGlvblggPSBudWxsO1xuICBpZiAoZ2VzdHVyZS5vcHRpb25zLngpIHtcbiAgICBvcHRpb25YID0gcGFyc2VGbG9hdFBhcmFtZXRlcigneCcsIGdlc3R1cmUub3B0aW9ucy54LCAnZ2V0Q29vcmRpbmF0ZXMnKTtcbiAgfVxuICBsZXQgb3B0aW9uWSA9IG51bGw7XG4gIGlmIChnZXN0dXJlLm9wdGlvbnMueSkge1xuICAgIG9wdGlvblkgPSBwYXJzZUZsb2F0UGFyYW1ldGVyKCd5JywgZ2VzdHVyZS5vcHRpb25zLnksICdnZXRDb29yZGluYXRlcycpO1xuICB9XG5cbiAgLy8gZmlndXJlIG91dCB0aGUgZWxlbWVudCBjb29yZGluYXRlcy5cbiAgaWYgKGVsKSB7XG4gICAgbGV0IHJlY3QgPSBhd2FpdCB0aGlzLmdldEVsZW1lbnRSZWN0KGVsKTtcbiAgICBsZXQgcG9zID0ge3g6IHJlY3QueCwgeTogcmVjdC55fTtcbiAgICBsZXQgc2l6ZSA9IHt3OiByZWN0LndpZHRoLCBoOiByZWN0LmhlaWdodH07XG5cbiAgICAvLyBkZWZhdWx0c1xuICAgIGxldCBvZmZzZXRYID0gMDtcbiAgICBsZXQgb2Zmc2V0WSA9IDA7XG5cbiAgICAvLyBnZXQgdGhlIHJlYWwgb2Zmc2V0c1xuICAgIGlmIChvcHRpb25YIHx8IG9wdGlvblkpIHtcbiAgICAgIG9mZnNldFggPSAob3B0aW9uWCB8fCAwKTtcbiAgICAgIG9mZnNldFkgPSAob3B0aW9uWSB8fCAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb2Zmc2V0WCA9IChzaXplLncgLyAyKTtcbiAgICAgIG9mZnNldFkgPSAoc2l6ZS5oIC8gMik7XG4gICAgfVxuXG4gICAgLy8gYXBwbHkgdGhlIG9mZnNldHNcbiAgICBjb29yZGluYXRlcy54ID0gcG9zLnggKyBvZmZzZXRYO1xuICAgIGNvb3JkaW5hdGVzLnkgPSBwb3MueSArIG9mZnNldFk7XG4gIH0gZWxzZSB7XG4gICAgLy8gbW92ZVRvIGNvb3JkaW5hdGVzIGFyZSBwYXNzZWQgaW4gYXMgb2Zmc2V0c1xuICAgIGNvb3JkaW5hdGVzLmFyZU9mZnNldHMgPSAoZ2VzdHVyZS5hY3Rpb24gPT09ICdtb3ZlVG8nKTtcbiAgICBjb29yZGluYXRlcy54ID0gKG9wdGlvblggfHwgMCk7XG4gICAgY29vcmRpbmF0ZXMueSA9IChvcHRpb25ZIHx8IDApO1xuICB9XG4gIHJldHVybiBjb29yZGluYXRlcztcbn07XG5cbmhlbHBlcnMuYXBwbHlNb3ZlVG9PZmZzZXQgPSBmdW5jdGlvbiAoZmlyc3RDb29yZGluYXRlcywgc2Vjb25kQ29vcmRpbmF0ZXMpIHtcbiAgaWYgKHNlY29uZENvb3JkaW5hdGVzLmFyZU9mZnNldHMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgeDogZmlyc3RDb29yZGluYXRlcy54ICsgc2Vjb25kQ29vcmRpbmF0ZXMueCxcbiAgICAgIHk6IGZpcnN0Q29vcmRpbmF0ZXMueSArIHNlY29uZENvb3JkaW5hdGVzLnksXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc2Vjb25kQ29vcmRpbmF0ZXM7XG4gIH1cbn07XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgaGVscGVycywgY29tbWFuZHMpO1xuZXhwb3J0IHsgZXh0ZW5zaW9ucywgaGVscGVycywgY29tbWFuZHMsIGdlc3R1cmVzQ2hhaW5Ub1N0cmluZyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2dlc3R1cmUuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
