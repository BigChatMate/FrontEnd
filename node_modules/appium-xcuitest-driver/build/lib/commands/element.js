"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumBaseDriver = require("appium-base-driver");

var _appiumIosDriver = require("appium-ios-driver");

var _appiumSupport = require("appium-support");

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("../logger"));

let commands = {},
    extensions = {};
exports.commands = commands;
Object.assign(extensions, _appiumIosDriver.iosCommands.element);

commands.getAttribute = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (attribute, el) {
    el = _appiumSupport.util.unwrapElement(el);

    if (!this.isWebContext()) {
      if (attribute === "contentSize") {
        return yield this.getContentSize(el);
      }

      let value = yield this.proxyCommand(`/element/${el}/attribute/${attribute}`, 'GET');

      if ([0, 1].indexOf(value) !== -1) {
        value = !!value;
      }

      return _lodash.default.isNull(value) || _lodash.default.isString(value) ? value : JSON.stringify(value);
    }

    let atomsElement = this.getAtomsElement(el);

    if (_lodash.default.isNull(atomsElement)) {
      throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}`);
    }

    return yield this.executeAtom('get_attribute_value', [atomsElement, attribute]);
  });

  return function (_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

commands.getText = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (el) {
    el = _appiumSupport.util.unwrapElement(el);

    if (!this.isWebContext()) {
      return yield this.proxyCommand(`/element/${el}/text`, 'GET');
    }

    let atomsElement = this.useAtomsElement(el);
    return yield this.executeAtom('get_text', [atomsElement]);
  });

  return function (_x3) {
    return _ref2.apply(this, arguments);
  };
}();

commands.getElementRect = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (el) {
    if (this.isWebContext()) {
      const _ref4 = yield this.getLocation(el),
            x = _ref4.x,
            y = _ref4.y;

      const _ref5 = yield this.getSize(el),
            width = _ref5.width,
            height = _ref5.height;

      return {
        x,
        y,
        width,
        height
      };
    }

    el = _appiumSupport.util.unwrapElement(el);
    return yield this.getNativeRect(el);
  });

  return function (_x4) {
    return _ref3.apply(this, arguments);
  };
}();

extensions.getNativeRect = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (el) {
    return yield this.proxyCommand(`/element/${el}/rect`, 'GET');
  });

  return function (_x5) {
    return _ref6.apply(this, arguments);
  };
}();

commands.getLocation = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (el) {
    el = _appiumSupport.util.unwrapElement(el);

    if (this.isWebContext()) {
      const atomsElement = yield this.useAtomsElement(el);
      let loc = yield this.executeAtom('get_top_left_coordinates', [atomsElement]);

      if (this.opts.absoluteWebLocations) {
        const script = 'return [document.body.scrollLeft, document.body.scrollTop];';

        const _ref8 = yield this.execute(script),
              _ref9 = (0, _slicedToArray2.default)(_ref8, 2),
              xOffset = _ref9[0],
              yOffset = _ref9[1];

        loc.x += xOffset;
        loc.y += yOffset;
      }

      return loc;
    }

    const rect = yield this.getElementRect(el);
    return {
      x: rect.x,
      y: rect.y
    };
  });

  return function (_x6) {
    return _ref7.apply(this, arguments);
  };
}();

commands.getLocationInView = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (el) {
    return yield this.getLocation(el);
  });

  return function (_x7) {
    return _ref10.apply(this, arguments);
  };
}();

commands.getSize = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (el) {
    el = _appiumSupport.util.unwrapElement(el);

    if (this.isWebContext()) {
      let atomsElement = this.getAtomsElement(el);

      if (atomsElement === null) {
        throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}'`);
      }

      return yield this.executeAtom('get_size', [atomsElement]);
    }

    const rect = yield this.getElementRect(el);
    return {
      width: rect.width,
      height: rect.height
    };
  });

  return function (_x8) {
    return _ref11.apply(this, arguments);
  };
}();

function hasSpecialKeys(keys) {
  var _iteratorNormalCompletion = true;
  var _didIteratorError = false;
  var _iteratorError = undefined;

  try {
    for (var _iterator = keys[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
      let char = _step.value;

      if (isSpecialKey(char)) {
        return true;
      }
    }
  } catch (err) {
    _didIteratorError = true;
    _iteratorError = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion && _iterator.return != null) {
        _iterator.return();
      }
    } finally {
      if (_didIteratorError) {
        throw _iteratorError;
      }
    }
  }

  return false;
}

function isSpecialKey(k) {
  if (k === '\uE003' || k === '\ue017') {
    return true;
  } else if (k === '\uE006' || k === '\uE007') {
    return true;
  }

  return false;
}

function translateKey(k) {
  if (k === '\uE006' || k === '\uE007') {
    return '\n';
  } else if (k === '\uE003' || k === '\ue017') {
    return '\b';
  }

  return k;
}

extensions.bringUpKeyboard = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (element) {
    var _this = this;

    let implicitWaitMs = this.implicitWaitMs;
    yield this.setImplicitWait(0);

    try {
      yield (0, _asyncbox.retryInterval)(10, 10, (0, _asyncToGenerator2.default)(function* () {
        try {
          yield _this.findNativeElementOrElements('class name', 'XCUIElementTypeKeyboard', false);

          _logger.default.debug('Keyboard found. Continuing with text input.');
        } catch (err) {
          _logger.default.debug('No keyboard found. Clicking element to open it.');

          yield _this.nativeClick(element);
          yield _this.findNativeElementOrElements('class name', 'XCUIElementTypeKeyboard', false);
        }
      }));
    } finally {
      yield this.setImplicitWait(implicitWaitMs);
    }
  });

  return function (_x9) {
    return _ref12.apply(this, arguments);
  };
}();

commands.setValueImmediate = function () {
  var _ref14 = (0, _asyncToGenerator2.default)(function* (value, el) {
    _logger.default.info('There is currently no way to bypass typing using XCUITest. Setting value through keyboard');

    yield this.setValue(value, el);
  });

  return function (_x10, _x11) {
    return _ref14.apply(this, arguments);
  };
}();

commands.setValue = function () {
  var _ref15 = (0, _asyncToGenerator2.default)(function* (value, el) {
    var _this2 = this;

    el = _appiumSupport.util.unwrapElement(el);

    if (this.isWebContext()) {
      let atomsElement = this.useAtomsElement(el);
      yield this.executeAtom('click', [atomsElement]);
      yield this.executeAtom('type', [atomsElement, value]);
    } else {
      const setFormattedValue = function () {
        var _ref16 = (0, _asyncToGenerator2.default)(function* (input, isKeyboardPresenceCheckEnabled) {
          if (typeof input !== 'string' && !(input instanceof Array)) {
            input = input.toString().split('');
          }

          try {
            yield _this2.proxyCommand(`/element/${el}/value`, 'POST', {
              value: input
            });
          } catch (err) {
            if (isKeyboardPresenceCheckEnabled && (yield _this2.getAttribute('type', el)) === 'XCUIElementTypeTextField') {
              _logger.default.info(`Cannot type in the text field because of ${err}.\nTrying to apply a workaround...`);

              yield _this2.bringUpKeyboard(el);
              yield _this2.proxyCommand(`/element/${el}/value`, 'POST', {
                value: input
              });
            } else {
              throw err;
            }
          }
        });

        return function setFormattedValue(_x14, _x15) {
          return _ref16.apply(this, arguments);
        };
      }();

      if (_lodash.default.isNull(value) || _lodash.default.isUndefined(value) || _lodash.default.isPlainObject(value)) {
        throw new Error(`Only strings and arrays of strings are supported as input arguments. Received: '${JSON.stringify(value)}'`);
      }

      if (_lodash.default.isArray(value)) {
        value = _lodash.default.flatMap(value, v => (_lodash.default.isString(v) ? v : JSON.stringify(v)).split(''));
      } else {
        value = (value || '').toString().split('');
      }

      if (!hasSpecialKeys(value)) {
        yield setFormattedValue(value, true);
        return;
      }

      let buffer = [];
      let isFirstChar = true;
      var _iteratorNormalCompletion2 = true;
      var _didIteratorError2 = false;
      var _iteratorError2 = undefined;

      try {
        for (var _iterator2 = value[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
          let k = _step2.value;
          let char = translateKey(k);

          if (char === k) {
            buffer.push(char);
            continue;
          }

          yield setFormattedValue(buffer, isFirstChar);
          isFirstChar = false;
          buffer = [];
          yield setFormattedValue([char], isFirstChar);
        }
      } catch (err) {
        _didIteratorError2 = true;
        _iteratorError2 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
            _iterator2.return();
          }
        } finally {
          if (_didIteratorError2) {
            throw _iteratorError2;
          }
        }
      }

      if (buffer.length) {
        yield setFormattedValue(buffer, false);
      }
    }
  });

  return function (_x12, _x13) {
    return _ref15.apply(this, arguments);
  };
}();

commands.keys = function () {
  var _ref17 = (0, _asyncToGenerator2.default)(function* (value) {
    if (_lodash.default.isArray(value)) {
      value = value.join('');
    }

    if (_lodash.default.isString(value)) {
      value = value.split('');
    }

    let buffer = [];
    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = value[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        let k = _step3.value;
        let char = translateKey(k);
        buffer.push(char);
      }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }

    yield this.proxyCommand('/wda/keys', 'POST', {
      value: buffer
    });
  });

  return function (_x16) {
    return _ref17.apply(this, arguments);
  };
}();

commands.clear = function () {
  var _ref18 = (0, _asyncToGenerator2.default)(function* (el) {
    el = _appiumSupport.util.unwrapElement(el);

    if (this.isWebContext()) {
      let atomsElement = this.useAtomsElement(el);
      yield this.executeAtom('clear', [atomsElement]);
      return;
    }

    yield (0, _asyncbox.retry)(5, this.proxyCommand.bind(this), `/element/${el}/clear`, 'POST');
  });

  return function (_x17) {
    return _ref18.apply(this, arguments);
  };
}();

commands.getContentSize = function () {
  var _ref19 = (0, _asyncToGenerator2.default)(function* (el) {
    if (this.isWebContext()) {
      throw new _appiumBaseDriver.errors.NotYetImplementedError('Support for getContentSize for webcontext is not yet implemented. Please contact an Appium dev');
    }

    const type = yield this.getAttribute('type', el);

    if (type !== "XCUIElementTypeTable" && type !== "XCUIElementTypeCollectionView") {
      throw new Error(`Can't get content size for type '${type}', only for ` + `tables and collection views`);
    }

    let locator = "*";

    if (type === "XCUIElementTypeTable") {
      locator = "XCUIElementTypeCell";
    }

    let contentHeight = 0;
    let children = yield this.findElOrEls(`class chain`, locator, true, el);

    if (children.length === 1) {
      const rect = yield this.getElementRect(_lodash.default.head(children));
      contentHeight = rect.height;
    } else if (children.length) {
      switch (type) {
        case "XCUIElementTypeTable":
          {
            const firstRect = yield this.getElementRect(_lodash.default.head(children));
            const lastRect = yield this.getElementRect(_lodash.default.last(children));
            contentHeight = lastRect.y + lastRect.height - firstRect.y;
            break;
          }

        case "XCUIElementTypeCollectionView":
          {
            let elsInRow = 1;
            let firstRect = yield this.getElementRect(_lodash.default.head(children));
            let initialRects = [firstRect];

            for (let i = 1; i < children.length; i++) {
              const rect = yield this.getElementRect(children[i]);
              initialRects.push(rect);

              if (rect.y !== firstRect.y) {
                elsInRow = i;
                break;
              }
            }

            const spaceBetweenEls = initialRects[elsInRow].y - initialRects[elsInRow - 1].y - initialRects[elsInRow - 1].height;
            const numRows = Math.ceil(children.length / elsInRow);
            contentHeight = numRows * firstRect.height + spaceBetweenEls * (numRows - 1);
            break;
          }

        default:
          throw new Error(`Programming error: type '${type}' was not ` + `valid but should have already been rejected`);
      }
    }

    const size = yield this.getSize(el);
    const origin = yield this.getLocationInView(el);
    return JSON.stringify({
      width: size.width,
      height: size.height,
      top: origin.y,
      left: origin.x,
      scrollableOffset: contentHeight
    });
  });

  return function (_x18) {
    return _ref19.apply(this, arguments);
  };
}();

commands.isKeyboardShown = (0, _asyncToGenerator2.default)(function* () {
  try {
    yield this.findNativeElementOrElements('class name', 'XCUIElementTypeKeyboard', false);
    return true;
  } catch (ign) {
    return false;
  }
});
Object.assign(extensions, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiZXh0ZW5zaW9ucyIsIk9iamVjdCIsImFzc2lnbiIsImlvc0NvbW1hbmRzIiwiZWxlbWVudCIsImdldEF0dHJpYnV0ZSIsImF0dHJpYnV0ZSIsImVsIiwidXRpbCIsInVud3JhcEVsZW1lbnQiLCJpc1dlYkNvbnRleHQiLCJnZXRDb250ZW50U2l6ZSIsInZhbHVlIiwicHJveHlDb21tYW5kIiwiaW5kZXhPZiIsIl8iLCJpc051bGwiLCJpc1N0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJhdG9tc0VsZW1lbnQiLCJnZXRBdG9tc0VsZW1lbnQiLCJlcnJvcnMiLCJVbmtub3duRXJyb3IiLCJleGVjdXRlQXRvbSIsImdldFRleHQiLCJ1c2VBdG9tc0VsZW1lbnQiLCJnZXRFbGVtZW50UmVjdCIsImdldExvY2F0aW9uIiwieCIsInkiLCJnZXRTaXplIiwid2lkdGgiLCJoZWlnaHQiLCJnZXROYXRpdmVSZWN0IiwibG9jIiwib3B0cyIsImFic29sdXRlV2ViTG9jYXRpb25zIiwic2NyaXB0IiwiZXhlY3V0ZSIsInhPZmZzZXQiLCJ5T2Zmc2V0IiwicmVjdCIsImdldExvY2F0aW9uSW5WaWV3IiwiaGFzU3BlY2lhbEtleXMiLCJrZXlzIiwiY2hhciIsImlzU3BlY2lhbEtleSIsImsiLCJ0cmFuc2xhdGVLZXkiLCJicmluZ1VwS2V5Ym9hcmQiLCJpbXBsaWNpdFdhaXRNcyIsInNldEltcGxpY2l0V2FpdCIsImZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyIsImxvZyIsImRlYnVnIiwiZXJyIiwibmF0aXZlQ2xpY2siLCJzZXRWYWx1ZUltbWVkaWF0ZSIsImluZm8iLCJzZXRWYWx1ZSIsInNldEZvcm1hdHRlZFZhbHVlIiwiaW5wdXQiLCJpc0tleWJvYXJkUHJlc2VuY2VDaGVja0VuYWJsZWQiLCJBcnJheSIsInRvU3RyaW5nIiwic3BsaXQiLCJpc1VuZGVmaW5lZCIsImlzUGxhaW5PYmplY3QiLCJFcnJvciIsImlzQXJyYXkiLCJmbGF0TWFwIiwidiIsImJ1ZmZlciIsImlzRmlyc3RDaGFyIiwicHVzaCIsImxlbmd0aCIsImpvaW4iLCJjbGVhciIsImJpbmQiLCJOb3RZZXRJbXBsZW1lbnRlZEVycm9yIiwidHlwZSIsImxvY2F0b3IiLCJjb250ZW50SGVpZ2h0IiwiY2hpbGRyZW4iLCJmaW5kRWxPckVscyIsImhlYWQiLCJmaXJzdFJlY3QiLCJsYXN0UmVjdCIsImxhc3QiLCJlbHNJblJvdyIsImluaXRpYWxSZWN0cyIsImkiLCJzcGFjZUJldHdlZW5FbHMiLCJudW1Sb3dzIiwiTWF0aCIsImNlaWwiLCJzaXplIiwib3JpZ2luIiwidG9wIiwibGVmdCIsInNjcm9sbGFibGVPZmZzZXQiLCJpc0tleWJvYXJkU2hvd24iLCJpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxVQUFVLEdBQUcsRUFBaEM7O0FBSUFDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjRixVQUFkLEVBQTBCRyw2QkFBWUMsT0FBdEM7O0FBRUFMLFFBQVEsQ0FBQ00sWUFBVDtBQUFBLDZDQUF3QixXQUFnQkMsU0FBaEIsRUFBMkJDLEVBQTNCLEVBQStCO0FBQ3JEQSxJQUFBQSxFQUFFLEdBQUdDLG9CQUFLQyxhQUFMLENBQW1CRixFQUFuQixDQUFMOztBQUNBLFFBQUksQ0FBQyxLQUFLRyxZQUFMLEVBQUwsRUFBMEI7QUFDeEIsVUFBSUosU0FBUyxLQUFLLGFBQWxCLEVBQWlDO0FBRS9CLHFCQUFhLEtBQUtLLGNBQUwsQ0FBb0JKLEVBQXBCLENBQWI7QUFDRDs7QUFHRCxVQUFJSyxLQUFLLFNBQVMsS0FBS0MsWUFBTCxDQUFtQixZQUFXTixFQUFHLGNBQWFELFNBQVUsRUFBeEQsRUFBMkQsS0FBM0QsQ0FBbEI7O0FBRUEsVUFBSSxDQUFDLENBQUQsRUFBSSxDQUFKLEVBQU9RLE9BQVAsQ0FBZUYsS0FBZixNQUEwQixDQUFDLENBQS9CLEVBQWtDO0FBQ2hDQSxRQUFBQSxLQUFLLEdBQUcsQ0FBQyxDQUFDQSxLQUFWO0FBQ0Q7O0FBRUQsYUFBUUcsZ0JBQUVDLE1BQUYsQ0FBU0osS0FBVCxLQUFtQkcsZ0JBQUVFLFFBQUYsQ0FBV0wsS0FBWCxDQUFwQixHQUF5Q0EsS0FBekMsR0FBaURNLElBQUksQ0FBQ0MsU0FBTCxDQUFlUCxLQUFmLENBQXhEO0FBQ0Q7O0FBQ0QsUUFBSVEsWUFBWSxHQUFHLEtBQUtDLGVBQUwsQ0FBcUJkLEVBQXJCLENBQW5COztBQUNBLFFBQUlRLGdCQUFFQyxNQUFGLENBQVNJLFlBQVQsQ0FBSixFQUE0QjtBQUMxQixZQUFNLElBQUlFLHlCQUFPQyxZQUFYLENBQXlCLHVEQUFzRGhCLEVBQUcsRUFBbEYsQ0FBTjtBQUNEOztBQUNELGlCQUFhLEtBQUtpQixXQUFMLENBQWlCLHFCQUFqQixFQUF3QyxDQUFDSixZQUFELEVBQWVkLFNBQWYsQ0FBeEMsQ0FBYjtBQUNELEdBdEJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQXdCQVAsUUFBUSxDQUFDMEIsT0FBVDtBQUFBLDhDQUFtQixXQUFnQmxCLEVBQWhCLEVBQW9CO0FBQ3JDQSxJQUFBQSxFQUFFLEdBQUdDLG9CQUFLQyxhQUFMLENBQW1CRixFQUFuQixDQUFMOztBQUNBLFFBQUksQ0FBQyxLQUFLRyxZQUFMLEVBQUwsRUFBMEI7QUFDeEIsbUJBQWEsS0FBS0csWUFBTCxDQUFtQixZQUFXTixFQUFHLE9BQWpDLEVBQXlDLEtBQXpDLENBQWI7QUFDRDs7QUFDRCxRQUFJYSxZQUFZLEdBQUcsS0FBS00sZUFBTCxDQUFxQm5CLEVBQXJCLENBQW5CO0FBQ0EsaUJBQWEsS0FBS2lCLFdBQUwsQ0FBaUIsVUFBakIsRUFBNkIsQ0FBQ0osWUFBRCxDQUE3QixDQUFiO0FBQ0QsR0FQRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFTQXJCLFFBQVEsQ0FBQzRCLGNBQVQ7QUFBQSw4Q0FBMEIsV0FBZ0JwQixFQUFoQixFQUFvQjtBQUM1QyxRQUFJLEtBQUtHLFlBQUwsRUFBSixFQUF5QjtBQUFBLDBCQUVGLEtBQUtrQixXQUFMLENBQWlCckIsRUFBakIsQ0FGRTtBQUFBLFlBRWhCc0IsQ0FGZ0IsU0FFaEJBLENBRmdCO0FBQUEsWUFFYkMsQ0FGYSxTQUViQSxDQUZhOztBQUFBLDBCQUdPLEtBQUtDLE9BQUwsQ0FBYXhCLEVBQWIsQ0FIUDtBQUFBLFlBR2hCeUIsS0FIZ0IsU0FHaEJBLEtBSGdCO0FBQUEsWUFHVEMsTUFIUyxTQUdUQSxNQUhTOztBQUl2QixhQUFPO0FBQUNKLFFBQUFBLENBQUQ7QUFBSUMsUUFBQUEsQ0FBSjtBQUFPRSxRQUFBQSxLQUFQO0FBQWNDLFFBQUFBO0FBQWQsT0FBUDtBQUNEOztBQUVEMUIsSUFBQUEsRUFBRSxHQUFHQyxvQkFBS0MsYUFBTCxDQUFtQkYsRUFBbkIsQ0FBTDtBQUNBLGlCQUFhLEtBQUsyQixhQUFMLENBQW1CM0IsRUFBbkIsQ0FBYjtBQUNELEdBVkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBWUFQLFVBQVUsQ0FBQ2tDLGFBQVg7QUFBQSw4Q0FBMkIsV0FBZ0IzQixFQUFoQixFQUFvQjtBQUM3QyxpQkFBYSxLQUFLTSxZQUFMLENBQW1CLFlBQVdOLEVBQUcsT0FBakMsRUFBeUMsS0FBekMsQ0FBYjtBQUNELEdBRkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBSUFSLFFBQVEsQ0FBQzZCLFdBQVQ7QUFBQSw4Q0FBdUIsV0FBZ0JyQixFQUFoQixFQUFvQjtBQUN6Q0EsSUFBQUEsRUFBRSxHQUFHQyxvQkFBS0MsYUFBTCxDQUFtQkYsRUFBbkIsQ0FBTDs7QUFDQSxRQUFJLEtBQUtHLFlBQUwsRUFBSixFQUF5QjtBQUN2QixZQUFNVSxZQUFZLFNBQVMsS0FBS00sZUFBTCxDQUFxQm5CLEVBQXJCLENBQTNCO0FBQ0EsVUFBSTRCLEdBQUcsU0FBUyxLQUFLWCxXQUFMLENBQWlCLDBCQUFqQixFQUE2QyxDQUFDSixZQUFELENBQTdDLENBQWhCOztBQUNBLFVBQUksS0FBS2dCLElBQUwsQ0FBVUMsb0JBQWQsRUFBb0M7QUFDbEMsY0FBTUMsTUFBTSxHQUFHLDZEQUFmOztBQURrQyw0QkFFRCxLQUFLQyxPQUFMLENBQWFELE1BQWIsQ0FGQztBQUFBO0FBQUEsY0FFM0JFLE9BRjJCO0FBQUEsY0FFbEJDLE9BRmtCOztBQUdsQ04sUUFBQUEsR0FBRyxDQUFDTixDQUFKLElBQVNXLE9BQVQ7QUFDQUwsUUFBQUEsR0FBRyxDQUFDTCxDQUFKLElBQVNXLE9BQVQ7QUFDRDs7QUFDRCxhQUFPTixHQUFQO0FBQ0Q7O0FBRUQsVUFBTU8sSUFBSSxTQUFTLEtBQUtmLGNBQUwsQ0FBb0JwQixFQUFwQixDQUFuQjtBQUNBLFdBQU87QUFBQ3NCLE1BQUFBLENBQUMsRUFBRWEsSUFBSSxDQUFDYixDQUFUO0FBQVlDLE1BQUFBLENBQUMsRUFBRVksSUFBSSxDQUFDWjtBQUFwQixLQUFQO0FBQ0QsR0FoQkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBa0JBL0IsUUFBUSxDQUFDNEMsaUJBQVQ7QUFBQSwrQ0FBNkIsV0FBZ0JwQyxFQUFoQixFQUFvQjtBQUMvQyxpQkFBYSxLQUFLcUIsV0FBTCxDQUFpQnJCLEVBQWpCLENBQWI7QUFDRCxHQUZEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQUlBUixRQUFRLENBQUNnQyxPQUFUO0FBQUEsK0NBQW1CLFdBQWdCeEIsRUFBaEIsRUFBb0I7QUFDckNBLElBQUFBLEVBQUUsR0FBR0Msb0JBQUtDLGFBQUwsQ0FBbUJGLEVBQW5CLENBQUw7O0FBQ0EsUUFBSSxLQUFLRyxZQUFMLEVBQUosRUFBeUI7QUFDdkIsVUFBSVUsWUFBWSxHQUFHLEtBQUtDLGVBQUwsQ0FBcUJkLEVBQXJCLENBQW5COztBQUNBLFVBQUlhLFlBQVksS0FBSyxJQUFyQixFQUEyQjtBQUN6QixjQUFNLElBQUlFLHlCQUFPQyxZQUFYLENBQXlCLHVEQUFzRGhCLEVBQUcsR0FBbEYsQ0FBTjtBQUNEOztBQUNELG1CQUFhLEtBQUtpQixXQUFMLENBQWlCLFVBQWpCLEVBQTZCLENBQUNKLFlBQUQsQ0FBN0IsQ0FBYjtBQUNEOztBQUVELFVBQU1zQixJQUFJLFNBQVMsS0FBS2YsY0FBTCxDQUFvQnBCLEVBQXBCLENBQW5CO0FBQ0EsV0FBTztBQUFDeUIsTUFBQUEsS0FBSyxFQUFFVSxJQUFJLENBQUNWLEtBQWI7QUFBb0JDLE1BQUFBLE1BQU0sRUFBRVMsSUFBSSxDQUFDVDtBQUFqQyxLQUFQO0FBQ0QsR0FaRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFjQSxTQUFTVyxjQUFULENBQXlCQyxJQUF6QixFQUErQjtBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUM3Qix5QkFBaUJBLElBQWpCLDhIQUF1QjtBQUFBLFVBQWRDLElBQWM7O0FBQ3JCLFVBQUlDLFlBQVksQ0FBQ0QsSUFBRCxDQUFoQixFQUF3QjtBQUN0QixlQUFPLElBQVA7QUFDRDtBQUNGO0FBTDRCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBTTdCLFNBQU8sS0FBUDtBQUNEOztBQUVELFNBQVNDLFlBQVQsQ0FBdUJDLENBQXZCLEVBQTBCO0FBQ3hCLE1BQUlBLENBQUMsS0FBSyxRQUFOLElBQWtCQSxDQUFDLEtBQUssUUFBNUIsRUFBc0M7QUFDcEMsV0FBTyxJQUFQO0FBQ0QsR0FGRCxNQUVPLElBQUlBLENBQUMsS0FBSyxRQUFOLElBQWtCQSxDQUFDLEtBQUssUUFBNUIsRUFBc0M7QUFDM0MsV0FBTyxJQUFQO0FBQ0Q7O0FBQ0QsU0FBTyxLQUFQO0FBQ0Q7O0FBRUQsU0FBU0MsWUFBVCxDQUF1QkQsQ0FBdkIsRUFBMEI7QUFDeEIsTUFBSUEsQ0FBQyxLQUFLLFFBQU4sSUFBa0JBLENBQUMsS0FBSyxRQUE1QixFQUFzQztBQUNwQyxXQUFPLElBQVA7QUFDRCxHQUZELE1BRU8sSUFBSUEsQ0FBQyxLQUFLLFFBQU4sSUFBa0JBLENBQUMsS0FBSyxRQUE1QixFQUFzQztBQUMzQyxXQUFPLElBQVA7QUFDRDs7QUFDRCxTQUFPQSxDQUFQO0FBQ0Q7O0FBRURoRCxVQUFVLENBQUNrRCxlQUFYO0FBQUEsK0NBQTZCLFdBQWdCOUMsT0FBaEIsRUFBeUI7QUFBQTs7QUFHcEQsUUFBSStDLGNBQWMsR0FBRyxLQUFLQSxjQUExQjtBQUNBLFVBQU0sS0FBS0MsZUFBTCxDQUFxQixDQUFyQixDQUFOOztBQUNBLFFBQUk7QUFDRixZQUFNLDZCQUFjLEVBQWQsRUFBa0IsRUFBbEIsa0NBQXNCLGFBQVk7QUFDdEMsWUFBSTtBQUNGLGdCQUFNLEtBQUksQ0FBQ0MsMkJBQUwsQ0FBaUMsWUFBakMsRUFBK0MseUJBQS9DLEVBQTBFLEtBQTFFLENBQU47O0FBQ0FDLDBCQUFJQyxLQUFKLENBQVUsNkNBQVY7QUFDRCxTQUhELENBR0UsT0FBT0MsR0FBUCxFQUFZO0FBRVpGLDBCQUFJQyxLQUFKLENBQVUsaURBQVY7O0FBQ0EsZ0JBQU0sS0FBSSxDQUFDRSxXQUFMLENBQWlCckQsT0FBakIsQ0FBTjtBQUVBLGdCQUFNLEtBQUksQ0FBQ2lELDJCQUFMLENBQWlDLFlBQWpDLEVBQStDLHlCQUEvQyxFQUEwRSxLQUExRSxDQUFOO0FBQ0Q7QUFDRixPQVhLLEVBQU47QUFZRCxLQWJELFNBYVU7QUFFUixZQUFNLEtBQUtELGVBQUwsQ0FBcUJELGNBQXJCLENBQU47QUFDRDtBQUNGLEdBdEJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQXdCQXBELFFBQVEsQ0FBQzJELGlCQUFUO0FBQUEsK0NBQTZCLFdBQWdCOUMsS0FBaEIsRUFBdUJMLEVBQXZCLEVBQTJCO0FBRXREK0Msb0JBQUlLLElBQUosQ0FBUywyRkFBVDs7QUFDQSxVQUFNLEtBQUtDLFFBQUwsQ0FBY2hELEtBQWQsRUFBcUJMLEVBQXJCLENBQU47QUFDRCxHQUpEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQU1BUixRQUFRLENBQUM2RCxRQUFUO0FBQUEsK0NBQW9CLFdBQWdCaEQsS0FBaEIsRUFBdUJMLEVBQXZCLEVBQTJCO0FBQUE7O0FBQzdDQSxJQUFBQSxFQUFFLEdBQUdDLG9CQUFLQyxhQUFMLENBQW1CRixFQUFuQixDQUFMOztBQUNBLFFBQUksS0FBS0csWUFBTCxFQUFKLEVBQXlCO0FBQ3ZCLFVBQUlVLFlBQVksR0FBRyxLQUFLTSxlQUFMLENBQXFCbkIsRUFBckIsQ0FBbkI7QUFDQSxZQUFNLEtBQUtpQixXQUFMLENBQWlCLE9BQWpCLEVBQTBCLENBQUNKLFlBQUQsQ0FBMUIsQ0FBTjtBQUNBLFlBQU0sS0FBS0ksV0FBTCxDQUFpQixNQUFqQixFQUF5QixDQUFDSixZQUFELEVBQWVSLEtBQWYsQ0FBekIsQ0FBTjtBQUNELEtBSkQsTUFJTztBQUNMLFlBQU1pRCxpQkFBaUI7QUFBQSxxREFBRyxXQUFPQyxLQUFQLEVBQWNDLDhCQUFkLEVBQWlEO0FBQ3pFLGNBQUksT0FBT0QsS0FBUCxLQUFpQixRQUFqQixJQUE2QixFQUFFQSxLQUFLLFlBQVlFLEtBQW5CLENBQWpDLEVBQTREO0FBQzFERixZQUFBQSxLQUFLLEdBQUdBLEtBQUssQ0FBQ0csUUFBTixHQUFpQkMsS0FBakIsQ0FBdUIsRUFBdkIsQ0FBUjtBQUNEOztBQUNELGNBQUk7QUFDRixrQkFBTSxNQUFJLENBQUNyRCxZQUFMLENBQW1CLFlBQVdOLEVBQUcsUUFBakMsRUFBMEMsTUFBMUMsRUFBa0Q7QUFBQ0ssY0FBQUEsS0FBSyxFQUFFa0Q7QUFBUixhQUFsRCxDQUFOO0FBQ0QsV0FGRCxDQUVFLE9BQU9OLEdBQVAsRUFBWTtBQUVaLGdCQUFJTyw4QkFBOEIsSUFBSSxPQUFNLE1BQUksQ0FBQzFELFlBQUwsQ0FBa0IsTUFBbEIsRUFBMEJFLEVBQTFCLENBQU4sTUFBd0MsMEJBQTlFLEVBQTBHO0FBQ3hHK0MsOEJBQUlLLElBQUosQ0FBVSw0Q0FBMkNILEdBQUksb0NBQXpEOztBQUNBLG9CQUFNLE1BQUksQ0FBQ04sZUFBTCxDQUFxQjNDLEVBQXJCLENBQU47QUFDQSxvQkFBTSxNQUFJLENBQUNNLFlBQUwsQ0FBbUIsWUFBV04sRUFBRyxRQUFqQyxFQUEwQyxNQUExQyxFQUFrRDtBQUFDSyxnQkFBQUEsS0FBSyxFQUFFa0Q7QUFBUixlQUFsRCxDQUFOO0FBQ0QsYUFKRCxNQUlPO0FBQ0wsb0JBQU1OLEdBQU47QUFDRDtBQUNGO0FBQ0YsU0FoQnNCOztBQUFBLHdCQUFqQkssaUJBQWlCO0FBQUE7QUFBQTtBQUFBLFNBQXZCOztBQXNCQSxVQUFJOUMsZ0JBQUVDLE1BQUYsQ0FBU0osS0FBVCxLQUFtQkcsZ0JBQUVvRCxXQUFGLENBQWN2RCxLQUFkLENBQW5CLElBQTJDRyxnQkFBRXFELGFBQUYsQ0FBZ0J4RCxLQUFoQixDQUEvQyxFQUF1RTtBQUNyRSxjQUFNLElBQUl5RCxLQUFKLENBQVcsbUZBQWtGbkQsSUFBSSxDQUFDQyxTQUFMLENBQWVQLEtBQWYsQ0FBc0IsR0FBbkgsQ0FBTjtBQUNEOztBQUNELFVBQUlHLGdCQUFFdUQsT0FBRixDQUFVMUQsS0FBVixDQUFKLEVBQXNCO0FBRXBCQSxRQUFBQSxLQUFLLEdBQUdHLGdCQUFFd0QsT0FBRixDQUFVM0QsS0FBVixFQUFrQjRELENBQUQsSUFBTyxDQUFDekQsZ0JBQUVFLFFBQUYsQ0FBV3VELENBQVgsSUFBZ0JBLENBQWhCLEdBQW9CdEQsSUFBSSxDQUFDQyxTQUFMLENBQWVxRCxDQUFmLENBQXJCLEVBQXdDTixLQUF4QyxDQUE4QyxFQUE5QyxDQUF4QixDQUFSO0FBQ0QsT0FIRCxNQUdPO0FBRUx0RCxRQUFBQSxLQUFLLEdBQUcsQ0FBQ0EsS0FBSyxJQUFJLEVBQVYsRUFBY3FELFFBQWQsR0FBeUJDLEtBQXpCLENBQStCLEVBQS9CLENBQVI7QUFDRDs7QUFFRCxVQUFJLENBQUN0QixjQUFjLENBQUNoQyxLQUFELENBQW5CLEVBQTRCO0FBRTFCLGNBQU1pRCxpQkFBaUIsQ0FBQ2pELEtBQUQsRUFBUSxJQUFSLENBQXZCO0FBQ0E7QUFDRDs7QUFLRCxVQUFJNkQsTUFBTSxHQUFHLEVBQWI7QUFDQSxVQUFJQyxXQUFXLEdBQUcsSUFBbEI7QUE1Q0s7QUFBQTtBQUFBOztBQUFBO0FBNkNMLDhCQUFjOUQsS0FBZCxtSUFBcUI7QUFBQSxjQUFab0MsQ0FBWTtBQUNuQixjQUFJRixJQUFJLEdBQUdHLFlBQVksQ0FBQ0QsQ0FBRCxDQUF2Qjs7QUFFQSxjQUFJRixJQUFJLEtBQUtFLENBQWIsRUFBZ0I7QUFDZHlCLFlBQUFBLE1BQU0sQ0FBQ0UsSUFBUCxDQUFZN0IsSUFBWjtBQUNBO0FBQ0Q7O0FBR0QsZ0JBQU1lLGlCQUFpQixDQUFDWSxNQUFELEVBQVNDLFdBQVQsQ0FBdkI7QUFDQUEsVUFBQUEsV0FBVyxHQUFHLEtBQWQ7QUFDQUQsVUFBQUEsTUFBTSxHQUFHLEVBQVQ7QUFHQSxnQkFBTVosaUJBQWlCLENBQUMsQ0FBQ2YsSUFBRCxDQUFELEVBQVM0QixXQUFULENBQXZCO0FBQ0Q7QUE1REk7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUE4REwsVUFBSUQsTUFBTSxDQUFDRyxNQUFYLEVBQW1CO0FBQ2pCLGNBQU1mLGlCQUFpQixDQUFDWSxNQUFELEVBQVMsS0FBVCxDQUF2QjtBQUNEO0FBQ0Y7QUFDRixHQXhFRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUEwRUExRSxRQUFRLENBQUM4QyxJQUFUO0FBQUEsK0NBQWdCLFdBQWdCakMsS0FBaEIsRUFBdUI7QUFDckMsUUFBSUcsZ0JBQUV1RCxPQUFGLENBQVUxRCxLQUFWLENBQUosRUFBc0I7QUFFcEJBLE1BQUFBLEtBQUssR0FBR0EsS0FBSyxDQUFDaUUsSUFBTixDQUFXLEVBQVgsQ0FBUjtBQUNEOztBQUNELFFBQUk5RCxnQkFBRUUsUUFBRixDQUFXTCxLQUFYLENBQUosRUFBdUI7QUFFckJBLE1BQUFBLEtBQUssR0FBR0EsS0FBSyxDQUFDc0QsS0FBTixDQUFZLEVBQVosQ0FBUjtBQUNEOztBQUVELFFBQUlPLE1BQU0sR0FBRyxFQUFiO0FBVnFDO0FBQUE7QUFBQTs7QUFBQTtBQVdyQyw0QkFBYzdELEtBQWQsbUlBQXFCO0FBQUEsWUFBWm9DLENBQVk7QUFDbkIsWUFBSUYsSUFBSSxHQUFHRyxZQUFZLENBQUNELENBQUQsQ0FBdkI7QUFFQXlCLFFBQUFBLE1BQU0sQ0FBQ0UsSUFBUCxDQUFZN0IsSUFBWjtBQUNEO0FBZm9DO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBZ0JyQyxVQUFNLEtBQUtqQyxZQUFMLENBQWtCLFdBQWxCLEVBQStCLE1BQS9CLEVBQXVDO0FBQUNELE1BQUFBLEtBQUssRUFBRTZEO0FBQVIsS0FBdkMsQ0FBTjtBQUNELEdBakJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQW1CQTFFLFFBQVEsQ0FBQytFLEtBQVQ7QUFBQSwrQ0FBaUIsV0FBZ0J2RSxFQUFoQixFQUFvQjtBQUNuQ0EsSUFBQUEsRUFBRSxHQUFHQyxvQkFBS0MsYUFBTCxDQUFtQkYsRUFBbkIsQ0FBTDs7QUFDQSxRQUFJLEtBQUtHLFlBQUwsRUFBSixFQUF5QjtBQUN2QixVQUFJVSxZQUFZLEdBQUcsS0FBS00sZUFBTCxDQUFxQm5CLEVBQXJCLENBQW5CO0FBQ0EsWUFBTSxLQUFLaUIsV0FBTCxDQUFpQixPQUFqQixFQUEwQixDQUFDSixZQUFELENBQTFCLENBQU47QUFDQTtBQUNEOztBQUNELFVBQU0scUJBQU0sQ0FBTixFQUFTLEtBQUtQLFlBQUwsQ0FBa0JrRSxJQUFsQixDQUF1QixJQUF2QixDQUFULEVBQXdDLFlBQVd4RSxFQUFHLFFBQXRELEVBQStELE1BQS9ELENBQU47QUFDRCxHQVJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQVVBUixRQUFRLENBQUNZLGNBQVQ7QUFBQSwrQ0FBMEIsV0FBZ0JKLEVBQWhCLEVBQW9CO0FBQzVDLFFBQUksS0FBS0csWUFBTCxFQUFKLEVBQXlCO0FBQ3ZCLFlBQU0sSUFBSVkseUJBQU8wRCxzQkFBWCxDQUFrQyxnR0FBbEMsQ0FBTjtBQUNEOztBQUVELFVBQU1DLElBQUksU0FBUyxLQUFLNUUsWUFBTCxDQUFrQixNQUFsQixFQUEwQkUsRUFBMUIsQ0FBbkI7O0FBRUEsUUFBSTBFLElBQUksS0FBSyxzQkFBVCxJQUNBQSxJQUFJLEtBQUssK0JBRGIsRUFDOEM7QUFDNUMsWUFBTSxJQUFJWixLQUFKLENBQVcsb0NBQW1DWSxJQUFLLGNBQXpDLEdBQ0MsNkJBRFgsQ0FBTjtBQUVEOztBQUNELFFBQUlDLE9BQU8sR0FBRyxHQUFkOztBQUNBLFFBQUlELElBQUksS0FBSyxzQkFBYixFQUFxQztBQUVuQ0MsTUFBQUEsT0FBTyxHQUFHLHFCQUFWO0FBQ0Q7O0FBRUQsUUFBSUMsYUFBYSxHQUFHLENBQXBCO0FBQ0EsUUFBSUMsUUFBUSxTQUFTLEtBQUtDLFdBQUwsQ0FBa0IsYUFBbEIsRUFBZ0NILE9BQWhDLEVBQXlDLElBQXpDLEVBQStDM0UsRUFBL0MsQ0FBckI7O0FBQ0EsUUFBSTZFLFFBQVEsQ0FBQ1IsTUFBVCxLQUFvQixDQUF4QixFQUEyQjtBQUd6QixZQUFNbEMsSUFBSSxTQUFTLEtBQUtmLGNBQUwsQ0FBb0JaLGdCQUFFdUUsSUFBRixDQUFPRixRQUFQLENBQXBCLENBQW5CO0FBQ0FELE1BQUFBLGFBQWEsR0FBR3pDLElBQUksQ0FBQ1QsTUFBckI7QUFDRCxLQUxELE1BS08sSUFBSW1ELFFBQVEsQ0FBQ1IsTUFBYixFQUFxQjtBQUcxQixjQUFRSyxJQUFSO0FBQ0UsYUFBSyxzQkFBTDtBQUE2QjtBQUMzQixrQkFBTU0sU0FBUyxTQUFTLEtBQUs1RCxjQUFMLENBQW9CWixnQkFBRXVFLElBQUYsQ0FBT0YsUUFBUCxDQUFwQixDQUF4QjtBQUNBLGtCQUFNSSxRQUFRLFNBQVMsS0FBSzdELGNBQUwsQ0FBb0JaLGdCQUFFMEUsSUFBRixDQUFPTCxRQUFQLENBQXBCLENBQXZCO0FBQ0FELFlBQUFBLGFBQWEsR0FBR0ssUUFBUSxDQUFDMUQsQ0FBVCxHQUFhMEQsUUFBUSxDQUFDdkQsTUFBdEIsR0FBK0JzRCxTQUFTLENBQUN6RCxDQUF6RDtBQUNBO0FBQ0Q7O0FBQ0QsYUFBSywrQkFBTDtBQUFzQztBQUNwQyxnQkFBSTRELFFBQVEsR0FBRyxDQUFmO0FBQ0EsZ0JBQUlILFNBQVMsU0FBUyxLQUFLNUQsY0FBTCxDQUFvQlosZ0JBQUV1RSxJQUFGLENBQU9GLFFBQVAsQ0FBcEIsQ0FBdEI7QUFDQSxnQkFBSU8sWUFBWSxHQUFHLENBQUNKLFNBQUQsQ0FBbkI7O0FBQ0EsaUJBQUssSUFBSUssQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR1IsUUFBUSxDQUFDUixNQUE3QixFQUFxQ2dCLENBQUMsRUFBdEMsRUFBMEM7QUFDeEMsb0JBQU1sRCxJQUFJLFNBQVMsS0FBS2YsY0FBTCxDQUFvQnlELFFBQVEsQ0FBQ1EsQ0FBRCxDQUE1QixDQUFuQjtBQUNBRCxjQUFBQSxZQUFZLENBQUNoQixJQUFiLENBQWtCakMsSUFBbEI7O0FBQ0Esa0JBQUlBLElBQUksQ0FBQ1osQ0FBTCxLQUFXeUQsU0FBUyxDQUFDekQsQ0FBekIsRUFBNEI7QUFDMUI0RCxnQkFBQUEsUUFBUSxHQUFHRSxDQUFYO0FBQ0E7QUFDRDtBQUNGOztBQUNELGtCQUFNQyxlQUFlLEdBQUdGLFlBQVksQ0FBQ0QsUUFBRCxDQUFaLENBQXVCNUQsQ0FBdkIsR0FBMkI2RCxZQUFZLENBQUNELFFBQVEsR0FBRyxDQUFaLENBQVosQ0FBMkI1RCxDQUF0RCxHQUEwRDZELFlBQVksQ0FBQ0QsUUFBUSxHQUFHLENBQVosQ0FBWixDQUEyQnpELE1BQTdHO0FBQ0Esa0JBQU02RCxPQUFPLEdBQUdDLElBQUksQ0FBQ0MsSUFBTCxDQUFVWixRQUFRLENBQUNSLE1BQVQsR0FBa0JjLFFBQTVCLENBQWhCO0FBR0FQLFlBQUFBLGFBQWEsR0FBSVcsT0FBTyxHQUFHUCxTQUFTLENBQUN0RCxNQUFyQixHQUFnQzRELGVBQWUsSUFBSUMsT0FBTyxHQUFHLENBQWQsQ0FBL0Q7QUFDQTtBQUNEOztBQUNEO0FBQVMsZ0JBQU0sSUFBSXpCLEtBQUosQ0FBVyw0QkFBMkJZLElBQUssWUFBakMsR0FDQyw2Q0FEWCxDQUFOO0FBMUJYO0FBNkJEOztBQUNELFVBQU1nQixJQUFJLFNBQVMsS0FBS2xFLE9BQUwsQ0FBYXhCLEVBQWIsQ0FBbkI7QUFDQSxVQUFNMkYsTUFBTSxTQUFTLEtBQUt2RCxpQkFBTCxDQUF1QnBDLEVBQXZCLENBQXJCO0FBRUEsV0FBT1csSUFBSSxDQUFDQyxTQUFMLENBQWU7QUFDcEJhLE1BQUFBLEtBQUssRUFBRWlFLElBQUksQ0FBQ2pFLEtBRFE7QUFFcEJDLE1BQUFBLE1BQU0sRUFBRWdFLElBQUksQ0FBQ2hFLE1BRk87QUFHcEJrRSxNQUFBQSxHQUFHLEVBQUVELE1BQU0sQ0FBQ3BFLENBSFE7QUFJcEJzRSxNQUFBQSxJQUFJLEVBQUVGLE1BQU0sQ0FBQ3JFLENBSk87QUFLcEJ3RSxNQUFBQSxnQkFBZ0IsRUFBRWxCO0FBTEUsS0FBZixDQUFQO0FBT0QsR0FwRUQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBc0VBcEYsUUFBUSxDQUFDdUcsZUFBVCxtQ0FBMkIsYUFBa0I7QUFDM0MsTUFBSTtBQUNGLFVBQU0sS0FBS2pELDJCQUFMLENBQWlDLFlBQWpDLEVBQStDLHlCQUEvQyxFQUEwRSxLQUExRSxDQUFOO0FBQ0EsV0FBTyxJQUFQO0FBQ0QsR0FIRCxDQUdFLE9BQU9rRCxHQUFQLEVBQVk7QUFDWixXQUFPLEtBQVA7QUFDRDtBQUNGLENBUEQ7QUFTQXRHLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjRixVQUFkLEVBQTBCRCxRQUExQjtlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgeyBpb3NDb21tYW5kcyB9IGZyb20gJ2FwcGl1bS1pb3MtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsLCByZXRyeSB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcblxuXG5sZXQgY29tbWFuZHMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG4vLyBwdWxsIGluIGFsbCB0aGUgZWxlbWVudCBjb21tYW5kcyBhbmQgaGVscGVycyBmcm9tIGlvcy1kcml2ZXIsXG4vLyB0aGVuIG92ZXJyaWRlIGFueXRoaW5nIHdlIHdhbnQgYmVsb3dcbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgaW9zQ29tbWFuZHMuZWxlbWVudCk7XG5cbmNvbW1hbmRzLmdldEF0dHJpYnV0ZSA9IGFzeW5jIGZ1bmN0aW9uIChhdHRyaWJ1dGUsIGVsKSB7XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgaWYgKGF0dHJpYnV0ZSA9PT0gXCJjb250ZW50U2l6ZVwiKSB7XG4gICAgICAvLyBkb24ndCBwcm94eSByZXF1ZXN0cyBmb3IgdGhlIGNvbnRlbnQgc2l6ZSBvZiBhIHNjcm9sbGFibGUgZWxlbWVudFxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0Q29udGVudFNpemUoZWwpO1xuICAgIH1cblxuICAgIC8vIG90aGVyd2lzZSBsZXQgV0RBIGhhbmRsZSBhdHRyaWJ1dGUgcmVxdWVzdHNcbiAgICBsZXQgdmFsdWUgPSBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL2VsZW1lbnQvJHtlbH0vYXR0cmlidXRlLyR7YXR0cmlidXRlfWAsICdHRVQnKTtcbiAgICAvLyBUcmFuc2Zvcm0gdGhlIHJlc3VsdCBmb3IgdGhlIGNhc2Ugd2hlbiBXREEgcmV0dXJucyBhbiBpbnRlZ2VyIHJlcHJlc2VudGF0aW9uIGZvciBhIGJvb2xlYW4gdmFsdWVcbiAgICBpZiAoWzAsIDFdLmluZGV4T2YodmFsdWUpICE9PSAtMSkge1xuICAgICAgdmFsdWUgPSAhIXZhbHVlO1xuICAgIH1cbiAgICAvLyBUaGUgcmV0dXJuZWQgdmFsdWUgbXVzdCBiZSBvZiB0eXBlIHN0cmluZyBhY2NvcmRpbmcgdG8gaHR0cHM6Ly93d3cudzMub3JnL1RSL3dlYmRyaXZlci8jZ2V0LWVsZW1lbnQtYXR0cmlidXRlXG4gICAgcmV0dXJuIChfLmlzTnVsbCh2YWx1ZSkgfHwgXy5pc1N0cmluZyh2YWx1ZSkpID8gdmFsdWUgOiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gIH1cbiAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgaWYgKF8uaXNOdWxsKGF0b21zRWxlbWVudCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihgRXJyb3IgY29udmVydGluZyBlbGVtZW50IElEIGZvciB1c2luZyBpbiBXRCBhdG9tczogJyR7ZWx9YCk7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF9hdHRyaWJ1dGVfdmFsdWUnLCBbYXRvbXNFbGVtZW50LCBhdHRyaWJ1dGVdKTtcbn07XG5cbmNvbW1hbmRzLmdldFRleHQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7ZWx9L3RleHRgLCAnR0VUJyk7XG4gIH1cbiAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF90ZXh0JywgW2F0b21zRWxlbWVudF0pO1xufTtcblxuY29tbWFuZHMuZ2V0RWxlbWVudFJlY3QgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAvLyBNb2JpbGUgc2FmYXJpIGRvZXNuJ3Qgc3VwcG9ydCByZWN0XG4gICAgY29uc3Qge3gsIHl9ID0gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbihlbCk7XG4gICAgY29uc3Qge3dpZHRoLCBoZWlnaHR9ID0gYXdhaXQgdGhpcy5nZXRTaXplKGVsKTtcbiAgICByZXR1cm4ge3gsIHksIHdpZHRoLCBoZWlnaHR9O1xuICB9XG5cbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5nZXROYXRpdmVSZWN0KGVsKTtcbn07XG5cbmV4dGVuc2lvbnMuZ2V0TmF0aXZlUmVjdCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7ZWx9L3JlY3RgLCAnR0VUJyk7XG59O1xuXG5jb21tYW5kcy5nZXRMb2NhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgY29uc3QgYXRvbXNFbGVtZW50ID0gYXdhaXQgdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIGxldCBsb2MgPSBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfdG9wX2xlZnRfY29vcmRpbmF0ZXMnLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgaWYgKHRoaXMub3B0cy5hYnNvbHV0ZVdlYkxvY2F0aW9ucykge1xuICAgICAgY29uc3Qgc2NyaXB0ID0gJ3JldHVybiBbZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0LCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcF07JztcbiAgICAgIGNvbnN0IFt4T2Zmc2V0LCB5T2Zmc2V0XSA9IGF3YWl0IHRoaXMuZXhlY3V0ZShzY3JpcHQpO1xuICAgICAgbG9jLnggKz0geE9mZnNldDtcbiAgICAgIGxvYy55ICs9IHlPZmZzZXQ7XG4gICAgfVxuICAgIHJldHVybiBsb2M7XG4gIH1cblxuICBjb25zdCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gIHJldHVybiB7eDogcmVjdC54LCB5OiByZWN0Lnl9O1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb25JblZpZXcgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0TG9jYXRpb24oZWwpO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgICBpZiAoYXRvbXNFbGVtZW50ID09PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihgRXJyb3IgY29udmVydGluZyBlbGVtZW50IElEIGZvciB1c2luZyBpbiBXRCBhdG9tczogJyR7ZWx9J2ApO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3NpemUnLCBbYXRvbXNFbGVtZW50XSk7XG4gIH1cblxuICBjb25zdCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gIHJldHVybiB7d2lkdGg6IHJlY3Qud2lkdGgsIGhlaWdodDogcmVjdC5oZWlnaHR9O1xufTtcblxuZnVuY3Rpb24gaGFzU3BlY2lhbEtleXMgKGtleXMpIHtcbiAgZm9yIChsZXQgY2hhciBvZiBrZXlzKSB7XG4gICAgaWYgKGlzU3BlY2lhbEtleShjaGFyKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaXNTcGVjaWFsS2V5IChrKSB7XG4gIGlmIChrID09PSAnXFx1RTAwMycgfHwgayA9PT0gJ1xcdWUwMTcnKSB7IC8vIEJBQ0tTUEFDRSBvciBERUxFVEVcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIGlmIChrID09PSAnXFx1RTAwNicgfHwgayA9PT0gJ1xcdUUwMDcnKSB7IC8vIFJFVFVSTiBvciBFTlRFUlxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gdHJhbnNsYXRlS2V5IChrKSB7XG4gIGlmIChrID09PSAnXFx1RTAwNicgfHwgayA9PT0gJ1xcdUUwMDcnKSB7IC8vIFJFVFVSTiBvciBFTlRFUlxuICAgIHJldHVybiAnXFxuJztcbiAgfSBlbHNlIGlmIChrID09PSAnXFx1RTAwMycgfHwgayA9PT0gJ1xcdWUwMTcnKSB7IC8vIEJBQ0tTUEFDRSBvciBERUxFVEVcbiAgICByZXR1cm4gJ1xcYic7XG4gIH1cbiAgcmV0dXJuIGs7XG59XG5cbmV4dGVuc2lvbnMuYnJpbmdVcEtleWJvYXJkID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgLy8gc29tZXRpbWVzIGlucHV0IGlzIGF0dGVtcHRlZCBiZWZvcmUgd2UgaGF2ZSBhIGtleWJvYXJkLiBUcnkgdG8gYnJpbmcgb25lIHVwXG4gIC8vIGJ1dCB3ZSB3YW50IHRvIGhhbmRsZSB0aGUgcmV0cmllcyBvbiBmaW5kXG4gIGxldCBpbXBsaWNpdFdhaXRNcyA9IHRoaXMuaW1wbGljaXRXYWl0TXM7XG4gIGF3YWl0IHRoaXMuc2V0SW1wbGljaXRXYWl0KDApO1xuICB0cnkge1xuICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoMTAsIDEwLCBhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cygnY2xhc3MgbmFtZScsICdYQ1VJRWxlbWVudFR5cGVLZXlib2FyZCcsIGZhbHNlKTtcbiAgICAgICAgbG9nLmRlYnVnKCdLZXlib2FyZCBmb3VuZC4gQ29udGludWluZyB3aXRoIHRleHQgaW5wdXQuJyk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gbm8ga2V5Ym9hcmQgZm91bmRcbiAgICAgICAgbG9nLmRlYnVnKCdObyBrZXlib2FyZCBmb3VuZC4gQ2xpY2tpbmcgZWxlbWVudCB0byBvcGVuIGl0LicpO1xuICAgICAgICBhd2FpdCB0aGlzLm5hdGl2ZUNsaWNrKGVsZW1lbnQpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKCdjbGFzcyBuYW1lJywgJ1hDVUlFbGVtZW50VHlwZUtleWJvYXJkJywgZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGZpbmFsbHkge1xuICAgIC8vIG5vIG1hdHRlciB3aGF0IHdlIGRvLCBtYWtlIHN1cmUgd2UgaGF2ZSB0aGUgaW1wbGljaXQgd2FpdCBzZXQgdXAgY29ycmVjdGx5XG4gICAgYXdhaXQgdGhpcy5zZXRJbXBsaWNpdFdhaXQoaW1wbGljaXRXYWl0TXMpO1xuICB9XG59O1xuXG5jb21tYW5kcy5zZXRWYWx1ZUltbWVkaWF0ZSA9IGFzeW5jIGZ1bmN0aW9uICh2YWx1ZSwgZWwpIHtcbiAgLy8gV0RBIGRvZXMgbm90IHByb3ZpZGUgbm8gd2F5IHRvIHNldCB0aGUgdmFsdWUgZGlyZWN0bHlcbiAgbG9nLmluZm8oJ1RoZXJlIGlzIGN1cnJlbnRseSBubyB3YXkgdG8gYnlwYXNzIHR5cGluZyB1c2luZyBYQ1VJVGVzdC4gU2V0dGluZyB2YWx1ZSB0aHJvdWdoIGtleWJvYXJkJyk7XG4gIGF3YWl0IHRoaXMuc2V0VmFsdWUodmFsdWUsIGVsKTtcbn07XG5cbmNvbW1hbmRzLnNldFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKHZhbHVlLCBlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdjbGljaycsIFthdG9tc0VsZW1lbnRdKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCd0eXBlJywgW2F0b21zRWxlbWVudCwgdmFsdWVdKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBzZXRGb3JtYXR0ZWRWYWx1ZSA9IGFzeW5jIChpbnB1dCwgaXNLZXlib2FyZFByZXNlbmNlQ2hlY2tFbmFibGVkKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJyAmJiAhKGlucHV0IGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICAgIGlucHV0ID0gaW5wdXQudG9TdHJpbmcoKS5zcGxpdCgnJyk7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL2VsZW1lbnQvJHtlbH0vdmFsdWVgLCAnUE9TVCcsIHt2YWx1ZTogaW5wdXR9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyBtYWtlIHN1cmUgdGhlcmUgaXMgYSBrZXlib2FyZCBpZiB0aGlzIGlzIGEgdGV4dCBmaWVsZFxuICAgICAgICBpZiAoaXNLZXlib2FyZFByZXNlbmNlQ2hlY2tFbmFibGVkICYmIGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKCd0eXBlJywgZWwpID09PSAnWENVSUVsZW1lbnRUeXBlVGV4dEZpZWxkJykge1xuICAgICAgICAgIGxvZy5pbmZvKGBDYW5ub3QgdHlwZSBpbiB0aGUgdGV4dCBmaWVsZCBiZWNhdXNlIG9mICR7ZXJyfS5cXG5UcnlpbmcgdG8gYXBwbHkgYSB3b3JrYXJvdW5kLi4uYCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5icmluZ1VwS2V5Ym9hcmQoZWwpO1xuICAgICAgICAgIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke2VsfS92YWx1ZWAsICdQT1NUJywge3ZhbHVlOiBpbnB1dH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBwb3NzaWJsZSB2YWx1ZXMgb2YgYHZhbHVlYDpcbiAgICAvLyAgIFsnc29tZSB0ZXh0J11cbiAgICAvLyAgIFsncycsICdvJywgJ20nLCAnZScsICcgJywgJ3QnLCAnZScsICd4JywgJ3QnXVxuICAgIC8vICAgJ3NvbWUgdGV4dCdcbiAgICBpZiAoXy5pc051bGwodmFsdWUpIHx8IF8uaXNVbmRlZmluZWQodmFsdWUpIHx8IF8uaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgT25seSBzdHJpbmdzIGFuZCBhcnJheXMgb2Ygc3RyaW5ncyBhcmUgc3VwcG9ydGVkIGFzIGlucHV0IGFyZ3VtZW50cy4gUmVjZWl2ZWQ6ICcke0pTT04uc3RyaW5naWZ5KHZhbHVlKX0nYCk7XG4gICAgfVxuICAgIGlmIChfLmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAvLyBtYWtlIHN1cmUgdGhhdCBhbGwgdGhlIHN0cmluZ3MgaW5zaWRlIGFyZSBhIHNpbmdsZSBjaGFyYWN0ZXIgbG9uZ1xuICAgICAgdmFsdWUgPSBfLmZsYXRNYXAodmFsdWUsICh2KSA9PiAoXy5pc1N0cmluZyh2KSA/IHYgOiBKU09OLnN0cmluZ2lmeSh2KSkuc3BsaXQoJycpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gbWFrZSBpdCBpbnRvIGFuIGFycmF5IG9mIGNoYXJhY3RlcnNcbiAgICAgIHZhbHVlID0gKHZhbHVlIHx8ICcnKS50b1N0cmluZygpLnNwbGl0KCcnKTtcbiAgICB9XG5cbiAgICBpZiAoIWhhc1NwZWNpYWxLZXlzKHZhbHVlKSkge1xuICAgICAgLy8gbm90aGluZyBzcGVjaWFsLCBzbyBqdXN0IHNlbmQgaXQgaW5cbiAgICAgIGF3YWl0IHNldEZvcm1hdHRlZFZhbHVlKHZhbHVlLCB0cnVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBpZiB0aGVyZSBhcmUgc3BlY2lhbCBjaGFyYWN0ZXJzLCBnbyB0aHJvdWdoIHRoZSB2YWx1ZSB1bnRpbCB3ZSBnZXQgdG8gb25lLFxuICAgIC8vIGFuZCB0aGVuIHByaW50IGl0IGluZGl2aWR1YWxseVxuICAgIC8vIGN1cnJlbnRseSBvbmx5IHN1cHBvcnRpbmcgcmV0dXJuLCBlbnRlciwgYmFja3NwYWNlLCBhbmQgZGVsZXRlXG4gICAgbGV0IGJ1ZmZlciA9IFtdO1xuICAgIGxldCBpc0ZpcnN0Q2hhciA9IHRydWU7XG4gICAgZm9yIChsZXQgayBvZiB2YWx1ZSkge1xuICAgICAgbGV0IGNoYXIgPSB0cmFuc2xhdGVLZXkoayk7XG5cbiAgICAgIGlmIChjaGFyID09PSBrKSB7XG4gICAgICAgIGJ1ZmZlci5wdXNoKGNoYXIpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gd3JpdGUgYW5kIGNsZWFyIHRoZSBidWZmZXJcbiAgICAgIGF3YWl0IHNldEZvcm1hdHRlZFZhbHVlKGJ1ZmZlciwgaXNGaXJzdENoYXIpO1xuICAgICAgaXNGaXJzdENoYXIgPSBmYWxzZTtcbiAgICAgIGJ1ZmZlciA9IFtdO1xuXG4gICAgICAvLyB3cml0ZSB0aGUgY2hhcmFjdGVyXG4gICAgICBhd2FpdCBzZXRGb3JtYXR0ZWRWYWx1ZShbY2hhcl0sIGlzRmlyc3RDaGFyKTtcbiAgICB9XG4gICAgLy8gZmluYWxseSwgc2VuZCBhbnl0aGluZyB0aGF0IG1pZ2h0IGJlIGxlZnRcbiAgICBpZiAoYnVmZmVyLmxlbmd0aCkge1xuICAgICAgYXdhaXQgc2V0Rm9ybWF0dGVkVmFsdWUoYnVmZmVyLCBmYWxzZSk7XG4gICAgfVxuICB9XG59O1xuXG5jb21tYW5kcy5rZXlzID0gYXN5bmMgZnVuY3Rpb24gKHZhbHVlKSB7XG4gIGlmIChfLmlzQXJyYXkodmFsdWUpKSB7XG4gICAgLy8gY29uY2F0ZW5hdGUgYW55IGluZGl2aWR1YWwgc3RyaW5nc1xuICAgIHZhbHVlID0gdmFsdWUuam9pbignJyk7XG4gIH1cbiAgaWYgKF8uaXNTdHJpbmcodmFsdWUpKSB7XG4gICAgLy8gc3BsaXQgaW50byBjb21wb25lbnQgY2hhcmFjdGVyc1xuICAgIHZhbHVlID0gdmFsdWUuc3BsaXQoJycpO1xuICB9XG5cbiAgbGV0IGJ1ZmZlciA9IFtdO1xuICBmb3IgKGxldCBrIG9mIHZhbHVlKSB7XG4gICAgbGV0IGNoYXIgPSB0cmFuc2xhdGVLZXkoayk7XG5cbiAgICBidWZmZXIucHVzaChjaGFyKTtcbiAgfVxuICBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS9rZXlzJywgJ1BPU1QnLCB7dmFsdWU6IGJ1ZmZlcn0pO1xufTtcblxuY29tbWFuZHMuY2xlYXIgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnY2xlYXInLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGF3YWl0IHJldHJ5KDUsIHRoaXMucHJveHlDb21tYW5kLmJpbmQodGhpcyksIGAvZWxlbWVudC8ke2VsfS9jbGVhcmAsICdQT1NUJyk7XG59O1xuXG5jb21tYW5kcy5nZXRDb250ZW50U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcignU3VwcG9ydCBmb3IgZ2V0Q29udGVudFNpemUgZm9yIHdlYmNvbnRleHQgaXMgbm90IHlldCBpbXBsZW1lbnRlZC4gUGxlYXNlIGNvbnRhY3QgYW4gQXBwaXVtIGRldicpO1xuICB9XG5cbiAgY29uc3QgdHlwZSA9IGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKCd0eXBlJywgZWwpO1xuXG4gIGlmICh0eXBlICE9PSBcIlhDVUlFbGVtZW50VHlwZVRhYmxlXCIgJiZcbiAgICAgIHR5cGUgIT09IFwiWENVSUVsZW1lbnRUeXBlQ29sbGVjdGlvblZpZXdcIikge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgZ2V0IGNvbnRlbnQgc2l6ZSBmb3IgdHlwZSAnJHt0eXBlfScsIG9ubHkgZm9yIGAgK1xuICAgICAgICAgICAgICAgICAgICBgdGFibGVzIGFuZCBjb2xsZWN0aW9uIHZpZXdzYCk7XG4gIH1cbiAgbGV0IGxvY2F0b3IgPSBcIipcIjtcbiAgaWYgKHR5cGUgPT09IFwiWENVSUVsZW1lbnRUeXBlVGFibGVcIikge1xuICAgIC8vIG9ubHkgZmluZCB0YWJsZSBjZWxscywgbm90IGp1c3QgYW55IGNoaWxkcmVuXG4gICAgbG9jYXRvciA9IFwiWENVSUVsZW1lbnRUeXBlQ2VsbFwiO1xuICB9XG5cbiAgbGV0IGNvbnRlbnRIZWlnaHQgPSAwO1xuICBsZXQgY2hpbGRyZW4gPSBhd2FpdCB0aGlzLmZpbmRFbE9yRWxzKGBjbGFzcyBjaGFpbmAsIGxvY2F0b3IsIHRydWUsIGVsKTtcbiAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMSkge1xuICAgIC8vIGlmIHdlIGtub3cgdGhlcmUncyBvbmx5IG9uZSBlbGVtZW50LCB3ZSBjYW4gb3B0aW1pemUgdG8gbWFrZSBqdXN0IG9uZVxuICAgIC8vIGNhbGwgdG8gV0RBXG4gICAgY29uc3QgcmVjdCA9IGF3YWl0IHRoaXMuZ2V0RWxlbWVudFJlY3QoXy5oZWFkKGNoaWxkcmVuKSk7XG4gICAgY29udGVudEhlaWdodCA9IHJlY3QuaGVpZ2h0O1xuICB9IGVsc2UgaWYgKGNoaWxkcmVuLmxlbmd0aCkge1xuICAgIC8vIG90aGVyd2lzZSBpZiB3ZSBoYXZlIG11bHRpcGxlIGVsZW1lbnRzLCBsb2dpYyBkaWZmZXJzIGJhc2VkIG9uIGVsZW1lbnRcbiAgICAvLyB0eXBlXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFwiWENVSUVsZW1lbnRUeXBlVGFibGVcIjoge1xuICAgICAgICBjb25zdCBmaXJzdFJlY3QgPSBhd2FpdCB0aGlzLmdldEVsZW1lbnRSZWN0KF8uaGVhZChjaGlsZHJlbikpO1xuICAgICAgICBjb25zdCBsYXN0UmVjdCA9IGF3YWl0IHRoaXMuZ2V0RWxlbWVudFJlY3QoXy5sYXN0KGNoaWxkcmVuKSk7XG4gICAgICAgIGNvbnRlbnRIZWlnaHQgPSBsYXN0UmVjdC55ICsgbGFzdFJlY3QuaGVpZ2h0IC0gZmlyc3RSZWN0Lnk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIlhDVUlFbGVtZW50VHlwZUNvbGxlY3Rpb25WaWV3XCI6IHtcbiAgICAgICAgbGV0IGVsc0luUm93ID0gMTsgLy8gd2Uga25vdyB0aGVyZSBtdXN0IGJlIGF0IGxlYXN0IG9uZSBlbGVtZW50IGluIHRoZSByb3dcbiAgICAgICAgbGV0IGZpcnN0UmVjdCA9IGF3YWl0IHRoaXMuZ2V0RWxlbWVudFJlY3QoXy5oZWFkKGNoaWxkcmVuKSk7XG4gICAgICAgIGxldCBpbml0aWFsUmVjdHMgPSBbZmlyc3RSZWN0XTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGNvbnN0IHJlY3QgPSBhd2FpdCB0aGlzLmdldEVsZW1lbnRSZWN0KGNoaWxkcmVuW2ldKTtcbiAgICAgICAgICBpbml0aWFsUmVjdHMucHVzaChyZWN0KTtcbiAgICAgICAgICBpZiAocmVjdC55ICE9PSBmaXJzdFJlY3QueSkge1xuICAgICAgICAgICAgZWxzSW5Sb3cgPSBpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNwYWNlQmV0d2VlbkVscyA9IGluaXRpYWxSZWN0c1tlbHNJblJvd10ueSAtIGluaXRpYWxSZWN0c1tlbHNJblJvdyAtIDFdLnkgLSBpbml0aWFsUmVjdHNbZWxzSW5Sb3cgLSAxXS5oZWlnaHQ7XG4gICAgICAgIGNvbnN0IG51bVJvd3MgPSBNYXRoLmNlaWwoY2hpbGRyZW4ubGVuZ3RoIC8gZWxzSW5Sb3cpO1xuXG4gICAgICAgIC8vIGFzc3VtZSBhbGwgY2VsbHMgYXJlIHRoZSBzYW1lIGhlaWdodFxuICAgICAgICBjb250ZW50SGVpZ2h0ID0gKG51bVJvd3MgKiBmaXJzdFJlY3QuaGVpZ2h0KSArIChzcGFjZUJldHdlZW5FbHMgKiAobnVtUm93cyAtIDEpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoYFByb2dyYW1taW5nIGVycm9yOiB0eXBlICcke3R5cGV9JyB3YXMgbm90IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGB2YWxpZCBidXQgc2hvdWxkIGhhdmUgYWxyZWFkeSBiZWVuIHJlamVjdGVkYCk7XG4gICAgfVxuICB9XG4gIGNvbnN0IHNpemUgPSBhd2FpdCB0aGlzLmdldFNpemUoZWwpO1xuICBjb25zdCBvcmlnaW4gPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uSW5WaWV3KGVsKTtcbiAgLy8gYXR0cmlidXRlcyBoYXZlIHRvIGJlIHN0cmluZ3MsIHNvIHN0cmluZ2lmeSB0aGlzIHVwXG4gIHJldHVybiBKU09OLnN0cmluZ2lmeSh7XG4gICAgd2lkdGg6IHNpemUud2lkdGgsXG4gICAgaGVpZ2h0OiBzaXplLmhlaWdodCxcbiAgICB0b3A6IG9yaWdpbi55LFxuICAgIGxlZnQ6IG9yaWdpbi54LFxuICAgIHNjcm9sbGFibGVPZmZzZXQ6IGNvbnRlbnRIZWlnaHRcbiAgfSk7XG59O1xuXG5jb21tYW5kcy5pc0tleWJvYXJkU2hvd24gPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoJ2NsYXNzIG5hbWUnLCAnWENVSUVsZW1lbnRUeXBlS2V5Ym9hcmQnLCBmYWxzZSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGlnbikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcyk7XG5leHBvcnQgeyBjb21tYW5kcyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2VsZW1lbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
