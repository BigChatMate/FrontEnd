"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RPC_RESPONSE_TIMEOUT_MS = exports.REMOTE_DEBUGGER_PORT = exports.DEBUGGER_TYPES = exports.RemoteDebugger = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _events = _interopRequireDefault(require("events"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumBaseDriver = require("appium-base-driver");

var _remoteDebuggerRpcClient = _interopRequireDefault(require("./remote-debugger-rpc-client"));

var _messageHandlers = _interopRequireDefault(require("./message-handlers"));

var _helpers = require("./helpers");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

const DEBUGGER_TYPES = {
  webkit: 1,
  webinspector: 2
};
exports.DEBUGGER_TYPES = DEBUGGER_TYPES;
const SELECT_APP_RETRIES = 20;
const REMOTE_DEBUGGER_PORT = 27753;
exports.REMOTE_DEBUGGER_PORT = REMOTE_DEBUGGER_PORT;
const RPC_RESPONSE_TIMEOUT_MS = 5000;
exports.RPC_RESPONSE_TIMEOUT_MS = RPC_RESPONSE_TIMEOUT_MS;
const PAGE_READY_TIMEOUT = 5000;
const RESPONSE_LOG_LENGTH = 100;
const GARBAGE_COLLECT_TIMEOUT = 5000;

class RemoteDebugger extends _events.default.EventEmitter {
  constructor(opts = {}) {
    super();
    const bundleId = opts.bundleId,
          platformVersion = opts.platformVersion,
          _opts$debuggerType = opts.debuggerType,
          debuggerType = _opts$debuggerType === void 0 ? DEBUGGER_TYPES.webinspector : _opts$debuggerType,
          _opts$useNewSafari = opts.useNewSafari,
          useNewSafari = _opts$useNewSafari === void 0 ? false : _opts$useNewSafari,
          pageLoadMs = opts.pageLoadMs,
          host = opts.host,
          _opts$port = opts.port,
          port = _opts$port === void 0 ? REMOTE_DEBUGGER_PORT : _opts$port,
          socketPath = opts.socketPath,
          _opts$pageReadyTimeou = opts.pageReadyTimeout,
          pageReadyTimeout = _opts$pageReadyTimeou === void 0 ? PAGE_READY_TIMEOUT : _opts$pageReadyTimeou,
          remoteDebugProxy = opts.remoteDebugProxy,
          _opts$garbageCollectO = opts.garbageCollectOnExecute,
          garbageCollectOnExecute = _opts$garbageCollectO === void 0 ? true : _opts$garbageCollectO;
    this.bundleId = bundleId;
    this.platformVersion = platformVersion;
    this.debuggerType = debuggerType;

    if (this.debuggerType === DEBUGGER_TYPES.webinspector) {
      this.useNewSafari = useNewSafari;
      this.pageLoadMs = pageLoadMs;

      _logger.default.debug(`useNewSafari --> ${this.useNewSafari}`);
    }

    this.garbageCollectOnExecute = garbageCollectOnExecute;
    this.host = host;
    this.port = port;
    this.socketPath = socketPath;
    this.remoteDebugProxy = remoteDebugProxy;
    this.pageReadyTimeout = pageReadyTimeout;
  }

  setup() {
    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this.specialCbs = {
      '_rpc_reportIdentifier:': _lodash.default.noop,
      '_rpc_forwardGetListing:': this.onPageChange.bind(this),
      '_rpc_reportConnectedApplicationList:': _lodash.default.noop,
      '_rpc_applicationConnected:': this.onAppConnect.bind(this),
      '_rpc_applicationDisconnected:': this.onAppDisconnect.bind(this),
      '_rpc_applicationUpdated:': this.onAppUpdate.bind(this),
      '_rpc_reportConnectedDriverList:': this.onReportDriverList.bind(this),
      'pageLoad': this.pageLoad.bind(this),
      'frameDetached': this.frameDetached.bind(this)
    };
    this.rpcClient = null;
  }

  teardown() {
    _logger.default.debug('Cleaning up listeners');

    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this.specialCbs = {};
    this.rpcClient = null;
    this.removeAllListeners(RemoteDebugger.EVENT_PAGE_CHANGE);
    this.removeAllListeners(RemoteDebugger.EVENT_DISCONNECT);
  }

  connect() {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this.setup();

      _this.rpcClient = new _remoteDebuggerRpcClient.default({
        host: _this.host,
        port: _this.port,
        socketPath: _this.socketPath,
        specialMessageHandlers: _this.specialCbs,
        messageProxy: _this.remoteDebugProxy
      });
      yield _this.rpcClient.connect();

      try {
        let appInfo = yield _this.setConnectionKey();

        _logger.default.debug('Connected to application');

        return appInfo;
      } catch (err) {
        yield _this.disconnect();
        return null;
      }
    })();
  }

  disconnect() {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this2.rpcClient.disconnect();

      _this2.emit(RemoteDebugger.EVENT_DISCONNECT, true);

      _this2.teardown();
    })();
  }

  isConnected() {
    return !!(this.rpcClient && this.rpcClient.isConnected());
  }

  logApplicationDictionary(apps) {
    function getValueString(key, value) {
      if (_lodash.default.isFunction(value)) {
        return '[Function]';
      }

      if (key === 'pageDict' && !_lodash.default.isArray(value)) {
        return '"Waiting for data"';
      }

      return JSON.stringify(value);
    }

    _logger.default.debug('Current applications available:');

    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = _lodash.default.toPairs(apps)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        let _step$value = (0, _slicedToArray2.default)(_step.value, 2),
            app = _step$value[0],
            info = _step$value[1];

        _logger.default.debug(`    Application: '${app}'`);

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = _lodash.default.toPairs(info)[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            let _step2$value = (0, _slicedToArray2.default)(_step2.value, 2),
                key = _step2$value[0],
                value = _step2$value[1];

            let valueString = getValueString(key, value);

            _logger.default.debug(`        ${key}: ${valueString}`);
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }
  }

  setConnectionKey() {
    var _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      return yield new _bluebird.default((resolve, reject) => {
        let connectCb = apps => {
          if (_lodash.default.isUndefined(apps) || _lodash.default.keys(apps).length === 0) {
            _logger.default.debug('Received no apps from remote debugger. Unable to connect.');

            return resolve(_this3.appDict);
          }

          let newDict = {};
          var _iteratorNormalCompletion3 = true;
          var _didIteratorError3 = false;
          var _iteratorError3 = undefined;

          try {
            for (var _iterator3 = _lodash.default.values(apps)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
              let dict = _step3.value;

              let _appInfoFromDict = (0, _helpers.appInfoFromDict)(dict),
                  _appInfoFromDict2 = (0, _slicedToArray2.default)(_appInfoFromDict, 2),
                  id = _appInfoFromDict2[0],
                  entry = _appInfoFromDict2[1];

              newDict[id] = entry;
            }
          } catch (err) {
            _didIteratorError3 = true;
            _iteratorError3 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
                _iterator3.return();
              }
            } finally {
              if (_didIteratorError3) {
                throw _iteratorError3;
              }
            }
          }

          _lodash.default.defaults(_this3.appDict, newDict);

          resolve(newDict);
        };

        _this3.rpcClient.setSpecialMessageHandler('_rpc_reportConnectedApplicationList:', reject, connectCb);

        _logger.default.debug('Sending connection key request');

        return (0, _asyncToGenerator2.default)(function* () {
          let _ref2 = yield _this3.rpcClient.send('setConnectionKey'),
              _ref3 = (0, _slicedToArray2.default)(_ref2, 3),
              simNameKey = _ref3[0],
              simBuildKey = _ref3[1],
              simPlatformVersion = _ref3[2];

          _logger.default.debug(`Sim name: ${simNameKey}`);

          _logger.default.debug(`Sim build: ${simBuildKey}`);

          _logger.default.debug(`Sim platform version: ${simPlatformVersion}`);
        })();
      });
    })();
  }

  updateAppsWithDict(dict) {
    this.appDict = this.appDict || {};

    let _appInfoFromDict3 = (0, _helpers.appInfoFromDict)(dict),
        _appInfoFromDict4 = (0, _slicedToArray2.default)(_appInfoFromDict3, 2),
        id = _appInfoFromDict4[0],
        entry = _appInfoFromDict4[1];

    if (this.appDict[id]) {
      entry.pageDict = this.appDict[id].pageDict;
    }

    this.appDict[id] = entry;

    if (_lodash.default.isUndefined(entry.pageDict)) {
      entry.pageDict = (0, _helpers.deferredPromise)();
    }

    if (!this.appIdKey) {
      this.appIdKey = (0, _helpers.getDebuggerAppKey)(this.bundleId, this.platformVersion, this.appDict);
    }
  }

  selectApp(currentUrl = null, maxTries = SELECT_APP_RETRIES, ignoreAboutBlankUrl = false) {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Selecting application');

      if (!_this4.appDict || _lodash.default.keys(_this4.appDict).length === 0) {
        _logger.default.debug('No applications currently connected.');

        return [];
      }

      let pageDict, appIdKey;

      appLoop: for (let i = 0; i < maxTries; i++) {
        _this4.logApplicationDictionary(_this4.appDict);

        let possibleAppIds = (0, _helpers.getPossibleDebuggerAppKeys)(_this4.bundleId, _this4.platformVersion, _this4.appDict);

        _logger.default.debug(`Trying out the possible app ids: ${possibleAppIds.join(', ')}`);

        var _iteratorNormalCompletion4 = true;
        var _didIteratorError4 = false;
        var _iteratorError4 = undefined;

        try {
          for (var _iterator4 = possibleAppIds[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
            let attemptedAppIdKey = _step4.value;

            try {
              _logger.default.debug(`Selecting app ${attemptedAppIdKey} (try #${i + 1} of ${maxTries})`);

              var _ref4 = yield _this4.rpcClient.selectApp(attemptedAppIdKey, _this4.onAppConnect.bind(_this4));

              var _ref5 = (0, _slicedToArray2.default)(_ref4, 2);

              appIdKey = _ref5[0];
              pageDict = _ref5[1];

              if (_lodash.default.isEmpty(pageDict)) {
                _logger.default.debug('Empty page dictionary received. Trying again.');

                continue;
              }

              _this4.appDict[appIdKey].pageDict = (0, _helpers.pageArrayFromDict)(pageDict);
              let found = false;
              var _iteratorNormalCompletion5 = true;
              var _didIteratorError5 = false;
              var _iteratorError5 = undefined;

              try {
                dictLoop: for (var _iterator5 = _lodash.default.values(_this4.appDict)[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
                  const appDict = _step5.value;
                  if (found) break;

                  if (!appDict || !appDict.pageDict) {
                    continue;
                  }

                  if (appDict.pageDict.promise) {
                    try {
                      yield _bluebird.default.resolve(appDict.pageDict.promise).timeout(10000);
                    } catch (err) {
                      if (!(err instanceof _bluebird.default.TimeoutError)) {
                        throw err;
                      }

                      continue;
                    }
                  }

                  var _iteratorNormalCompletion6 = true;
                  var _didIteratorError6 = false;
                  var _iteratorError6 = undefined;

                  try {
                    for (var _iterator6 = (appDict.pageDict || [])[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
                      const dict = _step6.value;

                      if ((!ignoreAboutBlankUrl || dict.url !== 'about:blank') && (!currentUrl || dict.url === currentUrl)) {
                        appIdKey = appDict.id;
                        pageDict = dict;
                        found = true;
                        break dictLoop;
                      }
                    }
                  } catch (err) {
                    _didIteratorError6 = true;
                    _iteratorError6 = err;
                  } finally {
                    try {
                      if (!_iteratorNormalCompletion6 && _iterator6.return != null) {
                        _iterator6.return();
                      }
                    } finally {
                      if (_didIteratorError6) {
                        throw _iteratorError6;
                      }
                    }
                  }
                }
              } catch (err) {
                _didIteratorError5 = true;
                _iteratorError5 = err;
              } finally {
                try {
                  if (!_iteratorNormalCompletion5 && _iterator5.return != null) {
                    _iterator5.return();
                  }
                } finally {
                  if (_didIteratorError5) {
                    throw _iteratorError5;
                  }
                }
              }

              if (!found) {
                if (currentUrl) {
                  _logger.default.debug(`Received app, but expected url ('${currentUrl}') was not found. Trying again.`);
                } else {
                  _logger.default.debug('Received app, but no match was found. Trying again.');
                }

                pageDict = null;
                continue;
              }

              break appLoop;
            } catch (err) {
              _logger.default.debug(`Error checking application: '${err.message}'. Retrying connection`);
            }
          }
        } catch (err) {
          _didIteratorError4 = true;
          _iteratorError4 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion4 && _iterator4.return != null) {
              _iterator4.return();
            }
          } finally {
            if (_didIteratorError4) {
              throw _iteratorError4;
            }
          }
        }
      }

      if (!pageDict) {
        _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
      }

      if (_this4.appIdKey !== appIdKey) {
        _logger.default.debug(`Received altered app id, updating from '${_this4.appIdKey}' to '${appIdKey}'`);

        _this4.appIdKey = appIdKey;
      }

      const pagePromises = Object.values(_this4.appDict).filter(app => !!app.pageDict && !!app.pageDict.promise).map(app => app.pageDict.promise);

      if (pagePromises.length) {
        _logger.default.debug(`Waiting for ${pagePromises.length} pages to be fulfilled`);

        yield _bluebird.default.any([_bluebird.default.delay(30000), _bluebird.default.all(pagePromises)]);
      }

      let pageArray = (0, _helpers.pageArrayFromDict)(pageDict);

      _logger.default.debug(`Finally selecting app ${_this4.appIdKey}: ${(0, _helpers.simpleStringify)(pageArray)}`);

      let fullPageArray = [];
      var _iteratorNormalCompletion7 = true;
      var _didIteratorError7 = false;
      var _iteratorError7 = undefined;

      try {
        for (var _iterator7 = _lodash.default.toPairs(_this4.appDict)[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {
          let _step7$value = (0, _slicedToArray2.default)(_step7.value, 2),
              app = _step7$value[0],
              info = _step7$value[1];

          if (!_lodash.default.isArray(info.pageDict)) continue;
          let id = app.replace('PID:', '');
          var _iteratorNormalCompletion8 = true;
          var _didIteratorError8 = false;
          var _iteratorError8 = undefined;

          try {
            for (var _iterator8 = info.pageDict[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {
              let page = _step8.value;

              if (page.url && (!ignoreAboutBlankUrl || page.url !== 'about:blank') && (!currentUrl || page.url === currentUrl)) {
                let pageDict = _lodash.default.clone(page);

                pageDict.id = `${id}.${pageDict.id}`;
                fullPageArray.push(pageDict);
              }
            }
          } catch (err) {
            _didIteratorError8 = true;
            _iteratorError8 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion8 && _iterator8.return != null) {
                _iterator8.return();
              }
            } finally {
              if (_didIteratorError8) {
                throw _iteratorError8;
              }
            }
          }
        }
      } catch (err) {
        _didIteratorError7 = true;
        _iteratorError7 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion7 && _iterator7.return != null) {
            _iterator7.return();
          }
        } finally {
          if (_didIteratorError7) {
            throw _iteratorError7;
          }
        }
      }

      return fullPageArray;
    })();
  }

  selectPage(appIdKey, pageIdKey, skipReadyCheck = false) {
    var _this5 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this5.appIdKey = `PID:${appIdKey}`;
      _this5.pageIdKey = pageIdKey;

      _logger.default.debug(`Selecting page '${pageIdKey}' on app '${_this5.appIdKey}' and forwarding socket setup`);

      yield _this5.rpcClient.send('setSenderKey', {
        appIdKey: _this5.appIdKey,
        pageIdKey: _this5.pageIdKey
      });

      _logger.default.debug('Sender key set');

      yield _this5.rpcClient.send('enablePage', {
        appIdKey: _this5.appIdKey,
        pageIdKey: _this5.pageIdKey,
        debuggerType: _this5.debuggerType
      });

      _logger.default.debug('Enabled activity on page');

      let ready = yield _this5.checkPageIsReady();

      if (!skipReadyCheck && !ready) {
        yield _this5.pageUnload();
      }
    })();
  }

  executeAtom(atom, args, frames) {
    var _this6 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (!_this6.rpcClient.connected) throw new Error('Remote debugger is not connected');
      let script = yield (0, _helpers.getScriptForAtom)(atom, args, frames);
      let value = yield _this6.execute(script, true);

      _logger.default.debug(`Received result for atom '${atom}' execution: ${_lodash.default.truncate((0, _helpers.simpleStringify)(value), {
        length: RESPONSE_LOG_LENGTH
      })}`);

      return value;
    })();
  }

  executeAtomAsync(atom, args, frames, responseUrl) {
    var _this7 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let asyncCallBack = `function (res) { xmlHttp = new XMLHttpRequest(); ` + `xmlHttp.open('POST', '${responseUrl}', true);` + `xmlHttp.setRequestHeader('Content-type','application/json'); ` + `xmlHttp.send(res); }`;
      let script = yield (0, _helpers.getScriptForAtom)(atom, args, frames, asyncCallBack);
      yield _this7.execute(script);
    })();
  }

  frameDetached() {
    this.emit(RemoteDebugger.EVENT_FRAMES_DETACHED);
  }

  pageLoad(startPageLoadMs, pageLoadVerifyHook) {
    var _this8 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let timeoutMs = 500;
      let start = startPageLoadMs || Date.now();

      _logger.default.debug('Page loaded, verifying whether ready');

      let verify = function () {
        var _ref6 = (0, _asyncToGenerator2.default)(function* () {
          _this8.pageLoadDelay = _appiumSupport.util.cancellableDelay(timeoutMs);

          try {
            yield _this8.pageLoadDelay;
          } catch (err) {
            if (err instanceof _bluebird.default.CancellationError) {
              return;
            }
          }

          if (!_this8.appIdKey) {
            _logger.default.debug('Not connected to an application. Ignoring page load');

            return;
          }

          if (_lodash.default.isFunction(pageLoadVerifyHook)) {
            yield pageLoadVerifyHook();
          }

          let ready = yield _this8.checkPageIsReady();

          if (ready || _this8.pageLoadMs > 0 && start + _this8.pageLoadMs < Date.now()) {
            _logger.default.debug('Page is ready');

            _this8.pageLoading = false;
          } else {
            _logger.default.debug('Page was not ready, retrying');

            yield verify();
          }
        });

        return function verify() {
          return _ref6.apply(this, arguments);
        };
      }();

      yield verify();
    })();
  }

  cancelPageLoad() {
    _logger.default.debug('Unregistering from page readiness notifications');

    this.pageLoading = false;

    if (this.pageLoadDelay) {
      this.pageLoadDelay.cancel();
    }
  }

  pageUnload() {
    var _this9 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Page unloading');

      _this9.pageLoading = true;
      yield _this9.waitForDom();
    })();
  }

  waitForDom(startPageLoadMs, pageLoadVerifyHook) {
    var _this10 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Waiting for dom...');

      yield _this10.pageLoad(startPageLoadMs, pageLoadVerifyHook);
    })();
  }

  checkPageIsReady() {
    var _this11 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let errors = (0, _helpers.checkParams)({
        appIdKey: _this11.appIdKey
      });
      if (errors) throw new Error(errors);

      _logger.default.debug('Checking document readyState');

      const readyCmd = '(function (){ return document.readyState; })()';
      let readyState = 'loading';

      try {
        readyState = yield _bluebird.default.resolve(_this11.execute(readyCmd, true)).timeout(_this11.pageReadyTimeout);
      } catch (err) {
        if (!(err instanceof _bluebird.default.TimeoutError)) {
          throw err;
        }

        _logger.default.debug(`Page readiness check timed out after ${_this11.pageReadyTimeout}ms`);

        return false;
      }

      _logger.default.debug(`readyState was ${(0, _helpers.simpleStringify)(readyState)}`);

      return readyState === 'complete';
    })();
  }

  navToUrl(url, pageLoadVerifyHook) {
    var _this12 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (_this12.debuggerType === DEBUGGER_TYPES.webinspector) {
        let errors = (0, _helpers.checkParams)({
          appIdKey: _this12.appIdKey,
          pageIdKey: _this12.pageIdKey
        });
        if (errors) throw new Error(errors);
      }

      _logger.default.debug(`Navigating to new URL: ${url}`);

      yield _this12.rpcClient.send('setUrl', {
        url,
        appIdKey: _this12.appIdKey,
        pageIdKey: _this12.pageIdKey,
        debuggerType: _this12.debuggerType
      });

      if (!_this12.useNewSafari) {
        yield _bluebird.default.delay(1000);
      }

      if (_this12.debuggerType === DEBUGGER_TYPES.webinspector) {
        yield _this12.waitForFrameNavigated();
      }

      yield _this12.waitForDom(Date.now(), pageLoadVerifyHook);
    })();
  }

  waitForFrameNavigated() {
    var _this13 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      return yield new _bluebird.default(function () {
        var _ref7 = (0, _asyncToGenerator2.default)(function* (resolve, reject) {
          _logger.default.debug('Waiting for frame navigated message...');

          let startMs = Date.now();

          let navEventListener = value => {
            _logger.default.debug(`Frame navigated in ${(Date.now() - startMs) / 1000} sec from source: ${value}`);

            if (_this13.navigationDelay) {
              _this13.navigationDelay.cancel();
            }

            resolve(value);
          };

          _this13.rpcClient.setSpecialMessageHandler('Page.frameNavigated', reject, navEventListener);

          if (!_this13.useNewSafari || _this13.pageLoadMs >= 0) {
            let timeout = _this13.useNewSafari ? _this13.pageLoadMs : 500;
            _this13.navigationDelay = _appiumSupport.util.cancellableDelay(timeout);

            try {
              yield _this13.navigationDelay;
              navEventListener('timeout');
            } catch (err) {}
          }
        });

        return function (_x, _x2) {
          return _ref7.apply(this, arguments);
        };
      }());
    })();
  }

  startTimeline(fn) {
    var _this14 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Starting to record the timeline');

      _this14.rpcClient.setTimelineEventHandler(fn);

      return yield _this14.rpcClient.send('startTimeline', {
        appIdKey: _this14.appIdKey,
        pageIdKey: _this14.pageIdKey,
        debuggerType: _this14.debuggerType
      });
    })();
  }

  stopTimeline() {
    var _this15 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Stopping to record the timeline');

      yield _this15.rpcClient.send('stopTimeline', {
        appIdKey: _this15.appIdKey,
        pageIdKey: _this15.pageIdKey,
        debuggerType: _this15.debuggerType
      });
    })();
  }

  startConsole(fn) {
    var _this16 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Starting to listen for JavaScript console');

      _this16.rpcClient.setConsoleLogEventHandler(fn);

      return yield _this16.rpcClient.send('startConsole', {
        appIdKey: _this16.appIdKey,
        pageIdKey: _this16.pageIdKey,
        debuggerType: _this16.debuggerType
      });
    })();
  }

  stopConsole() {
    var _this17 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Stopping to listen for JavaScript console');

      yield _this17.rpcClient.send('stopConsole', {
        appIdKey: _this17.appIdKey,
        pageIdKey: _this17.pageIdKey,
        debuggerType: _this17.debuggerType
      });
    })();
  }

  startNetwork(fn) {
    var _this18 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Starting to listen for network events');

      _this18.rpcClient.setNetworkLogEventHandler(fn);

      return yield _this18.rpcClient.send('startNetwork', {
        appIdKey: _this18.appIdKey,
        pageIdKey: _this18.pageIdKey,
        debuggerType: _this18.debuggerType
      });
    })();
  }

  stopNetwork() {
    var _this19 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Stopping to listen for network events');

      yield _this19.rpcClient.send('stopNetwork', {
        appIdKey: _this19.appIdKey,
        pageIdKey: _this19.pageIdKey,
        debuggerType: _this19.debuggerType
      });
    })();
  }

  execute(command, override) {
    var _this20 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (_this20.pageLoading && !override) {
        _logger.default.debug('Trying to execute but page is not loaded.');

        yield _this20.waitForDom();
      }

      if (_this20.debuggerType === DEBUGGER_TYPES.webinspector) {
        let errors = (0, _helpers.checkParams)({
          appIdKey: _this20.appIdKey,
          pageIdKey: _this20.pageIdKey
        });
        if (errors) throw new Error(errors);
      }

      if (_this20.garbageCollectOnExecute) {
        yield _this20.garbageCollect();
      }

      _logger.default.debug(`Sending javascript command ${_lodash.default.truncate(command, {
        length: 50
      })}`);

      let res = yield _this20.rpcClient.send('sendJSCommand', {
        command,
        appIdKey: _this20.appIdKey,
        pageIdKey: _this20.pageIdKey,
        debuggerType: _this20.debuggerType
      });
      return _this20.convertResult(res);
    })();
  }

  callFunction(objId, fn, args) {
    var _this21 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let errors = (0, _helpers.checkParams)({
        appIdKey: _this21.appIdKey,
        pageIdKey: _this21.pageIdKey
      });
      if (errors) throw new Error(errors);

      if (_this21.garbageCollectOnExecute) {
        yield _this21.garbageCollect();
      }

      _logger.default.debug('Calling javascript function');

      let res = yield _this21.rpcClient.send('callJSFunction', {
        objId,
        fn,
        args,
        appIdKey: _this21.appIdKey,
        pageIdKey: _this21.pageIdKey,
        debuggerType: _this21.debuggerType
      });
      return _this21.convertResult(res);
    })();
  }

  convertResult(res) {
    if (_lodash.default.isUndefined(res)) {
      throw new Error(`Did not get OK result from remote debugger. Result was: ${_lodash.default.truncate((0, _helpers.simpleStringify)(res), {
        length: RESPONSE_LOG_LENGTH
      })}`);
    } else if (_lodash.default.isString(res)) {
      try {
        res = JSON.parse(res);
      } catch (err) {}
    } else if (!_lodash.default.isObject(res)) {
      throw new Error(`Result has unexpected type: (${typeof res}).`);
    }

    if (res.status && res.status !== 0) {
      throw (0, _appiumBaseDriver.errorFromCode)(res.status, res.value.message || res.value);
    }

    return res.hasOwnProperty('value') ? res.value : res;
  }

  allowNavigationWithoutReload(allow = true) {
    this.rpcClient.allowNavigationWithoutReload(allow);
  }

  getCookies(urls) {
    var _this22 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Getting network cookies');

      return yield _this22.rpcClient.send('getCookies', {
        appIdKey: _this22.appIdKey,
        pageIdKey: _this22.pageIdKey,
        debuggerType: _this22.debuggerType,
        urls
      });
    })();
  }

  deleteCookie(cookieName, url) {
    var _this23 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug(`Deleting cookie '${cookieName}' on '${url}'`);

      return yield _this23.rpcClient.send('deleteCookie', {
        appIdKey: _this23.appIdKey,
        pageIdKey: _this23.pageIdKey,
        debuggerType: _this23.debuggerType,
        cookieName,
        url
      });
    })();
  }

  garbageCollect(timeoutMs = GARBAGE_COLLECT_TIMEOUT) {
    var _this24 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug(`Garbage collecting with ${timeoutMs}ms timeout`);

      const errors = (0, _helpers.checkParams)({
        appIdKey: _this24.appIdKey,
        pageIdKey: _this24.pageIdKey
      });

      if (errors) {
        _logger.default.debug(`Unable to collect garbage at this time`);

        return;
      }

      yield _bluebird.default.resolve(_this24.rpcClient.send('garbageCollect', {
        appIdKey: _this24.appIdKey,
        pageIdKey: _this24.pageIdKey,
        debuggerType: _this24.debuggerType
      })).timeout(timeoutMs).then(function () {
        _logger.default.debug(`Garbage collection successful`);
      }).catch(function (err) {
        if (err instanceof _bluebird.default.TimeoutError) {
          _logger.default.debug(`Garbage collection timed out after ${timeoutMs}ms`);
        } else {
          _logger.default.debug(`Unable to collect garbage: ${err.message}`);
        }
      });
    })();
  }

}

exports.RemoteDebugger = RemoteDebugger;
RemoteDebugger.EVENT_PAGE_CHANGE = 'remote_debugger_page_change';
RemoteDebugger.EVENT_FRAMES_DETACHED = 'remote_debugger_frames_detached';
RemoteDebugger.EVENT_DISCONNECT = 'remote_debugger_disconnect';
var _iteratorNormalCompletion9 = true;
var _didIteratorError9 = false;
var _iteratorError9 = undefined;

try {
  for (var _iterator9 = _lodash.default.toPairs(_messageHandlers.default)[Symbol.iterator](), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {
    let _step9$value = (0, _slicedToArray2.default)(_step9.value, 2),
        name = _step9$value[0],
        handler = _step9$value[1];

    RemoteDebugger.prototype[name] = handler;
  }
} catch (err) {
  _didIteratorError9 = true;
  _iteratorError9 = err;
} finally {
  try {
    if (!_iteratorNormalCompletion9 && _iterator9.return != null) {
      _iterator9.return();
    }
  } finally {
    if (_didIteratorError9) {
      throw _iteratorError9;
    }
  }
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtZGVidWdnZXIuanMiXSwibmFtZXMiOlsiREVCVUdHRVJfVFlQRVMiLCJ3ZWJraXQiLCJ3ZWJpbnNwZWN0b3IiLCJTRUxFQ1RfQVBQX1JFVFJJRVMiLCJSRU1PVEVfREVCVUdHRVJfUE9SVCIsIlJQQ19SRVNQT05TRV9USU1FT1VUX01TIiwiUEFHRV9SRUFEWV9USU1FT1VUIiwiUkVTUE9OU0VfTE9HX0xFTkdUSCIsIkdBUkJBR0VfQ09MTEVDVF9USU1FT1VUIiwiUmVtb3RlRGVidWdnZXIiLCJldmVudHMiLCJFdmVudEVtaXR0ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJidW5kbGVJZCIsInBsYXRmb3JtVmVyc2lvbiIsImRlYnVnZ2VyVHlwZSIsInVzZU5ld1NhZmFyaSIsInBhZ2VMb2FkTXMiLCJob3N0IiwicG9ydCIsInNvY2tldFBhdGgiLCJwYWdlUmVhZHlUaW1lb3V0IiwicmVtb3RlRGVidWdQcm94eSIsImdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlIiwibG9nIiwiZGVidWciLCJzZXR1cCIsImFwcERpY3QiLCJhcHBJZEtleSIsInBhZ2VJZEtleSIsInBhZ2VMb2FkaW5nIiwic3BlY2lhbENicyIsIl8iLCJub29wIiwib25QYWdlQ2hhbmdlIiwiYmluZCIsIm9uQXBwQ29ubmVjdCIsIm9uQXBwRGlzY29ubmVjdCIsIm9uQXBwVXBkYXRlIiwib25SZXBvcnREcml2ZXJMaXN0IiwicGFnZUxvYWQiLCJmcmFtZURldGFjaGVkIiwicnBjQ2xpZW50IiwidGVhcmRvd24iLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJFVkVOVF9QQUdFX0NIQU5HRSIsIkVWRU5UX0RJU0NPTk5FQ1QiLCJjb25uZWN0IiwiUmVtb3RlRGVidWdnZXJScGNDbGllbnQiLCJzcGVjaWFsTWVzc2FnZUhhbmRsZXJzIiwibWVzc2FnZVByb3h5IiwiYXBwSW5mbyIsInNldENvbm5lY3Rpb25LZXkiLCJlcnIiLCJkaXNjb25uZWN0IiwiZW1pdCIsImlzQ29ubmVjdGVkIiwibG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5IiwiYXBwcyIsImdldFZhbHVlU3RyaW5nIiwia2V5IiwidmFsdWUiLCJpc0Z1bmN0aW9uIiwiaXNBcnJheSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b1BhaXJzIiwiYXBwIiwiaW5mbyIsInZhbHVlU3RyaW5nIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjb25uZWN0Q2IiLCJpc1VuZGVmaW5lZCIsImtleXMiLCJsZW5ndGgiLCJuZXdEaWN0IiwidmFsdWVzIiwiZGljdCIsImlkIiwiZW50cnkiLCJkZWZhdWx0cyIsInNldFNwZWNpYWxNZXNzYWdlSGFuZGxlciIsInNlbmQiLCJzaW1OYW1lS2V5Iiwic2ltQnVpbGRLZXkiLCJzaW1QbGF0Zm9ybVZlcnNpb24iLCJ1cGRhdGVBcHBzV2l0aERpY3QiLCJwYWdlRGljdCIsInNlbGVjdEFwcCIsImN1cnJlbnRVcmwiLCJtYXhUcmllcyIsImlnbm9yZUFib3V0QmxhbmtVcmwiLCJhcHBMb29wIiwiaSIsInBvc3NpYmxlQXBwSWRzIiwiam9pbiIsImF0dGVtcHRlZEFwcElkS2V5IiwiaXNFbXB0eSIsImZvdW5kIiwiZGljdExvb3AiLCJwcm9taXNlIiwidGltZW91dCIsIlRpbWVvdXRFcnJvciIsInVybCIsIm1lc3NhZ2UiLCJlcnJvckFuZFRocm93IiwicGFnZVByb21pc2VzIiwiT2JqZWN0IiwiZmlsdGVyIiwibWFwIiwiYW55IiwiZGVsYXkiLCJhbGwiLCJwYWdlQXJyYXkiLCJmdWxsUGFnZUFycmF5IiwicmVwbGFjZSIsInBhZ2UiLCJjbG9uZSIsInB1c2giLCJzZWxlY3RQYWdlIiwic2tpcFJlYWR5Q2hlY2siLCJyZWFkeSIsImNoZWNrUGFnZUlzUmVhZHkiLCJwYWdlVW5sb2FkIiwiZXhlY3V0ZUF0b20iLCJhdG9tIiwiYXJncyIsImZyYW1lcyIsImNvbm5lY3RlZCIsIkVycm9yIiwic2NyaXB0IiwiZXhlY3V0ZSIsInRydW5jYXRlIiwiZXhlY3V0ZUF0b21Bc3luYyIsInJlc3BvbnNlVXJsIiwiYXN5bmNDYWxsQmFjayIsIkVWRU5UX0ZSQU1FU19ERVRBQ0hFRCIsInN0YXJ0UGFnZUxvYWRNcyIsInBhZ2VMb2FkVmVyaWZ5SG9vayIsInRpbWVvdXRNcyIsInN0YXJ0IiwiRGF0ZSIsIm5vdyIsInZlcmlmeSIsInBhZ2VMb2FkRGVsYXkiLCJ1dGlsIiwiY2FuY2VsbGFibGVEZWxheSIsIkNhbmNlbGxhdGlvbkVycm9yIiwiY2FuY2VsUGFnZUxvYWQiLCJjYW5jZWwiLCJ3YWl0Rm9yRG9tIiwiZXJyb3JzIiwicmVhZHlDbWQiLCJyZWFkeVN0YXRlIiwibmF2VG9VcmwiLCJ3YWl0Rm9yRnJhbWVOYXZpZ2F0ZWQiLCJzdGFydE1zIiwibmF2RXZlbnRMaXN0ZW5lciIsIm5hdmlnYXRpb25EZWxheSIsInN0YXJ0VGltZWxpbmUiLCJmbiIsInNldFRpbWVsaW5lRXZlbnRIYW5kbGVyIiwic3RvcFRpbWVsaW5lIiwic3RhcnRDb25zb2xlIiwic2V0Q29uc29sZUxvZ0V2ZW50SGFuZGxlciIsInN0b3BDb25zb2xlIiwic3RhcnROZXR3b3JrIiwic2V0TmV0d29ya0xvZ0V2ZW50SGFuZGxlciIsInN0b3BOZXR3b3JrIiwiY29tbWFuZCIsIm92ZXJyaWRlIiwiZ2FyYmFnZUNvbGxlY3QiLCJyZXMiLCJjb252ZXJ0UmVzdWx0IiwiY2FsbEZ1bmN0aW9uIiwib2JqSWQiLCJpc1N0cmluZyIsInBhcnNlIiwiaXNPYmplY3QiLCJzdGF0dXMiLCJoYXNPd25Qcm9wZXJ0eSIsImFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQiLCJhbGxvdyIsImdldENvb2tpZXMiLCJ1cmxzIiwiZGVsZXRlQ29va2llIiwiY29va2llTmFtZSIsInRoZW4iLCJjYXRjaCIsIm1lc3NhZ2VIYW5kbGVycyIsIm5hbWUiLCJoYW5kbGVyIiwicHJvdG90eXBlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsY0FBYyxH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U0FBTCxDQUFlMEMsSUFBZixDQUFvQixnQkFBcEIsRUFBc0M7QUFDMUR4RCxRQUFBQSxRQUFRLEVBQUUsT0FBSSxDQUFDQSxRQUQyQztBQUUxREMsUUFBQUEsU0FBUyxFQUFFLE9BQUksQ0FBQ0EsU0FGMEM7QUFHMURkLFFBQUFBLFlBQVksRUFBRSxPQUFJLENBQUNBO0FBSHVDLE9BQXRDLENBQWhCLEVBSUZ3RixPQUpFLENBSU1zQyxTQUpOLEVBS0xnRCxJQUxLLENBS0EsWUFBWTtBQUNoQnJLLHdCQUFJQyxLQUFKLENBQVcsK0JBQVg7QUFDRCxPQVBLLEVBT0hxSyxLQVBHLENBT0csVUFBVXpJLEdBQVYsRUFBZTtBQUN0QixZQUFJQSxHQUFHLFlBQVlpQixrQkFBUWtDLFlBQTNCLEVBQXlDO0FBQ3ZDaEYsMEJBQUlDLEtBQUosQ0FBVyxzQ0FBcUNvSCxTQUFVLElBQTFEO0FBQ0QsU0FGRCxNQUVPO0FBQ0xySCwwQkFBSUMsS0FBSixDQUFXLDhCQUE2QjRCLEdBQUcsQ0FBQ3FELE9BQVEsRUFBcEQ7QUFDRDtBQUNGLE9BYkssQ0FBTjtBQVh5RDtBQXlCMUQ7O0FBMXFCOEM7OztBQThxQmpEbEcsY0FBYyxDQUFDcUMsaUJBQWYsR0FBbUMsNkJBQW5DO0FBQ0FyQyxjQUFjLENBQUNrSSxxQkFBZixHQUF1QyxpQ0FBdkM7QUFDQWxJLGNBQWMsQ0FBQ3NDLGdCQUFmLEdBQWtDLDRCQUFsQzs7Ozs7O0FBR0Esd0JBQTRCZCxnQkFBRWtDLE9BQUYsQ0FBVTZILHdCQUFWLENBQTVCLG1JQUF3RDtBQUFBO0FBQUEsUUFBOUNDLElBQThDO0FBQUEsUUFBeENDLE9BQXdDOztBQUN0RHpMLElBQUFBLGNBQWMsQ0FBQzBMLFNBQWYsQ0FBeUJGLElBQXpCLElBQWlDQyxPQUFqQztBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHJhbnNwaWxlOm1haW5cbmltcG9ydCBldmVudHMgZnJvbSAnZXZlbnRzJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgZXJyb3JGcm9tQ29kZSB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgUmVtb3RlRGVidWdnZXJScGNDbGllbnQgZnJvbSAnLi9yZW1vdGUtZGVidWdnZXItcnBjLWNsaWVudCc7XG5pbXBvcnQgbWVzc2FnZUhhbmRsZXJzIGZyb20gJy4vbWVzc2FnZS1oYW5kbGVycyc7XG5pbXBvcnQgeyBhcHBJbmZvRnJvbURpY3QsIHBhZ2VBcnJheUZyb21EaWN0LCBnZXREZWJ1Z2dlckFwcEtleSwgZ2V0UG9zc2libGVEZWJ1Z2dlckFwcEtleXMsIGNoZWNrUGFyYW1zLFxuICAgICAgICAgZ2V0U2NyaXB0Rm9yQXRvbSwgc2ltcGxlU3RyaW5naWZ5LCBkZWZlcnJlZFByb21pc2UgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgUHJvbWlzZSBmcm9tICdibHVlYmlyZCc7XG5cblxuY29uc3QgREVCVUdHRVJfVFlQRVMgPSB7XG4gIHdlYmtpdDogMSxcbiAgd2ViaW5zcGVjdG9yOiAyXG59O1xuY29uc3QgU0VMRUNUX0FQUF9SRVRSSUVTID0gMjA7XG5jb25zdCBSRU1PVEVfREVCVUdHRVJfUE9SVCA9IDI3NzUzO1xuXG4vKiBIb3cgbWFueSBtaWxsaXNlY29uZHMgdG8gd2FpdCBmb3Igd2Via2l0IHRvIHJldHVybiBhIHJlc3BvbnNlIGJlZm9yZSB0aW1pbmcgb3V0ICovXG5jb25zdCBSUENfUkVTUE9OU0VfVElNRU9VVF9NUyA9IDUwMDA7XG5cbmNvbnN0IFBBR0VfUkVBRFlfVElNRU9VVCA9IDUwMDA7XG5cbmNvbnN0IFJFU1BPTlNFX0xPR19MRU5HVEggPSAxMDA7XG5cbmNvbnN0IEdBUkJBR0VfQ09MTEVDVF9USU1FT1VUID0gNTAwMDtcblxuXG5jbGFzcyBSZW1vdGVEZWJ1Z2dlciBleHRlbmRzIGV2ZW50cy5FdmVudEVtaXR0ZXIge1xuICAvKlxuICAgKiBUaGUgY29uc3RydWN0b3IgdGFrZXMgYW4gb3B0cyBoYXNoIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICAgKiAgIC0gYnVuZGxlSWQgLSBpZCBvZiB0aGUgYXBwIGJlaW5nIGNvbm5lY3RlZCB0b1xuICAgKiAgIC0gcGxhdGZvcm1WZXJzaW9uIC0gdmVyc2lvbiBvZiBpT1NcbiAgICogICAtIGRlYnVnZ2VyVHlwZSAtIG9uZSBvZiB0aGUgREVCVUdHRVJfVFlQRVNcbiAgICogICAtIHVzZU5ld1NhZmFyaSAtIGZvciB3ZWIgaW5zcGVjdG9yLCB3aGV0aGVyIHRoaXMgaXMgYSBuZXcgU2FmYXJpIGluc3RhbmNlXG4gICAqICAgLSBwYWdlTG9hZE1zIC0gdGhlIHRpbWUsIGluIG1zLCB0aGF0IHNob3VsZCBiZSB3YWl0ZWQgZm9yIHBhZ2UgbG9hZGluZ1xuICAgKiAgIC0gaG9zdCAtIHRoZSByZW1vdGUgZGVidWdnZXIncyBob3N0IGFkZHJlc3NcbiAgICogICAtIHBvcnQgLSB0aGUgcmVtb3RlIGRlYnVnZ2VyIHBvcnQgdGhyb3VnaCB3aGljaCB0byBjb21tdW5pY2F0ZVxuICAgKi9cbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSkge1xuICAgIHN1cGVyKCk7XG5cbiAgICBjb25zdCB7XG4gICAgICBidW5kbGVJZCxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbixcbiAgICAgIGRlYnVnZ2VyVHlwZSA9IERFQlVHR0VSX1RZUEVTLndlYmluc3BlY3RvcixcbiAgICAgIHVzZU5ld1NhZmFyaSA9IGZhbHNlLFxuICAgICAgcGFnZUxvYWRNcyxcbiAgICAgIGhvc3QsXG4gICAgICBwb3J0ID0gUkVNT1RFX0RFQlVHR0VSX1BPUlQsXG4gICAgICBzb2NrZXRQYXRoLFxuICAgICAgcGFnZVJlYWR5VGltZW91dCA9IFBBR0VfUkVBRFlfVElNRU9VVCxcbiAgICAgIHJlbW90ZURlYnVnUHJveHksXG4gICAgICBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSA9IHRydWUsXG4gICAgfSA9IG9wdHM7XG5cbiAgICB0aGlzLmJ1bmRsZUlkID0gYnVuZGxlSWQ7XG4gICAgdGhpcy5wbGF0Zm9ybVZlcnNpb24gPSBwbGF0Zm9ybVZlcnNpb247XG4gICAgdGhpcy5kZWJ1Z2dlclR5cGUgPSBkZWJ1Z2dlclR5cGU7XG4gICAgaWYgKHRoaXMuZGVidWdnZXJUeXBlID09PSBERUJVR0dFUl9UWVBFUy53ZWJpbnNwZWN0b3IpIHtcbiAgICAgIHRoaXMudXNlTmV3U2FmYXJpID0gdXNlTmV3U2FmYXJpO1xuICAgICAgdGhpcy5wYWdlTG9hZE1zID0gcGFnZUxvYWRNcztcbiAgICAgIGxvZy5kZWJ1ZyhgdXNlTmV3U2FmYXJpIC0tPiAke3RoaXMudXNlTmV3U2FmYXJpfWApO1xuICAgIH1cbiAgICB0aGlzLmdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlID0gZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGU7XG5cbiAgICB0aGlzLmhvc3QgPSBob3N0O1xuICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgdGhpcy5zb2NrZXRQYXRoID0gc29ja2V0UGF0aDtcbiAgICB0aGlzLnJlbW90ZURlYnVnUHJveHkgPSByZW1vdGVEZWJ1Z1Byb3h5O1xuICAgIHRoaXMucGFnZVJlYWR5VGltZW91dCA9IHBhZ2VSZWFkeVRpbWVvdXQ7XG4gIH1cblxuICBzZXR1cCAoKSB7XG4gICAgLy8gYXBwIGhhbmRsaW5nIGNvbmZpZ3VyYXRpb25cbiAgICB0aGlzLmFwcERpY3QgPSB7fTtcbiAgICB0aGlzLmFwcElkS2V5ID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VJZEtleSA9IG51bGw7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgLy8gc2V0IHVwIHRoZSBzcGVjaWFsIGNhbGxiYWNrcyBmb3IgaGFuZGxpbmcgcmQgZXZlbnRzXG4gICAgdGhpcy5zcGVjaWFsQ2JzID0ge1xuICAgICAgJ19ycGNfcmVwb3J0SWRlbnRpZmllcjonOiBfLm5vb3AsXG4gICAgICAnX3JwY19mb3J3YXJkR2V0TGlzdGluZzonOiB0aGlzLm9uUGFnZUNoYW5nZS5iaW5kKHRoaXMpLFxuICAgICAgJ19ycGNfcmVwb3J0Q29ubmVjdGVkQXBwbGljYXRpb25MaXN0Oic6IF8ubm9vcCxcbiAgICAgICdfcnBjX2FwcGxpY2F0aW9uQ29ubmVjdGVkOic6IHRoaXMub25BcHBDb25uZWN0LmJpbmQodGhpcyksXG4gICAgICAnX3JwY19hcHBsaWNhdGlvbkRpc2Nvbm5lY3RlZDonOiB0aGlzLm9uQXBwRGlzY29ubmVjdC5iaW5kKHRoaXMpLFxuICAgICAgJ19ycGNfYXBwbGljYXRpb25VcGRhdGVkOic6IHRoaXMub25BcHBVcGRhdGUuYmluZCh0aGlzKSxcbiAgICAgICdfcnBjX3JlcG9ydENvbm5lY3RlZERyaXZlckxpc3Q6JzogdGhpcy5vblJlcG9ydERyaXZlckxpc3QuYmluZCh0aGlzKSxcbiAgICAgICdwYWdlTG9hZCc6IHRoaXMucGFnZUxvYWQuYmluZCh0aGlzKSxcbiAgICAgICdmcmFtZURldGFjaGVkJzogdGhpcy5mcmFtZURldGFjaGVkLmJpbmQodGhpcyksXG4gICAgfTtcblxuICAgIHRoaXMucnBjQ2xpZW50ID0gbnVsbDtcbiAgfVxuXG4gIHRlYXJkb3duICgpIHtcbiAgICBsb2cuZGVidWcoJ0NsZWFuaW5nIHVwIGxpc3RlbmVycycpO1xuXG4gICAgdGhpcy5hcHBEaWN0ID0ge307XG4gICAgdGhpcy5hcHBJZEtleSA9IG51bGw7XG4gICAgdGhpcy5wYWdlSWRLZXkgPSBudWxsO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSBmYWxzZTtcblxuICAgIHRoaXMuc3BlY2lhbENicyA9IHt9O1xuXG4gICAgdGhpcy5ycGNDbGllbnQgPSBudWxsO1xuXG4gICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoUmVtb3RlRGVidWdnZXIuRVZFTlRfUEFHRV9DSEFOR0UpO1xuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKFJlbW90ZURlYnVnZ2VyLkVWRU5UX0RJU0NPTk5FQ1QpO1xuICB9XG5cbiAgYXN5bmMgY29ubmVjdCAoKSB7XG4gICAgdGhpcy5zZXR1cCgpO1xuXG4gICAgLy8gaW5pdGlhbGl6ZSB0aGUgcnBjIGNsaWVudFxuICAgIHRoaXMucnBjQ2xpZW50ID0gbmV3IFJlbW90ZURlYnVnZ2VyUnBjQ2xpZW50KHtcbiAgICAgIGhvc3Q6IHRoaXMuaG9zdCxcbiAgICAgIHBvcnQ6IHRoaXMucG9ydCxcbiAgICAgIHNvY2tldFBhdGg6IHRoaXMuc29ja2V0UGF0aCxcbiAgICAgIHNwZWNpYWxNZXNzYWdlSGFuZGxlcnM6IHRoaXMuc3BlY2lhbENicyxcbiAgICAgIG1lc3NhZ2VQcm94eTogdGhpcy5yZW1vdGVEZWJ1Z1Byb3h5LFxuICAgIH0pO1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LmNvbm5lY3QoKTtcblxuICAgIC8vIGdldCB0aGUgY29ubmVjdGlvbiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgYXBwXG4gICAgdHJ5IHtcbiAgICAgIGxldCBhcHBJbmZvID0gYXdhaXQgdGhpcy5zZXRDb25uZWN0aW9uS2V5KCk7XG4gICAgICBsb2cuZGVidWcoJ0Nvbm5lY3RlZCB0byBhcHBsaWNhdGlvbicpO1xuICAgICAgcmV0dXJuIGFwcEluZm87XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBhd2FpdCB0aGlzLmRpc2Nvbm5lY3QoKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRpc2Nvbm5lY3QgKCkge1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LmRpc2Nvbm5lY3QoKTtcbiAgICB0aGlzLmVtaXQoUmVtb3RlRGVidWdnZXIuRVZFTlRfRElTQ09OTkVDVCwgdHJ1ZSk7XG4gICAgdGhpcy50ZWFyZG93bigpO1xuICB9XG5cbiAgaXNDb25uZWN0ZWQgKCkge1xuICAgIHJldHVybiAhISh0aGlzLnJwY0NsaWVudCAmJiB0aGlzLnJwY0NsaWVudC5pc0Nvbm5lY3RlZCgpKTtcbiAgfVxuXG4gIGxvZ0FwcGxpY2F0aW9uRGljdGlvbmFyeSAoYXBwcykge1xuICAgIGZ1bmN0aW9uIGdldFZhbHVlU3RyaW5nIChrZXksIHZhbHVlKSB7XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gJ1tGdW5jdGlvbl0nO1xuICAgICAgfVxuICAgICAgaWYgKGtleSA9PT0gJ3BhZ2VEaWN0JyAmJiAhXy5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gJ1wiV2FpdGluZyBmb3IgZGF0YVwiJztcbiAgICAgIH1cbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZygnQ3VycmVudCBhcHBsaWNhdGlvbnMgYXZhaWxhYmxlOicpO1xuICAgIGZvciAobGV0IFthcHAsIGluZm9dIG9mIF8udG9QYWlycyhhcHBzKSkge1xuICAgICAgbG9nLmRlYnVnKGAgICAgQXBwbGljYXRpb246ICcke2FwcH0nYCk7XG4gICAgICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgXy50b1BhaXJzKGluZm8pKSB7XG4gICAgICAgIGxldCB2YWx1ZVN0cmluZyA9IGdldFZhbHVlU3RyaW5nKGtleSwgdmFsdWUpO1xuICAgICAgICBsb2cuZGVidWcoYCAgICAgICAgJHtrZXl9OiAke3ZhbHVlU3RyaW5nfWApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNldENvbm5lY3Rpb25LZXkgKCkge1xuICAgIC8vIG9ubHkgcmVzb2x2ZSB3aGVuIHRoZSBjb25uZWN0aW9uIHJlc3BvbnNlIGlzIHJlY2VpdmVkXG4gICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8vIGxvY2FsIGNhbGxiYWNrLCBjYWxsZWQgd2hlbiB0aGUgcmVtb3RlIGRlYnVnZ2VyIGhhcyBlc3RhYmxpc2hlZFxuICAgICAgLy8gYSBjb25uZWN0aW9uIHRvIHRoZSBhcHAgdW5kZXIgdGVzdFxuICAgICAgLy8gYGFwcGAgd2lsbCBiZSBhbiBhcnJheSBvZiBkaWN0aW9uYXJpZXMgb2YgYXBwIGluZm9ybWF0aW9uXG4gICAgICBsZXQgY29ubmVjdENiID0gKGFwcHMpID0+IHtcbiAgICAgICAgaWYgKF8uaXNVbmRlZmluZWQoYXBwcykgfHwgXy5rZXlzKGFwcHMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGxvZy5kZWJ1ZygnUmVjZWl2ZWQgbm8gYXBwcyBmcm9tIHJlbW90ZSBkZWJ1Z2dlci4gVW5hYmxlIHRvIGNvbm5lY3QuJyk7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUodGhpcy5hcHBEaWN0KTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbmV3RGljdCA9IHt9O1xuXG4gICAgICAgIC8vIHRyYW5zbGF0ZSB0aGUgcmVjZWl2ZWQgaW5mb3JtYXRpb24gaW50byBhbiBlYXNpZXItdG8tbWFuYWdlXG4gICAgICAgIC8vIGhhc2ggd2l0aCBhcHAgaWQgYXMga2V5LCBhbmQgYXBwIGluZm8gYXMgdmFsdWVcbiAgICAgICAgZm9yIChsZXQgZGljdCBvZiBfLnZhbHVlcyhhcHBzKSkge1xuICAgICAgICAgIGxldCBbaWQsIGVudHJ5XSA9IGFwcEluZm9Gcm9tRGljdChkaWN0KTtcbiAgICAgICAgICBuZXdEaWN0W2lkXSA9IGVudHJ5O1xuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSB0aGUgb2JqZWN0J3MgbGlzdCBvZiBhcHBzLCBhbmQgcmV0dXJuIGl0IHRocm91Z2ggdGhlIHByb21pc2VcbiAgICAgICAgXy5kZWZhdWx0cyh0aGlzLmFwcERpY3QsIG5ld0RpY3QpO1xuICAgICAgICByZXNvbHZlKG5ld0RpY3QpO1xuICAgICAgfTtcbiAgICAgIHRoaXMucnBjQ2xpZW50LnNldFNwZWNpYWxNZXNzYWdlSGFuZGxlcignX3JwY19yZXBvcnRDb25uZWN0ZWRBcHBsaWNhdGlvbkxpc3Q6JywgcmVqZWN0LCBjb25uZWN0Q2IpO1xuXG4gICAgICBsb2cuZGVidWcoJ1NlbmRpbmcgY29ubmVjdGlvbiBrZXkgcmVxdWVzdCcpO1xuICAgICAgcmV0dXJuIChhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBbc2ltTmFtZUtleSwgc2ltQnVpbGRLZXksIHNpbVBsYXRmb3JtVmVyc2lvbl0gPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzZXRDb25uZWN0aW9uS2V5Jyk7XG4gICAgICAgIGxvZy5kZWJ1ZyhgU2ltIG5hbWU6ICR7c2ltTmFtZUtleX1gKTtcbiAgICAgICAgbG9nLmRlYnVnKGBTaW0gYnVpbGQ6ICR7c2ltQnVpbGRLZXl9YCk7XG4gICAgICAgIGxvZy5kZWJ1ZyhgU2ltIHBsYXRmb3JtIHZlcnNpb246ICR7c2ltUGxhdGZvcm1WZXJzaW9ufWApO1xuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZUFwcHNXaXRoRGljdCAoZGljdCkge1xuICAgIC8vIGdldCB0aGUgZGljdGlvbmFyeSBlbnRyeSBpbnRvIGEgbmljZSBmb3JtLCBhbmQgYWRkIGl0IHRvIHRoZVxuICAgIC8vIGFwcGxpY2F0aW9uIGRpY3Rpb25hcnlcbiAgICB0aGlzLmFwcERpY3QgPSB0aGlzLmFwcERpY3QgfHwge307XG4gICAgbGV0IFtpZCwgZW50cnldID0gYXBwSW5mb0Zyb21EaWN0KGRpY3QpO1xuICAgIGlmICh0aGlzLmFwcERpY3RbaWRdKSB7XG4gICAgICAvLyBwcmVzZXJ2ZSB0aGUgcGFnZSBkaWN0aW9uYXJ5IGZvciB0aGlzIGVudHJ5XG4gICAgICBlbnRyeS5wYWdlRGljdCA9IHRoaXMuYXBwRGljdFtpZF0ucGFnZURpY3Q7XG4gICAgfVxuICAgIHRoaXMuYXBwRGljdFtpZF0gPSBlbnRyeTtcblxuICAgIC8vIGFkZCBhIHByb21pc2UgdG8gZ2V0IHRoZSBwYWdlIGRpY3Rpb25hcnlcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChlbnRyeS5wYWdlRGljdCkpIHtcbiAgICAgIGVudHJ5LnBhZ2VEaWN0ID0gZGVmZXJyZWRQcm9taXNlKCk7XG4gICAgfVxuXG4gICAgLy8gdHJ5IHRvIGdldCB0aGUgYXBwIGlkIGZyb20gb3VyIGNvbm5lY3RlZCBhcHBzXG4gICAgaWYgKCF0aGlzLmFwcElkS2V5KSB7XG4gICAgICB0aGlzLmFwcElkS2V5ID0gZ2V0RGVidWdnZXJBcHBLZXkodGhpcy5idW5kbGVJZCwgdGhpcy5wbGF0Zm9ybVZlcnNpb24sIHRoaXMuYXBwRGljdCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VsZWN0QXBwIChjdXJyZW50VXJsID0gbnVsbCwgbWF4VHJpZXMgPSBTRUxFQ1RfQVBQX1JFVFJJRVMsIGlnbm9yZUFib3V0QmxhbmtVcmwgPSBmYWxzZSkge1xuICAgIGxvZy5kZWJ1ZygnU2VsZWN0aW5nIGFwcGxpY2F0aW9uJyk7XG4gICAgaWYgKCF0aGlzLmFwcERpY3QgfHwgXy5rZXlzKHRoaXMuYXBwRGljdCkubGVuZ3RoID09PSAwKSB7XG4gICAgICBsb2cuZGVidWcoJ05vIGFwcGxpY2F0aW9ucyBjdXJyZW50bHkgY29ubmVjdGVkLicpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8vIGl0ZXJhdGl2ZSBzb2x1dGlvbiwgYXMgcmVjdXJzaW9uIHdhcyBzd2FsbG93aW5nIHRoZSBwcm9taXNlIGF0IHNvbWUgcG9pbnRcbiAgICBsZXQgcGFnZURpY3QsIGFwcElkS2V5O1xuICAgIGFwcExvb3A6IGZvciAobGV0IGkgPSAwOyBpIDwgbWF4VHJpZXM7IGkrKykge1xuICAgICAgdGhpcy5sb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkodGhpcy5hcHBEaWN0KTtcbiAgICAgIGxldCBwb3NzaWJsZUFwcElkcyA9IGdldFBvc3NpYmxlRGVidWdnZXJBcHBLZXlzKHRoaXMuYnVuZGxlSWQsIHRoaXMucGxhdGZvcm1WZXJzaW9uLCB0aGlzLmFwcERpY3QpO1xuICAgICAgbG9nLmRlYnVnKGBUcnlpbmcgb3V0IHRoZSBwb3NzaWJsZSBhcHAgaWRzOiAke3Bvc3NpYmxlQXBwSWRzLmpvaW4oJywgJyl9YCk7XG4gICAgICBmb3IgKGxldCBhdHRlbXB0ZWRBcHBJZEtleSBvZiBwb3NzaWJsZUFwcElkcykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgU2VsZWN0aW5nIGFwcCAke2F0dGVtcHRlZEFwcElkS2V5fSAodHJ5ICMke2kgKyAxfSBvZiAke21heFRyaWVzfSlgKTtcbiAgICAgICAgICBbYXBwSWRLZXksIHBhZ2VEaWN0XSA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbGVjdEFwcChhdHRlbXB0ZWRBcHBJZEtleSwgdGhpcy5vbkFwcENvbm5lY3QuYmluZCh0aGlzKSk7XG4gICAgICAgICAgLy8gaW4gaU9TIDguMiB0aGUgY29ubmVjdCBsb2dpYyBoYXBwZW5zLCBidXQgd2l0aCBhbiBlbXB0eSBkaWN0aW9uYXJ5XG4gICAgICAgICAgLy8gd2hpY2ggbGVhZHMgdG8gdGhlIHJlbW90ZSBkZWJ1Z2dlciBnZXR0aW5nIGRpc2Nvbm5lY3RlZCwgYW5kIGludG8gYSBsb29wXG4gICAgICAgICAgaWYgKF8uaXNFbXB0eShwYWdlRGljdCkpIHtcbiAgICAgICAgICAgIGxvZy5kZWJ1ZygnRW1wdHkgcGFnZSBkaWN0aW9uYXJ5IHJlY2VpdmVkLiBUcnlpbmcgYWdhaW4uJyk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBzYXZlIHRoZSBwYWdlIGFycmF5IGZvciB0aGlzIGFwcFxuICAgICAgICAgIHRoaXMuYXBwRGljdFthcHBJZEtleV0ucGFnZURpY3QgPSBwYWdlQXJyYXlGcm9tRGljdChwYWdlRGljdCk7XG5cbiAgICAgICAgICAvLyBpZiB3ZSBhcmUgbG9va2luZyBmb3IgYSBwYXJ0aWN1bGFyIHVybCwgbWFrZSBzdXJlIHdlIGhhdmUgdGhlIHJpZ2h0IHBhZ2UuIElnbm9yZSBlbXB0eSBvciB1bmRlZmluZWQgdXJscy4gSWdub3JlIGFib3V0OmJsYW5rIGlmIHJlcXVlc3RlZC5cbiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgICBkaWN0TG9vcDogZm9yIChjb25zdCBhcHBEaWN0IG9mIF8udmFsdWVzKHRoaXMuYXBwRGljdCkpIHtcbiAgICAgICAgICAgIGlmIChmb3VuZCkgYnJlYWs7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgICAgICAgICAgaWYgKCFhcHBEaWN0IHx8ICFhcHBEaWN0LnBhZ2VEaWN0KSB7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiB0aGUgcGFnZSBkaWN0aW9uYXJ5IGhhcyBub3QgYmVlbiBsb2FkZWQgeWV0IGZyb20gdGhlIHdlYlxuICAgICAgICAgICAgLy8gaW5zcGVjdG9yLCB3YWl0IGZvciBpdCBvciB0aW1lIG91dCBhZnRlciAxMHNcbiAgICAgICAgICAgIGlmIChhcHBEaWN0LnBhZ2VEaWN0LnByb21pc2UpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLnJlc29sdmUoYXBwRGljdC5wYWdlRGljdC5wcm9taXNlKS50aW1lb3V0KDEwMDAwKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgUHJvbWlzZS5UaW1lb3V0RXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIG9uIHRpbWVvdXQsIGp1c3QgZ28gb25cbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGRpY3Qgb2YgKGFwcERpY3QucGFnZURpY3QgfHwgW10pKSB7XG4gICAgICAgICAgICAgIGlmICgoIWlnbm9yZUFib3V0QmxhbmtVcmwgfHwgZGljdC51cmwgIT09ICdhYm91dDpibGFuaycpICYmICghY3VycmVudFVybCB8fCBkaWN0LnVybCA9PT0gY3VycmVudFVybCkpIHtcbiAgICAgICAgICAgICAgICAvLyBzYXZlIHdoZXJlIHdlIGZvdW5kIHRoZSByaWdodCBwYWdlXG4gICAgICAgICAgICAgICAgYXBwSWRLZXkgPSBhcHBEaWN0LmlkO1xuICAgICAgICAgICAgICAgIHBhZ2VEaWN0ID0gZGljdDtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWsgZGljdExvb3A7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRVcmwpIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBhcHAsIGJ1dCBleHBlY3RlZCB1cmwgKCcke2N1cnJlbnRVcmx9Jykgd2FzIG5vdCBmb3VuZC4gVHJ5aW5nIGFnYWluLmApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKCdSZWNlaXZlZCBhcHAsIGJ1dCBubyBtYXRjaCB3YXMgZm91bmQuIFRyeWluZyBhZ2Fpbi4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhZ2VEaWN0ID0gbnVsbDtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIHdlIGhhdmUgZ290dGVuIHRoZSBjb3JyZWN0IGFwcGxpY2F0aW9uIGJ5IHRoaXMgcG9pbnQsIHNvIHNob3J0IGNpcmN1aXQgZXZlcnl0aGluZ1xuICAgICAgICAgIGJyZWFrIGFwcExvb3A7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgRXJyb3IgY2hlY2tpbmcgYXBwbGljYXRpb246ICcke2Vyci5tZXNzYWdlfScuIFJldHJ5aW5nIGNvbm5lY3Rpb25gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGlmLCBhZnRlciBhbGwgdGhpcywgd2UgaGF2ZSBubyBkaWN0aW9uYXJ5LCB3ZSBoYXZlIGZhaWxlZFxuICAgIGlmICghcGFnZURpY3QpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgY29ubmVjdCB0byBhIHZhbGlkIGFwcCBhZnRlciAke21heFRyaWVzfSB0cmllcy5gKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hcHBJZEtleSAhPT0gYXBwSWRLZXkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgYWx0ZXJlZCBhcHAgaWQsIHVwZGF0aW5nIGZyb20gJyR7dGhpcy5hcHBJZEtleX0nIHRvICcke2FwcElkS2V5fSdgKTtcbiAgICAgIHRoaXMuYXBwSWRLZXkgPSBhcHBJZEtleTtcbiAgICB9XG5cbiAgICAvLyB3YWl0IGZvciBhbGwgdGhlIHByb21pc2VzIGFyZSBiYWNrLCBvciAzMHMgcGFzc2VzXG4gICAgY29uc3QgcGFnZVByb21pc2VzID0gT2JqZWN0LnZhbHVlcyh0aGlzLmFwcERpY3QpXG4gICAgICAuZmlsdGVyKChhcHApID0+ICEhYXBwLnBhZ2VEaWN0ICYmICEhYXBwLnBhZ2VEaWN0LnByb21pc2UpXG4gICAgICAubWFwKChhcHApID0+IGFwcC5wYWdlRGljdC5wcm9taXNlKTtcbiAgICBpZiAocGFnZVByb21pc2VzLmxlbmd0aCkge1xuICAgICAgbG9nLmRlYnVnKGBXYWl0aW5nIGZvciAke3BhZ2VQcm9taXNlcy5sZW5ndGh9IHBhZ2VzIHRvIGJlIGZ1bGZpbGxlZGApO1xuICAgICAgYXdhaXQgUHJvbWlzZS5hbnkoW1Byb21pc2UuZGVsYXkoMzAwMDApLCBQcm9taXNlLmFsbChwYWdlUHJvbWlzZXMpXSk7XG4gICAgfVxuXG4gICAgLy8gdHJhbnNsYXRlIHRoZSBkaWN0aW9uYXJ5IGludG8gYSB1c2VmdWwgZm9ybSwgYW5kIHJldHVybiB0byBzZW5kZXJcbiAgICBsZXQgcGFnZUFycmF5ID0gcGFnZUFycmF5RnJvbURpY3QocGFnZURpY3QpO1xuICAgIGxvZy5kZWJ1ZyhgRmluYWxseSBzZWxlY3RpbmcgYXBwICR7dGhpcy5hcHBJZEtleX06ICR7c2ltcGxlU3RyaW5naWZ5KHBhZ2VBcnJheSl9YCk7XG5cbiAgICBsZXQgZnVsbFBhZ2VBcnJheSA9IFtdO1xuICAgIGZvciAobGV0IFthcHAsIGluZm9dIG9mIF8udG9QYWlycyh0aGlzLmFwcERpY3QpKSB7XG4gICAgICBpZiAoIV8uaXNBcnJheShpbmZvLnBhZ2VEaWN0KSkgY29udGludWU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICAgIGxldCBpZCA9IGFwcC5yZXBsYWNlKCdQSUQ6JywgJycpO1xuICAgICAgZm9yIChsZXQgcGFnZSBvZiBpbmZvLnBhZ2VEaWN0KSB7XG4gICAgICAgIGlmIChwYWdlLnVybCAmJiAoIWlnbm9yZUFib3V0QmxhbmtVcmwgfHwgcGFnZS51cmwgIT09ICdhYm91dDpibGFuaycpICYmICghY3VycmVudFVybCB8fCBwYWdlLnVybCA9PT0gY3VycmVudFVybCkpIHtcbiAgICAgICAgICBsZXQgcGFnZURpY3QgPSBfLmNsb25lKHBhZ2UpO1xuICAgICAgICAgIHBhZ2VEaWN0LmlkID0gYCR7aWR9LiR7cGFnZURpY3QuaWR9YDtcbiAgICAgICAgICBmdWxsUGFnZUFycmF5LnB1c2gocGFnZURpY3QpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bGxQYWdlQXJyYXk7XG4gIH1cblxuICBhc3luYyBzZWxlY3RQYWdlIChhcHBJZEtleSwgcGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayA9IGZhbHNlKSB7XG4gICAgdGhpcy5hcHBJZEtleSA9IGBQSUQ6JHthcHBJZEtleX1gO1xuICAgIHRoaXMucGFnZUlkS2V5ID0gcGFnZUlkS2V5O1xuXG4gICAgbG9nLmRlYnVnKGBTZWxlY3RpbmcgcGFnZSAnJHtwYWdlSWRLZXl9JyBvbiBhcHAgJyR7dGhpcy5hcHBJZEtleX0nIGFuZCBmb3J3YXJkaW5nIHNvY2tldCBzZXR1cGApO1xuXG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc2V0U2VuZGVyS2V5Jywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5XG4gICAgfSk7XG4gICAgbG9nLmRlYnVnKCdTZW5kZXIga2V5IHNldCcpO1xuXG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnZW5hYmxlUGFnZScsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcbiAgICBsb2cuZGVidWcoJ0VuYWJsZWQgYWN0aXZpdHkgb24gcGFnZScpO1xuXG4gICAgLy8gbWFrZSBzdXJlIGV2ZXJ5dGhpbmcgaXMgcmVhZHkgdG8gZ29cbiAgICBsZXQgcmVhZHkgPSBhd2FpdCB0aGlzLmNoZWNrUGFnZUlzUmVhZHkoKTtcbiAgICBpZiAoIXNraXBSZWFkeUNoZWNrICYmICFyZWFkeSkge1xuICAgICAgYXdhaXQgdGhpcy5wYWdlVW5sb2FkKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZUF0b20gKGF0b20sIGFyZ3MsIGZyYW1lcykge1xuICAgIGlmICghdGhpcy5ycGNDbGllbnQuY29ubmVjdGVkKSB0aHJvdyBuZXcgRXJyb3IoJ1JlbW90ZSBkZWJ1Z2dlciBpcyBub3QgY29ubmVjdGVkJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgIGxldCBzY3JpcHQgPSBhd2FpdCBnZXRTY3JpcHRGb3JBdG9tKGF0b20sIGFyZ3MsIGZyYW1lcyk7XG5cbiAgICBsZXQgdmFsdWUgPSBhd2FpdCB0aGlzLmV4ZWN1dGUoc2NyaXB0LCB0cnVlKTtcbiAgICBsb2cuZGVidWcoYFJlY2VpdmVkIHJlc3VsdCBmb3IgYXRvbSAnJHthdG9tfScgZXhlY3V0aW9uOiAke18udHJ1bmNhdGUoc2ltcGxlU3RyaW5naWZ5KHZhbHVlKSwge2xlbmd0aDogUkVTUE9OU0VfTE9HX0xFTkdUSH0pfWApO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVBdG9tQXN5bmMgKGF0b20sIGFyZ3MsIGZyYW1lcywgcmVzcG9uc2VVcmwpIHtcbiAgICBsZXQgYXN5bmNDYWxsQmFjayA9IGBmdW5jdGlvbiAocmVzKSB7IHhtbEh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgeG1sSHR0cC5vcGVuKCdQT1NUJywgJyR7cmVzcG9uc2VVcmx9JywgdHJ1ZSk7YCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgeG1sSHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LXR5cGUnLCdhcHBsaWNhdGlvbi9qc29uJyk7IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgYHhtbEh0dHAuc2VuZChyZXMpOyB9YDtcbiAgICBsZXQgc2NyaXB0ID0gYXdhaXQgZ2V0U2NyaXB0Rm9yQXRvbShhdG9tLCBhcmdzLCBmcmFtZXMsIGFzeW5jQ2FsbEJhY2spO1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZShzY3JpcHQpO1xuICB9XG5cbiAgZnJhbWVEZXRhY2hlZCAoKSB7XG4gICAgdGhpcy5lbWl0KFJlbW90ZURlYnVnZ2VyLkVWRU5UX0ZSQU1FU19ERVRBQ0hFRCk7XG4gIH1cblxuICBhc3luYyBwYWdlTG9hZCAoc3RhcnRQYWdlTG9hZE1zLCBwYWdlTG9hZFZlcmlmeUhvb2spIHtcbiAgICBsZXQgdGltZW91dE1zID0gNTAwO1xuICAgIGxldCBzdGFydCA9IHN0YXJ0UGFnZUxvYWRNcyB8fCBEYXRlLm5vdygpO1xuICAgIGxvZy5kZWJ1ZygnUGFnZSBsb2FkZWQsIHZlcmlmeWluZyB3aGV0aGVyIHJlYWR5Jyk7XG5cbiAgICBsZXQgdmVyaWZ5ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5wYWdlTG9hZERlbGF5ID0gdXRpbC5jYW5jZWxsYWJsZURlbGF5KHRpbWVvdXRNcyk7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnBhZ2VMb2FkRGVsYXk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIFByb21pc2UuQ2FuY2VsbGF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAvLyBpZiB0aGUgcHJvbWlzZSBoYXMgYmVlbiBjYW5jZWxsZWRcbiAgICAgICAgICAvLyB3ZSB3YW50IHRvIHNraXAgY2hlY2tpbmcgdGhlIHJlYWRpbmVzc1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyB3ZSBjYW4gZ2V0IHRoaXMgY2FsbGVkIGluIHRoZSBtaWRkbGUgb2YgdHJ5aW5nIHRvIGZpbmQgYSBuZXcgYXBwXG4gICAgICBpZiAoIXRoaXMuYXBwSWRLZXkpIHtcbiAgICAgICAgbG9nLmRlYnVnKCdOb3QgY29ubmVjdGVkIHRvIGFuIGFwcGxpY2F0aW9uLiBJZ25vcmluZyBwYWdlIGxvYWQnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKHBhZ2VMb2FkVmVyaWZ5SG9vaykpIHtcbiAgICAgICAgYXdhaXQgcGFnZUxvYWRWZXJpZnlIb29rKCk7XG4gICAgICB9XG5cbiAgICAgIGxldCByZWFkeSA9IGF3YWl0IHRoaXMuY2hlY2tQYWdlSXNSZWFkeSgpO1xuXG4gICAgICAvLyBpZiB3ZSBhcmUgcmVhZHksIG9yIHdlJ3ZlIHNwZW5kIHRvbyBtdWNoIHRpbWUgb24gdGhpc1xuICAgICAgaWYgKHJlYWR5IHx8ICh0aGlzLnBhZ2VMb2FkTXMgPiAwICYmIChzdGFydCArIHRoaXMucGFnZUxvYWRNcykgPCBEYXRlLm5vdygpKSkge1xuICAgICAgICBsb2cuZGVidWcoJ1BhZ2UgaXMgcmVhZHknKTtcbiAgICAgICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmRlYnVnKCdQYWdlIHdhcyBub3QgcmVhZHksIHJldHJ5aW5nJyk7XG4gICAgICAgIGF3YWl0IHZlcmlmeSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgYXdhaXQgdmVyaWZ5KCk7XG4gIH1cblxuICBjYW5jZWxQYWdlTG9hZCAoKSB7XG4gICAgbG9nLmRlYnVnKCdVbnJlZ2lzdGVyaW5nIGZyb20gcGFnZSByZWFkaW5lc3Mgbm90aWZpY2F0aW9ucycpO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5wYWdlTG9hZERlbGF5KSB7XG4gICAgICB0aGlzLnBhZ2VMb2FkRGVsYXkuY2FuY2VsKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcGFnZVVubG9hZCAoKSB7XG4gICAgbG9nLmRlYnVnKCdQYWdlIHVubG9hZGluZycpO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSB0cnVlO1xuICAgIGF3YWl0IHRoaXMud2FpdEZvckRvbSgpO1xuICB9XG5cbiAgYXN5bmMgd2FpdEZvckRvbSAoc3RhcnRQYWdlTG9hZE1zLCBwYWdlTG9hZFZlcmlmeUhvb2spIHtcbiAgICBsb2cuZGVidWcoJ1dhaXRpbmcgZm9yIGRvbS4uLicpO1xuICAgIGF3YWl0IHRoaXMucGFnZUxvYWQoc3RhcnRQYWdlTG9hZE1zLCBwYWdlTG9hZFZlcmlmeUhvb2spO1xuICB9XG5cbiAgYXN5bmMgY2hlY2tQYWdlSXNSZWFkeSAoKSB7XG4gICAgbGV0IGVycm9ycyA9IGNoZWNrUGFyYW1zKHthcHBJZEtleTogdGhpcy5hcHBJZEtleX0pO1xuICAgIGlmIChlcnJvcnMpIHRocm93IG5ldyBFcnJvcihlcnJvcnMpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICBsb2cuZGVidWcoJ0NoZWNraW5nIGRvY3VtZW50IHJlYWR5U3RhdGUnKTtcbiAgICBjb25zdCByZWFkeUNtZCA9ICcoZnVuY3Rpb24gKCl7IHJldHVybiBkb2N1bWVudC5yZWFkeVN0YXRlOyB9KSgpJztcbiAgICBsZXQgcmVhZHlTdGF0ZSA9ICdsb2FkaW5nJztcbiAgICB0cnkge1xuICAgICAgcmVhZHlTdGF0ZSA9IGF3YWl0IFByb21pc2UucmVzb2x2ZSh0aGlzLmV4ZWN1dGUocmVhZHlDbWQsIHRydWUpKS50aW1lb3V0KHRoaXMucGFnZVJlYWR5VGltZW91dCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBQcm9taXNlLlRpbWVvdXRFcnJvcikpIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgICAgbG9nLmRlYnVnKGBQYWdlIHJlYWRpbmVzcyBjaGVjayB0aW1lZCBvdXQgYWZ0ZXIgJHt0aGlzLnBhZ2VSZWFkeVRpbWVvdXR9bXNgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGByZWFkeVN0YXRlIHdhcyAke3NpbXBsZVN0cmluZ2lmeShyZWFkeVN0YXRlKX1gKTtcblxuICAgIHJldHVybiByZWFkeVN0YXRlID09PSAnY29tcGxldGUnO1xuICB9XG5cbiAgYXN5bmMgbmF2VG9VcmwgKHVybCwgcGFnZUxvYWRWZXJpZnlIb29rKSB7XG4gICAgLy8gbm8gbmVlZCB0byBkbyB0aGlzIGNoZWNrIHdoZW4gdXNpbmcgd2Via2l0XG4gICAgaWYgKHRoaXMuZGVidWdnZXJUeXBlID09PSBERUJVR0dFUl9UWVBFUy53ZWJpbnNwZWN0b3IpIHtcbiAgICAgIGxldCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXl9KTtcbiAgICAgIGlmIChlcnJvcnMpIHRocm93IG5ldyBFcnJvcihlcnJvcnMpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBOYXZpZ2F0aW5nIHRvIG5ldyBVUkw6ICR7dXJsfWApO1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3NldFVybCcsIHtcbiAgICAgIHVybCxcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcblxuICAgIGlmICghdGhpcy51c2VOZXdTYWZhcmkpIHtcbiAgICAgIC8vIGEgc21hbGwgcGF1c2UgZm9yIHRoZSBicm93c2VyIHRvIGNhdGNoIHVwXG4gICAgICBhd2FpdCBQcm9taXNlLmRlbGF5KDEwMDApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmRlYnVnZ2VyVHlwZSA9PT0gREVCVUdHRVJfVFlQRVMud2ViaW5zcGVjdG9yKSB7XG4gICAgICBhd2FpdCB0aGlzLndhaXRGb3JGcmFtZU5hdmlnYXRlZCgpO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLndhaXRGb3JEb20oRGF0ZS5ub3coKSwgcGFnZUxvYWRWZXJpZnlIb29rKTtcbiAgfVxuXG4gIGFzeW5jIHdhaXRGb3JGcmFtZU5hdmlnYXRlZCAoKSB7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGxvZy5kZWJ1ZygnV2FpdGluZyBmb3IgZnJhbWUgbmF2aWdhdGVkIG1lc3NhZ2UuLi4nKTtcbiAgICAgIGxldCBzdGFydE1zID0gRGF0ZS5ub3coKTtcblxuICAgICAgLy8gYWRkIGEgaGFuZGxlciBmb3IgdGhlIGBQYWdlLmZyYW1lTmF2aWdhdGVkYCBtZXNzYWdlXG4gICAgICAvLyBmcm9tIHRoZSByZW1vdGUgZGVidWdnZXJcbiAgICAgIGxldCBuYXZFdmVudExpc3RlbmVyID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgRnJhbWUgbmF2aWdhdGVkIGluICR7KChEYXRlLm5vdygpIC0gc3RhcnRNcykgLyAxMDAwKX0gc2VjIGZyb20gc291cmNlOiAke3ZhbHVlfWApO1xuICAgICAgICBpZiAodGhpcy5uYXZpZ2F0aW9uRGVsYXkpIHtcbiAgICAgICAgICB0aGlzLm5hdmlnYXRpb25EZWxheS5jYW5jZWwoKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHZhbHVlKTtcbiAgICAgIH07XG4gICAgICB0aGlzLnJwY0NsaWVudC5zZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIoJ1BhZ2UuZnJhbWVOYXZpZ2F0ZWQnLCByZWplY3QsIG5hdkV2ZW50TGlzdGVuZXIpO1xuXG4gICAgICAvLyB0aW1lb3V0LCBpbiBjYXNlIHJlbW90ZSBkZWJ1Z2dlciBkb2Vzbid0IHJlc3BvbmQsXG4gICAgICAvLyBvciB0YWtlcyBhIGxvbmcgdGltZVxuICAgICAgaWYgKCF0aGlzLnVzZU5ld1NhZmFyaSB8fCB0aGlzLnBhZ2VMb2FkTXMgPj0gMCkge1xuICAgICAgICAvLyB1c2UgcGFnZUxvYWRNcywgb3IgYSBzbWFsbCBhbW91bnQgb2YgdGltZVxuICAgICAgICBsZXQgdGltZW91dCA9IHRoaXMudXNlTmV3U2FmYXJpID8gdGhpcy5wYWdlTG9hZE1zIDogNTAwO1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25EZWxheSA9IHV0aWwuY2FuY2VsbGFibGVEZWxheSh0aW1lb3V0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLm5hdmlnYXRpb25EZWxheTtcbiAgICAgICAgICBuYXZFdmVudExpc3RlbmVyKCd0aW1lb3V0Jyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vIG5vdGhpbmcgdG8gZG86IHdlIG9ubHkgZ2V0IGhlcmUgaWYgdGhlIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgICAgIC8vIGFscmVhZHkgbm90aWZpZWQgb2YgZnJhbWUgbmF2aWdhdGlvbiwgYW5kIHRoZSBkZWxheVxuICAgICAgICAgIC8vIHdhcyBjYW5jZWxsZWRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRUaW1lbGluZSAoZm4pIHtcbiAgICBsb2cuZGVidWcoJ1N0YXJ0aW5nIHRvIHJlY29yZCB0aGUgdGltZWxpbmUnKTtcbiAgICB0aGlzLnJwY0NsaWVudC5zZXRUaW1lbGluZUV2ZW50SGFuZGxlcihmbik7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0YXJ0VGltZWxpbmUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICBkZWJ1Z2dlclR5cGU6IHRoaXMuZGVidWdnZXJUeXBlXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdG9wVGltZWxpbmUgKCkge1xuICAgIGxvZy5kZWJ1ZygnU3RvcHBpbmcgdG8gcmVjb3JkIHRoZSB0aW1lbGluZScpO1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0b3BUaW1lbGluZScsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0Q29uc29sZSAoZm4pIHtcbiAgICBsb2cuZGVidWcoJ1N0YXJ0aW5nIHRvIGxpc3RlbiBmb3IgSmF2YVNjcmlwdCBjb25zb2xlJyk7XG4gICAgdGhpcy5ycGNDbGllbnQuc2V0Q29uc29sZUxvZ0V2ZW50SGFuZGxlcihmbik7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0YXJ0Q29uc29sZScsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0b3BDb25zb2xlICgpIHtcbiAgICBsb2cuZGVidWcoJ1N0b3BwaW5nIHRvIGxpc3RlbiBmb3IgSmF2YVNjcmlwdCBjb25zb2xlJyk7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc3RvcENvbnNvbGUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICBkZWJ1Z2dlclR5cGU6IHRoaXMuZGVidWdnZXJUeXBlXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdGFydE5ldHdvcmsgKGZuKSB7XG4gICAgbG9nLmRlYnVnKCdTdGFydGluZyB0byBsaXN0ZW4gZm9yIG5ldHdvcmsgZXZlbnRzJyk7XG4gICAgdGhpcy5ycGNDbGllbnQuc2V0TmV0d29ya0xvZ0V2ZW50SGFuZGxlcihmbik7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0YXJ0TmV0d29yaycsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0b3BOZXR3b3JrICgpIHtcbiAgICBsb2cuZGVidWcoJ1N0b3BwaW5nIHRvIGxpc3RlbiBmb3IgbmV0d29yayBldmVudHMnKTtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzdG9wTmV0d29yaycsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGUgKGNvbW1hbmQsIG92ZXJyaWRlKSB7XG4gICAgLy8gaWYgdGhlIHBhZ2UgaXMgbm90IGxvYWRlZCB5ZXQsIHdhaXQgZm9yIGl0XG4gICAgaWYgKHRoaXMucGFnZUxvYWRpbmcgJiYgIW92ZXJyaWRlKSB7XG4gICAgICBsb2cuZGVidWcoJ1RyeWluZyB0byBleGVjdXRlIGJ1dCBwYWdlIGlzIG5vdCBsb2FkZWQuJyk7XG4gICAgICBhd2FpdCB0aGlzLndhaXRGb3JEb20oKTtcbiAgICB9XG5cbiAgICAvLyBubyBuZWVkIHRvIGNoZWNrIGVycm9ycyBpZiBpdCBpcyB3ZWJraXRcbiAgICBpZiAodGhpcy5kZWJ1Z2dlclR5cGUgPT09IERFQlVHR0VSX1RZUEVTLndlYmluc3BlY3Rvcikge1xuICAgICAgbGV0IGVycm9ycyA9IGNoZWNrUGFyYW1zKHthcHBJZEtleTogdGhpcy5hcHBJZEtleSwgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleX0pO1xuICAgICAgaWYgKGVycm9ycykgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICB9XG5cbiAgICBpZiAodGhpcy5nYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSkge1xuICAgICAgYXdhaXQgdGhpcy5nYXJiYWdlQ29sbGVjdCgpO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgU2VuZGluZyBqYXZhc2NyaXB0IGNvbW1hbmQgJHtfLnRydW5jYXRlKGNvbW1hbmQsIHtsZW5ndGg6IDUwfSl9YCk7XG4gICAgbGV0IHJlcyA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3NlbmRKU0NvbW1hbmQnLCB7XG4gICAgICBjb21tYW5kLFxuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgZGVidWdnZXJUeXBlOiB0aGlzLmRlYnVnZ2VyVHlwZVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuY29udmVydFJlc3VsdChyZXMpO1xuICB9XG5cbiAgYXN5bmMgY2FsbEZ1bmN0aW9uIChvYmpJZCwgZm4sIGFyZ3MpIHtcbiAgICBsZXQgZXJyb3JzID0gY2hlY2tQYXJhbXMoe2FwcElkS2V5OiB0aGlzLmFwcElkS2V5LCBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5fSk7XG4gICAgaWYgKGVycm9ycykgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgIGlmICh0aGlzLmdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlKSB7XG4gICAgICBhd2FpdCB0aGlzLmdhcmJhZ2VDb2xsZWN0KCk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKCdDYWxsaW5nIGphdmFzY3JpcHQgZnVuY3Rpb24nKTtcbiAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnY2FsbEpTRnVuY3Rpb24nLCB7XG4gICAgICBvYmpJZCxcbiAgICAgIGZuLFxuICAgICAgYXJncyxcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmNvbnZlcnRSZXN1bHQocmVzKTtcbiAgfVxuXG4gIGNvbnZlcnRSZXN1bHQgKHJlcykge1xuICAgIGlmIChfLmlzVW5kZWZpbmVkKHJlcykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRGlkIG5vdCBnZXQgT0sgcmVzdWx0IGZyb20gcmVtb3RlIGRlYnVnZ2VyLiBSZXN1bHQgd2FzOiAke18udHJ1bmNhdGUoc2ltcGxlU3RyaW5naWZ5KHJlcyksIHtsZW5ndGg6IFJFU1BPTlNFX0xPR19MRU5HVEh9KX1gKTtcbiAgICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcocmVzKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVzID0gSlNPTi5wYXJzZShyZXMpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIHdlIG1pZ2h0IGdldCBhIHNlcmlhbGl6ZWQgb2JqZWN0LCBidXQgd2UgbWlnaHQgbm90XG4gICAgICAgIC8vIGlmIHdlIGdldCBoZXJlLCBpdCBpcyBqdXN0IGEgdmFsdWVcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFfLmlzT2JqZWN0KHJlcykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUmVzdWx0IGhhcyB1bmV4cGVjdGVkIHR5cGU6ICgke3R5cGVvZiByZXN9KS5gKTtcbiAgICB9XG5cbiAgICBpZiAocmVzLnN0YXR1cyAmJiByZXMuc3RhdHVzICE9PSAwKSB7XG4gICAgICAvLyB3ZSBnb3Qgc29tZSBmb3JtIG9mIGVycm9yLlxuICAgICAgdGhyb3cgZXJyb3JGcm9tQ29kZShyZXMuc3RhdHVzLCByZXMudmFsdWUubWVzc2FnZSB8fCByZXMudmFsdWUpO1xuICAgIH1cblxuICAgIC8vIHdpdGggZWl0aGVyIGhhdmUgYW4gb2JqZWN0IHdpdGggYSBgdmFsdWVgIHByb3BlcnR5IChldmVuIGlmIGBudWxsYCksXG4gICAgLy8gb3IgYSBwbGFpbiBvYmplY3RcbiAgICByZXR1cm4gcmVzLmhhc093blByb3BlcnR5KCd2YWx1ZScpID8gcmVzLnZhbHVlIDogcmVzO1xuICB9XG5cbiAgYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCAoYWxsb3cgPSB0cnVlKSB7XG4gICAgdGhpcy5ycGNDbGllbnQuYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZChhbGxvdyk7XG4gIH1cblxuICBhc3luYyBnZXRDb29raWVzICh1cmxzKSB7XG4gICAgbG9nLmRlYnVnKCdHZXR0aW5nIG5ldHdvcmsgY29va2llcycpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdnZXRDb29raWVzJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgZGVidWdnZXJUeXBlOiB0aGlzLmRlYnVnZ2VyVHlwZSxcbiAgICAgIHVybHMsXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVDb29raWUgKGNvb2tpZU5hbWUsIHVybCkge1xuICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgY29va2llICcke2Nvb2tpZU5hbWV9JyBvbiAnJHt1cmx9J2ApO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdkZWxldGVDb29raWUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICBkZWJ1Z2dlclR5cGU6IHRoaXMuZGVidWdnZXJUeXBlLFxuICAgICAgY29va2llTmFtZSxcbiAgICAgIHVybCxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGdhcmJhZ2VDb2xsZWN0ICh0aW1lb3V0TXMgPSBHQVJCQUdFX0NPTExFQ1RfVElNRU9VVCkge1xuICAgIGxvZy5kZWJ1ZyhgR2FyYmFnZSBjb2xsZWN0aW5nIHdpdGggJHt0aW1lb3V0TXN9bXMgdGltZW91dGApO1xuICAgIGNvbnN0IGVycm9ycyA9IGNoZWNrUGFyYW1zKHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICB9KTtcbiAgICBpZiAoZXJyb3JzKSB7XG4gICAgICBsb2cuZGVidWcoYFVuYWJsZSB0byBjb2xsZWN0IGdhcmJhZ2UgYXQgdGhpcyB0aW1lYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgYXdhaXQgUHJvbWlzZS5yZXNvbHZlKHRoaXMucnBjQ2xpZW50LnNlbmQoJ2dhcmJhZ2VDb2xsZWN0Jywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgZGVidWdnZXJUeXBlOiB0aGlzLmRlYnVnZ2VyVHlwZVxuICAgIH0pKS50aW1lb3V0KHRpbWVvdXRNcylcbiAgICAudGhlbihmdW5jdGlvbiAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgICAgbG9nLmRlYnVnKGBHYXJiYWdlIGNvbGxlY3Rpb24gc3VjY2Vzc2Z1bGApO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by1jYWxsYmFja3NcbiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBQcm9taXNlLlRpbWVvdXRFcnJvcikge1xuICAgICAgICBsb2cuZGVidWcoYEdhcmJhZ2UgY29sbGVjdGlvbiB0aW1lZCBvdXQgYWZ0ZXIgJHt0aW1lb3V0TXN9bXNgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVW5hYmxlIHRvIGNvbGxlY3QgZ2FyYmFnZTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG4vLyBldmVudCBlbWl0dGVkIHB1YmxpY2FsbHlcblJlbW90ZURlYnVnZ2VyLkVWRU5UX1BBR0VfQ0hBTkdFID0gJ3JlbW90ZV9kZWJ1Z2dlcl9wYWdlX2NoYW5nZSc7XG5SZW1vdGVEZWJ1Z2dlci5FVkVOVF9GUkFNRVNfREVUQUNIRUQgPSAncmVtb3RlX2RlYnVnZ2VyX2ZyYW1lc19kZXRhY2hlZCc7XG5SZW1vdGVEZWJ1Z2dlci5FVkVOVF9ESVNDT05ORUNUID0gJ3JlbW90ZV9kZWJ1Z2dlcl9kaXNjb25uZWN0JztcblxuLy8gYWRkIGdlbmVyaWMgY2FsbGJhY2tzXG5mb3IgKGxldCBbbmFtZSwgaGFuZGxlcl0gb2YgXy50b1BhaXJzKG1lc3NhZ2VIYW5kbGVycykpIHtcbiAgUmVtb3RlRGVidWdnZXIucHJvdG90eXBlW25hbWVdID0gaGFuZGxlcjtcbn1cblxuZXhwb3J0IHtcbiAgUmVtb3RlRGVidWdnZXIsIERFQlVHR0VSX1RZUEVTLCBSRU1PVEVfREVCVUdHRVJfUE9SVCwgUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVMsXG59O1xuIl0sImZpbGUiOiJsaWIvcmVtb3RlLWRlYnVnZ2VyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
