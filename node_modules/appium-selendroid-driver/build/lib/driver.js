"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DEVICE_PORT = exports.SelendroidDriver = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumBaseDriver = require("appium-base-driver");

var _selendroid = _interopRequireDefault(require("./selendroid"));

var _appiumSupport = require("appium-support");

var _installer = require("./installer");

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("./logger"));

var _commands = _interopRequireDefault(require("./commands"));

var _appiumAdb = require("appium-adb");

var _helpers = _interopRequireDefault(require("./helpers"));

var _appiumAndroidDriver = require("appium-android-driver");

var _desiredCaps = _interopRequireDefault(require("./desired-caps"));

let helpers = {};
Object.assign(helpers, _helpers.default, _appiumAndroidDriver.androidHelpers);
const SYSTEM_PORT_RANGE = [8200, 8299];
const DEVICE_PORT = 8080;
exports.DEVICE_PORT = DEVICE_PORT;
const NO_PROXY = [['GET', new RegExp('^/session/[^/]+/log/types$')], ['POST', new RegExp('^/session/[^/]+/log')], ['POST', new RegExp('^/session/[^/]+/location')], ['POST', new RegExp('^/session/[^/]+/appium')], ['GET', new RegExp('^/session/[^/]+/appium')], ['POST', new RegExp('^/session/[^/]+/context')], ['GET', new RegExp('^/session/[^/]+/context')], ['GET', new RegExp('^/session/[^/]+/contexts')], ['POST', new RegExp('^/session/[^/]+/element/[^/]+/value')], ['GET', new RegExp('^/session/[^/]+/element/[^/]+/rect')], ['GET', new RegExp('^/session/[^/]+/network_connection')], ['POST', new RegExp('^/session/[^/]+/network_connection')], ['POST', new RegExp('^/session/[^/]+/ime')], ['GET', new RegExp('^/session/[^/]+/ime')], ['POST', new RegExp('^/session/[^/]+/keys')], ['POST', new RegExp('^/session/[^/]+/touch/multi/perform')]];
const APP_EXTENSION = '.apk';

class SelendroidDriver extends _appiumBaseDriver.BaseDriver {
  constructor(opts = {}, shouldValidateCaps = true) {
    delete opts.shell;
    super(opts, shouldValidateCaps);
    this.desiredCapConstraints = _desiredCaps.default;
    this.selendroid = null;
    this.jwpProxyActive = false;
    this.defaultIME = null;
    this.jwpProxyAvoid = NO_PROXY;
    this.apkStrings = {};
    this.chromedriver = null;
    this.sessionChromedrivers = {};
    this.opts.systemPort = opts.selendroidPort || SYSTEM_PORT_RANGE[0];
    this.opts.adbPort = opts.adbPort || _appiumAdb.DEFAULT_ADB_PORT;
  }

  createSession(caps) {
    var _this = this,
        _superprop_callCreateSession = (..._args) => super.createSession(..._args);

    return (0, _asyncToGenerator2.default)(function* () {
      try {
        if (!(yield (0, _installer.serverExists)())) {
          throw new Error('Cannot start a selendroid session because the server ' + 'apk does not exist. Please run `npm run-script ' + 'selendroid` in the appium-selendroid-driver package');
        }

        let sessionId;

        var _ref = yield _superprop_callCreateSession(caps);

        var _ref2 = (0, _slicedToArray2.default)(_ref, 1);

        sessionId = _ref2[0];
        _this.curContext = _this.defaultContextName();
        _this.opts.app = yield _this.helpers.configureApp(_this.opts.app, APP_EXTENSION);
        yield _this.checkAppPresent();
        _this.opts.systemPort = _this.opts.selendroidPort || SYSTEM_PORT_RANGE[0];
        _this.opts.adbPort = _this.opts.adbPort || _appiumAdb.DEFAULT_ADB_PORT;
        yield _this.startSelendroidSession();
        return [sessionId, caps];
      } catch (e) {
        yield _this.deleteSession();
        throw e;
      }
    })();
  }

  validateDesiredCaps(caps) {
    let res = super.validateDesiredCaps(caps);
    if (!res) return res;

    if (this.opts.reboot) {
      this.setAvdFromCapabilities(caps);
    }
  }

  setAvdFromCapabilities(caps) {
    if (this.opts.avd) {
      _logger.default.info('avd name defined, ignoring device name and platform version');
    } else {
      if (!caps.deviceName) {
        _logger.default.errorAndThrow('avd or deviceName should be specified when reboot option is enabled');
      }

      if (!caps.platformVersion) {
        _logger.default.errorAndThrow('avd or platformVersion should be specified when reboot option is enabled');
      }

      let avdDevice = caps.deviceName.replace(/[^a-zA-Z0-9_.]/g, "-");
      this.opts.avd = `${avdDevice}__${caps.platformVersion}`;
    }
  }

  get driverData() {
    return {};
  }

  isEmulator() {
    return !!this.opts.avd;
  }

  startSelendroidSession() {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (!_this2.opts.javaVersion) {
        _this2.opts.javaVersion = yield helpers.getJavaVersion();
      }

      let _ref3 = yield helpers.getDeviceInfoFromCaps(_this2.opts),
          udid = _ref3.udid,
          emPort = _ref3.emPort;

      _this2.opts.udid = udid;
      _this2.opts.emPort = emPort;
      _this2.adb = yield _appiumAndroidDriver.androidHelpers.createADB(_this2.opts);
      yield helpers.ensureInternetPermissionForApp(_this2.adb, _this2.opts.app);
      let appInfo = yield helpers.getLaunchInfo(_this2.adb, _this2.opts);
      Object.assign(_this2.opts, appInfo);
      yield _this2.initSelendroidServer();
      yield helpers.initDevice(_this2.adb, _this2.opts);
      yield _this2.adb.forwardPort(_this2.opts.systemPort, DEVICE_PORT);
      yield _this2.initAUT();
      yield helpers.unlock(_this2, _this2.adb, _this2.caps);
      yield _this2.selendroid.startSession(_this2.caps);
      yield _this2.ensureAppStarts();

      if (_this2.opts.autoWebview) {
        yield (0, _asyncbox.retryInterval)(20, _this2.opts.autoWebviewTimeout || 2000, (0, _asyncToGenerator2.default)(function* () {
          yield _this2.setContext(_this2.defaultWebviewName());
        }));
      }

      _this2.jwpProxyActive = true;
    })();
  }

  initSelendroidServer() {
    var _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this3.selendroid = new _selendroid.default({
        host: _this3.opts.host || 'localhost',
        systemPort: _this3.opts.systemPort,
        devicePort: DEVICE_PORT,
        adb: _this3.adb,
        apk: _this3.opts.app,
        tmpDir: _this3.opts.tmpDir,
        appPackage: _this3.opts.appPackage,
        appActivity: _this3.opts.appActivity
      });
      _this3.proxyReqRes = _this3.selendroid.proxyReqRes.bind(_this3.selendroid);
      yield _this3.selendroid.prepareModifiedServer();
    })();
  }

  initAUT() {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Initializing application under test');

      _this4.apkStrings[_this4.opts.language] = yield helpers.pushStrings(_this4.opts.language, _this4.adb, _this4.opts);

      if (!_this4.opts.skipUninstall) {
        yield _this4.adb.uninstallApk(_this4.opts.appPackage);
      }

      if (!_this4.opts.noSign) {
        let signed = yield _this4.adb.checkApkCert(_this4.opts.app, _this4.opts.appPackage);

        if (!signed) {
          _logger.default.debug('Application not signed. Signing.');

          yield _this4.adb.sign(_this4.opts.app, _this4.opts.appPackage);
        }
      }

      yield helpers.installApk(_this4.adb, _this4.opts);
      yield _this4.selendroid.installModifiedServer();
    })();
  }

  ensureAppStarts() {
    var _this5 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let appWaitPackage = _this5.opts.appWaitPackage || _this5.opts.appPackage;
      let appWaitActivity = _this5.opts.appWaitActivity || _this5.opts.appActivity;

      try {
        yield _this5.adb.waitForActivity(appWaitPackage, appWaitActivity, 5000);
      } catch (e) {
        _logger.default.info(`Selendroid did not start the activity we were waiting for, ` + `'${appWaitPackage}/${appWaitActivity}'. ` + `Starting it ourselves`);

        yield _this5.adb.startApp({
          pkg: _this5.opts.appPackage,
          activity: _this5.opts.appActivity,
          action: _this5.opts.intentAction,
          category: _this5.opts.intentCategory,
          flags: _this5.opts.intentFlags,
          waitPkg: _this5.opts.appWaitPackage,
          waitActivity: _this5.opts.appWaitActivity,
          optionalIntentArguments: _this5.opts.optionalIntentArguments,
          stopApp: !_this5.opts.dontStopAppOnReset,
          retry: false
        });
      }
    })();
  }

  deleteSession() {
    var _this6 = this,
        _superprop_callDeleteSession = (..._args2) => super.deleteSession(..._args2);

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Deleting Selendroid session');

      if (_this6.selendroid) {
        if (_this6.jwpProxyActive) {
          yield _this6.selendroid.deleteSession();
        }

        _this6.selendroid = null;
      }

      _this6.jwpProxyActive = false;

      if (_this6.adb) {
        if (_this6.opts.unicodeKeyboard && _this6.opts.resetKeyboard && _this6.defaultIME) {
          _logger.default.debug(`Resetting IME to '${_this6.defaultIME}'`);

          yield _this6.adb.setIME(_this6.defaultIME);
        }

        yield _this6.adb.forceStop(_this6.opts.appPackage);
        yield _this6.adb.stopLogcat();

        if (_this6.opts.reboot) {
          let avdName = _this6.opts.avd.replace('@', '');

          _logger.default.debug(`closing emulator '${avdName}'`);

          yield _this6.adb.killEmulator(avdName);
        }
      }

      yield _superprop_callDeleteSession();
    })();
  }

  checkAppPresent() {
    var _this7 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Checking whether app is actually present');

      if (!(yield _appiumSupport.fs.exists(_this7.opts.app))) {
        _logger.default.errorAndThrow(`Could not find app apk at '${_this7.opts.app}'`);
      }
    })();
  }

  defaultWebviewName() {
    return `${_appiumAndroidDriver.WEBVIEW_BASE}0`;
  }

  proxyActive(sessionId) {
    super.proxyActive(sessionId);
    return true;
  }

  getProxyAvoidList(sessionId) {
    super.getProxyAvoidList(sessionId);
    return this.jwpProxyAvoid;
  }

  canProxy(sessionId) {
    super.canProxy(sessionId);
    return true;
  }

}

exports.SelendroidDriver = SelendroidDriver;
var _iteratorNormalCompletion = true;
var _didIteratorError = false;
var _iteratorError = undefined;

try {
  for (var _iterator = _lodash.default.toPairs(_appiumAndroidDriver.androidCommands)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
    let _step$value = (0, _slicedToArray2.default)(_step.value, 2),
        cmd = _step$value[0],
        fn = _step$value[1];

    if (!_lodash.default.includes(['defaultWebviewName'], cmd)) {
      SelendroidDriver.prototype[cmd] = fn;
    }
  }
} catch (err) {
  _didIteratorError = true;
  _iteratorError = err;
} finally {
  try {
    if (!_iteratorNormalCompletion && _iterator.return != null) {
      _iterator.return();
    }
  } finally {
    if (_didIteratorError) {
      throw _iteratorError;
    }
  }
}

var _iteratorNormalCompletion2 = true;
var _didIteratorError2 = false;
var _iteratorError2 = undefined;

try {
  for (var _iterator2 = _lodash.default.toPairs(_commands.default)[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
    let _step2$value = (0, _slicedToArray2.default)(_step2.value, 2),
        cmd = _step2$value[0],
        fn = _step2$value[1];

    SelendroidDriver.prototype[cmd] = fn;
  }
} catch (err) {
  _didIteratorError2 = true;
  _iteratorError2 = err;
} finally {
  try {
    if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
      _iterator2.return();
    }
  } finally {
    if (_didIteratorError2) {
      throw _iteratorError2;
    }
  }
}

var _default = SelendroidDriver;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kcml2ZXIuanMiXSwibmFtZXMiOlsiaGVscGVycyIsIk9iamVjdCIsImFzc2lnbiIsInNlbGVuZHJvaWRIZWxwZXJzIiwiYW5kcm9pZEhlbHBlcnMiLCJTWVNURU1fUE9SVF9SQU5HRSIsIkRFVklDRV9QT1JUIiwiTk9fUFJPWFkiLCJSZWdFeHAiLCJBUFBfRVhURU5TSU9OIiwiU2VsZW5kcm9pZERyaXZlciIsIkJhc2VEcml2ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJzaG91bGRWYWxpZGF0ZUNhcHMiLCJzaGVsbCIsImRlc2lyZWRDYXBDb25zdHJhaW50cyIsInNlbGVuZHJvaWQiLCJqd3BQcm94eUFjdGl2ZSIsImRlZmF1bHRJTUUiLCJqd3BQcm94eUF2b2lkIiwiYXBrU3RyaW5ncyIsImNocm9tZWRyaXZlciIsInNlc3Npb25DaHJvbWVkcml2ZXJzIiwic3lzdGVtUG9ydCIsInNlbGVuZHJvaWRQb3J0IiwiYWRiUG9ydCIsIkRFRkFVTFRfQURCX1BPUlQiLCJjcmVhdGVTZXNzaW9uIiwiY2FwcyIsIkVycm9yIiwic2Vzc2lvbklkIiwiY3VyQ29udGV4dCIsImRlZmF1bHRDb250ZXh0TmFtZSIsImFwcCIsImNvbmZpZ3VyZUFwcCIsImNoZWNrQXBwUHJlc2VudCIsInN0YXJ0U2VsZW5kcm9pZFNlc3Npb24iLCJlIiwiZGVsZXRlU2Vzc2lvbiIsInZhbGlkYXRlRGVzaXJlZENhcHMiLCJyZXMiLCJyZWJvb3QiLCJzZXRBdmRGcm9tQ2FwYWJpbGl0aWVzIiwiYXZkIiwibG9nZ2VyIiwiaW5mbyIsImRldmljZU5hbWUiLCJlcnJvckFuZFRocm93IiwicGxhdGZvcm1WZXJzaW9uIiwiYXZkRGV2aWNlIiwicmVwbGFjZSIsImRyaXZlckRhdGEiLCJpc0VtdWxhdG9yIiwiamF2YVZlcnNpb24iLCJnZXRKYXZhVmVyc2lvbiIsImdldERldmljZUluZm9Gcm9tQ2FwcyIsInVkaWQiLCJlbVBvcnQiLCJhZGIiLCJjcmVhdGVBREIiLCJlbnN1cmVJbnRlcm5ldFBlcm1pc3Npb25Gb3JBcHAiLCJhcHBJbmZvIiwiZ2V0TGF1bmNoSW5mbyIsImluaXRTZWxlbmRyb2lkU2VydmVyIiwiaW5pdERldmljZSIsImZvcndhcmRQb3J0IiwiaW5pdEFVVCIsInVubG9jayIsInN0YXJ0U2Vzc2lvbiIsImVuc3VyZUFwcFN0YXJ0cyIsImF1dG9XZWJ2aWV3IiwiYXV0b1dlYnZpZXdUaW1lb3V0Iiwic2V0Q29udGV4dCIsImRlZmF1bHRXZWJ2aWV3TmFtZSIsIlNlbGVuZHJvaWRTZXJ2ZXIiLCJob3N0IiwiZGV2aWNlUG9ydCIsImFwayIsInRtcERpciIsImFwcFBhY2thZ2UiLCJhcHBBY3Rpdml0eSIsInByb3h5UmVxUmVzIiwiYmluZCIsInByZXBhcmVNb2RpZmllZFNlcnZlciIsImRlYnVnIiwibGFuZ3VhZ2UiLCJwdXNoU3RyaW5ncyIsInNraXBVbmluc3RhbGwiLCJ1bmluc3RhbGxBcGsiLCJub1NpZ24iLCJzaWduZWQiLCJjaGVja0Fwa0NlcnQiLCJzaWduIiwiaW5zdGFsbEFwayIsImluc3RhbGxNb2RpZmllZFNlcnZlciIsImFwcFdhaXRQYWNrYWdlIiwiYXBwV2FpdEFjdGl2aXR5Iiwid2FpdEZvckFjdGl2aXR5Iiwic3RhcnRBcHAiLCJwa2ciLCJhY3Rpdml0eSIsImFjdGlvbiIsImludGVudEFjdGlvbiIsImNhdGVnb3J5IiwiaW50ZW50Q2F0ZWdvcnkiLCJmbGFncyIsImludGVudEZsYWdzIiwid2FpdFBrZyIsIndhaXRBY3Rpdml0eSIsIm9wdGlvbmFsSW50ZW50QXJndW1lbnRzIiwic3RvcEFwcCIsImRvbnRTdG9wQXBwT25SZXNldCIsInJldHJ5IiwidW5pY29kZUtleWJvYXJkIiwicmVzZXRLZXlib2FyZCIsInNldElNRSIsImZvcmNlU3RvcCIsInN0b3BMb2djYXQiLCJhdmROYW1lIiwia2lsbEVtdWxhdG9yIiwiZnMiLCJleGlzdHMiLCJXRUJWSUVXX0JBU0UiLCJwcm94eUFjdGl2ZSIsImdldFByb3h5QXZvaWRMaXN0IiwiY2FuUHJveHkiLCJfIiwidG9QYWlycyIsImFuZHJvaWRDb21tYW5kcyIsImNtZCIsImZuIiwiaW5jbHVkZXMiLCJwcm90b3R5cGUiLCJjb21tYW5kcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLElBQUlBLE9BQU8sR0FBRyxFQUFkO0FBQ0FDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjRixPQUFkLEVBQXVCRyxnQkFBdkIsRUFBMENDLG1DQUExQztBQUlBLE1BQU1DLGlCQUFpQixHQUFHLENBQUMsSUFBRCxFQUFPLElBQVAsQ0FBMUI7QUFJQSxNQUFNQyxXQUFXLEdBQUcsSUFBcEI7O0FBR0EsTUFBTUMsUUFBUSxHQUFHLENBQ2YsQ0FBQyxLQUFELEVBQVEsSUFBSUMsTUFBSixDQUFXLDRCQUFYLENBQVIsQ0FEZSxFQUVmLENBQUMsTUFBRCxFQUFTLElBQUlBLE1BQUosQ0FBVyxxQkFBWCxDQUFULENBRmUsRUFHZixDQUFDLE1BQUQsRUFBUyxJQUFJQSxNQUFKLENBQVcsMEJBQVgsQ0FBVCxDQUhlLEVBSWYsQ0FBQyxNQUFELEVBQVMsSUFBSUEsTUFBSixDQUFXLHdCQUFYLENBQVQsQ0FKZSxFQUtmLENBQUMsS0FBRCxFQUFRLElBQUlBLE1BQUosQ0FBVyx3QkFBWCxDQUFSLENBTGUsRUFNZixDQUFDLE1BQUQsRUFBUyxJQUFJQSxNQUFKLENBQVcseUJBQVgsQ0FBVCxDQU5lLEVBT2YsQ0FBQyxLQUFELEVBQVEsSUFBSUEsTUFBSixDQUFXLHlCQUFYLENBQVIsQ0FQZSxFQVFmLENBQUMsS0FBRCxFQUFRLElBQUlBLE1BQUosQ0FBVywwQkFBWCxDQUFSLENBUmUsRUFTZixDQUFDLE1BQUQsRUFBUyxJQUFJQSxNQUFKLENBQVcscUNBQVgsQ0FBVCxDQVRlLEVBVWYsQ0FBQyxLQUFELEVBQVEsSUFBSUEsTUFBSixDQUFXLG9DQUFYLENBQVIsQ0FWZSxFQVdmLENBQUMsS0FBRCxFQUFRLElB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QUFDNUN4SCxNQUFBQSxnQkFBZ0IsQ0FBQzJILFNBQWpCLENBQTJCSCxHQUEzQixJQUFrQ0MsRUFBbEM7QUFDRDtBQUNGOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFHRCx3QkFBc0JKLGdCQUFFQyxPQUFGLENBQVVNLGlCQUFWLENBQXRCLG1JQUEyQztBQUFBO0FBQUEsUUFBakNKLEdBQWlDO0FBQUEsUUFBNUJDLEVBQTRCOztBQUN6Q3pILElBQUFBLGdCQUFnQixDQUFDMkgsU0FBakIsQ0FBMkJILEdBQTNCLElBQWtDQyxFQUFsQztBQUNEOzs7Ozs7Ozs7Ozs7Ozs7O2VBR2N6SCxnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBCYXNlRHJpdmVyIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBTZWxlbmRyb2lkU2VydmVyIGZyb20gJy4vc2VsZW5kcm9pZCc7XG5pbXBvcnQgeyBmcyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IHNlcnZlckV4aXN0cyB9IGZyb20gJy4vaW5zdGFsbGVyJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBjb21tYW5kcyBmcm9tICcuL2NvbW1hbmRzJztcbmltcG9ydCB7IERFRkFVTFRfQURCX1BPUlQgfSBmcm9tICdhcHBpdW0tYWRiJztcbmltcG9ydCBzZWxlbmRyb2lkSGVscGVycyBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgYW5kcm9pZEhlbHBlcnMsIGFuZHJvaWRDb21tYW5kcywgV0VCVklFV19CQVNFIH0gZnJvbSAnYXBwaXVtLWFuZHJvaWQtZHJpdmVyJztcbmltcG9ydCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgZnJvbSAnLi9kZXNpcmVkLWNhcHMnO1xuXG5cbmxldCBoZWxwZXJzID0ge307XG5PYmplY3QuYXNzaWduKGhlbHBlcnMsIHNlbGVuZHJvaWRIZWxwZXJzLCBhbmRyb2lkSGVscGVycyk7XG5cbi8vIFRoZSByYW5nZSBvZiBwb3J0cyB3ZSBjYW4gdXNlIG9uIHRoZSBzeXN0ZW0gZm9yIGNvbW11bmljYXRpbmcgdG8gdGhlXG4vLyBTZWxlbmRyb2lkIEhUVFAgc2VydmVyIG9uIHRoZSBkZXZpY2VcbmNvbnN0IFNZU1RFTV9QT1JUX1JBTkdFID0gWzgyMDAsIDgyOTldO1xuXG4vLyBUaGlzIGlzIHRoZSBwb3J0IHRoYXQgU2VsZW5kcm9pZCBsaXN0ZW5zIHRvIG9uIHRoZSBkZXZpY2UuIFdlIHdpbGwgZm9yd2FyZFxuLy8gb25lIG9mIHRoZSBwb3J0cyBhYm92ZSBvbiB0aGUgc3lzdGVtIHRvIHRoaXMgcG9ydCBvbiB0aGUgZGV2aWNlLlxuY29uc3QgREVWSUNFX1BPUlQgPSA4MDgwO1xuXG4vLyBUaGlzIGlzIGEgc2V0IG9mIG1ldGhvZHMgYW5kIHBhdGhzIHRoYXQgd2UgbmV2ZXIgd2FudCB0byBwcm94eSB0byBTZWxlbmRyb2lkXG5jb25zdCBOT19QUk9YWSA9IFtcbiAgWydHRVQnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvbG9nL3R5cGVzJCcpXSxcbiAgWydQT1NUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL2xvZycpXSxcbiAgWydQT1NUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL2xvY2F0aW9uJyldLFxuICBbJ1BPU1QnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvYXBwaXVtJyldLFxuICBbJ0dFVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9hcHBpdW0nKV0sXG4gIFsnUE9TVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9jb250ZXh0JyldLFxuICBbJ0dFVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9jb250ZXh0JyldLFxuICBbJ0dFVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9jb250ZXh0cycpXSxcbiAgWydQT1NUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL2VsZW1lbnQvW14vXSsvdmFsdWUnKV0sXG4gIFsnR0VUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL2VsZW1lbnQvW14vXSsvcmVjdCcpXSxcbiAgWydHRVQnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvbmV0d29ya19jb25uZWN0aW9uJyldLFxuICBbJ1BPU1QnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvbmV0d29ya19jb25uZWN0aW9uJyldLFxuICBbJ1BPU1QnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvaW1lJyldLFxuICBbJ0dFVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9pbWUnKV0sXG4gIFsnUE9TVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9rZXlzJyldLFxuICBbJ1BPU1QnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvdG91Y2gvbXVsdGkvcGVyZm9ybScpXSxcbl07XG5cbmNvbnN0IEFQUF9FWFRFTlNJT04gPSAnLmFwayc7XG5cblxuY2xhc3MgU2VsZW5kcm9pZERyaXZlciBleHRlbmRzIEJhc2VEcml2ZXIge1xuICBjb25zdHJ1Y3RvciAob3B0cyA9IHt9LCBzaG91bGRWYWxpZGF0ZUNhcHMgPSB0cnVlKSB7XG4gICAgLy8gYHNoZWxsYCBvdmVyd3JpdGVzIGFkYi5zaGVsbCwgc28gcmVtb3ZlXG4gICAgZGVsZXRlIG9wdHMuc2hlbGw7XG5cbiAgICBzdXBlcihvcHRzLCBzaG91bGRWYWxpZGF0ZUNhcHMpO1xuXG4gICAgdGhpcy5kZXNpcmVkQ2FwQ29uc3RyYWludHMgPSBkZXNpcmVkQ2FwQ29uc3RyYWludHM7XG4gICAgdGhpcy5zZWxlbmRyb2lkID0gbnVsbDtcbiAgICB0aGlzLmp3cFByb3h5QWN0aXZlID0gZmFsc2U7XG4gICAgdGhpcy5kZWZhdWx0SU1FID0gbnVsbDtcbiAgICB0aGlzLmp3cFByb3h5QXZvaWQgPSBOT19QUk9YWTtcbiAgICB0aGlzLmFwa1N0cmluZ3MgPSB7fTsgLy8gbWFwIG9mIGxhbmd1YWdlIC0+IHN0cmluZ3Mgb2JqXG5cbiAgICAvLyBoYW5kbGUgd2VidmlldyBtZWNoYW5pY3MgZnJvbSBBbmRyb2lkRHJpdmVyXG4gICAgdGhpcy5jaHJvbWVkcml2ZXIgPSBudWxsO1xuICAgIHRoaXMuc2Vzc2lvbkNocm9tZWRyaXZlcnMgPSB7fTtcblxuICAgIHRoaXMub3B0cy5zeXN0ZW1Qb3J0ID0gb3B0cy5zZWxlbmRyb2lkUG9ydCB8fCBTWVNURU1fUE9SVF9SQU5HRVswXTtcbiAgICB0aGlzLm9wdHMuYWRiUG9ydCA9IG9wdHMuYWRiUG9ydCB8fCBERUZBVUxUX0FEQl9QT1JUO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlU2Vzc2lvbiAoY2Fwcykge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIShhd2FpdCBzZXJ2ZXJFeGlzdHMoKSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc3RhcnQgYSBzZWxlbmRyb2lkIHNlc3Npb24gYmVjYXVzZSB0aGUgc2VydmVyICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2FwayBkb2VzIG5vdCBleGlzdC4gUGxlYXNlIHJ1biBgbnBtIHJ1bi1zY3JpcHQgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnc2VsZW5kcm9pZGAgaW4gdGhlIGFwcGl1bS1zZWxlbmRyb2lkLWRyaXZlciBwYWNrYWdlJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFRPRE8gaGFuZGxlIG90aGVyU2Vzc2lvbkRhdGEgZm9yIG11bHRpcGxlIHNlc3Npb25zXG4gICAgICBsZXQgc2Vzc2lvbklkO1xuICAgICAgW3Nlc3Npb25JZF0gPSBhd2FpdCBzdXBlci5jcmVhdGVTZXNzaW9uKGNhcHMpO1xuICAgICAgdGhpcy5jdXJDb250ZXh0ID0gdGhpcy5kZWZhdWx0Q29udGV4dE5hbWUoKTtcbiAgICAgIC8vIGZhaWwgdmVyeSBlYXJseSBpZiB0aGUgYXBwIGRvZXNuJ3QgYWN0dWFsbHkgZXhpc3QsIHNpbmNlIHNlbGVuZHJvaWRcbiAgICAgIC8vICh1bmxpa2UgdGhlIGFuZHJvaWQgZHJpdmVyKSBjYW4ndCBydW4gYSBwcmUtaW5zdGFsbGVkIGFwcCBiYXNlZFxuICAgICAgLy8gb25seSBvbiBwYWNrYWdlIG5hbWUuIEl0IGhhcyB0byBiZSBhbiBhY3R1YWwgYXBrXG4gICAgICB0aGlzLm9wdHMuYXBwID0gYXdhaXQgdGhpcy5oZWxwZXJzLmNvbmZpZ3VyZUFwcCh0aGlzLm9wdHMuYXBwLCBBUFBfRVhURU5TSU9OKTtcbiAgICAgIGF3YWl0IHRoaXMuY2hlY2tBcHBQcmVzZW50KCk7XG4gICAgICB0aGlzLm9wdHMuc3lzdGVtUG9ydCA9IHRoaXMub3B0cy5zZWxlbmRyb2lkUG9ydCB8fCBTWVNURU1fUE9SVF9SQU5HRVswXTtcbiAgICAgIHRoaXMub3B0cy5hZGJQb3J0ID0gdGhpcy5vcHRzLmFkYlBvcnQgfHwgREVGQVVMVF9BREJfUE9SVDtcbiAgICAgIGF3YWl0IHRoaXMuc3RhcnRTZWxlbmRyb2lkU2Vzc2lvbigpO1xuICAgICAgcmV0dXJuIFtzZXNzaW9uSWQsIGNhcHNdO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuZGVsZXRlU2Vzc2lvbigpO1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gIH1cblxuICB2YWxpZGF0ZURlc2lyZWRDYXBzIChjYXBzKSB7XG4gICAgLy8gY2hlY2sgd2l0aCB0aGUgYmFzZSBjbGFzcywgYW5kIHJldHVybiBpZiBpdCBmYWlsc1xuICAgIGxldCByZXMgPSBzdXBlci52YWxpZGF0ZURlc2lyZWRDYXBzKGNhcHMpO1xuICAgIGlmICghcmVzKSByZXR1cm4gcmVzOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICBpZiAodGhpcy5vcHRzLnJlYm9vdCkge1xuICAgICAgdGhpcy5zZXRBdmRGcm9tQ2FwYWJpbGl0aWVzKGNhcHMpO1xuICAgIH1cbiAgfVxuXG4gIHNldEF2ZEZyb21DYXBhYmlsaXRpZXMgKGNhcHMpIHtcbiAgICBpZiAodGhpcy5vcHRzLmF2ZCkge1xuICAgICAgbG9nZ2VyLmluZm8oJ2F2ZCBuYW1lIGRlZmluZWQsIGlnbm9yaW5nIGRldmljZSBuYW1lIGFuZCBwbGF0Zm9ybSB2ZXJzaW9uJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghY2Fwcy5kZXZpY2VOYW1lKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdhdmQgb3IgZGV2aWNlTmFtZSBzaG91bGQgYmUgc3BlY2lmaWVkIHdoZW4gcmVib290IG9wdGlvbiBpcyBlbmFibGVkJyk7XG4gICAgICB9XG4gICAgICBpZiAoIWNhcHMucGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdhdmQgb3IgcGxhdGZvcm1WZXJzaW9uIHNob3VsZCBiZSBzcGVjaWZpZWQgd2hlbiByZWJvb3Qgb3B0aW9uIGlzIGVuYWJsZWQnKTtcbiAgICAgIH1cbiAgICAgIGxldCBhdmREZXZpY2UgPSBjYXBzLmRldmljZU5hbWUucmVwbGFjZSgvW15hLXpBLVowLTlfLl0vZywgXCItXCIpO1xuICAgICAgdGhpcy5vcHRzLmF2ZCA9IGAke2F2ZERldmljZX1fXyR7Y2Fwcy5wbGF0Zm9ybVZlcnNpb259YDtcbiAgICB9XG4gIH1cblxuICBnZXQgZHJpdmVyRGF0YSAoKSB7XG4gICAgLy8gVE9ETyBmaWxsZSBvdXQgcmVzb3VyY2UgaW5mbyBoZXJlXG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgaXNFbXVsYXRvciAoKSB7XG4gICAgcmV0dXJuICEhdGhpcy5vcHRzLmF2ZDtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0U2VsZW5kcm9pZFNlc3Npb24gKCkge1xuICAgIGlmICghdGhpcy5vcHRzLmphdmFWZXJzaW9uKSB7XG4gICAgICB0aGlzLm9wdHMuamF2YVZlcnNpb24gPSBhd2FpdCBoZWxwZXJzLmdldEphdmFWZXJzaW9uKCk7XG4gICAgfVxuXG4gICAgLy8gZ2V0IGRldmljZSB1ZGlkIGZvciB0aGlzIHNlc3Npb25cbiAgICBsZXQge3VkaWQsIGVtUG9ydH0gPSBhd2FpdCBoZWxwZXJzLmdldERldmljZUluZm9Gcm9tQ2Fwcyh0aGlzLm9wdHMpO1xuICAgIHRoaXMub3B0cy51ZGlkID0gdWRpZDtcbiAgICB0aGlzLm9wdHMuZW1Qb3J0ID0gZW1Qb3J0O1xuXG4gICAgLy8gbm93IHRoYXQgd2Uga25vdyBvdXIgamF2YSB2ZXJzaW9uIGFuZCBkZXZpY2UgaW5mbywgd2UgY2FuIGNyZWF0ZSBvdXJcbiAgICAvLyBBREIgaW5zdGFuY2VcbiAgICB0aGlzLmFkYiA9IGF3YWl0IGFuZHJvaWRIZWxwZXJzLmNyZWF0ZUFEQih0aGlzLm9wdHMpO1xuICAgIC8vIGZhaWwgdmVyeSBlYXJseSBpZiB0aGUgdXNlcidzIGFwcCBkb2Vzbid0IGhhdmUgdGhlIGFwcHJvcHJpYXRlIHBlcm1zXG4gICAgLy8gZm9yIHNlbGVuZHJvaWQgYXV0b21hdGlvblxuICAgIGF3YWl0IGhlbHBlcnMuZW5zdXJlSW50ZXJuZXRQZXJtaXNzaW9uRm9yQXBwKHRoaXMuYWRiLCB0aGlzLm9wdHMuYXBwKTtcbiAgICAvLyBnZXQgYXBwUGFja2FnZSBldCBhbCBmcm9tIG1hbmlmZXN0IGlmIG5lY2Vzc2FyeVxuICAgIGxldCBhcHBJbmZvID0gYXdhaXQgaGVscGVycy5nZXRMYXVuY2hJbmZvKHRoaXMuYWRiLCB0aGlzLm9wdHMpO1xuICAgIC8vIGFuZCBnZXQgaXQgb250byBvdXIgJ29wdHMnIG9iamVjdCBzbyB3ZSB1c2UgaXQgZnJvbSBub3cgb25cbiAgICBPYmplY3QuYXNzaWduKHRoaXMub3B0cywgYXBwSW5mbyk7XG4gICAgLy8gc2V0IHVwIHRoZSBtb2RpZmllZCBzZWxlbmRyb2lkIHNlcnZlciBldGNcbiAgICBhd2FpdCB0aGlzLmluaXRTZWxlbmRyb2lkU2VydmVyKCk7XG4gICAgLy8gc3RhcnQgYW4gYXZkLCBzZXQgdGhlIGxhbmd1YWdlL2xvY2FsZSwgcGljayBhbiBlbXVsYXRvciwgZXRjLi4uXG4gICAgLy8gVE9ETyB3aXRoIG11bHRpcGxlIGRldmljZXMgd2UnbGwgbmVlZCB0byBwYXJhbWV0ZXJpemUgdGhpc1xuICAgIGF3YWl0IGhlbHBlcnMuaW5pdERldmljZSh0aGlzLmFkYiwgdGhpcy5vcHRzKTtcbiAgICAvLyBGdXJ0aGVyIHByZXBhcmUgdGhlIGRldmljZSBieSBmb3J3YXJkaW5nIHRoZSBTZWxlbmRyb2lkIHBvcnRcbiAgICBhd2FpdCB0aGlzLmFkYi5mb3J3YXJkUG9ydCh0aGlzLm9wdHMuc3lzdGVtUG9ydCwgREVWSUNFX1BPUlQpO1xuICAgIC8vIHByZXBhcmUgb3VyIGFjdHVhbCBBVVQsIGdldCBpdCBvbiB0aGUgZGV2aWNlLCBldGMuLi5cbiAgICBhd2FpdCB0aGlzLmluaXRBVVQoKTtcbiAgICAvLyB1bmxvY2sgdGhlIGRldmljZSB0byBwcmVwYXJlIGl0IGZvciB0ZXN0aW5nXG4gICAgYXdhaXQgaGVscGVycy51bmxvY2sodGhpcywgdGhpcy5hZGIsIHRoaXMuY2Fwcyk7XG4gICAgLy8gbGF1bmNoIHNlbGVuZHJvaWQgYW5kIHdhaXQgdGlsbCBpdHMgb25saW5lIGFuZCB3ZSBoYXZlIGEgc2Vzc2lvblxuICAgIGF3YWl0IHRoaXMuc2VsZW5kcm9pZC5zdGFydFNlc3Npb24odGhpcy5jYXBzKTtcbiAgICAvLyByZXNjdWUgc2VsZW5kcm9pZCBpZiBpdCBmYWlscyB0byBzdGFydCBvdXIgQVVUXG4gICAgYXdhaXQgdGhpcy5lbnN1cmVBcHBTdGFydHMoKTtcbiAgICAvLyBpZiB3ZSB3YW50IHRvIGltbWVkaWF0ZWx5IGdldCBpbnRvIGEgd2Vidmlldywgc2V0IG91ciBjb250ZXh0XG4gICAgLy8gYXBwcm9wcmlhdGVseVxuICAgIGlmICh0aGlzLm9wdHMuYXV0b1dlYnZpZXcpIHtcbiAgICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoMjAsIHRoaXMub3B0cy5hdXRvV2Vidmlld1RpbWVvdXQgfHwgMjAwMCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLnNldENvbnRleHQodGhpcy5kZWZhdWx0V2Vidmlld05hbWUoKSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gbm93IHRoYXQgZXZlcnl0aGluZyBoYXMgc3RhcnRlZCBzdWNjZXNzZnVsbHksIHR1cm4gb24gcHJveHlpbmcgc28gYWxsXG4gICAgLy8gc3Vic2VxdWVudCBzZXNzaW9uIHJlcXVlc3RzIGdvIHN0cmFpZ2h0IHRvL2Zyb20gc2VsZW5kcm9pZFxuICAgIHRoaXMuandwUHJveHlBY3RpdmUgPSB0cnVlO1xuICB9XG5cbiAgYXN5bmMgaW5pdFNlbGVuZHJvaWRTZXJ2ZXIgKCkge1xuICAgIC8vIG5vdyB0aGF0IHdlIGhhdmUgcGFja2FnZSBhbmQgYWN0aXZpdHksIHdlIGNhbiBjcmVhdGUgYW4gaW5zdGFuY2Ugb2ZcbiAgICAvLyBzZWxlbmRyb2lkIHdpdGggdGhlIGFwcHJvcHJpYXRlIGRhdGFcbiAgICB0aGlzLnNlbGVuZHJvaWQgPSBuZXcgU2VsZW5kcm9pZFNlcnZlcih7XG4gICAgICBob3N0OiB0aGlzLm9wdHMuaG9zdCB8fCAnbG9jYWxob3N0JyxcbiAgICAgIHN5c3RlbVBvcnQ6IHRoaXMub3B0cy5zeXN0ZW1Qb3J0LFxuICAgICAgZGV2aWNlUG9ydDogREVWSUNFX1BPUlQsXG4gICAgICBhZGI6IHRoaXMuYWRiLFxuICAgICAgYXBrOiB0aGlzLm9wdHMuYXBwLFxuICAgICAgdG1wRGlyOiB0aGlzLm9wdHMudG1wRGlyLFxuICAgICAgYXBwUGFja2FnZTogdGhpcy5vcHRzLmFwcFBhY2thZ2UsXG4gICAgICBhcHBBY3Rpdml0eTogdGhpcy5vcHRzLmFwcEFjdGl2aXR5LFxuICAgIH0pO1xuICAgIHRoaXMucHJveHlSZXFSZXMgPSB0aGlzLnNlbGVuZHJvaWQucHJveHlSZXFSZXMuYmluZCh0aGlzLnNlbGVuZHJvaWQpO1xuICAgIC8vIGxldCBzZWxlbmRyb2lkIHJlcGFja2FnZSBpdHNlbGYgZm9yIG91ciBBVVRcbiAgICBhd2FpdCB0aGlzLnNlbGVuZHJvaWQucHJlcGFyZU1vZGlmaWVkU2VydmVyKCk7XG4gIH1cblxuICBhc3luYyBpbml0QVVUICgpIHtcbiAgICBsb2dnZXIuZGVidWcoJ0luaXRpYWxpemluZyBhcHBsaWNhdGlvbiB1bmRlciB0ZXN0Jyk7XG4gICAgLy8gc2V0IHRoZSBsb2NhbGl6ZWQgc3RyaW5ncyBmb3IgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UgZnJvbSB0aGUgYXBrXG4gICAgLy8gVE9ETzogaW5jb3Jwb3JhdGUgY2hhbmdlcyBmcm9tIGFwcGl1bSM1MzA4IHdoaWNoIGZpeCBhIHJhY2UgY29uZC1cbiAgICAvLyBpdGlvbiBidWcgaW4gb2xkIGFwcGl1bSBhbmQgbmVlZCB0byBiZSByZXBsaWNhdGVkIGhlcmVcbiAgICB0aGlzLmFwa1N0cmluZ3NbdGhpcy5vcHRzLmxhbmd1YWdlXSA9IGF3YWl0IGhlbHBlcnMucHVzaFN0cmluZ3MoXG4gICAgICAgIHRoaXMub3B0cy5sYW5ndWFnZSwgdGhpcy5hZGIsIHRoaXMub3B0cyk7XG4gICAgaWYgKCF0aGlzLm9wdHMuc2tpcFVuaW5zdGFsbCkge1xuICAgICAgYXdhaXQgdGhpcy5hZGIudW5pbnN0YWxsQXBrKHRoaXMub3B0cy5hcHBQYWNrYWdlKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLm9wdHMubm9TaWduKSB7XG4gICAgICBsZXQgc2lnbmVkID0gYXdhaXQgdGhpcy5hZGIuY2hlY2tBcGtDZXJ0KHRoaXMub3B0cy5hcHAsIHRoaXMub3B0cy5hcHBQYWNrYWdlKTtcbiAgICAgIGlmICghc2lnbmVkKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbGljYXRpb24gbm90IHNpZ25lZC4gU2lnbmluZy4nKTtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGIuc2lnbih0aGlzLm9wdHMuYXBwLCB0aGlzLm9wdHMuYXBwUGFja2FnZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGF3YWl0IGhlbHBlcnMuaW5zdGFsbEFwayh0aGlzLmFkYiwgdGhpcy5vcHRzKTtcbiAgICAvLyBnZXQgU2VsZW5kcm9pZCBvbiB0aGUgZGV2aWNlIHRvb1xuICAgIGF3YWl0IHRoaXMuc2VsZW5kcm9pZC5pbnN0YWxsTW9kaWZpZWRTZXJ2ZXIoKTtcbiAgfVxuXG4gIGFzeW5jIGVuc3VyZUFwcFN0YXJ0cyAoKSB7XG4gICAgLy8gbWFrZSBzdXJlIHdlIGhhdmUgYW4gYWN0aXZpdHkgYW5kIHBhY2thZ2UgdG8gd2FpdCBmb3JcbiAgICBsZXQgYXBwV2FpdFBhY2thZ2UgPSB0aGlzLm9wdHMuYXBwV2FpdFBhY2thZ2UgfHwgdGhpcy5vcHRzLmFwcFBhY2thZ2U7XG4gICAgbGV0IGFwcFdhaXRBY3Rpdml0eSA9IHRoaXMub3B0cy5hcHBXYWl0QWN0aXZpdHkgfHwgdGhpcy5vcHRzLmFwcEFjdGl2aXR5O1xuICAgIHRyeSB7XG4gICAgICAvLyB3YWl0IGZvciB1cCB0byA1cyBmb3Igc2VsZW5kcm9pZCB0byBoYXZlIHN0YXJ0ZWQgdGhlIGFwcCBhZnRlciBpdCBpc1xuICAgICAgLy8gb25saW5lXG4gICAgICBhd2FpdCB0aGlzLmFkYi53YWl0Rm9yQWN0aXZpdHkoYXBwV2FpdFBhY2thZ2UsIGFwcFdhaXRBY3Rpdml0eSwgNTAwMCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nZ2VyLmluZm8oYFNlbGVuZHJvaWQgZGlkIG5vdCBzdGFydCB0aGUgYWN0aXZpdHkgd2Ugd2VyZSB3YWl0aW5nIGZvciwgYCArXG4gICAgICAgICAgICAgICAgICBgJyR7YXBwV2FpdFBhY2thZ2V9LyR7YXBwV2FpdEFjdGl2aXR5fScuIGAgK1xuICAgICAgICAgICAgICAgICAgYFN0YXJ0aW5nIGl0IG91cnNlbHZlc2ApO1xuICAgICAgYXdhaXQgdGhpcy5hZGIuc3RhcnRBcHAoe1xuICAgICAgICBwa2c6IHRoaXMub3B0cy5hcHBQYWNrYWdlLFxuICAgICAgICBhY3Rpdml0eTogdGhpcy5vcHRzLmFwcEFjdGl2aXR5LFxuICAgICAgICBhY3Rpb246IHRoaXMub3B0cy5pbnRlbnRBY3Rpb24sXG4gICAgICAgIGNhdGVnb3J5OiB0aGlzLm9wdHMuaW50ZW50Q2F0ZWdvcnksXG4gICAgICAgIGZsYWdzOiB0aGlzLm9wdHMuaW50ZW50RmxhZ3MsXG4gICAgICAgIHdhaXRQa2c6IHRoaXMub3B0cy5hcHBXYWl0UGFja2FnZSxcbiAgICAgICAgd2FpdEFjdGl2aXR5OiB0aGlzLm9wdHMuYXBwV2FpdEFjdGl2aXR5LFxuICAgICAgICBvcHRpb25hbEludGVudEFyZ3VtZW50czogdGhpcy5vcHRzLm9wdGlvbmFsSW50ZW50QXJndW1lbnRzLFxuICAgICAgICBzdG9wQXBwOiAhdGhpcy5vcHRzLmRvbnRTdG9wQXBwT25SZXNldCxcbiAgICAgICAgcmV0cnk6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBkZWxldGVTZXNzaW9uICgpIHtcbiAgICBsb2dnZXIuZGVidWcoJ0RlbGV0aW5nIFNlbGVuZHJvaWQgc2Vzc2lvbicpO1xuICAgIGlmICh0aGlzLnNlbGVuZHJvaWQpIHtcbiAgICAgIGlmICh0aGlzLmp3cFByb3h5QWN0aXZlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2VsZW5kcm9pZC5kZWxldGVTZXNzaW9uKCk7XG4gICAgICB9XG4gICAgICB0aGlzLnNlbGVuZHJvaWQgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLmp3cFByb3h5QWN0aXZlID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5hZGIpIHtcbiAgICAgIGlmICh0aGlzLm9wdHMudW5pY29kZUtleWJvYXJkICYmIHRoaXMub3B0cy5yZXNldEtleWJvYXJkICYmXG4gICAgICAgICAgdGhpcy5kZWZhdWx0SU1FKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgUmVzZXR0aW5nIElNRSB0byAnJHt0aGlzLmRlZmF1bHRJTUV9J2ApO1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5zZXRJTUUodGhpcy5kZWZhdWx0SU1FKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMuYWRiLmZvcmNlU3RvcCh0aGlzLm9wdHMuYXBwUGFja2FnZSk7XG4gICAgICBhd2FpdCB0aGlzLmFkYi5zdG9wTG9nY2F0KCk7XG4gICAgICBpZiAodGhpcy5vcHRzLnJlYm9vdCkge1xuICAgICAgICBsZXQgYXZkTmFtZSA9IHRoaXMub3B0cy5hdmQucmVwbGFjZSgnQCcsICcnKTtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBjbG9zaW5nIGVtdWxhdG9yICcke2F2ZE5hbWV9J2ApO1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5raWxsRW11bGF0b3IoYXZkTmFtZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGF3YWl0IHN1cGVyLmRlbGV0ZVNlc3Npb24oKTtcbiAgfVxuXG4gIGFzeW5jIGNoZWNrQXBwUHJlc2VudCAoKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdDaGVja2luZyB3aGV0aGVyIGFwcCBpcyBhY3R1YWxseSBwcmVzZW50Jyk7XG4gICAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKHRoaXMub3B0cy5hcHApKSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBmaW5kIGFwcCBhcGsgYXQgJyR7dGhpcy5vcHRzLmFwcH0nYCk7XG4gICAgfVxuICB9XG5cbiAgZGVmYXVsdFdlYnZpZXdOYW1lICgpIHtcbiAgICByZXR1cm4gYCR7V0VCVklFV19CQVNFfTBgO1xuICB9XG5cbiAgcHJveHlBY3RpdmUgKHNlc3Npb25JZCkge1xuICAgIHN1cGVyLnByb3h5QWN0aXZlKHNlc3Npb25JZCk7XG5cbiAgICAvLyB3ZSBhbHdheXMgaGF2ZSBhbiBhY3RpdmUgcHJveHkgdG8gdGhlIHNlbGVuZHJvaWQgc2VydmVyXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBnZXRQcm94eUF2b2lkTGlzdCAoc2Vzc2lvbklkKSB7XG4gICAgc3VwZXIuZ2V0UHJveHlBdm9pZExpc3Qoc2Vzc2lvbklkKTtcblxuICAgIHJldHVybiB0aGlzLmp3cFByb3h5QXZvaWQ7XG4gIH1cblxuICBjYW5Qcm94eSAoc2Vzc2lvbklkKSB7XG4gICAgc3VwZXIuY2FuUHJveHkoc2Vzc2lvbklkKTtcblxuICAgIC8vIHdlIGNhbiBhbHdheXMgcHJveHkgdG8gdGhlIHNlbGVuZHJvaWQgc2VydmVyXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn1cblxuLy8gZmlyc3QgYWRkIHRoZSBhbmRyb2lkLWRyaXZlciBjb21tYW5kcyB3aGljaCB3ZSB3aWxsIGZhbGwgYmFjayB0b1xuZm9yIChsZXQgW2NtZCwgZm5dIG9mIF8udG9QYWlycyhhbmRyb2lkQ29tbWFuZHMpKSB7XG4gIC8vIHdlIGRvIHNvbWUgZGlmZmVyZW50L3NwZWNpYWwgdGhpbmdzIHdpdGggdGhlc2UgbWV0aG9kc1xuICBpZiAoIV8uaW5jbHVkZXMoWydkZWZhdWx0V2Vidmlld05hbWUnXSwgY21kKSkge1xuICAgIFNlbGVuZHJvaWREcml2ZXIucHJvdG90eXBlW2NtZF0gPSBmbjtcbiAgfVxufVxuXG4vLyB0aGVuIG92ZXJ3cml0ZSB3aXRoIGFueSBzZWxlbmRyb2lkLXNwZWNpZmljIGNvbW1hbmRzXG5mb3IgKGxldCBbY21kLCBmbl0gb2YgXy50b1BhaXJzKGNvbW1hbmRzKSkge1xuICBTZWxlbmRyb2lkRHJpdmVyLnByb3RvdHlwZVtjbWRdID0gZm47XG59XG5cbmV4cG9ydCB7IFNlbGVuZHJvaWREcml2ZXIsIERFVklDRV9QT1JUIH07XG5leHBvcnQgZGVmYXVsdCBTZWxlbmRyb2lkRHJpdmVyO1xuIl0sImZpbGUiOiJsaWIvZHJpdmVyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
